---
source_image: docs_tutorials-evolution_list_topics_container-apps__deploy-django-photo-app.jpg
page_number: 0
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 147.03
tokens: 19649
characters: 10653
timestamp: 2025-12-24T05:32:11.000187
finish_reason: stop
---

### Создание django-приложения для раздачи фотографий

Эта статья полезна?

С помощью этого руководства вы научитесь сохранять данные проекта, размещённого в Container Apps, с помощью Object Storage. Вы будете использовать репозиторий GitVerse с исходным кодом. На примере этих приложений вы научитесь создавать сервис Container Apps без потери данных, когда трафик падает до нуля.

Вы будете использовать следующие сервисы:
• Artifact Registry — для хранения, совместного использования и управления Docker-образами и Helm-чартами.
• Container Apps — сервис для запуска контейнерных приложений в облаке. Не требует знания Kubernetes и создания виртуальных машин.
• Object Storage — объёмное S3-хранилище с бесплатным хранением файлов, объёмом до 15 ГБ.

Шаги:
1. Подготовьте среду.
2. Клонируйте или скачайте репозиторий кода с GitVerse.
3. Соберите образ с django-приложением и присвойте тег.
4. Загрузите Docker-образ с django-приложением в реестр.
5. Соберите образ с nginx-сервисом и присвойте тег.
6. Загрузите Docker-образ с nginx-сервером в реестр.
7. Создайте бакеты для базы данных и хранения медиафайлов.
8. Создайте первую ревизию контейнера с django-приложением.
9. Проверьте работоспособность развернутого django-приложения.
10. Создайте и запустите контейнер с nginx-сервисом.

Перед началом работы
Зарегистрируйтесь в личном кабинете Cloud.ru.
Если вы уже зарегистрированы, войдите под своей учетной записью.

1. Подготовьте среду
Подготовьте среду, если не сделали этого ранее.

2. Клонируйте или скачайте репозиторий с GitVerse
Вы можете зарегистрироваться в GitVerse, если у вас еще нет аккаунта, и познакомиться с новой системой контроля версий. Этот шаг необходим и не влияет на дальнейшее прохождение сценария.

В этом репозитории находится исходный код django-приложения, написанного на Python, а также nginx-сервис для публикации фотографий.

git clone https://gitverse.ru/crcloudru/evo-container-apps-django-app

3. Соберите образ с django-приложением и присвойте тег
Внимание
Убедитесь, что Docker Desktop запущен и пользователь авторизован в приложении.
Используйте реестр, созданный на этапе подготовки среды.

1. Перейдите в подкаталог с django-приложением.
cd django_app

2. Выполните команду сборки образа:
docker build . \
--tag django-app-cr.cloud.ru/manage-photos-django-app \
--platform linux/amd64 \
--provenance false

Для создания контейнера Docker-образ должен быть собран под платформу Linux/amd64, поэтому в команде используется флаг platform со значением linux/amd64.

4. Загрузите Docker-образ с django-приложением в реестр
Загрузите образ в реестр Artifact Registry, выполнив команду:
docker push <registry_name>.cr.cloud.ru/manage-photos-django-app

Где:
• <registry_name> — название реестра, которое вы указывали при его создании в Artifact Registry.
• manage-photos-django-app — название будущего репозитория в Artifact Registry. Название репозитория соответствует имени Docker-образа.

5. Соберите образ с nginx-сервисом и присвойте тег
Внимание
Убедитесь, что Docker Desktop запущен и пользователь авторизован в приложении.
Используйте реестр, созданный на этапе подготовки среды.

1. В исходном коде приложения в файле nginx.conf убедитесь, что в качестве каталога для хранения файлов указан /files/media/.
2. Перейдите в подкаталог с nginx-сервисом.
cd nginx_share_media_files

3. Выполните команду сборки образа:
docker build . \
--tag django-app-cr.cloud.ru/nginx-service \
--platform linux/amd64 \
--provenance false

Для создания контейнера Docker-образ должен быть собран под платформу Linux/amd64, поэтому в команде используется флаг platform со значением linux/amd64.

6. Загрузите Docker-образ с nginx-сервисом в реестр
Загрузите образ в реестр Artifact Registry, выполнив команду:
docker push <registry_name>.cr.cloud.ru/manage-photos-nginx

Где:
• <registry_name> — название реестра, которое вы указывали при его создании в Artifact Registry.
• manage-photos-nginx — название будущего репозитория в Artifact Registry. Название репозитория соответствует имени Docker-образа.

7. Создайте бакеты в Object Storage
В сервисе Объект Storage создайте бакет для базы данных и бакет для хранения медиаданных.

Общие параметры

Название
manage-photos-database

Доменное имя
Опционально

Максимальный объём бакета
Опционально

Логирование
Опционально

Настройки
Класс хранения по умолчанию
Стандартный

Максимальный объём бакета
Опционально

Логирование
Опционально

Бакет для базы данных SQLite:
Внимание
SQLite не поддерживает одновременную многопоточную запись, особенно при размещении файла базы в Object Storage. Этот пример предназначен исключительно для демонстрационных целей и быстрого запуска приложения.
Для production-среды настоятельно рекомендуется использовать полноценную СУБД, например PostgreSQL — она обеспечит надежность, масштабируемость и поддержку конкурентного доступа.
• Название — <your_name>, например django-app-media-data .
• Доменное имя — не задано.
• Класс хранения по умолчанию — Стандартный .
• Максимальный размер — отключите или укажите на свое усмотрение.
• Этот бакет предназначен для хранения загруженных фотографий. Он будет примонтирован в приложение по пути /files/database .

Бакет для хранения медиаданных:
• Название — <your_name>, например django-app-media-db .
• Доменное имя — не задано.
• Класс хранения по умолчанию — Стандартный .
• Максимальный размер — отключите или укажите на свое усмотрение.
• Этот бакет предназначен для хранения загруженных фотографий. Он будет примонтирован в приложение по пути /files/media .

Убедитесь, что в личном кабинете на странице сервиса Object Storage:
• в списке бакетов отображаются созданные вами бакеты;
• класс хранения созданных бакетов — Стандартный.

8. Создайте и запустите контейнер с django-приложением
1. Откройте меню загруженного образа django-app и нажмите Создать Container App.

2. Заполните поля и активируйте опции:

Создание Container App
django-app.cr.cloud.ru/ma...9bc3cea181bca219d3dd93521
Название контейнера
container-app-django-app
Порт контейнера
8000
vCPU и RAM
0.2 vCPU - 512 MB
Мин. кол-во экземпляров
0
Макс. кол-во экземпляров
1
Публичный адрес
container-app-django-app.containerapps.ru
Автоматическое развертывание
Отмена Создать

• Название контейнера — глобально уникальное имя, на базе которого формируется адрес вашего приложения в домене *.containerapps.ru.
• Порт контейнера — порт контейнера, который должен совпадать с портом вашего приложения. В этом сценарии используем порт 8000.
• vCPU/RAM — количество vCPU и RAM, которые выделяются для каждого экземпляра контейнера при старте вашего приложения. Установите минимальное количество экземпляров — 0, а максимальное — 1.
• Публичный адрес — активируйте опцию, чтобы получить URL-адрес для вызова приложения из интернета.
• Автоматическое развертывание — активируйте опцию, чтобы каждый раз после загрузки в Artifact Registry новой версии образа на стороне Container Apps автоматически создавалась новая ревизия контейнера.

3. Нажмите Создать.
Контейнер будет создан в течение нескольких секунд. Отобразится интерфейс Container Apps с информацией о созданном контейнере.
4. Нажмите Создать ревизию на основе выбранной.
5. Добавьте том — бакет в сервисе Object Storage для БД приложения:
a. В разделе Тома главного контейнера выберите Добавить том.
b. Укажите тип тома — постоянный.
c. Введите название тома, например django-app-db .
d. Выберите созданный на предыдущем этапе бакет для базы данных.
e. Нажмите Добавить.
f. В разделе Параметры монтирования в поле Путь укажите путь до папки с базой данных.
6. Добавьте том — бакет в сервисе Object Storage для хранения медиаданных:
a. В разделе Тома главного контейнера выберите Добавить том.
b. Укажите тип тома — постоянный.
c. Введите название тома, например django-media .
d. Выберите созданный на предыдущем этапе бакет для медиаданных.
e. Нажмите Добавить.
f. В разделе Параметры монтирования в поле Путь укажите путь до папки с медиаданными /files/media .

Общие параметры Переменные Health-пробы Тома
Ключ Значение
MEDIA_ROOT /files/media
DB_DIR /files/database
ADMIN_USERNAME admin
ADMIN_PASSWORD ****

8. Нажмите Создать.
Откроется страница сервиса Container Apps. Контейнер будет запущен в течение нескольких секунд.
Дождитесь, когда контейнер и ревизия перейдут в статус «Выполняется».

container-app-django-app Выполняется
Публичный URL: https://container-app-django-app.containerapps.ru

9. Проверьте работоспособность развернутого django-приложения
1. Перейдите по публичному URL-адресу контейнера с django-приложением:

Отобразится окно входа в панель администратора.
2. Укажите логин и пароль. Отобразится каталог с изображениями.

Site administration
Authentication and Authorization
Groups
Users
Files
Photos

3. Попробуйте загрузить изображение.

Даже если страница закрыта и приложение не используется, загруженные в базу данных изображения сохраняются.
Что делать, если приложение не отвечает

10. Создайте и запустите контейнер с nginx-сервисом
1. Перейдите в сервис Container Apps через меню в левом верхнем углу экрана.

2. Выберите Container Services и нажмите Создать.
3. Укажите название контейнера и активируйте опцию Привилегированный режим, чтобы обеспечить доступ nginx-сервиса к root-пользователю.

Создание Container App и первой ревизии
Контейнеры Настройки масштабирования Дополнительные опции
Название Container App container-app-nginx-test
Тестовый образ
Привилегированный режим
Главный контейнер
main-container-bqslt-more
Общие параметры Переменные Health-пробы Тома
media
Тип Постоянный
Бакет из Object Storage django-app-media-data
Только чтение Выключено
Параметры монтирования
Путь (path) /files/media
Подпуть (subpath) /somedirectory
Опционально
Только чтение
8. Нажмите Следующий шаг.
9. Задайте количество ресурсов:
• Минимальное количество экземпляров: 0.
• Максимальное количество экземпляров: 1.
10. Нажмите Создать.
Откроется страница сервиса Container Apps. Контейнер будет запущен в течение нескольких секунд.
Дождитесь, когда контейнер и ревизия перейдут в статус «Выполняется».

11. Проверьте работоспособность развернутого nginx-сервиса
Перейдите по публичному URL-адресу контейнера с nginx-сервисом.
Отобразится каталог изображений, загруженных с помощью сервиса Django.
Что делать, если приложение не отвечает

Результат
Вы научились:
• создавать репозитории в существующих реестрах Artifact Registry;
• добавлять и запускать контейнер через меню в Artifact Registry;
• запрашивать приложение не поступают;
• разворачивать приложения, которые совместно используют один и тот же бакет Object Storage.
Смотрите обучающее видео по сервису Container Apps и узнайте о том, как сохранять данные в бакете при нулевом трафике.