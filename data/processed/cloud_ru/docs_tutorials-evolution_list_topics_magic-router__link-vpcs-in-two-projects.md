---
source_image: docs_tutorials-evolution_list_topics_magic-router__link-vpcs-in-two-projects.jpg
page_number: 0
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 148.28
tokens: 18056
characters: 10661
timestamp: 2025-12-24T05:50:26.889298
finish_reason: stop
---

### Связывание ресурсов разных VPC из разных проектов

С помощью этого руководства вы создадите связность между виртуальными машинами из разных VPC, принадлежащих разным проектам. Вы будете использовать соединения, маршруты и правила групп безопасности для связи ресурсов. Схема иллюстрирует результат по итогам выполнения шагов руководства:

![Схема связывания ресурсов разных VPC](https://cloud.ru/docs/images/vpc/magic-router-vpc-connection.png)

Вы будете использовать следующие сервисы:

• Виртуальные машины — сервис, в рамках которого предоставляется виртуальная машина.

• VPC — изолированная виртуальная сеть для создания безопасной инфраструктуры.

• Подсети — часть облачной сети, которая изолирована от других подобных сетей.

• Magic Router — сервис для управления сетевыми связями между ресурсами внутри облачной инфраструктуры.

• Группы безопасности — сервис для контроля трафика виртуальных машин.

Шаги:

1. Подготовьте среду.
2. Создайте соединение между VPC и Magic Router.
3. Создайте соединение Magic Link.
4. Настройте маршруты на Magic Router.
5. Настройте маршруты для VPC.
6. Настройте правила групп безопасности.
7. Проверьте сетевую связность.

Перед началом работы

1. Зарегистрируйтесь в личном кабинете Cloud.ru.
   Если вы уже зарегистрированы, войдите под своей учетной записью.
2. Создайте и загрузите SSH-ключ в облако.

1. Подготовьте среду

1. Создайте две VPC-сети:
   a. В проекте 1 VPC-1.
   b. В проекте 2 VPC-2.

2. Создайте три подсети — две в VPC-1 и одну в VPC-2:
   a. Подсеть subnet-1 в VPC-1 в зоне доступности ru.AZ-1:
      • Название: subnet-1.
      • VPC: VPC-1.
      • Зона доступности: ru.AZ-1.
      • Адрес: 10.1.1.0/24.
   b. Подсеть subnet-2 в VPC-1 в зоне доступности ru.AZ-2:
      • Название: subnet-2.
      • VPC: VPC-1.
      • Зона доступности: ru.AZ-2.
      • Адрес: 10.3.3.0/24.
   c. Подсеть subnet-3 в VPC-2 в зоне доступности ru.AZ-1:
      • Название: subnet-3.
      • VPC: VPC-2.
      • Зона доступности: ru.AZ-1.
      • Адрес: 10.2.2.0/24.

Убедитесь, что:
• В проекте 1 → Сеть → VPC для VPC-1 подсети subnet-1, subnet-2 отображаются в статусе «Создана».
• В проекте 2 → Сеть → VPC для VPC-2 подсеть subnet-3 отображается в статусе «Создана».

3. Создайте три VM — две в VPC-1 и одну в VPC-2:
   a. vm-1 в VPC-1 и подсети subnet-1:
      • Название: vm-1.
      • Зона доступности: ru.AZ-1.
      • Образ: Публичные → Ubuntu 22.04.
      • Гарантированная доля vCPU: 10%.
      • vCPU: 1.
      • RAM: 1.
      • VPC: VPC-1.
      • Под сеть: 10.1.1.0/24 (subnet-1).
      • Внутренний IP: Автоматически.
      • Группы безопасности: SSH-access_ru.AZ-1.
      • Метод аутентификации: Публичный ключ и пароль.
      • Публичный ключ: ваш SSH-ключ.
      • Пароль: ваш пароль.
      • Имя хоста: vm-1.
   b. vm-2 в VPC-1 и подсети subnet-2:
      • Название: vm-2.
      • Зона доступности: ru.AZ-2.
      • Образ: Публичные → Ubuntu 22.04.
      • Гарантированная доля vCPU: 10%.
      • vCPU: 1.
      • RAM: 1.
      • VPC: VPC-1.
      • Под сеть: 10.3.3.0/24 (subnet-2).
      • Внутренний IP: Автоматически.
      • Группы безопасности: SSH-access_ru.AZ-2.
      • Метод аутентификации: Публичный ключ и пароль.
      • Публичный ключ: ваш SSH-ключ.
      • Пароль: ваш пароль.
      • Имя хоста: vm-2.
   c. vm-3 в VPC-2 и подсети subnet-3:
      • Название: vm-3.
      • Зона доступности: ru.AZ-1.
      • Образ: Публичные → Ubuntu 22.04.
      • Гарантированная доля vCPU: 10%.
      • vCPU: 1.
      • RAM: 1.
      • VPC: VPC-2.
      • Под сеть: 10.2.2.0/24 (subnet-3).
      • Внутренний IP: Автоматически.
      • Группы безопасности: SSH-access_ru.AZ-1.
      • Метод аутентификации: Публичный ключ и пароль.
      • Публичный ключ: ваш SSH-ключ.
      • Пароль: ваш пароль.
      • Имя хоста: vm-3.

Убедитесь, что:
• В проекте 1 → Инфраструктура → Виртуальные машины виртуальные машины vm-1 и vm-2 отображаются в статусе «Запущена».
• В проекте 2 → Инфраструктура → Виртуальные машины виртуальная машина vm-3 отображается в статусе «Запущена»

2. Создайте соединения между VPC и Magic Router

Создайте Magic Router в каждом из проектов и создайте соединения между VPC и Magic Router.

1. В проекте 1 создайте соединение между VPC и Magic Router.
   • Выберите сервис Magic Router.
   • Нажмите Создать Magic Router.
   • В Типе соединения выберите VPC Evolution.
   • Выберите VPC-1.
   • Нажмите Создать.
   Убедитесь, что в проекте 1 → Сеть → Magic Router на странице Соединения отображается соединение VPC-1 в статусе «Активно».
2. В проекте 2 создайте соединение между VPC и Magic Router.
   • Выберите сервис Magic Router.
   • Нажмите Создать Magic Router.
   • В Типе соединения выберите VPC Evolution.
   • Выберите VPC-2.
   • Нажмите Создать.
   Убедитесь, что в проекте 2 → Сеть → Magic Router на странице Соединения соединение VPC-2 отображается в статусе «Активно».

3. Создайте соединение Magic Link

1. В проекте 2 → Сеть → Magic Router перейдите на вкладку Информация и скопируйте ID Magic Router.
2. В проекте 1 создайте Magic Link.
   • В проекте 1 выберите Сеть → Magic Router, перейдите на вкладку Соединения.
   • Нажмите Создать соединение.
   • В Типе соединения выберите Magic Link.
   • Название соединения: MagicLink-1.
   • В поле Magic Router ID укажите идентификатор Magic Router, который получили на шаге 1 инструкции.
   • Нажмите Добавить.
Соединение будет создано со статусом «Ожидает подтверждения». Дождитесь, когда в проекте 2 запрос на создание Magic Link будет одобрен.

Убедитесь, что в обоих проектах → Сеть → Magic Router на странице Соединения соединение MagicLink-1 отображается в статусе «Активно».

4. Настройте маршруты на Magic Router

Внимание
При создании маршрутов на Magic Router необходимо указывать зону доступности, в которой расположена целевая подсеть.

1. В проекте 1 настройте маршруты на Magic Router:
   a. В сервисе Magic Router создайте маршрут к подсети subnet-1:
      • Адрес назначения: 10.1.1.0/24.
      • VPC: VPC-1.
      • Зона доступности: ru.AZ-1.
   b. В сервисе Magic Router создайте маршрут к подсети subnet-2:
      • Адрес назначения: 10.3.3.0/24.
      • VPC: VPC-1.
      • Зона доступности: ru.AZ-2.
   c. В сервисе Magic Router создайте маршрут к подсети subnet-3:
      • Адрес назначения: 10.2.2.0/24.
      • VPC: Magic Link.
      • Зона доступности: ru.AZ-1.

Убедитесь, что в проекте 1 → Сеть → Magic Router на странице Маршруты три маршрута отображаются в статусе «Создан».

2. В проекте 2 настройте маршруты на Magic Router:
   a. В сервисе Magic Router создайте маршрут к подсети subnet-1:
      • Адрес назначения: 10.1.1.0/24.
      • VPC: Magic Link.
      • Зона доступности: ru.AZ-1.
   b. В сервисе Magic Router создайте маршрут к подсети subnet-2:
      • Адрес назначения: 10.3.3.0/24.
      • VPC: Magic Link.
      • Зона доступности: ru.AZ-2.
   c. В сервисе Magic Router создайте маршрут к подсети subnet-3:
      • Адрес назначения: 10.2.2.0/24.
      • VPC: VPC-2.
      • Зона доступности: ru.AZ-1.

Убедитесь, что в проекте 2 → Сеть → Magic Router на странице Маршруты три маршрута отображаются в статусе «Создан».

Подсказка
Маршруты через Magic Link лучше создавать в зоне доступности, в которой находится подсеть назначения — подсеть проекта 2.
В большинстве случаев связность появится независимо от того, в какой зоне доступности создан маршрут. Но в таком случае возможна неоптимальная маршрутизация трафика.

5. Настройте маршруты для VPC

Внимание
При создании маршрутов в VPC необходимо указывать зону доступности, в которой расположена подсеть этой VPC. Если в VPC созданы подсети в нескольких зонах доступности, маршруты необходимо создать в каждой зоне доступности.

1. В проекте 1 настройте маршруты для Evolution VPC:
   a. В сервисе VPC выберите VPC-1.
   b. Создайте пользовательский маршрут с параметрами:
      • Адрес назначения: 10.2.2.0/24.
      • Next Hop Type: Magic Router.
      • Зона доступности: ru.AZ-1.
   c. Создайте еще один маршрут с параметрами:
      • Адрес назначения: 10.3.3.0/24.
      • Next Hop Type: Magic Router.
      • Зона доступности: ru.AZ-1.

Убедитесь, что в проекте 1 → Сеть → VPC на странице Маршруты для VPC-1 два маршрута отображаются в статусе «Активен».

2. В проекте 2 настройте маршруты для Evolution VPC:
   a. В сервисе VPC выберите VPC-2.
   b. Создайте пользовательский маршрут с параметрами:
      • Адрес назначения: 10.1.1.0/24.
      • Next Hop Type: Magic Router.
      • Зона доступности: ru.AZ-1.
   c. Создайте еще один маршрут с параметрами:
      • Адрес назначения: 10.3.3.0/24.
      • Next Hop Type: Magic Router.
      • Зона доступности: ru.AZ-1.

Убедитесь, что в проекте 2 → Сеть → VPC на странице Маршруты для VPC-2 два маршрута отображаются в статусе «Активен».

Подсказка
В VPC можно создать один агрегированный маршрут 10.0.0.0/8 вместо всех более специфических маршрутов. Это не повлияет на маршрутизацию трафика к локальным подсетям в данной VPC.

6. Настройте правила группы безопасности

1. В проекте 1 добавьте правила входящего трафика в группы безопасности SSH-access_ru.AZ-1 и SSH-access_ru.AZ-2:
   a. Выберите сервис Группы безопасности.
   b. Для группы безопасности SSH-access_ru.AZ-1 создайте правило для входящего трафика с параметрами:
      • Протокол: ICMP.
      • Тип источника: IP-адрес.
      • Источник: 0.0.0.0/0.
   c. Для группы безопасности SSH-access_ru.AZ-2 создайте правило для входящего трафика с параметрами:
      • Протокол: ICMP.
      • Тип источника: IP-адрес.
      • Источник: 0.0.0.0/0.

Убедитесь, что в проекте 1 → Сеть → Группы безопасности в группах безопасности SSH-access_ru.AZ-1 и SSH-access_ru.AZ-2 отображается созданное правило входящего трафика.

2. В проекте 2 добавьте правила входящего трафика в группу безопасности SSH-access_ru.AZ-1:
   a. Выберите сервис Группы безопасности.
   b. Для группы безопасности SSH-access_ru.AZ-1 создайте правило для входящего трафика с параметрами:
      • Протокол: ICMP.
      • Тип источника: IP-адрес.
      • Источник: 0.0.0.0/0.

Убедитесь, что в проекте 2 → Сеть → Группы безопасности в группе безопасности SSH-access_ru.AZ-1 и SSH-access_ru.AZ-2 отображается созданное правило входящего трафика.

7. Проверьте сетевую связность

1. Подключитесь к любой виртуальной машине через виртуальную консоль.
2. Чтобы проверить сетевую связность с оставшимися виртуальными машинами, выполните команду:

   ping <IP>

Где IP — IP-адрес виртуальной машины, с которой надо проверить сетевую связность.

Результат

Вы настроили связность между виртуальными машинами в разных VPC из разных проектов через Magic Link и получили опыт работы с соединениями, маршрутами и правилами групп безопасности.