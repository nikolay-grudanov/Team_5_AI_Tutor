---
source_image: docs_tutorials-evolution_list_topics_bare-metal__postgre_deploy.jpg
page_number: 0
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 47.01
tokens: 6251
characters: 3844
timestamp: 2025-12-24T04:39:08.838370
finish_reason: stop
---

### Развертывание PostgreSQL на сервере Bare Metal

С помощью этого руководства вы развернете СУБД PostgreSQL 15 на сервере Bare Metal с ОС Ubuntu 22.04.

Шаги:

1. Разверните инфраструктуру.
2. Установите и настройте PostgreSQL.
3. Оптимизируйте настройки PostgreSQL.
4. Оптимизируйте настройки файловой системы.

#### 1. Разверните инфраструктуру

1. Арендуйте сервер Bare Metal с публичным IP-адресом. Для корректной работы модели выбирайте конфигурации с объемом оперативной памяти более 32 ГБ.
2. Подключитесь к серверу по SSH или через виртуальную консоль.

#### 2. Установите и настройте PostgreSQL

1. Установите PostgreSQL:

```sh
sudo apt update
sudo apt install postgresql
```

2. Переключитесь на профиль администратора PostgreSQL:

```sh
sudo su - postgres
```

3. Создайте базу данных и пользователя для нее:

```sh
createdb test_database
createuser -P test_user
psql -c "GRANT ALL PRIVILEGES ON DATABASE test_database TO test_user;"
```

4. Переключитесь на основного пользователя:

```sh
exit
```

#### 3. Оптимизируйте настройки PostgreSQL

PostgreSQL по умолчанию содержит набор параметров для более тонкой настройки ее работы. Например, вы можете увеличить производительность СУБД.

1. Откройте файл с конфигурацией СУБД:

```sh
sudo nano /etc/postgresql/<postgresql_version>/main/postgresql.conf
```

2. Отредактируйте параметры в файле:

```sh
# 25% of shared_buffers
shared_buffers = 16GB
# 75% of RAM
effective_cache_size = 48GB
# 128MB-256 MB
work_mem = 256MB
#
maintenance_work_mem = 20m
# обычно достаточно 100-200
max_connections = 150
# для возможности репликации
wal_level = replica
# для максимизации производительности
synchronous_commit = off
# checkpoint_timeout = 30min
max_wal_size = 4GB
```

Где:
- `shared_buffers` — определяет производительность СУБД. Увеличьте его до 25% от доступной оперативной памяти. Например, если у вас 64 ГБ ОЗУ, установите значение около 16 ГБ.
- `effective_cache_size` — объем памяти, который резервируется под PostgreSQL в кэше ОС. Установите его на 50-75% от общей оперативной памяти.
- `work_mem` — объем памяти, выделяемый для сортировки и хеширования операций. Увеличьте его до 128–256 МБ.
- `maintenance_work_mem` — объем памяти для фоновых задач обслуживания, таких как «VACUUM» и «CREATE INDEX». Увеличьте его до 1-2 ГБ.
- `max_connections` — лимит на соединения с СУБД. Устанавливайте исходя из предполагаемой нагрузки. Обычно достаточно 100–200 соединений.
- `wal_level` — режим работы журнала предзаписи (WAL). Установите режим «replica», чтобы обеспечить возможность репликации БД в случае сбоя.
- `synchronous_commit` — определяет, в какой момент транзакции считаются выполненными. Если вам важна максимальная производительность, установите значение «off». Однако это снизит надежность транзакций.
- `checkpoint_timeout` — настраивает интервал между созданием контрольных точек восстановления. Для повышения производительности увеличьте этот интервал до 30 минут. Однако при сбое БД ее восстановление займет больше времени.
- `max_wal_size` — управляет размером WAL-файлов. Увеличьте значение для больших рабочих нагрузок.

#### 4. Оптимизируйте настройки файловой системы

Вы также можете повысить производительность СУБД за счет оптимизации настроек файловой системы. Для этого добавьте дополнительные параметры в конфигурационный файл диска:

- `noatime` — отключает запись времени доступа к файлу.
- `nodiratime` — отключает обновление времени доступа для каталогов.

Настройки снижают нагрузку на оперативную память. Чтобы их добавить:

1. Откройте файл с конфигурацией диска:

```sh
sudo nano /etc/fstab
```

2. В строке с диском, на котором установлена СУБД, добавьте параметры «noatime» и «nodiratime»:

```sh
# <device>        <dir>   <type>  <options> <dump> <fsck>
UUID=0a3407de-014b-458b-b5c1-848e******* /      ext4 defaults,noatime,nodiratime 0   1
```