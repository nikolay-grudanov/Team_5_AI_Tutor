---
source_image: docs_tutorials-evolution_list_topics_magic-router__link-vpcs-in-project.jpg
page_number: 0
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 107.09
tokens: 12718
characters: 6780
timestamp: 2025-12-24T05:49:28.309063
finish_reason: stop
---

### Связывание ресурсов в разных VPC внутри проекта

С помощью этого руководства вы настроите сетевую связность между виртуальными машинами из разных VPC, принадлежащих одному проекту. Вы будете использовать соединения, маршруты и правила групп безопасности для связи ресурсов. Схема сетевой связности ресурсов представлена ниже.

![Схема сетевой связности ресурсов](https://cloud.ru/docs/images/vpc-connection.png)

Маршруты в VPC 1:
- 10.2.2.0/24 к Magic Router, ru.AZ-1
- 10.2.2.0/24 к Magic Router, ru.AZ-2

Маршруты в Magic Router:
- 10.1.1.0/24 к VPC 1, ru.AZ-1
- 10.3.3.0/24 к VPC 1, ru.AZ-2
- 10.2.2.0/24 к VPC 2, ru.AZ-1

Маршруты в VPC 2:
- 10.1.1.0/24 к Magic Router, ru.AZ-1
- 10.3.3.0/24 к Magic Router, ru.AZ-1

Вы будете использовать следующие сервисы:

• Виртуальные машины — сервис, в рамках которого предоставляется виртуальная машина.
• VPC — изолированная виртуальная сеть для создания безопасной инфраструктуры.
• Magic Router — сервис для управления сетевыми связями между ресурсами внутри облачной инфраструктуры.
• Группы безопасности — сервис для контроля трафика виртуальных машин.

Шаги:

1. Разверните ресурсы в облаке.
2. Создайте соединение между VPC.
3. Настройте маршруты на Magic Router.
4. Настройте маршруты для VPC.
5. Настройте правила групп безопасности.
6. Проверьте сетевую связность.

Перед началом работы

1. Зарегистрируйтесь в личном кабинете Cloud.ru.
   Если вы уже зарегистрированы, войдите под своей учетной записью.
2. Создайте и загрузите SSH-ключ в облако.

1. Разверните ресурсы в облаке

1. Создайте две VPC-сети с названиями VPC-1 и VPC-2.
2. Создайте подсеть subnet-1:
   • Название: subnet-1.
   • VPC: VPC-1.
   • Зона доступности: ru.AZ-1.
   • Адрес: 10.1.1.0/24.
3. Создайте подсеть subnet-2:
   • Название: subnet-2.
   • VPC: VPC-1.
   • Зона доступности: ru.AZ-2.
   • Адрес: 10.3.3.0/24.
4. Создайте подсеть subnet-3:
   • Название: subnet-3.
   • VPC: VPC-2.
   • Зона доступности: ru.AZ-1.
   • Адрес: 10.2.2.0/24.
Убедитесь, что на странице сервиса Подсети подсети subnet-1, subnet-2, subnet-3 находятся в статусе «Создана».

5. Создайте виртуальную машину со следующими параметрами:
   • Название: vm-1.
   • Зона доступности: ru.AZ-1.
   • Образ: Публичные → Ubuntu 22.04.
   • Гарантированная доля vCPU: 10%.
   • vCPU: 1.
   • RAM: 1.
   • VPC: VPC-1.
   • Подсеть: 10.1.1.0/24 (subnet-1).
   • Внутренний IP: Автоматически.
   • Группы безопасности: SSH-access_ru.AZ-1.
   • Метод аутентификации: Публичный ключ и пароль.
   • Публичный ключ: ваш SSH-ключ.
   • Пароль: ваш пароль.
   • Имя хоста: vm-1.
6. Создайте виртуальную машину со следующими параметрами:
   • Название: vm-2.
   • Зона доступности: ru.AZ-2.
   • Образ: Публичные → Ubuntu 22.04.
   • Гарантированная доля vCPU: 10%.
   • vCPU: 1.
   • RAM: 1.
   • VPC: VPC-1.
   • Подсеть: 10.3.3.0/24 (subnet-2).
   • Внутренний IP: Автоматически.
   • Группы безопасности: SSH-access_ru.AZ-2.
   • Метод аутентификации: Публичный ключ и пароль.
   • Публичный ключ: ваш SSH-ключ.
   • Пароль: ваш пароль.
   • Имя хоста: vm-2.
7. Создайте виртуальную машину со следующими параметрами:
   • Название: vm-3.
   • Зона доступности: ru.AZ-1.
   • Образ: Публичные → Ubuntu 22.04.
   • Гарантированная доля vCPU: 10%.
   • vCPU: 1.
   • RAM: 1.
   • VPC: VPC-2.
   • Подсеть: 10.2.2.0/24 (subnet-3).
   • Внутренний IP: Автоматически.
   • Группы безопасности: SSH-access_ru.AZ-1.
   • Метод аутентификации: Публичный ключ и пароль.
   • Публичный ключ: ваш SSH-ключ.
   • Пароль: ваш пароль.
   • Имя хоста: vm-3.
Убедитесь, что в личном кабинете на странице сервиса Виртуальные машины отображается виртуальные машины vm-1, vm-2, vm-3 в статусе «Запущена».

2. Создайте соединение между VPC

1. Выберите сервис Magic Router.
2. Нажмите Создать Magic Router.
3. Нажмите VPC Evolution.
4. Выберите VPC-1 и VPC-2.
5. Нажмите Создать.
Убедитесь, что в сервисе Magic Router на странице Соединения отображается два соединения в статусе «Активно».

3. Настройте маршруты на Magic Router

При создании маршрутов в Magic Router необходимо указывать зону доступности, в которой расположена целевая подсеть.

1. В сервисе Magic Router создайте маршрут к подсети subnet-1:
   • Адрес назначения: 10.1.1.0/24.
   • VPC: VPC-1.
   • Зона доступности: ru.AZ-1.
2. В сервисе Magic Router создайте маршрут к подсети subnet-2:
   • Адрес назначения: 10.3.3.0/24.
   • VPC: VPC-1.
   • Зона доступности: ru.AZ-2.
3. В сервисе Magic Router создайте маршрут к подсети subnet-3:
   • Адрес назначения: 10.2.2.0/24.
   • VPC: VPC-2.
   • Зона доступности: ru.AZ-1.
Убедитесь, что в сервисе Magic Router на странице Маршруты отображаются три маршрута в статусе «Создан».

4. Настройте маршруты для VPC

При создании маршрутов в VPC необходимо указывать зону доступности, в которой расположена подсеть этой VPC. Если в VPC созданы подсети в нескольких зонах доступности, маршруты необходимо создать в каждой зоне доступности.

1. В сервисе Evolution VPC выберите VPC-1.
   a. Создайте пользовательский маршрут с параметрами:
      • Адрес назначения: 10.2.2.0/24.
      • Next Hop Type: Magic Router.
      • Зона доступности: ru.AZ-1.
   b. Создайте еще один маршрут с параметрами:
      • Адрес назначения: 10.2.2.0/24.
      • Next Hop Type: Magic Router.
      • Зона доступности: ru.AZ-2.
Убедитесь, что для VPC-1 на странице Маршруты отображаются два маршрута в статусе «Активен».
2. В сервисе Evolution VPC выберите VPC-2.
   a. Создайте пользовательский маршрут с параметрами:
      • Адрес назначения: 10.1.1.0/24.
      • Next Hop Type: Magic Router.
      • Зона доступности: ru.AZ-1.
   b. Создайте еще один маршрут с параметрами:
      • Адрес назначения: 10.3.3.0/24.
      • Next Hop Type: Magic Router.
      • Зона доступности: ru.AZ-1.
Убедитесь, что для VPC-2 на странице Маршруты отображаются два маршрута в статусе «Активен».

5. Настройте правила групп безопасности

1. Выберите сервис Группы безопасности.
2. Для группы безопасности SSH-access_ru.AZ-1 создайте правило для входящего трафика с параметрами:
   • Протокол: ICMP.
   • Тип источника: IP-адрес.
   • Источник: 0.0.0.0/0.
3. Для группы безопасности SSH-access_ru.AZ-2 создайте правило для входящего трафика с параметрами:
   • Протокол: ICMP.
   • Тип источника: IP-адрес.
   • Источник: 0.0.0.0/0.

6. Проверьте сетевую связность

1. Подключитесь к любой виртуальной машине через виртуальную консоль.
2. Чтобы проверить сетевую связность с оставшимися виртуальными машинами, выполните команду:

   ping <IP>

   Где IP — IP-адрес виртуальной машины, с которой надо проверить сетевую связность.

Результат

Вы настроили сетевую связность между виртуальными машинами из разных VPC, принадлежащих одному проекту. Вы получили опыт работы с соединениями, маршрутами и правилами групп безопасности.