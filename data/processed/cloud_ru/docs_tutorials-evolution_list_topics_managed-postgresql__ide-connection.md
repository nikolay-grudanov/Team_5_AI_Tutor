---
source_image: docs_tutorials-evolution_list_topics_managed-postgresql__ide-connection.jpg
page_number: 0
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 88.70
tokens: 10778
characters: 6416
timestamp: 2025-12-24T05:58:27.191418
finish_reason: stop
---

### Подключение кластера Managed PostgreSQL® к локальной IDE

Эта статья полезна?

С помощью этого руководства вы настроите подключение с локальной IDE DBeaver с сервисом Managed PostgreSQL®.

Вы выполните развертывание виртуальной машины Ubuntu 22.04, настройку сетей и групп безопасности, создание кластера PostgreSQL, установку и конфигурирование сервера nginx для подключения к базе данных с локальной IDE.

Данная конфигурация позволит подключиться с любой IDE, например: VS Code, DataGrip, DBeaver.

Вы будете использовать следующие сервисы:

• Виртуальные машины — сервис, в рамках которого предоставляется виртуальная машина.
• Публичный IP-адрес — для доступа к базе данных через интернет.
• Managed PostgreSQL — управляемая база данных PostgreSQL.
• VPC — изолированная виртуальная сеть для создания безопасной инфраструктуры.
• Nginx — веб-сервер для проксирования запросов и организации защищенного HTTPS-доступа к приложению.
• DBeaver — универсальный клиент баз данных для управления и администрирования SQL и NoSQL СУБД.

Шаги:

1. Разверните ресурсы в облаке.
2. Настройте nginx для проксирования запросов к базе данных.
3. Протестируйте подключение с локальной IDE DBeaver.
4. Удалите доступ по SSH для виртуальной машины.

Перед началом работы

Зарегистрируйтесь в личном кабинете Cloud.ru.

Если вы уже зарегистрированы, войдите под своей учетной записью.

1. Разверните ресурсы в облаке

1. Создайте виртуальную сеть с названием ide-connection-VPC.
2. Создайте подсеть со следующими параметрами:
   a. Название — ide-connection-subnet .
   b. Адрес — 10.10.1.0/24 .
   c. VPC — ide-connection-VPC .
   d. DNS-серверы — 8.8.8.8 .
3. Создайте новую группу безопасности со следующими параметрами:
   a. Зону доступности — укажите ту же зону доступности, что выбрана для сети.
   b. Название — ide-connection .
   c. Добавьте правила входящего трафика:
      a. Протокол — TCP .
      b. Порт — 55432 .
      c. Тип источника — IP-адрес .
      d. Источник — <ip-address>0 , где <ip-address> — IP-адрес, с которого вы будете подключаться.
4. Создайте виртуальную машину со следующими параметрами:
   • Название — ide-connection .
   • Образ — на вкладке Публичные выберите образ Ubuntu 22.04 .
   • Подключить публичный IP — оставьте опцию включенной. Для виртуальной машины будет арендован и назначен прямой публичный IP.
   • Группы безопасности — ide-connection .
   • Логин — user1 .
   • Метод аутентификации — Публичный ключ .
   • Сетевой интерфейс — выберите тип Подсеть с публичным IP .
   • Сетевые настройки — выберите подсеть ide-connection-subnet .
   • Имя хоста — ide-connection .
5. Создайте кластер [postgresql] со следующими параметрами:
   1. Название кластера — ide-connection .
   2. Название базы данных — default .
   3. Версия PostgreSQL — 16 .
   4. Режим — Стандарт .
   5. Тип — Single .
   6. Подсеть — ide-connection-subnet .

6. Убедитесь, что ресурсы созданы и отображаются в личном кабинете:
   a. На странице сервиса VPC:
      • отображается сеть ide-connection-VPC ;
      • в списке подсетей отображается ide-connection-subnet .
   b. На странице сервиса «Группы безопасности» отображается группа безопасности ide-connection со статусом «Создана».
   c. На странице сервиса «Виртуальные машины» отображается виртуальная машина ide-connection со статусом «Запущена».
   d. На странице сервиса Managed PostgreSQL® отображается кластер ide-connection со статусом «Доступен».

2. Настройте nginx для проксирования запросов к базе данных

На этом шаге вы настроите систему и nginx-сервер для настройки подключения к базе данных.

1. Подключитесь к виртуальной машине по SSH.
2. Обновите систему:

   sudo apt update && sudo apt upgrade -y

3. Установите nginx:

   sudo apt install nginx -y

4. Настройте сетевой фильтр:

   sudo ufw allow OpenSSH
   sudo ufw allow 55432
   sudo ufw enable

5. Проверьте установку nginx и ufw:

   nginx -v
   sudo ufw status

6. Создайте каталог для stream-конфигураций:

   sudo mkdir -p /etc/nginx/streams

7. Создайте файл конфигурации:

   sudo nano /etc/nginx/streams/postgres-proxy.conf

8. Вставьте конфигурацию в файл:

   server {
     listen 55432;
     proxy_pass <db_private_ip>:5432;
     proxy_connect_timeout 5s;
     proxy_timeout 600s;
   }

   Где <db_private_ip> — IP-адрес кластера Managed PostgreSQL®.

9. Откройте файл конфигурации nginx для подключения stream-блока:

   sudo nano /etc/nginx/nginx.conf

10. Добавьте блок перед блоком http :

   stream {
     log_format basic '$remote_addr:$remote_port -> $server_addr:$server_port '
       'upstream: $upstream_addr status: $status';
     access_log /var/log/nginx/postgres-proxy-access.log basic;
     error_log /var/log/nginx/postgres-proxy-error.log;
     include /etc/nginx/streams/*.conf;
   }

11. Примените конфигурацию nginx:

   sudo nginx -t
   sudo systemctl restart nginx

12. Проверьте, что nginx слушает порт:

   sudo ss -tuln | grep 55432

3. Протестируйте подключение с локальной IDE DBeaver

На этом шаге вы подключитесь с локальной IDE к кластеру Managed PostgreSQL®.

1. Откройте DBeaver или другую IDE для работы с базами данных.
2. Создайте новое подключение к базе данных со следующими параметрами:
   a. Host — публичный IP-адрес виртуальной машины.
   b. Port — 55432 .
   c. Database — название базы данных.
   d. Username — имя пользователя кластера Managed PostgreSQL®.
   e. Password — пароль пользователя кластера Managed PostgreSQL®.
3. Сохраните соединение.

4. Удалите доступ по SSH для виртуальной машины

Для повышения безопасности удалите доступ по SSH для вашей виртуальной машины, так как он больше не требуется.

1. В личном кабинете перейдите в сервис «Виртуальные машины» и выберите машину ide-connection-VPC , созданную на первом шаге.
2. Перейдите на вкладку Сетевые параметры.
3. Нажмите Изменить группы безопасности для публичного IP-адреса.
4. Удалите группу SSH-access ru .
5. Нажмите Сохранить.
6. Убедитесь, что доступа нет — попробуйте подключиться к виртуальной машине по SSH.

Результат

Вы настроили безопасное подключение к управляемому кластеру PostgreSQL из локальной IDE DBeaver через облачную инфраструктуру с использованием nginx в качестве прокси-сервера.

Полученные навыки помогут организовывать удаленный доступ к облачным базам данных из различных IDE, настраивать сетевую безопасность и группы доступа, а также использовать nginx для проксирования подключений к управляемым сервисам баз данных.