---
source_image: page_593.png
page_number: 593
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 47.93
tokens: 11777
characters: 1985
timestamp: 2025-12-24T10:43:25.713754
finish_reason: stop
---

успешный запрос! Из функции handle_connection удалите println! который печатал данные запроса и заменял их кодом из Листинга 20-3.

Файл: src/main.rs

```rust
fn handle_connection(mut stream: TcpStream) {
    let buf_reader = BufReader::new(&mut stream);
    let http_request: Vec<_> = buf_reader
        .lines()
        .map(|result| result.unwrap())
        .take_while(|line| !line.is_empty())
        .collect();

    let response = "HTTP/1.1 200 OK\r\n\r\n";

    stream.write_all(response.as_bytes()).unwrap();
}
```

Листинг 20-3: Запись короткого успешного HTTP ответа в поток

Первая новая строка определяет переменную response которая содержит данные сообщения об успешном выполнении. Затем мы вызываем as_bytes в нашем response чтобы преобразовать строковые данные в байты. Метод write в stream принимает & [u8] и отправляет эти байты напрямую по соединению.

Поскольку операция write может завершиться неудачно, мы, как и раньше, используем unwrap для любого результата ошибки. Опять же, в реальном приложении вы бы добавили сюда обработку ошибок. Наконец, flush подождёт и предотвратит продолжение программы, пока все байты не будут записаны в соединение; TcpStream содержит внутренний буфер для минимизации обращений к базовой операционной системе.

Сделав этим изменения давайте запустим код и сделаем запрос. Мы больше не выводим в терминал любые данные, поэтому мы не увидим ничего, кроме вывода из Cargo. Когда вы загружаете адрес 127.0.0.1:7878 в веб-браузер, вы должны получить пустую страницу вместо ошибки. Вы только что вручную закодировали запрос и ответ HTTP!

Возвращение реального HTML

Реализуем функционал для возврата более пустой страницы. Создайте новый файл hello.html в корне каталога вашего проекта, а не в каталоге src . Вы можете ввести любой HTML-код; В листинге 20-4 показана одна возможность.

Файл: hello.html

```html
{{#include ../listings/ch20-web-server/listing-20-04/hello.html}}
```

Листинг 20-4. Образец HTML-файла для возврата в ответ