---
source_image: page_595.png
page_number: 595
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 52.39
tokens: 11795
characters: 2112
timestamp: 2025-12-24T10:43:32.324279
finish_reason: stop
---

серверов. Мы хотим настроить наши ответы в зависимости от запроса и отправлять обратно HTML-файл только для правильно сформированного запроса в /.

Проверка запроса и выборочное возвращение ответа

Прямо сейчас наш веб-сервер вернёт HTML-код в файле независимо от того, что запросил клиент. Давайте добавим функциональность, чтобы проверять, запрашивает ли браузер / перед возвратом HTML-файла, и возвращать ошибку, если браузер запрашивает что-либо ещё. Для этого нам нужно изменить handle_connection, как показано в листинге 20-6. Этот новый код проверяет содержимое полученного запроса на соответствие тому, как мы знаем, что запрос на / выглядит как, и добавляет блоки if и else чтобы обрабатывать запросы по-разному.

Файл: src/main.rs

// --snip--

fn handle_connection(mut stream: TcpStream) {
    let buf_reader = BufReader::new(&mut stream);
    let request_line = buf_reader.lines().next().unwrap().unwrap();

    if request_line == "GET / HTTP/1.1" {
        let status_line = "HTTP/1.1 200 OK";
        let contents = fs::read_to_string("hello.html").unwrap();
        let length = contents.len();

        let response = format!(
            "{status_line}\r\nContent-Length: {length}\r\n\r\n{contents}"
        );

        stream.write_all(response.as_bytes()).unwrap();
    } else {
        // some other request
    }
}

Листинг 20-6: Сопоставление запроса и обработка запросов для корневого ресурса /, отличающимся от запросов других ресурсов

Сначала мы жёстко кодируем данные, соответствующие запросу /, в переменную get. Поскольку мы читаем необработанные байты в буфер, мы преобразуем get в байтовую строку, добавляя синтаксис байтовой строки b"" в начало данных содержимого. Затем мы проверяем, начинается ли buffer с байтов в get. Если это так, это означает, что мы получили правильно сформированный запрос к /, и это успешный случай, который мы обработаем в блоке if который возвращает содержимое нашего HTML-файла.

Если buffer не начинается с байтов в get, это означает, что мы получили другой запрос. Мы добавим код в блок else через мгновение, чтобы ответить на все остальные запросы.