---
source_image: page_348.png
page_number: 348
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 54.11
tokens: 11695
characters: 1855
timestamp: 2025-12-24T10:33:12.121946
finish_reason: stop
---

Закрытия: Анонимные функции, подхватывающие своё окружение

Замыкания в Rust - это анонимные функции, которые можно сохранять в переменных или передавать в качестве аргументов другим функциям. Вы можете создать замыкание в одном месте, а затем вызвать его в каком-нибудь другом, чтобы выполнить обработку в другом контексте. В отличие от функций, замыкания могут использовать значения из области видимости, в которой они были определены. Мы продемонстрируем, как эти возможности замыканий позволяют повторно использовать код и изменять поведение.

Захват переменных окружения с помощью замыкания

Сначала мы рассмотрим, как можно использовать замыкания для фиксирования значений среды, в которой они определены, для последующего использования. Вот сценарий: Время от времени наша компания по производству футболок выдаёт эксклюзивную футболку, выпущенную ограниченным тиражом, кому-то из нашего списка рассылки в качестве рекламной акции. Люди в списке рассылки могут по желанию добавить свой любимый цвет в свой профиль. Если человек, выбранный для получения бесплатной футболки, указал свой любимый цвет, он получает футболку этого цвета. Если человек не указал свой любимый цвет, он получит рубашку того цвета, которых в данный момент у компании больше всего.

Существует множество способов реализовать это. В данном примере мы будем использовать перечисление ShirtColor, которое имеет варианты Red и Blue (для простоты ограничим количество доступных цветов). Запасы компании мы представим структурой Inventory, которая имеет поле shirts, содержащее Vec<ShirtColor>, который содержит цвета рубашек, имеющихся на складе. Метод giveaway, определённый у Inventory, получает опциональный цвет рубашки, который предпочитает обладатель бесплатной рубашки, и возвращает цвет рубашки, которую он получит. Эта схема показана в листинге 13-1:

Файл : src/main.rs