---
source_image: page_316.png
page_number: 316
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 43.78
tokens: 11680
characters: 1799
timestamp: 2025-12-24T10:31:46.088052
finish_reason: stop
---

Организационная проблема распределения ответственности за выполнение нескольких задач функции main является общей для многих выполняемых проектов. В результате Rust сообщество разработало процесс для использования в качестве руководства по разделению ответственности бинарной программы, когда код в main начинает увеличиваться. Процесс имеет следующие шаги:

• Разделите код программы на два файла main.rs и lib.rs. Перенесите всю логику работы программы в файл lib.rs.
• Пока ваша логика синтаксического анализа командной строки мала, она может оставаться в файле main.rs.
• Когда логика синтаксического анализа командной строки становится сложной, извлеките её из main.rs и переместите в lib.rs.

Функциональные обязанности, которые остаются в функции main после этого процесса должно быть ограничено следующим:

• Вызов логики разбора командной строки со значениями аргументов
• Настройка любой другой конфигурации
• Вызов функции run в lib.rs
• Обработка ошибки, если run возвращает ошибку

Этот шаблон о разделении ответственности: main.rs занимается запуском программы, а lib.rs обрабатывает всю логику задачи. Поскольку нельзя проверить функцию main напрямую, то такая структура позволяет проверить всю логику программы путём перемещения её в функции внутри lib.rs. Единственный код, который остаётся в main.rs будет достаточно маленьким, чтобы проверить его корректность прочитав код. Давайте переработаем нашу программу, следуя этому процессу.

Извлечение парсера аргументов

Мы извлечём функциональность для разбора аргументов в функцию, которую вызовет main для подготовки к перемещению логики разбора командной строки в файл src/lib.rs. Листинг 12-5 показывает новый запуск main, который вызывает новую функцию parse_config, которую мы определим сначала в src/main.rs.

Файл: src/main.rs