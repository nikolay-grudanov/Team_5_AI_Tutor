---
source_image: page_584.png
page_number: 584
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 53.19
tokens: 11732
characters: 1830
timestamp: 2025-12-24T10:43:08.784178
finish_reason: stop
---

генерирует код, который хотите!

Функционально подобные макросы

Функционально подобные макросы выглядят подобно вызову функций. Они аналогично макросам `macro_rules!` и являются более гибкими, чем функции; например, они могут принимать неизвестное количество аргументов. Тем не менее, макросы `macro_rules!` можно объявлять только с использованием синтаксиса подобного сопоставлению, который мы обсуждали ранее в разделе "Декларативные макросы `macro_rules!` для общего мета программирования". Функционально подобные макросы принимают параметр `TokenStream` и их определение манипулирует этим `TokenStream`, используя код Rust, как это делают два других типа процедурных макроса. Примером подобного функционально подобного макроса является макрос `sql!/code6}`, который можно вызвать так:

```rust
let sql = sql!(SELECT * FROM posts WHERE id=1);
```

Этот макрос будет разбирать SQL оператор внутри него и проверять, что он синтаксически правильный, что является гораздо более сложной обработкой, чем то что может сделать макрос `macro_rules!`. Макрос `sql!` мог бы быть определён так:

```rust
#[proc_macro]
pub fn sql(input: TokenStream) -> TokenStream {
    // Это определение похоже на сигнатуру пользовательского выводимого макроса: мы получаем токены, которые находятся внутри скобок и возвращаем код, который мы хотели сгенерировать.
}
```

Итоги

Уф! Теперь у вас есть некоторые возможности Rust, которые вы не будете часто использовать, но вы будете знать, что они доступны в особых обстоятельствах. Мы представили несколько сложных тем, чтобы при появлении сообщения с предложением исправить ошибку или в коде других людей, вы могли бы распознать эти концепции и синтаксис. Используйте эту главу как справочник, который поможет вам в решениях.

Далее мы применим все, что мы обсуждали в книге и сделаем ещё один проект!