---
source_image: page_332.png
page_number: 332
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 28.13
tokens: 7455
characters: 1781
timestamp: 2025-12-24T10:54:23.828518
finish_reason: stop
---

Листинг 13.20 содержит определение структуры Counter и связанную с ней функцию new для создания экземпляров структуры Counter.

**Листинг 13.20.** Определение структуры Counter и функции new, создающей экземпляры структуры Counter с начальным значением поля count, равным 0

src/lib.rs
```rust
struct Counter {
    count: u32,
}

impl Counter {
    fn new() -> Counter {
        Counter { count: 0 }
    }
}
```

Структура Counter имеет одно поле с именем count. Это поле содержит значение типа u32, которое будет отслеживать, где мы находимся в процессе перебора значений от 1 до 5. Поле count является приватным, потому что мы хотим, чтобы реализация структуры Counter управляла своим значением. Функция new обеспечивает поддержку поведения, состоящего в том, что новые экземпляры всегда начинаются со значения 0 в поле count.

Далее мы выполним реализацию типажа Iterator для типа Counter путем определения тела метода next, чтобы уточнить, что должно происходить, когда этот итератор используется, как показано в листинге 13.21.

**Листинг 13.21.** Реализация типажа Iterator в структуре Counter

src/lib.rs
```rust
impl Iterator for Counter {
    type Item = u32;

    fn next(&mut self) -> Option<Self::Item> {
        self.count += 1;
        if self.count < 6 {
            Some(self.count)
        } else {
            None
        }
    }
}
```

В итераторе мы устанавливаем связанный тип Item равным u32, то есть итератор будет возвращать значения типа u32. Опять-таки, пока не переживайте насчет связанных типов, мы рассмотрим их в главе 19.

Мы хотим, чтобы итератор прибавлял к текущему состоянию 1, поэтому мы инициализировали count со значением 0, в результате чего он сначала будет возвращать 1. Если значение count меньше 6, то метод next будет возвращать текущее