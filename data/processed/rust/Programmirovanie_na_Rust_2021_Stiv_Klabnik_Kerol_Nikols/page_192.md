---
source_image: page_192.png
page_number: 192
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 37.81
tokens: 7681
characters: 2427
timestamp: 2025-12-24T10:50:54.945465
finish_reason: stop
---

Использование обратной трассировки при вызове panic!

Давайте взглянем еще на один пример и посмотрим, что происходит, когда вызов макрокоманды panic! поступает не из нашего кода, который вызывает макрокоманду напрямую, а из библиотеки в связи с дефектом в нашем коде. В листинге 9.1 есть код, который пытается обратиться к элементу по индексу в векторе.

Листинг 9.1. Попытка обратиться к элементу за пределами вектора, что приведет к вызову макрокоманды panic!

src/main.rs

```rust
fn main() {
    let v = vec![1, 2, 3];

    v[99];
}
```

Здесь мы пытаемся обратиться к сотому элементу вектора (который находится в индексе 99, потому что индексация начинается с нуля), но в нем только три элемента. В этой ситуации возникнет состояние паники. Использование [ ] предположительно должно возвращать элемент, но, если передается недопустимый индекс, то здесь нет ни одного правильного элемента, который Rust мог бы вернуть.

Другие языки, такие как C, в этой ситуации попытаются дать вам именно то, что вы просили, даже если это не то, что вы хотите: вы получите все, что находится в том месте в памяти, которое соответствовало бы этому элементу в векторе, даже если память не принадлежит вектору. Это называется переполнением буфера и приводит к уязвимостям в системе безопасности, если злоумышленнику удается манипулировать индексом так, чтобы считывать данные, хранящиеся после массива, которые запрещено читать.

В целях защиты программы от такого рода уязвимостей, если вы попытаетесь прочитать элемент в несуществующем индексе, то язык Rust остановит исполнение и откажется продолжать работу. Давайте попробуем и посмотрим:

```sh
$ cargo run
Compiling panic v0.1.0 (file:///projects/panic)
Finished dev [unoptimized + debuginfo] target(s) in 0.27 secs
Running 'target/debug/panic'
thread 'main' panicked at 'index out of bounds: the len is 3 but the index is 99', libcore/slice/mod.rs:2448:10
note: Run with 'RUST_BACKTRACE=1' for a backtrace.
```

Приведенная выше ошибка указывает на файл, который мы не писали, — libcore/slice/mod.rs. Он представляет собой реализацию среза slice в исходном коде Rust. Код, который запускается на исполнение, когда мы используем [ ] в векторе v, располагается в файле libcore/slice/mod.rs, и именно там на самом деле происходит panic!.

Следующая далее строка примечания говорит о том, что мы можем установить переменную среды RUST_BACKTRACE, чтобы получить обратную трассировку того,