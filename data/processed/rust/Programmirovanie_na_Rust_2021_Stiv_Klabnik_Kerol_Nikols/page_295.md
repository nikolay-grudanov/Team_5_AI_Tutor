---
source_image: page_295.png
page_number: 295
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 24.21
tokens: 7389
characters: 1589
timestamp: 2025-12-24T10:53:22.486980
finish_reason: stop
---

Функция run не возвращает значение, которое требуется развернуть (методом unwrap) так, как это делает функция Config::new, которая возвращает экземпляр структуры Config. Поскольку run в случае успеха возвращает (), нас интересует только обнаружение ошибки, поэтому нам не нужно выполнять метод unwrap_or_else, чтобы вернуть развернутое значение, потому что оно будет исключительно ().

Тела блока if let и метода unwrap_or_else в обоих случаях одинаковы: мы печатаем ошибку и завершаем работу.

Разбивка кода в библиотечную упаковку

Наш проект minigrep пока что выглядит неплохо! Теперь мы разобьем файл src/main.rs и поместим некоторую часть кода в файл src/lib.rs, чтобы протестировать его и сократить число обязанностей файла src/main.rs.

Давайте переместим весь код, который не является функцией main, из src/main.rs в src/lib.rs:

○ Определение функции run.
○ Релевантные инструкции use.
○ Определение структуры Config.
○ Определение функции Config::new.

Содержимое src/lib.rs должно иметь сигнатуры, показанные в листинге 12.13 (для краткости тела функций опущены). Обратите внимание, что этот код не будет компилироваться до тех пор, пока мы не изменим src/main.rs в листинге 12.14.

Листинг 12.13. Перемещение определений структуры Config и функции run в src/lib.rs

src/lib.rs
use std::error::Error;
use std::fs;

pub struct Config {
    pub query: String,
    pub filename: String,
}

impl Config {
    pub fn new(args: &[String]) -> Result<Config, &'static str> {
        // --пропуск--
    }
}

pub fn run(config: Config) -> Result<(), Box<dyn Error>> {
    // --пропуск--
}