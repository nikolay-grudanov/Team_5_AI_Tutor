---
source_image: page_557.png
page_number: 557
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 30.21
tokens: 7461
characters: 1867
timestamp: 2025-12-24T11:00:23.187800
finish_reason: stop
---

let thread = thread::spawn(move || {
    loop {
        let job = receiver.lock()①.unwrap()②.recv()③.unwrap()④;
        println!("Работник {} получил задание; исполняется.", id);
        (*job)();
    }
});
Worker {
    id,
    thread,
}

Здесь мы сначала вызываем метод lock для receiver, чтобы получить мьютекс ①, а затем — метод unwrap, чтобы поднимать панику при любых ошибках ②. Получить замок не выйдет, если мьютекс находится в отравленном состоянии, что может произойти, если какой-то другой поток поднял панику, удерживая замок вместо того, чтобы его освободить. В этой ситуации правильно вызывать метод unwrap, чтобы этот поток мог поднимать панику. При необходимости поменяйте unwrap на метод expect с сообщением об ошибке, которое имеет для вас смысл.

Если мы получаем замок на мьютексе, то вызываем метод recv, чтобы получить задание Job из канала ③. Заключительный вызов метода unwrap здесь проходит без ошибок ④, которые тоже могут произойти, если поток, держащий передающую сторону канала, выключился, подобно тому, как метод send возвращает Err, если принимающая сторона выключилась.

Вызов метода recv блокируется, поэтому, если задания еще нет, то текущий поток будет ждать до тех пор, пока оно не появится. Умный указатель Mutex<T> обеспечивает, чтобы только один поток Worker запрашивал задание за один раз.

Теоретически этот код должен компилироваться. К сожалению, компилятор Rust еще не совершенен, и мы получаем такую ошибку¹:

error[E0161]: cannot move a value of type std::ops::FnOnce() + std::marker::Send: the size of std::ops::FnOnce() + std::marker::Send cannot be statically determined
 --> src/lib.rs:63:17
  |
63 |         (*job)();
  |         ^^^^^^

¹ ошибка[E0161]: не получается переместить значение типа std::ops::FnOnce() + std::marker::Send: размер std::ops::FnOnce() + std::marker::Send не получается определить статически