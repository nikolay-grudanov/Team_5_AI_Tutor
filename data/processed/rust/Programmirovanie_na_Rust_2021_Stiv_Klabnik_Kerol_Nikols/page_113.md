---
source_image: page_113.png
page_number: 113
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 31.10
tokens: 7483
characters: 1957
timestamp: 2025-12-24T10:48:42.562145
finish_reason: stop
---

Теперь, вызывая функцию first_word, мы получаем обратно единственное значение, которое привязано к опорным данным. Значение состоит из ссылки на начальную точку среза и числа элементов в срезе.

Возвращение среза также будет работать для функции second_word:

fn second_word(s: &String) -> &str {

Теперь у нас есть простой API, который гораздо сложнее испортить, потому что компилятор будет обеспечивать, чтобы ссылки на значение типа String оставались действительными. Помните дефект в программе из листинга 4.8, когда мы получили индекс на конец первого слова, но затем очистили строку, в результате чего индекс стал недействительным? Этот код был логически неправильным, но не показывал никаких ошибок. Проблемы проявились бы позже, если бы мы продолжили использовать первый индекс слова с очищенной строкой. Срезы делают этот дефект невозможным и гораздо раньше сообщают о том, что у нас есть проблема с кодом. Использование срезовой версии функции first_word вызовет ошибку компиляции:

src/main.rs

fn main() {
    let mut s = String::from("hello world");

    let word = first_word(&s);

    s.clear(); // error!

    println!("первое слово равно {}", word);
}

Вот ошибка компилятора¹:

error[E0502]: cannot borrow `s` as mutable because it is also borrowed as immutable
 --> src/main.rs:18:5
  |
16 |     let word = first_word(&s);
  |                        -- immutable borrow occurs here
17 | 
18 |     s.clear(); // error!
  | ^^^^^^^^^ mutable borrow occurs here
19 | 
20 |     println!("the first word is: {}", word);
  |                        ---- immutable borrow later used here

Вспомните правила заимствования, в которых говорится, что если у нас есть неизменяемая ссылка на что-то, то мы не можем брать еще и изменяемую ссылку. Поскольку методу clear нужно обрезать значение типа String, он пытается взять

¹ ошибка[E0502]: не получается позаимствовать переменную `s` как изменяемую, потому что она также заимствуется как неизменяемая