---
source_image: page_491.png
page_number: 491
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 34.85
tokens: 7588
characters: 2239
timestamp: 2025-12-24T10:58:44.737670
finish_reason: stop
---

Использование функций extern для вызова внешнего кода

Иногда коду Rust нужно взаимодействовать с кодом, написанным на другом языке. Для этого в Rust есть ключевое слово extern, которое облегчает создание и использование интерфейса с внешними функциями (FFI от англ. Foreign Function Interface). Интерфейс с внешними функциями — это способ, которым в языке программирования определяются функции и обеспечивается возможность вызова этих функций другим («иностранным» — foreign) языком программирования.

ВЫЗОВ ФУНКЦИЙ RUST ИЗ ДРУГИХ ЯЗЫКОВ

Мы также можем использовать extern для создания интерфейса, который позволяет другим языкам вызывать функции Rust. Вместо блока extern мы добавляем ключевое слово extern и указываем используемый ABI непосредственно перед ключевым словом fn. Нам также нужно добавить аннотацию #[no_mangle], чтобы компилятор Rust не искажал имя этой функции. При искажении (mangling) компилятор изменяет имя, данное функции, на другое, содержащее больше информации для других частей процесса компиляции, но неудобное для восприятия человеком. Каждый компилятор языка программирования искажает имена по-разному, поэтому для того, чтобы другие языки могли вызывать функцию Rust, мы должны отключить искажение имени со стороны компилятора Rust.

В следующем примере мы делаем функцию call_from_c доступной из кода C, после того как она скомпилирована в совместную библиотеку и связана из C:

    #[no_mangle]
    pub extern "C" fn call_from_c() {
        println!("Только что была вызвана функция Rust из C!");
    }

Это использование extern не требует ключевого слова unsafe.

В листинге 19.8 показано, как настраивать интеграцию с функцией abs из стандартной библиотеки С. Функции, объявляемые в блоках extern, всегда небезопасны для вызова из кода на Rust. Причина в том, что другие языки не обеспечивают соблюдение правил и гарантий Rust, а Rust не может их проверить, поэтому ответственность за безопасность ложится на программиста.

Листинг 19.8. Объявление и вызов функции extern, определенной на другом языке src/main.rs

    extern "C" {
        fn abs(input: i32) -> i32;
    }

    fn main() {
        unsafe {
            println!("Абсолютное значение для -3 согласно языку C: {}", abs(-3));
        }
    }