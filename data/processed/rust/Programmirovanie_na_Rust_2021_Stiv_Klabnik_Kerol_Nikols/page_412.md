---
source_image: page_412.png
page_number: 412
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 34.57
tokens: 7554
characters: 2071
timestamp: 2025-12-24T10:56:42.986462
finish_reason: stop
---

Если бы нам было разрешено выполнить этот код, то, вероятно, порожденный поток был бы немедленно помещен на задний план вообще без выполнения. Порожденный поток имеет ссылку на переменную v внутри, но главный поток исполнения немедленно отбрасывает v, используя метод drop, который мы обсуждали в главе 15. Затем, когда порожденный поток начинает выполняться, переменная v больше недействительна, поэтому ссылка на нее тоже недействительна. О нет!

Для того чтобы исправить ошибку компилятора в листинге 16.3, мы можем воспользоваться советом, содержащимся в сообщении об ошибке¹:

help: to force the closure to take ownership of `v` (and any other referenced variables), use the `move` keyword
let handle = thread::spawn(move || {
    ^^^^^^^

Добавляя ключевое слово move перед замыканием, мы делаем замыкание владельцем значений, которые оно использует, то есть языку Rust не нужно выводить логически, что требуется заимствовать эти значения. Модификация листинга 16.3, показанная в листинге 16.5, будет компилироваться и выполняться так, как мы хотим.

Листинг 16.5. Ключевое слово move делает замыкание владельцем значений, которые оно использует
src/main.rs
use std::thread;

fn main() {
    let v = vec![1, 2, 3];

    let handle = thread::spawn(move || {
        println!("Вот вектор: {:?}", v);
    });

    handle.join().unwrap();
}

Что произошло бы с кодом в листинге 16.4, где главный поток исполнения вызывал drop, если бы мы использовали замыкание с ключевым словом move? Может ли move исправить это дело? К сожалению, нет. Возникнет другая ошибка, поскольку то, что пытается сделать листинг 16.4, не допускается по другой причине. Если мы добавим ключевое слово move в замыкание, то переместим переменную v в среду замыкания и больше не сможем вызывать для него drop в главный поток исполнения. Вместо этого мы получим такую ошибку компилятора²:

¹ справка: для того чтобы заставить замыкание стать владельцем переменной `v` (и любых других ссылочных переменных), используйте ключевое слово `move`
² ошибка[E0382]: использование перемещенного значения `v`