---
source_image: page_535.png
page_number: 535
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 25.51
tokens: 7502
characters: 1927
timestamp: 2025-12-24T10:59:47.333411
finish_reason: stop
---

в поток как наш ответ на успешный запрос! Из функции handle_connection удалите инструкцию println!, которая печатала данные запроса, и замените ее кодом из листинга 20.3.

Листинг 20.3. Запись крошечного успешного HTTP-ответа в поток src/main.rs

fn handle_connection(mut stream: TcpStream) {
    let mut buffer = [0; 512];

    stream.read(&mut buffer).unwrap();

    ① let response = "HTTP/1.1 200 OK\r\n\r\n";

    ② stream.write(response.as_bytes()③).unwrap();
    ④ stream.flush().unwrap();
}

Первая новая строка определяет переменную response, которая содержит данные сообщения об успехе ①. Затем мы вызываем метод as_bytes для переменной response, чтобы конвертировать строковые данные в байты ③. Метод write для stream берет &[u8] и посылает эти байты непосредственно по соединению ②.

Поскольку операция write может не сработать, мы используем метод unwrap для любого результата с ошибкой, как и раньше. Опять же, в реальном приложении вы бы добавили сюда обработку ошибок. Наконец, метод flush будет ждать и препятствовать продолжению программы до тех пор, пока все байты не будут записаны в соединение ④. Тип TcpStream содержит внутренний буфер для минимизации вызовов опорной операционной системы.

Внеся эти изменения, давайте выполним код и сделаем запрос. Мы больше не печатаем данные в терминал, поэтому в нем будут только данные из Cargo. Когда вы загрузите 127.0.0.1:7878 в веб-браузере, вы должны получить пустую страницу вместо ошибки. Вы только что вручную закодировали HTTP-запрос и ответ!

Возвращение реального HTML

Давайте реализуем функциональность для возвращения не только пустой страницы. В корневом каталоге проекта, но не в каталоге src, создайте новый файл hello.html. Вы можете ввести любой HTML, который хотите. В листинге 20.4 показан один из вариантов.

Листинг 20.4. Пример HTML-файла для возвращения в ответе hello.html

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">