---
source_image: page_446.png
page_number: 446
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 36.04
tokens: 7574
characters: 2287
timestamp: 2025-12-24T10:57:37.226425
finish_reason: stop
---

Типаж State определяет совместное поведение разных состояний поста, и все состояния — Draft, PendingReview и Published — будут реализовывать типаж State. Пока что у данного типажа нет никаких методов. Мы начнем с определения только Draft, потому что именно с этого состояния начинается пост.

Когда мы создаем новый экземпляр структуры Post, то устанавливаем его поле state равным значению Some, в котором содержится умный указатель Box 1. Вокз указывает на новый экземпляр структуры Post. Благодаря этому всякий раз, когда мы создаем новый экземпляр структуры Post, он будет начинаться как черновик. Поскольку поле state экземпляра структуры Post приватное, нет никакого способа создать Post в любом другом состоянии! В функции Post::new мы устанавливаем поле content равным новому, пустому экземпляру типа String 2.

Хранение текста поста

Листинг 17.11 показывает, что мы хотим вызывать метод add_text и передавать ему строковый срез &str, который затем добавляется в текстовое содержимое статьи блога. Мы реализуем его как метод, а не представляем поле content как pub. Это означает, что позже мы можем реализовать метод, который будет контролировать, как читаются данные поля content. Метод add_text довольно прост, поэтому давайте добавим его реализацию в блок impl Post листинга 17.13.

Листинг 17.13. Реализация метода add_text для добавления текста в содержимое поста
src/lib.rs
impl Post {
    // --пропуск--
    pub fn add_text(&mut self, text: &str) {
        self.content.push_str(text);
    }
}

Метод add_text берет изменяемую ссылку на self, потому что мы изменяем экземпляр структуры Post, для которой вызываем метод add_text. Затем мы вызываем push_str для экземпляра типа String в поле content и передаем аргумент text для добавления в сохраненное содержимое content. Это поведение не зависит от состояния, в котором находится пост, поэтому оно не является частью паттерна переходов между состояниями. Метод add_text вообще не взаимодействует с полем content, но представляет собой часть нужного нам поведения.

Делаем пустой черновик

Даже после того, как мы вызвали метод add_text и добавили некое содержимое в статью, нужно, чтобы метод content по-прежнему возвращал пустой строковый срез, так как статья пока находится в черновом состоянии, как показано в 3 в лис-