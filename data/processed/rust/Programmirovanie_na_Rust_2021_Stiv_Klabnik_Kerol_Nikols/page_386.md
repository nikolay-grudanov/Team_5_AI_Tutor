---
source_image: page_386.png
page_number: 386
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 27.73
tokens: 7478
characters: 1959
timestamp: 2025-12-24T10:55:51.832284
finish_reason: stop
---

О Так как тип RefCell<T> допускает, чтобы изменяемые заимствования проверялись во время выполнения, вы можете изменять значение внутри типа RefCell<T>, даже когда тип RefCell<T> неизменяем.

Изменение значения внутри неизменяемого значения — это паттерн внутренней изменяемости. Давайте посмотрим, когда внутренняя изменяемость бывает полезна, и узнаем, как это работает.

Внутренняя изменяемость: изменяемое заимствование неизменяемого значения

Из правил заимствования следует, что, когда у вас есть неизменяемое значение, вы не можете заимствовать его изменяемо. Например, этот код не компилируется:

fn main() {
    let x = 5;
    let y = &mut x;
}

Если вы попытаетесь скомпилировать этот код, то получите ошибку1:

error[E0596]: cannot borrow immutable local variable 'x' as mutable
 --> src/main.rs:3:18
  |
2 |     let x = 5;
  |         - consider changing this to 'mut x'
3 |     let y = &mut x;
  |                        ^ cannot borrow mutably

Однако есть ситуации, в которых полезно, чтобы значение само изменялось в своих методах, но было неизменяемым для другого кода. Код, находящийся вне методов такого значения, не сможет изменить это значение. Использование типа RefCell<T> — это один из способов получить внутреннюю изменяемость. Но тип RefCell<T> не обходит правила заимствования полностью: контролер заимствования в компиляторе допускает эту внутреннюю изменяемость, а правила заимствования проверяются во время выполнения. Нарушив эти правила, вместо ошибки компилятора вы получите panic!.

Давайте на практике посмотрим, где можно использовать тип RefCell<T> для изменения неизменяемого значения, и узнаем, почему это полезно.

Вариант использования внутренней изменяемости: мок-объекты

Тестовый двойник — это часто встречающееся понятие программирования, когда во время тестирования один тип используется вместо другого. Объекты-пустыш-

1 ошибка[E0596]: невозможно заимствовать неизменяемую локальную переменную 'x' как изменяемую