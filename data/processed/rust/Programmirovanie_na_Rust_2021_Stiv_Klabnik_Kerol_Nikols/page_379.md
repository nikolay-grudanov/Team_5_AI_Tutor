---
source_image: page_379.png
page_number: 379
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 28.90
tokens: 7542
characters: 2337
timestamp: 2025-12-24T10:55:42.474667
finish_reason: stop
---

Это сообщение об ошибке указывает, что нельзя вызывать метод drop явным образом. В указанном сообщении используется общий термин программирования «деструктор», обозначающий функцию, которая очищает экземпляр. Деструктор аналогичен конструктору, который создает экземпляр. Функция drop языка Rust представляет собой деструктор.

Язык Rust не позволяет вызывать метод drop явным образом, потому что он будет вызывать метод drop автоматически для значения в конце функции main. Иначе это привело бы к ошибке двойного высвобождения, потому что язык Rust пытался бы очистить одно и то же значение дважды.

Нельзя отключить автоматическую вставку drop, когда значение выходит из области видимости, также нельзя вызывать метод drop явным образом. Поэтому, если нам нужно принудительно очистить значение досрочно, то мы можем применить функцию std::mem::drop.

Функция std::mem::drop отличается от метода drop из типажа Drop. Мы вызываем ее, передавая в качестве аргумента значение, которое нужно принудительно отбросить досрочно. Указанная функция находится в прелюдии, поэтому мы можем изменить функцию main из листинга 15.15 так, чтобы та вызывала функцию drop, как показано в листинге 15.16.

Листинг 15.16. Вызов функции std::mem::drop для явного отбрасывания значения, прежде чем оно выйдет из области видимости

src/main.rs

```rust
fn main() {
    let c = CustomSmartPointer { data: String::from("некие данные") };
    println!("Экземпляр CustomSmartPointer создан.");
    drop(c);
    println!("CustomSmartPointer отброшен до конца функции main.");
}
```

При выполнении этого кода будет выведено следующее:

    CustomSmartPointer created.
    Dropping CustomSmartPointer with data `some data`!
    CustomSmartPointer dropped before the end of main.

Текст Dropping CustomSmartPointer with data `some data`! выводится между текстом CustomSmartPointer created. и текстом CustomSmartPointer dropped before the end of main., показывая, что код функции drop вызывается для отбрасывания переменной с в этой точке.

Вы можете использовать код, задаваемый в реализации типажа Drop, многими способами, делая очистку удобной и безопасной. Например, можно использовать его для создания собственного средства выделения памяти! С типажом Drop и системой владения Rust вам не нужно помнить об очистке, потому что компилятор делает ее автоматически.