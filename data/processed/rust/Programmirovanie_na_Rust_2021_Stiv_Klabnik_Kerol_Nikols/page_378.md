---
source_image: page_378.png
page_number: 378
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 29.40
tokens: 7527
characters: 2051
timestamp: 2025-12-24T10:55:40.461852
finish_reason: stop
---

Экземпляры CustomSmartPointer созданы.
Отбрасывается CustomSmartPointer с данными `чужие вещи`!
Отбрасывается CustomSmartPointer с данными `мои вещи`!

Rust автоматически вызывал метод drop, когда экземпляры выходили из области видимости, вызывая заданный нами код. Переменные отбрасываются в обратном порядке их создания, поэтому переменная d была отброшена до переменной с.

Этот пример дает вам наглядное руководство по работе метода drop. Обычно вместо печатаемого сообщения вы задаете код очистки, который должен выполняться типом.

Досрочное отбрасывание значения с помощью std::mem::drop

К сожалению, отключить автоматический метод drop не так просто. Отключать метод drop обычно не требуется, смысл типажа Drop в том, что он обрабатывается автоматически. Время от времени, однако, вы, возможно, захотите очищать значение досрочно. Один из примеров — использование умных указателей, управляющих замками: вы, возможно, захотите выполнить метод drop принудительно, освободив замок, чтобы другой код в той же области видимости смог получить этот замок. Rust не дает вызывать метод drop типажа Drop вручную. Если вы захотите принудительно отбросить значение до конца его области видимости, то должны вызвать функцию std::mem::drop, предусмотренную стандартной библиотекой.

Если мы попытаемся вызвать метод drop типажа Drop вручную путем модификации функции main в листинге 15.14, как показано в листинге 15.15, то произойдет ошибка компилятора.

Листинг 15.15. Попытка вызвать метод drop из типажа Drop вручную для досрочной очистки

src/main.rs
```rust
fn main() {
    let c = CustomSmartPointer { data: String::from("некие данные") };
    println!("Экземпляр CustomSmartPointer создан.");
    c.drop();
    println!("CustomSmartPointer отброшен до конца функции main.");
}
```

Когда мы попытаемся скомпилировать этот код, то получим ошибку¹:

error[E0040]: explicit use of destructor method
 --> src/main.rs:14:7
  |
14 |     c.drop();
  |     ^^^^ explicit destructor calls not allowed

¹ ошибка[E0040]: явное использование метода деструктора