---
source_image: page_200.png
page_number: 200
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 26.61
tokens: 7476
characters: 1913
timestamp: 2025-12-24T10:50:55.092067
finish_reason: stop
---

Поскольку это сообщение об ошибке начинается с указанного нами текста — Не получилось открыть hello.txt, — то становится легче найти место, откуда приходит это сообщение об ошибке. Если мы используем метод unwrap в нескольких местах, то потребуется больше времени, чтобы выяснить, какой именно метод unwrap служит причиной паники, потому что все вызовы метода unwrap, которые поднимают панику, печатают одно и то же сообщение.

Распространение ошибок

Когда вы пишете функцию, реализация которой вызывает что-то, что, возможно, не сработает, вместо того, чтобы обрабатывать ошибку внутри этой функции, вы можете вернуть ошибку в вызывающий код, и уже он будет решать, что делать. Это называется «распространение» ошибки, оно дает вызывающему коду больше контроля над тем, где, возможно, больше информации или алгоритмов, которые диктуют то, как следует обрабатывать ошибку, а не то, что у вас есть в контексте кода.

Например, листинг 9.6 показывает функцию, которая читает имя пользователя из файла. Если файл не существует или его не получается прочитать, функция вернет эти ошибки в код, вызвавший данную функцию.

Листинг 9.6. Функция, которая возвращает ошибки в вызывающий код с помощью выражения match

src/main.rs
use std::io;
use std::io::Read;
use std::fs::File;

fn read_username_from_file() -> Result<String, io::Error> {
    let f = File::open("hello.txt"); // 2

    let mut f = match f {
        Ok(file) => file,
        Err(e) => return Err(e),
    };

    let mut s = String::new();

    match f.read_to_string(&mut s) { // 5
        Ok(_) => Ok(s), // 7
        Err(e) => Err(e), // 8
    }
}

Указанную функцию можно записать гораздо короче, но мы начнем с того, что проделаем большую часть работы вручную, чтобы познакомиться с обработкой ошибок. В конце мы покажем более короткий способ. Давайте сначала посмотрим на возвращаемый из функции тип: Result<String, io::Error> 1. Он означает, что