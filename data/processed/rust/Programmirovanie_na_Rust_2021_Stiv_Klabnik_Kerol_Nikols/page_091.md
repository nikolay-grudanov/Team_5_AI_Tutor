---
source_image: page_091.png
page_number: 91
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 48.92
tokens: 7832
characters: 3113
timestamp: 2025-12-24T10:48:26.276013
finish_reason: stop
---

СТЕК И КУЧА

Во многих языках программирования не нужно часто думать о стеке и куче. Но в языке системного программирования, таком как Rust, то, где находится значение — в стеке или куче, — существенно влияет на то, как себя ведет язык и почему приходится принимать те или иные решения. Соответствующие компоненты владения будут описаны применительно к стеку и куче далее в этой главе, поэтому ниже приведено краткое подготовительное пояснение.

И стек, и куча являются частями памяти, которые доступны коду для использования во время выполнения, но они структурированы по-разному. Стек хранит значения в том порядке, в котором он их получает, а удаляет значения в обратном порядке. Этот принцип называется «последним вошел, первым вышел». Подумайте о стопке тарелок: когда вы добавляете тарелки в стопку, вы кладете их наверх, а когда вам нужно взять тарелку, вы снимаете ее сверху. Добавить тарелки в середину и вниз или убрать их оттуда не получится! Добавление данных называется вталкиванием в стек, а удаление данных называется выталкиванием из стека.

Все данные, хранящиеся в стеке, должны иметь известный фиксированный размер. А вот данные, размер которых во время компиляции неизвестен или может измениться, должны храниться в куче. Куча менее организована: когда вы помещаете данные в кучу, вы запрашиваете определенный объем пространства. Операционная система находит достаточно большое пустое место в куче, помечает его как используемое и возвращает указатель, являющийся адресом этого места. Такой процесс называется выделением пространства в куче и иногда сокращается до двух слов — выделение пространства. Вталкивание значений в стек не считается выделением. Поскольку указатель известен и имеет фиксированный размер, вы можете хранить указатель в стеке, но, когда вам нужны фактические данные, вы должны проследовать по указателю.

Представьте себе, как вас обслуживают в ресторане. Когда вы входите, то говорите, сколько вас, и сотрудник находит свободный столик, подходящий всем, и провожает вас. Если кто-то из вашей компании приходит позже, он может спросить, где вы сидите, чтобы вас найти.

Вталкивание в стек происходит быстрее, чем выделение пространства в куче, поскольку операционной системе не нужно искать место для хранения новых данных. Это место всегда находится в верхней части стека. В сравнении с этим выделение пространства в куче требует больше усилий, поскольку операционная система сначала должна найти достаточно большое пространство для хранения данных, а затем выполнить служебные действия по подготовке к следующему выделению.

Доступ к данным в куче происходит медленнее, чем к данным в стеке, поскольку для этого необходимо проследовать по указателю. Современные процессоры работают быстрее, если они меньше перемещаются по памяти. Продолжая аналогию, рассмотрим пример с официантом в ресторане, принимающим заказы от многих столиков. Эффективнее всего получить все заказы от одного столика и только потом переходить к следующему. Процесс получения заказа от столика A, затем от столика B, далее еще одного заказа от A, а после снова от B будет гораздо медленнее. Точно