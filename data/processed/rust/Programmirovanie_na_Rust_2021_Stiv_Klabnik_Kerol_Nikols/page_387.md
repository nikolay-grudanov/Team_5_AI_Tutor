---
source_image: page_387.png
page_number: 387
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 26.59
tokens: 7468
characters: 1932
timestamp: 2025-12-24T10:55:53.526031
finish_reason: stop
---

ки, или mock-объекты, — это специфические типы тестовых двойников, которые регистрируют происходящее во время теста, что позволяет проверить правильность предпринятых действий.

В Rust нет объектов в том же смысле, что и в других языках, а в стандартную библиотеку Rust не встроена функциональность имитационных объектов, как в некоторых других языках. Однако вы можете создать структуру, подобную имитационному объекту.

Вот сценарий, который мы будем тестировать: мы создадим библиотеку, которая отслеживает значение по отношению к максимальному значению и отправляет сообщения о том, насколько близко текущее значение к максимальному. Эта библиотека может использоваться, например, для отслеживания квоты пользователя на число вызовов API, которые ему разрешено выполнять.

В нашей библиотеке будет только одна возможность: отследить, насколько близко значение находится к максимальному, а также какие сообщения необходимы и в какое время. Приложения, которые используют библиотеку, должны обеспечить механизм отправки сообщений: приложение могло бы помещать сообщение в приложение, отправлять электронное письмо, текстовое сообщение или что-то еще. Библиотека не должна знать эту деталь. Все, что ей нужно, — это нечто, что реализует типаж под названием Messenger. Листинг 15.20 показывает код библиотеки.

Листинг 15.20. Библиотека, позволяющая отслеживать близость значения к максимальному и предупреждать, когда это значение находится на неких уровнях src/lib.rs

pub trait Messenger {
    fn send(&self, msg: &str);
}

pub struct LimitTracker<'a, T: 'a + Messenger> {
    messenger: &'a T,
    value: usize,
    max: usize,
}

impl<'a, T> LimitTracker<'a, T>
    where T: Messenger {
    pub fn new(messenger: &T, max: usize) -> LimitTracker<T> {
        LimitTracker {
            messenger,
            value: 0,
            max,
        }
    }

    pub fn set_value(&mut self, value: usize) {
        self.value = value;