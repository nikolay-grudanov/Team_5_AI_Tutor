---
source_image: page_297.png
page_number: 297
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 25.11
tokens: 7442
characters: 1851
timestamp: 2025-12-24T10:53:28.359498
finish_reason: stop
---

1. Написать тест, который не срабатывает, и выполнить его, чтобы убедиться, что он не срабатывает по известной вам причине.

2. Написать или модифицировать объем кода, достаточный для того, чтобы новый тест проходил успешно.

3. Провести рефакторинг кода, который вы только что добавили или модифицировали, и убедиться, что тесты продолжают проходить успешно.

4. Повторить, начиная с пункта 1!

Этот процесс является лишь одним из многих способов написания ПО, но разработка на основе тестирования также помогает направлять процесс планирования кода. Написание теста перед написанием кода, который приводит к успешному прохождению теста, помогает поддерживать высокий уровень тестового покрытия на протяжении всего процесса.

Мы проверим реализацию функциональности, которая будет фактически искать строку запроса в содержимом файла и создавать список строк файла, соответствующих запросу. Мы добавим это свойство в функцию под названием search.

Написание провального теста

Поскольку инструкции println!, которые мы использовали для проверки поведения программы, больше не нужны, давайте уберем их из src/lib.rs и src/main.rs. Затем в src/lib.rs мы добавим модуль tests с тестовой функцией, как это было сделано в главе 11. Тестовая функция определяет необходимые свойства функции search: она будет принимать запрос и текст для поиска запроса. Эта функция будет возвращать только те строки из текста, которые содержат запрос. В листинге 12.15 показан этот тест, он пока что не компилируется.

Листинг 12.15. Создание провального теста для функции search, которую мы хотели бы иметь

src/lib.rs
```rust
#[cfg(test)]
mod tests {
    use super::*;

    #[test]
    fn one_result() {
        let query = "duct";
        let contents = "\n
Rust:
safe, fast, productive.
Pick three.";

        assert_eq!(
            vec!["safe, fast, productive."],
```