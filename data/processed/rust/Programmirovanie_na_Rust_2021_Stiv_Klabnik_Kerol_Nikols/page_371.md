---
source_image: page_371.png
page_number: 371
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 29.02
tokens: 7479
characters: 1801
timestamp: 2025-12-24T10:55:30.275209
finish_reason: stop
---

Сравнение числа и ссылки на это число не допускается, поскольку они относятся к разным типам. Мы должны использовать оператор разыменования, пройдя по ссылке на значение, на которое она указывает.

Использование Box<T> в качестве ссылки

Мы можем переписать код листинга 15.6 так, чтобы использовать умный указатель Box<T> вместо ссылки. Оператор разыменования будет работать, как показано в листинге 15.7.

Листинг 15.7. Использование оператора разыменования в умном указателе Box<i32>
src/main.rs
fn main() {
    let x = 5;
    let y = Box::new(x);
    assert_eq!(5, x);
    assert_eq!(5, *y);
}

Единственное различие между листингом 15.7 и листингом 15.6 состоит в том, что здесь мы устанавливаем переменную y как экземпляр типа Box, указывающего на значение в переменной x, а не как ссылку, указывающую на значение переменной x ①. В последнем проверочном утверждении ② мы можем использовать оператор разыменования, чтобы пройти по указателю Box таким же образом, как мы делали, когда переменная y была ссылкой. Далее мы узнаем характерные особенности типа Box<T>, благодаря которым можно использовать оператор разыменования путем определения собственного типа Box.

Определение собственного умного указателя

Давайте построим умный указатель, подобный типу Box<T> из стандартной библиотеки, чтобы увидеть на практике, чем по умолчанию отличаются умные указатели от ссылок. Затем мы посмотрим, как добавлять возможность использовать оператор разыменования.

Тип Box<T> в конечном счете определяется как кортежная структура с одним элементом, поэтому листинг 15.8 определяет тип MyBox<T> таким же образом. Мы также определим функцию new, которая будет соответствовать функции new, определенной для Box<T>.

Листинг 15.8. Определение типа MyBox<T>
src/main.rs
struct MyBox<T>(T);

impl<T> MyBox<T> {