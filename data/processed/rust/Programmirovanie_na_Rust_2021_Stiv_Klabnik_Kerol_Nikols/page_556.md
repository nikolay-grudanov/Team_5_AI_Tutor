---
source_image: page_556.png
page_number: 556
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 32.58
tokens: 7495
characters: 1841
timestamp: 2025-12-24T11:00:25.342317
finish_reason: stop
---

ния, который получает метод execute. Как описано в разделе «Создание синонимов типов с помощью псевдонимов типов» (с. 506), псевдонимы типов позволяют делать длинные типы короче. Взгляните на листинг 20.19.

Листинг 20.19. Создание псевдонима типа Job для умного указателя Box, содержащего каждое замыкание, а затем отправка задания по каналу src/lib.rs

```rust
// --пропуск--

type Job = Box<FnOnce() + Send + 'static>;

impl ThreadPool {
    // --пропуск--

    pub fn execute<F>(&self, f: F)
        where
            F: FnOnce() + Send + 'static
    {
        let job = Box::new(f);
        self.sender.send(job).unwrap();
    }
}

// --пропуск--
```

После создания нового экземпляра типа Job с использованием замыкания, которое мы получаем в методе execute ①, мы отправляем это задание по отправляющему концу канала ②. Мы вызываем метод unwrap для send на тот случай, если отправить сообщение не получится. Это может произойти, например, если мы остановим выполнение всех потоков, то есть принимающая сторона перестала получать новые сообщения. На данный момент мы не можем остановить исполнение потоков: они продолжают свою работу до тех пор, пока существует пул. Мы используем метод unwrap, потому что знаем, что сбоя не произойдет, но компилятору это неизвестно.

Но мы еще не закончили! В работнике замыкание, передаваемое в функцию thread::spawn, по-прежнему ссылается только на принимающий конец канала. Вместо этого нужно, чтобы замыкание работало в бесконечном цикле, запрашивая у принимающего конца канала задание и выполняя его при получении. Давайте внесем изменение, показанное в листинге 20.20, в функцию Worker::new.

Листинг 20.20. Получение и исполнение заданий в потоке работника Worker src/lib.rs

```rust
// --пропуск--

impl Worker {
    fn new(id: usize, receiver: Arc<Mutex<mpsc::Receiver<Job>>>) -> Worker {
```