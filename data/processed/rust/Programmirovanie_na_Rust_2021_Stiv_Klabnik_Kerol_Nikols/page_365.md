---
source_image: page_365.png
page_number: 365
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 38.15
tokens: 7660
characters: 2561
timestamp: 2025-12-24T10:55:26.887477
finish_reason: stop
---

Применение рекурсивных типов с помощью умных указателей Box

Компилятору нужно знать, сколько места занимает тип. Один из типов, размер которого нельзя узнать во время компиляции, — рекурсивный тип, где частью значения может быть еще одно значение того же типа. Поскольку эта вложенность значений теоретически может продолжаться бесконечно, язык Rust не знает, сколько места требуется для значения рекурсивного типа. Однако размер умных указателей Box известен, поэтому, вставляя Box в определение рекурсивного типа, вы можете иметь рекурсивные типы.

Давайте изучим cons-список, рекурсивный тип данных, часто встречающийся в языках функционального программирования. За исключением рекурсии тип cons-списка, который мы определим, довольно прост, поэтому идеи в примере, который мы рассмотрим, пригодятся при работе с более сложными примерами, где есть рекурсивные типы.

Более подробная информация о cons-списке

Cons-список — это структура данных, которая происходит из языка Lisp и его диалектов. В Lisp функция cons (расшифровывается как «сконструировать функцию») создает новую пару из двух аргументов, обычно это значение и еще одна пара. Эти пары, содержащие пары, образуют список.

Понятие функции cons вошло в более общий жаргон функционального программирования: в английском языке «to cons x on y» («прикрепить x к y») неофициально означает «сконструировать новый экземпляр контейнера, поместив элемент x в начало этого нового контейнера, за которым следует контейнер y».

Каждый элемент в cons-списке содержит два элемента: значение текущего элемента и значение следующего элемента. Последний элемент в списке содержит только значение Nil без следующего элемента. Cons-список создается рекурсивным вызовом функции cons. Каноническим именем для обозначения базового случая рекурсии является Nil. Обратите внимание, это не то же самое, что понятие “null” в главе 6, которое является недействительным или отсутствующим значением.

Хотя языки функционального программирования часто используют cons-списки, в Rust cons-список применяется не так широко. В большинстве случаев, когда у вас есть список элементов в языке Rust, лучше всего выбрать Vec<T>. Другие, более сложные рекурсивные типы данных бывают полезными в различных ситуациях, но, начав с cons-списка, можно, ни на что не отвлекаясь, узнать, как умные указатели Box помогают определять рекурсивный тип данных.

Листинг 15.2 содержит определение перечисления для cons-списка. Обратите внимание, что этот код пока не компилируется, поскольку размер типа List неизвестен, что мы и продемонстрируем.