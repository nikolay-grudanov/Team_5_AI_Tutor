---
source_image: page_324.png
page_number: 324
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 30.82
tokens: 7515
characters: 1980
timestamp: 2025-12-24T10:54:16.325604
finish_reason: stop
---

src/main.rs

fn main() {
    let x = 4;

    fn equal_to_x(z: i32) -> bool { z == x }

    let y = 4;

    assert!(equal_to_x(y));
}

Мы получаем ошибку¹:

error[E0434]: can't capture dynamic environment in a fn item; use the || { ... } closure form instead
--> src/main.rs
|
4 | fn equal_to_x(z: i32) -> bool { z == x }

Компилятор даже напоминает нам о том, что это работает только с замыканиями!

Когда замыкание захватывает значение из своей среды, оно использует память, сохраняя значения в теле замыкания. Такое использование памяти является теми накладными расходами, которые мы не хотим оплачивать в более общих случаях, когда нужно выполнить код, который не захватывает свою среду. Поскольку функции не позволяют захватывать среду, определение и использование функций не повлечет за собой таких накладных расходов.

Замыкания захватывают значения из своей среды тремя способами — они непосредственно соотносятся с тремя способами, которыми функция может брать параметр: беря во владение, заимствуя изменяемо и заимствуя неизменяемо. Они кодируются в трех типажах Fn следующим образом:

○ FnOnce использует переменные, которые он захватывает из окаймляющей его области видимости, именуемой средой замыкания. Для того чтобы потребить захваченные переменные, замыкание должно брать их во владение и перемещать в замыкание, когда оно определено. Часть имени Once означает, что замыкание не может владеть одними и теми же переменными более одного раза, поэтому оно может быть вызвано только один раз.

○ FnMut может изменять среду, потому что он заимствует значения изменяемо.

○ Fn заимствует значения из среды неизменяемо.

Когда вы создаете замыкание, язык Rust логически выводит типаж, подлежащий использованию, основываясь на том, как замыкание использует значения из среды. Абсолютно все замыкания реализуют FnOnce, потому что все они могут быть

¹ ошибка[E0434]: не удается захватить динамическую среду в элементе fn; вместо этого используйте форму замыкания || { ... }