---
source_image: page_284.png
page_number: 284
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 40.66
tokens: 7663
characters: 2762
timestamp: 2025-12-24T10:53:23.994917
finish_reason: stop
---

Прежде всего, функция main теперь выполняет две задачи: проводит разбор аргументов и читает файлы. Для такой маленькой функции это не является серьезной проблемой. Однако если мы продолжим развивать программу внутри функции main, то число отдельных задач, которые обрабатывает функция main, будет увеличиваться. По мере того как расширяется круг ответственности функции, об этой функции становится труднее рассуждать, ее становится труднее тестировать и труднее вносить в нее изменения, не нарушая ни одной из ее частей. Лучше всего разделить функциональность так, чтобы каждая функция отвечала за одну задачу.

Эта трудность связана со второй проблемой: хотя переменные query и filename являются конфигурационными для программы, такие переменные, как contents, используются для выполнения алгоритма программы. Чем длиннее функция main, тем больше переменных нужно ввести в область видимости; чем больше переменных в области видимости, тем сложнее отслеживать цель каждой из них. Лучше всего сгруппировать конфигурационные переменные в одну структуру и тем самым сделать ясным их назначение.

Третья проблема заключается в том, что мы использовали метод exrrest для печати сообщения об ошибке, когда не получается прочитать файл, а сообщение об ошибке просто выводит Что-то пошло не так при чтении файла. Чтение файла может не получиться в нескольких случаях: например, файл отсутствует либо у нас нет разрешения на его открытие. Сейчас, независимо от этой ситуации, мы выведем сообщение об ошибке Что-то пошло не так при чтении файла, которое не даст пользователю никакой информации!

Четвертая проблема: мы используем метод exrrest многократно для обработки разных ошибок, и если пользователь запускает программу, не указывая достаточное число аргументов, он видит ошибку выхода индекса за пределы границ (index out of bounds), которая неявно объясняет проблему. Было бы лучше, если бы весь код обработки ошибок был в одном месте, — благодаря этому будущие разработчики будут консультироваться только в одном месте кода, если потребуется внести изменение в алгоритм обработки ошибок. Наличие всего кода обработки ошибок в одном месте также позволит печатать сообщения, которые будут иметь смысл для конечных пользователей.

Давайте решим эти четыре проблемы путем рефакторинга проекта.

Разделение обязанностей в двоичных проектах

Функция main отвечает за многочисленные задачи — эта организационная проблема часто встречается во многих двоичных проектах. В результате сообщество языка Rust разработало процесс, используемый в качестве руководящего принципа для распределения обязанностей в двоичной программе, когда main расширяется. Этот процесс состоит из следующих шагов:

О Разбить программу на main.rs и lib.rs и переместить алгоритм программы в lib.rs.