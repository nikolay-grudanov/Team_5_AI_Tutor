---
source_image: page_445.png
page_number: 445
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 31.03
tokens: 7477
characters: 1915
timestamp: 2025-12-24T10:57:28.367575
finish_reason: stop
---

Затем мы хотим обеспечить возможность запроса на рассмотрение поста 4, чтобы метод content возвращал пустую строку, ожидая рассмотрения 5. Когда пост получает одобрение 6, он должен быть опубликован, то есть текст сообщения будет возвращен, когда будет вызван метод content 7.

Обратите внимание, что единственный тип из упаковки, с которым мы взаимодействуем, — это Post. Этот тип будет использовать паттерн переходов между состояниями и содержать значение — один из трех объектов состояния, в которых может быть статья-черновик, статья, которая ожидает рассмотрения, или опубликованная статья. Переход из одного состояния в другое будет управляться внутри типа Post. Состояния изменяются в ответ на методы, вызываемые пользователями библиотеки в экземпляре типа Post, но пользователям не приходится управлять изменениями состояний напрямую. Кроме того, пользователи не могут ошибиться в состояниях, например, публикуя пост до того, как он будет рассмотрен.

Определение поста и создание нового экземпляра в состоянии черновика

Давайте приступим к реализации библиотеки! Нам нужна публичная структура Post, имеющая некое содержимое, поэтому мы начнем с определения структуры и связанной с ней публичной функции new для создания экземпляра структуры Post, как показано в листинге 17.12. Мы также создадим приватный типаж State. Тогда Post будет содержать типажный объект Box<Dyn State> внутри Option<T> в приватном поле state. Чуть позже вы увидите, зачем нужен тип Option<T>.

Листинг 17.12. Определение структуры Post и функции new, создающей новый экземпляр структуры Post, а также типаж State и структура Draft
src/lib.rs

pub struct Post {
    state: Option<Box<dyn State>>,
    content: String,
}

impl Post {
    pub fn new() -> Post {
        Post {
            state: Some(Box::new(Draft {})),
            content: String::new(),
        }
    }
}

trait State {}

struct Draft {}

impl State for Draft {}