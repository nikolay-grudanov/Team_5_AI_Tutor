---
source_image: page_444.png
page_number: 444
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 36.88
tokens: 7554
characters: 2146
timestamp: 2025-12-24T10:57:33.820742
finish_reason: stop
---

Использование паттерна переходов между состояниями означает, что при изменении бизнес-требований к программе не нужно изменять код значения, содержащего состояние, или код, использующий значение. Нам нужно только обновить код внутри одного из объектов состояния, чтобы изменить его правила или, возможно, добавить больше объектов состояния. Давайте рассмотрим пример паттерна переходов между состояниями и его применение в Rust.

Мы реализуем процесс создания поста в блоге в несколько этапов. Функциональность блога будет выглядеть следующим образом:

1. Пост начинается как пустой черновик.
2. Когда черновик готов, запрашивается его проверка.
3. После того как пост одобрен, он публикуется.
4. Печатаются только опубликованные посты, поэтому неодобренные не могут быть опубликованы случайно.

Другие изменения поста не должны иметь никакого эффекта. Например, если мы попытаемся одобрить черновик поста до того, как запросим проверку, то такой пост должен остаться неопубликованным черновиком.

В листинге 17.11 процесс создания поста показан в коде: он представляет собой пример использования API для реализации в библиотечной упаковке blog. Код пока не компилируется, так как мы еще не реализовали упаковку blog.

Листинг 17.11. Код, демонстрирующий желаемое поведение упаковки blog
src/main.rs

use blog::Post;

fn main() {
    let mut post = Post::new();
    post.add_text("Сегодня на обед я ел салат");
    assert_eq!("", post.content());
    post.request_review();
    assert_eq!("", post.content());
    post.approve();
    assert_eq!("Сегодня на обед я ел салат", post.content());
}

Мы хотим, чтобы пользователь мог создавать новый черновик поста с помощью Post::new ①. Затем мы хотим, чтобы текст добавлялся в пост, пока он находится в черновом состоянии ②. Если мы попытаемся получить содержимое статьи немедленно, до ее одобрения, то ничего не произойдет, потому что пост пока еще является черновиком. Мы добавили макрокоманду assert_eq! в код для демонстрационных целей ③. Отличным модульным тестом для нее была бы проверка, что черновик возвращает пустую строку из метода content, но для данного примера мы писать тесты не будем.