---
source_image: page_538.png
page_number: 538
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 27.95
tokens: 7503
characters: 1725
timestamp: 2025-12-24T10:59:52.935458
finish_reason: stop
---

Теперь давайте добавим код из листинга 20.7 в блок else, который будет возвращать ответ с кодом состояния 404, сигнализирующий о том, что содержимое запроса не найдено. Мы также вернем некоторый HTML, который будет отображаться на странице в браузере, сообщая ответ конечному пользователю.

Листинг 20.7. Ответ с кодом состояния 404 и страницей ошибок, если запрашивается любой ресурс, кроме /
src/main.rs

```rust
// --пропуск--

} else {
    let status_line = "HTTP/1.1 404 NOT FOUND\r\n\r\n"; // 1
    let contents = fs::read_to_string("404.html").unwrap(); // 2

    let response = format!("{}{}", status_line, contents);

    stream.write(response.as_bytes()).unwrap();
    stream.flush().unwrap();
}
```

Здесь ответ имеет строку состояния с кодом 404 и причиной НЕ НАЙДЕНО 1. Мы по-прежнему не возвращаем заголовки, а телом отклика будет HTML в файле 404.html 2. Вам нужно создать файл 404.html для страницы ошибок рядом с hello.html. Опять же, вы можете применять любой HTML, который хотите, либо используйте пример HTML в листинге 20.8.

Листинг 20.8. Пример содержимого страницы для отправки обратно с любым ответом 404
404.html

```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Привет!</title>
</head>
<body>
    <h1>Ой!</h1>
    <p>Извините, я не знаю, что вы запрашиваете.</p>
</body>
</html>
```

С этими изменениями запустите сервер снова. Запрос 127.0.0.1:7878 должен возвращать содержимое hello.html, а любой запрос, к примеру 127.0.0.1:7878/foo, должен возвращать HTML с сообщением об ошибке из 404.html.

Небольшой рефакторинг

На данный момент в блоках if и else много повторов: они одновременно читают файлы и пишут содержимое файлов в поток. Единственными различиями