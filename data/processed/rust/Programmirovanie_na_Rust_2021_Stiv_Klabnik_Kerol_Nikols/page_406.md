---
source_image: page_406.png
page_number: 406
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 43.57
tokens: 7692
characters: 2678
timestamp: 2025-12-24T10:56:40.222691
finish_reason: stop
---

О Дефекты, возможные только в некоторых ситуациях, которые трудно воспроизвести и устранить.

Rust пытается смягчить негативные последствия использования потоков. Но чтобы программировать в многопоточном контексте, нужно тщательно все обдумать и разработать структуру кода, отличную от структуры кода в программах, работающих в одном потоке.

Языки программирования реализуют потоки несколькими способами. Многие ОС предусматривают API для создания новых потоков. Модель, в которой язык вызывает API для создания потоков, иногда называют 1:1, имея в виду один поток ОС на один поток языка.

Многие языки программирования предоставляют специальные реализации потоков. Потоки, предоставляемые языком программирования, называют также зелеными. Языки, использующие зеленые потоки, будут выполнять их в контексте другого числа потоков ОС. По этой причине модель с зеленым потоком называется моделью M:N:, существует M зеленых потоков на N потоков ОС, где M и N — не обязательно одно и то же число.

Каждая модель имеет свои преимущества и компромиссы, и самый важный компромисс для Rust — это поддержка времени выполнения. Термин «время выполнения» (runtime) запутанный и в разных контекстах может иметь разные значения¹.

В данном контексте под временем выполнения мы подразумеваем код, который включается языком в каждый двоичный файл. Этот код может быть крупным или малым в зависимости от языка, но каждый язык, не являющийся ассемблером, будет иметь некий объем кода времени выполнения. Когда говорят, что у языка «нет времени выполнения», часто имеют в виду «малый объем кода времени выполнения». Меньшие объемы кода времени выполнения имеют меньшее число функциональных средств, но у них есть преимущество: в результате получаются меньше по объему двоичные файлы, которые облегчают объединение языка с другими языками в большем количестве контекстов. Хотя многие языки устроены так, что в них увеличено время выполнения в обмен на дополнительные функциональные средства, в Rust почти не должно быть времени выполнения, и в нем не может быть компромисса с возможностью вызова C для поддержания производительности.

Модель обработки на основе зеленых потоков M:N требует более крупной языковой среды времени выполнения, чтобы управлять потоками. По этой причине стандартная библиотека Rust предусматривает реализацию только потоков 1:1. Ввиду того что язык Rust является весьма низкоуровневым языком, существуют упаковки, которые реализуют поточную обработку M:N, если вам нужен больший контроль того, какие потоки и когда выполняются и как снизить трудоемкость переключения контекстов.

¹ В контексте данного раздела термин «runtime» скорее обозначает среду времени выполнения.