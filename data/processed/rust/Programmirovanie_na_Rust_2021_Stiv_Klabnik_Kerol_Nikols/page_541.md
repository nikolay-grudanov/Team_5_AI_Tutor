---
source_image: page_541.png
page_number: 541
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 38.52
tokens: 7756
characters: 2701
timestamp: 2025-12-24T11:00:07.310466
finish_reason: stop
---

после блока if, чтобы проверить запрос ресурса /sleep ②. Когда этот запрос будет получен, сервер будет засыпать на 5 секунд ③ перед отображением успешной HTML-страницы ④.

Вы видите, насколько примитивен наш сервер: реальные библиотеки распознавали бы многочисленные запросы гораздо лаконичнее!

Запустите сервер с помощью команды cargo run. Затем откройте два окна браузера: одно для http://127.0.0.1:7878, а другое — для http://127.0.0.1:7878/sleep. Если вы введете URI-ресурс / несколько раз, как и раньше, то увидите, что он быстро отвечает. Но если вы введете /sleep, а затем загрузите /, то увидите, что ресурс / ждет до тех пор, пока sleep не проспит полные 5 секунд перед загрузкой.

Есть много способов изменить характер работы веб-сервера, чтобы не скапливалось большое количество запросов из-за медленного запроса. Способ, который мы применим, называется пулом потоков исполнения.

Повышение пропускной способности с помощью пула потоков исполнения

Пул потоков исполнения — это группа порожденных потоков исполнения, которые ожидают задачу и готовы ее выполнить. Когда программа получает новую задачу, она назначает ее одним из потоков исполнения в пуле — этот поток будет обрабатывать задачу. Остальные потоки в пуле могут обрабатывать другие задачи, поступающие, пока первый поток занимается обработкой. Когда первый поток завершает обработку своей задачи, он возвращается в пул незанятых потоков исполнения и готов к обработке новой задачи. Пул потоков исполнения позволяет обрабатывать соединения конкурентно, увеличивая пропускную способность сервера.

У нас в пуле будет несколько потоков исполнения для защиты от DoS-атак. Если бы программа создавала новый поток для каждого запроса по мере его поступления, то кто-то, сделав 10 миллионов запросов к серверу, создал бы хаос, израсходовав все ресурсы сервера и застопорив обработку запросов.

Мы не будем порождать неограниченное число потоков, а создадим фиксированное число ожидающих своей очереди в пуле. По мере поступления запросов они будут отправляться в пул для обработки. Пул будет поддерживать очередь входящих запросов. Каждый поток в пуле будет выталкивать запрос из этой очереди, обрабатывать его, а затем приступать к следующему запросу. С помощью этой конструкции мы можем конкурентно обрабатывать N запросов, где N — это число потоков исполнения. Если каждый поток отвечает на продолжительный запрос, то последующие запросы по-прежнему будут ожидать в очереди, но мы увеличили число продолжительных запросов, которые можно обрабатывать до момента достижения этой точки.

Это техническое решение — лишь одно из многих, которые повышают пропускную способность веб-сервера. Другие варианты — это модель ветвлений/объеди-