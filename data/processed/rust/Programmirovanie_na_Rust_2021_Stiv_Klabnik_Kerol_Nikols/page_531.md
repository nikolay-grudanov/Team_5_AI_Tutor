---
source_image: page_531.png
page_number: 531
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 36.57
tokens: 7646
characters: 2536
timestamp: 2025-12-24T10:59:52.544159
finish_reason: stop
---

давать писать ответ в поток. В целом этот цикл for будет обрабатывать каждое соединение по очереди и производить серию потоков для обработки.

Пока что обработка потока состоит из вызова метода unwrap для завершения программы, если в потоке есть ошибки 3. Если ошибок нет, то программа выводит сообщение 4. Мы добавим больше функциональности для случая успеха в следующем листинге. Причина, по которой мы можем получать ошибки от метода incoming, когда клиент подключается к серверу, заключается в том, что фактически мы перебираем не соединения, а попытки соединения. Соединение может не быть успешным по ряду причин, многие из которых зависят от операционной системы. Например, многие операционные системы имеют лимит на число одновременно открытых соединений, которые они могут поддерживать. Новые попытки соединения, превышающие это число, будут выдавать ошибку до тех пор, пока некоторые из открытых соединений не будут закрыты.

Давайте попробуем выполнить этот код! Вызовите команду cargo run в терминале, а затем загрузите 127.0.0.1:7878 в веб-браузере. Браузер должен выдать сообщение об ошибке наподобие «Connection reset» («Сброс соединения»), так как сервер в данный момент не отправляет обратно никаких данных. Но посмотрев на терминал, вы должны увидеть несколько сообщений, которые были выведены, когда браузер соединился с сервером!

    Running `target/debug/hello`
    Соединение установлено!
    Соединение установлено!
    Соединение установлено!

Иногда вы увидите, что со стороны браузера выводится несколько сообщений для одного запроса. Причина может быть в том, что браузер делает запрос страницы, а также других ресурсов, таких как иконка favicon.ico, которая появляется на вкладке браузера.

Возможно также, что браузер пытается соединиться с сервером несколько раз, потому что сервер не отвечает данными. Когда переменная stream выходит из области видимости и отбрасывается в конце цикла, соединение закрывается как часть реализации функции drop. Браузеры иногда регулируют закрытые соединения путем повторной попытки, потому что проблема может быть временной. Важно то, что мы успешно получили дескриптор для TCP-соединения!

Не забудьте остановить программу, нажав Ctrl-C, когда закончите выполнение отдельной версии кода. После внесения любых изменений в код заново выполните команду cargo run, чтобы работать с последней версией кода.

Чтение запроса

Давайте реализуем функциональность чтения запроса из браузера! Чтобы сначала получить соединение и затем выполнить некие действия с ним, мы начнем новую