---
source_image: page_098.png
page_number: 98
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 41.25
tokens: 7753
characters: 2270
timestamp: 2025-12-24T10:48:25.903386
finish_reason: stop
---

Вы получите ошибку ниже, потому что Rust мешает использовать недействительную ссылку¹:

error[E0382]: use of moved value: `s1`
  --> src/main.rs:5:28
   |
3  |     let s2 = s1;
   |         -- value moved here
4  |
5  |     println!("{}, world!", s1);
   |                        ^^ value used here after move
   = note: move occurs because `s1` has type `std::string::String`, which does not implement the `Copy` trait

Если во время работы с другими языками вы слышали термины «мелкая копия» и «глубокая копия», то копирование указателя, длины и емкости без копирования данных, вероятно, звучит как создание мелкой копии. Но так как язык Rust также делает недействительной первую переменную, эта операция называется не «мелкая копия», а «перемещение» (move). В этом примере мы бы сказали, что s1 была перемещена в s2. Поэтому то, что происходит на самом деле, показано на рис. 4.4.

И это решает проблему! Только переменная s2 действительная; когда она выйдет из области видимости, эта переменная высвободит память, и дело сделано.

В дополнение, из этого вытекает одно конструктивное решение: Rust никогда не будет автоматически создавать «глубокие» копии данных. Следовательно, любое автоматическое копирование считается незатратным с точки зрения производительности времени выполнения.

<table>
  <tr>
    <th colspan="2">s1</th>
  </tr>
  <tr>
    <th>имя</th>
    <th>значение</th>
  </tr>
  <tr>
    <td>ptr</td>
    <td></td>
  </tr>
  <tr>
    <td>длина</td>
    <td>5</td>
  </tr>
  <tr>
    <td>емкость</td>
    <td>5</td>
  </tr>
</table>

<table>
  <tr>
    <th colspan="2">s2</th>
  </tr>
  <tr>
    <th>имя</th>
    <th>значение</th>
  </tr>
  <tr>
    <td>ptr</td>
    <td></td>
  </tr>
  <tr>
    <td>длина</td>
    <td>5</td>
  </tr>
  <tr>
    <td>емкость</td>
    <td>5</td>
  </tr>
</table>

<table>
  <tr>
    <th>указатель</th>
    <th>значение</th>
  </tr>
  <tr>
    <td>0</td>
    <td>h</td>
  </tr>
  <tr>
    <td>1</td>
    <td>e</td>
  </tr>
  <tr>
    <td>2</td>
    <td>l</td>
  </tr>
  <tr>
    <td>3</td>
    <td>l</td>
  </tr>
  <tr>
    <td>4</td>
    <td>o</td>
  </tr>
</table>

Рис. 4.4. Представление в памяти после того, как переменная s1 была сделана недействительной

¹ ошибка[E0382]: использование перемещенного значения: `s1`