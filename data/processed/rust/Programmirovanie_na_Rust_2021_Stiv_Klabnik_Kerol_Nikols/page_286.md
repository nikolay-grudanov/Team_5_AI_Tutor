---
source_image: page_286.png
page_number: 286
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 33.06
tokens: 7546
characters: 2110
timestamp: 2025-12-24T10:53:17.909801
finish_reason: stop
---

алгоритм, который выясняет, какие аргументы входят в переменные, и передает значения обратно в функцию main. Мы по-прежнему создаем переменные query и filename в функции main, но main больше не отвечает за то, как соотносятся аргументы и переменные командной строки.

С учетом того, что программа небольшая, эта переделка, возможно, покажется излишней, но мы проводим рефакторинг понемногу, поступательными шагами. После внесения этого изменения выполните программу еще раз, чтобы убедиться, что разбор аргументов по-прежнему работает. Полезно часто проверять, есть ли улучшения. Это помогает выявлять причину проблем, когда они возникают.

Группировка конфигурационных значений

Мы можем сделать еще один небольшой шаг для дальнейшего улучшения функции parse_config. В данный момент мы возвращаем кортеж, но затем мы немедленно снова разбиваем его на отдельные части. Это признак того, что правильной абстракции, скорее всего, еще нет.

Еще одним индикатором, который говорит о том, что возможны улучшения, является конфигурационная часть parse_config. Из нее следует, что два возвращаемых значения связаны и являются частью одного конфигурационного значения. В настоящее время мы не передаем этот смысл в структуре данных иначе, чем группируя два значения в кортеж; мы могли бы поместить два значения в одну структуру и дать каждому полю структуры осмысленное имя. Так будущим разработчикам кода будет проще понять, как разные значения соотносятся друг с другом и какова их цель.

ПРИМЕЧАНИЕ
Использование примитивных значений, когда более уместен сложный тип, — это антипаттерн, который называется «одержимость примитивами».

Листинг 12.6 показывает улучшения функции parse_config.

Листинг 12.6. Рефакторинг функции parse_config для возвращения экземпляра структуры Config
src/main.rs
fn main() {
    let args: Vec<String> = env::args().collect();

    let config = parse_config(&args);

    println!("Поиск {}", config.query);
    println!("В файле {}", config.filename);

    let contents = fs::read_to_string(config.filename)
        .expect("Что-то пошло не так при чтении файла");
    // -- пропуск --