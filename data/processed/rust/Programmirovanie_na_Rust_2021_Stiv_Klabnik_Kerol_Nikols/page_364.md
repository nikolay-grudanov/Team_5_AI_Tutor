---
source_image: page_364.png
page_number: 364
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 35.32
tokens: 7624
characters: 2312
timestamp: 2025-12-24T10:55:24.060347
finish_reason: stop
---

О Вы хотите владеть значением, и нужно, чтобы оно имело не конкретный тип, а тип, который реализует некоторый типаж.

Мы продемонстрируем первую ситуацию в разделе «Применение рекурсивных типов с помощью умных указателей Box». Во втором случае передача владения крупного объема данных может занимать много времени, поскольку данные копируются из всего стека. В целях повышения производительности в этой ситуации мы можем хранить крупный объем данных кучи в умном указателе Box. Тогда только небольшой объем данных указателя копируется из стека, в то время как данные, на которые он ссылается, остаются в одном месте в куче. Третий случай называется типажным объектом, в главе 17 целый раздел («Использование типажных объектов, допускающих значения разных типов») посвящен указанной теме. Поэтому вы снова примените знания из этого раздела в главе 17!

Использование Box<T> для хранения данных в куче

Прежде чем обсудить этот вариант использования Box<T>, мы рассмотрим его синтаксис и способы взаимодействия со значениями, хранящимися в указателе Box<T>.

Листинг 15.1 показывает использование умного указателя Box для хранения значения типа i32 в куче.

Листинг 15.1. Хранение значения типа i32 в куче с помощью умного указателя Box
src/main.rs
```rust
fn main() {
    let b = Box::new(5);
    println!("b = {}", b);
}
```

Мы определяем переменную b как имеющую значение Box, которая указывает на значение 5, размещаемое в куче. Эта программа выведет b = 5. В данном случае мы можем обратиться к данным в умном указателе Box аналогично тому, как мы бы сделали, если бы эти данные были в стеке. Так же, как любое обладаемое значение, когда умный указатель Box выходит из области видимости, как это делает переменная b в конце функции main, она будет высвобождена. Высвобождение происходит для умного указателя Box (хранящегося в стеке) и для данных, на которые он указывает (хранящихся в куче).

Размещение одного значения в куче не имеет особых преимуществ, поэтому вы не будете часто использовать умные указатели Box по отдельности таким образом. В большинстве ситуаций уместнее иметь значения наподобие одного i32 в стеке, где они хранятся по умолчанию. Давайте посмотрим, в каком случае умные указатели Box позволяют определять типы, которые нельзя было бы определять, если бы не было умных указателей Box.