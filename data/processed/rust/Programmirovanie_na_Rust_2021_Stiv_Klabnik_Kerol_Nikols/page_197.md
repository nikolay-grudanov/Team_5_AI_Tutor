---
source_image: page_197.png
page_number: 197
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 27.18
tokens: 7524
characters: 2073
timestamp: 2025-12-24T10:50:49.789418
finish_reason: stop
---

Если в текущем каталоге нет файла с именем hello.txt, а мы выполним этот код, то из макрокоманды panic! будут получены такие денные¹:

thread 'main' panicked at 'Problem opening the file: Error { repr: Os { code: 2, message: "No such file or directory" } }', src/main.rs:9:12

Как обычно, этот результат сообщает, что конкретно пошло не так.

Применение выражения match с разными ошибками

Код в листинге 9.4 поднимет panic! независимо от того, почему функция File::open не сработала. Вместо этого мы хотим предпринимать разные действия по разным причинам сбоя. Если функция File::open не сработала, потому что файл не существует, то требуется создать файл и вернуть дескриптор на новый файл. Если же функция File::open не сработала по какой-либо другой причине — например, потому, что у нас не было разрешения на открытие файла, — нужно, чтобы код по-прежнему поднимал panic! точно так же, как это было сделано в листинге 9.4. Посмотрите на листинг 9.5, в который добавлено внутреннее выражение match.

Листинг 9.5. Обработка разных видов ошибок разными способами
src/main.rs
use std::fs::File;
use std::io::ErrorKind;

fn main() {
    let f = File::open("hello.txt");

    let f = match f {
        Ok(file) => file,
        Err(error) => match error.kind() {
            ErrorKind::NotFound => match File::create("hello.txt") {
                Ok(fc) => fc,
                Err(e) => panic!("Проблема с созданием файла: {:?}", e),
            },
            other_error => panic!("Проблема с открытием файла: {:?}", other_error),
        },
    };
}

Тип значения, которое функция File::open возвращает внутри варианта Err, равен io::Error, то есть структуре, предусмотренной стандартной библиотекой. Эта структура имеет метод kind, который мы можем вызвать, чтобы получить значение io::ErrorKind. Перечисление io::ErrorKind предусмотрено стандартной библиотекой, и в нем есть варианты, представляющие разные виды ошибок, которые

¹ поток 'main' поднял панику в точке 'Проблема с открытием файла: Error { repr: Os { code: 2, message: "Нет такого файла или каталога" } }'