---
source_image: page_201.png
page_number: 201
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 39.15
tokens: 7710
characters: 2945
timestamp: 2025-12-24T10:51:10.300007
finish_reason: stop
---

функция возвращает значение типа Result<T, E>, где обобщенный параметр T был заполнен конкретным типом String, а обобщенный тип E был заполнен конкретным типом io::Error. Если эта функция работает успешно без каких-либо проблем, то код, вызывающий эту функцию, получит значение Ok, содержащее значение экземпляра String — имя пользователя, которое эта функция прочитала из файла 7. Если же эта функция столкнется с какими-либо проблемами, то код, вызывающий ее, получит значение Err, содержащее экземпляр io::Error с дополнительной информацией о характере этих проблем. В качестве типа, возвращаемого из этой функции, мы выбрали io::Error, поскольку он оказался типом значения ошибки, возвращаемой из обеих операций, которые могут завершиться сбоем: функции File::open и метода read_to_string, вызываемых нами в теле этой функции.

Тело функции начинается с вызова функции File::open 2. Затем мы обрабатываем значение Result, возвращаемое выражением match 3, аналогичного выражению match в листинге 9.4. Только вместо вызова panic! в случае Err мы возвращаемся из этой функции досрочно и передаем значение ошибки из функции File::open обратно в вызывающий код как значение ошибки этой функции 4. Если функция File::open срабатывает успешно, то мы сохраняем файловый дескриптор в переменной f и продолжаем работу.

Затем мы создаем новый экземпляр типа String в переменной s 5 и вызываем метод read_to_string для файлового дескриптора в f, чтобы прочитать содержимое файла в переменную s 6. Метод read_to_string также возвращает Result, так как он может завершиться сбоем, даже если функция File::open сработала успешно. Поэтому нам нужно еще одно выражение match, чтобы обработать этот экземпляр типа Result: если метод read_to_string срабатывает, то функция сработала, и мы возвращаем имя пользователя из файла, которое теперь находится в переменной s, обернутое в Ok 7. Если метод read_to_string не срабатывает, то мы возвращаем значение ошибки таким же образом, как вернули значение ошибки в выражении match, которое обрабатывало значение, возвращаемое из функции File::open 8. Однако нам не нужно указывать инструкцию return, потому что это выражение является последним в функции.

Код, который вызывает этот код, затем займется обработкой, получив либо значение Ok, содержащее имя пользователя, либо значение Err, содержащее io::Error. Мы не знаем, что именно вызывающий код сделает с этими значениями. Если вызывающий код получит значение Err, то он может либо вызвать panic! и аварийно завершить программу, либо воспользоваться именем пользователя по умолчанию, либо найти имя пользователя где-то еще помимо файла. У нас нет достаточной информации о том, что именно вызывающий код попытается сделать по факту, поэтому мы распространяем всю информацию об успехе или ошибке, чтобы обработать ее надлежащим образом.

Этот паттерн распространения ошибки является в Rust настолько частым, что для его упрощения в языке предоставлен оператор ?.