---
source_image: page_285.png
page_number: 285
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 30.96
tokens: 7475
characters: 1890
timestamp: 2025-12-24T10:53:14.521217
finish_reason: stop
---

О Пока алгоритм разбора командной строки небольшой, он может оставаться в main.rs.
О Когда алгоритм разбора командной строки начнет усложняться, извлечь его из main.rs и переместить в lib.rs.

После этого процесса функция main должна отвечать за следующее:
О Вызов алгоритма разбора командной строки со значениями аргументов.
О Настройка любой другой конфигурации.
О Вызов функции run в lib.rs.
О Обработка ошибки, если run возвращает ошибку.

Этот паттерн касается разделения обязанностей: main.rs выполняет программу, а lib.rs занимается полным алгоритмом поставленной задачи. Поскольку вы не можете проверить функцию main напрямую, эта структура позволяет тестировать весь алгоритм программы, переместив его в функции внутри lib.rs. Единственный код, который остается в main.rs, будет достаточно мал, и его правильность можно легко проверить, прочтя его. Давайте переделаем программу, следуя этому процессу.

Извлечение парсера аргументов

Мы извлекаем свойство разбора аргументов в функцию, которая будет вызываться функцией main, для подготовки к перемещению алгоритма разбора командной строки в src/lib.rs. Листинг 12.5 показывает новое начало функции main, вызывающей новую функцию parse_config, которую мы пока обозначим в src/main.rs.

Листинг 12.5. Извлечение функции parse_config из main
src/main.rs

```rust
fn main() {
    let args: Vec<String> = env::args().collect();

    let (query, filename) = parse_config(&args);

    // --пропуск--
}

fn parse_config(args: &[String]) -> (&str, &str) {
    let query = &args[1];
    let filename = &args[2];

    (query, filename)
}
```

Мы по-прежнему собираем аргументы командной строки в вектор, но вместо того, чтобы передавать значение аргумента в индексе 1 переменной query, а значение аргумента в индексе 2 переменной filename внутри функции main, мы передаем весь вектор функции parse_config. Тогда функция parse_config содержит