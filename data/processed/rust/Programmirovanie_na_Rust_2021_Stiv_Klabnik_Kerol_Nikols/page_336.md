---
source_image: page_336.png
page_number: 336
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 34.14
tokens: 7506
characters: 2009
timestamp: 2025-12-24T10:54:39.154775
finish_reason: stop
---

Функция env::args возвращает итератор! Вместо того чтобы собирать итераторные значения в вектор и затем передавать срез в метод Config::new, теперь мы напрямую передаем владение итератора, возвращаемого из функции env::args, в функцию Config::new.

Далее нужно обновить определение Config::new. В файле src/lib.rs проекта ввода-вывода давайте изменим сигнатуру функции Config::new так, чтобы она выглядела как в листинге 13.26. Этот код пока не компилируется, потому что нужно обновить тело функции.

Листинг 13.26. Обновление сигнатуры функции Config::new, в результате которого ожидается итератор

src/lib.rs
impl Config {
    pub fn new(mut args: std::env::Args) -> Result<Config, &'static str> {
        // --пропуск--
    }
}

Документация стандартной библиотеки для функции env::args показывает, что тип возвращаемого ею итератора равен std::env::Args. Мы обновили сигнатуру функции Config::new, поэтому параметр args вместо типа &[String] теперь имеет тип std::env::Args. Поскольку мы берем параметр args во владение и будем изменять args путем перебора, мы можем добавить в описание параметра args ключевое слово mut, сделав его изменяемым.

Использование методов типажа Iterator вместо индексирования

Далее мы исправим тело метода Config::new. В документации стандартной библиотеки также упоминается, что std::env::Args реализует типаж Iterator, поэтому мы знаем, что можем вызывать для него метод next! В листинге 13.27 обновлен код из листинга 12.23 посредством использования метода next.

Листинг 13.27. Изменение тела функции Config::new с целью использования итераторных методов

src/lib.rs
impl Config {
    pub fn new(mut args: std::env::Args) -> Result<Config, &'static str> {
        args.next();

        let query = match args.next() {
            Some(arg) => arg,
            None => return Err("Не получена строка запроса"),
        };

        let filename = match args.next() {
            Some(arg) => arg,
            None => return Err("Не получено имя файла"),
        };
    }
}