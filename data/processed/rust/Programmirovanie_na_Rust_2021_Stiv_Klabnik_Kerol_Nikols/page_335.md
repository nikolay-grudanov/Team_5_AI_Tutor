---
source_image: page_335.png
page_number: 335
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 33.75
tokens: 7489
characters: 1925
timestamp: 2025-12-24T10:54:38.726266
finish_reason: stop
---

Здесь мы нуждались в методе clone потому, что в параметре args у нас срез с элементами типа String, но функция new параметром args не владеет. Для того чтобы возвращать владение экземплярам структуры Config, нам пришлось клонировать значения из полей query и filename структуры Config, и благодаря этому экземпляр структуры Config может владеть своими значениями.

С учетом новых знаний об итераторах мы можем изменить функцию new так, чтобы в качестве своего аргумента вместо заимствования среза она брала во владение итератор. Мы будем использовать итераторную функциональность вместо кода, который проверяет длину среза и выполняет индексирование в определенные места. Это сделает яснее принцип работы функции Config::new, поскольку итератор будет обращаться к значениям.

После того как Config::new берет итератор во владение и перестает использовать заимствующие индексные операции, мы можем больше не вызывать метод clone и не выделять новое пространство памяти, а переместить значения типа String из итератора в структуру Config.

Использование возвращаемого итератора напрямую

Откройте файл src/main.rs проекта ввода-вывода, который должен выглядеть следующим образом:

src/main.rs
```rust
fn main() {
    let args: Vec<String> = env::args().collect();

    let config = Config::new(&args).unwrap_or_else(|err| {
        eprintln!("Проблема с разбором аргументов: {}", err);
        process::exit(1);
    });
    // --пропуск--
}
```

Мы изменим начало функции main, которое было в листинге 12.24, на код из листинга 13.25. Этот код не будет компилироваться до тех пор, пока мы также не обновим Config::new.

Листинг 13.25. Передача возвращаемого значения из функции env::args в функцию Config::new
src/main.rs
```rust
fn main() {
    let config = Config::new(env::args()).unwrap_or_else(|err| {
        eprintln!("Проблема с разбором аргументов: {}", err);
        process::exit(1);
    });
    // --пропуск--
}
```