---
source_image: page_547.png
page_number: 547
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 36.16
tokens: 7523
characters: 2008
timestamp: 2025-12-24T11:00:18.896219
finish_reason: stop
---

| ^^^^
= note: #[warn(unused_variables)] on by default
= note: to avoid this warning, consider using `_size` instead

warning: unused variable: `f`
 --> src/lib.rs:8:30
8 |     pub fn execute<F>(&self, f: F)
   |                        ^

= note: to avoid this warning, consider using `_f` instead

Сейчас мы получаем только предупреждения, а это значит, он компилируется! Но обратите внимание: если вы попытаетесь выполнить команду cargo run и сделать запрос в браузере, то увидите ошибки, рассмотренные в начале главы. Библиотека на самом деле еще не вызывает замыкание, передаваемое в execute!

ПРИМЕЧАНИЕ

В случае языков со строгими компиляторами, таких как Haskell и Rust, можно услышать такое утверждение: «Если код компилируется, то он работает». Но это не истина в последней инстанции. Наш проект компилируется, но при этом абсолютно ничего не делает! Если бы мы создавали настоящий, законченный проект, то сейчас было бы самое время начать писать модульные тесты, чтобы проверить, что код компилируется и имеет желаемое поведение.

Проверка числа потоков исполнения в new

Мы продолжим получать предупреждения, потому что мы ничего не делаем с параметрами для функций new и execute. Давайте реализуем тела этих функций с желаемым поведением. Для начала подумаем о new. Ранее мы выбрали беззаконный тип для параметра size, потому что пул с отрицательным числом потоков исполнения не имеет смысла. Однако пул с нулем потоков исполнения также не имеет смысла, хотя 0 является абсолютно допустимым значением типа usize. Мы добавим код для проверки, что величина size больше нуля, перед возвращением экземпляра структуры ThreadPool, и в случае если программа получит ноль, то она будет поднимать панику с помощью макрокоманды assert!, как показано в листинге 20.13.

Листинг 20.13. Реализация функции ThreadPool::new с паникой, в случае если size равен нулю
src/lib.rs

impl ThreadPool {
    /// Создать новый пул потоков исполнения.
    ///
    /// Размер — это число потоков исполнения в пуле.
    ///