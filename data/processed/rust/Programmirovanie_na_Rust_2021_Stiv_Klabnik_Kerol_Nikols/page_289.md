---
source_image: page_289.png
page_number: 289
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 37.26
tokens: 7603
characters: 2201
timestamp: 2025-12-24T10:53:28.410535
finish_reason: stop
---

impl ②, который связывает функцию new со структурой Config. Попробуйте еще раз скомпилировать этот код, чтобы убедиться, что он работает.

Исправление обработки ошибок

Теперь мы поработаем над исправлением обработки ошибок. Напомним, что попытка обратиться к значениям в векторе args с индексом 1 или 2 вызовет панику программы, если вектор содержит менее трех элементов. Попробуйте выполнить программу без аргументов. Она будет выглядеть так:

$ cargo run
    Compiling minigrep v0.1.0 (file:///projects/minigrep)
    Finished dev [unoptimized + debuginfo] target(s) in 0.0 secs
    Running `target/debug/minigrep`
thread 'main' panicked at 'index out of bounds: the len is 1 but the index is 1', src/main.rs:25:21
note: Run with `RUST_BACKTRACE=1` for a backtrace.

Строчка с сообщением об ошибке index out of bounds: the len is 1 but the index is 1 («индекс за пределами границ: длина равна 1, но индекс равен 1») предназначена разработчикам. Указанное сообщение не поможет конечным пользователям понять, что произошло и что они должны делать. Давайте это исправим.

Улучшение сообщения об ошибке

В листинг 12.8 мы добавим проверку функции new, которая удостоверится, что срез является достаточно длинным, перед тем как обращаться к индексам 1 и 2. Если срез недостаточно длинный, то программа поднимает панику и показывает более качественное сообщение об ошибке, чем сообщение о выходе индекса за пределы.

Листинг 12.8. Добавление проверки числа аргументов
src/main.rs

// --пропуск--
fn new(args: &[String]) -> Config {
    if args.len() < 3 {
        panic!("недостаточно аргументов");
    }
    // --пропуск--

Этот код похож на функцию Guess::new из листинга 9.10, где мы вызывали panic!, когда аргумент value находился вне интервала допустимых значений. Вместо проверки интервала значений здесь мы проверяем, что длина args не менее 3, а остальная часть функции может работать, исходя из предположения, что это условие соблюдено. Если в args менее трех элементов, то это условие будет истинным и мы вызовем макрокоманду panic!, которая немедленно завершит программу.

Добавив несколько строк кода в new, снова выполним программу без аргументов и посмотрим, как ошибка выглядит на этот раз: