---
source_image: page_407.png
page_number: 407
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 31.59
tokens: 7494
characters: 1883
timestamp: 2025-12-24T10:56:28.422799
finish_reason: stop
---

Теперь, когда мы дали определение понятию потока в языке Rust, давайте узнаем, как использовать предусмотренный стандартной библиотекой API, связанный с потоками исполнения.

Создание нового потока с помощью spawn

Для того чтобы создать новый поток, мы вызываем функцию thread::spawn и передаем ей замыкание (мы говорили о замыканиях в главе 13), содержащее код, который мы хотим выполнить в новом потоке исполнения. Пример из листинга 16.1 выводит некий текст из главного потока исполнения и другой текст из нового потока.

Листинг 16.1. Создание нового потока для вывода чего-либо, в то время как главный поток выводит что-то другое

src/main.rs

use std::thread;
use std::time::Duration;

fn main() {
    thread::spawn(|| {
        for i in 1..10 {
            println!("привет, число {} из порожденного потока!", i);
            thread::sleep(Duration::from_millis(1));
        }
    });

    for i in 1..5 {
        println!("привет, число {} из главного потока!", i);
        thread::sleep(Duration::from_millis(1));
    }
}

Обратите внимание, что с помощью этой функции новый поток остановится, когда закончится главный, независимо от того, выполнился он или нет. Данные этой программы могут каждый раз немного отличаться, но они будут выглядеть примерно так:

    привет, число 1 из главного потока!
    привет, число 1 из порожденного потока!
    привет, число 2 из главного потока!
    привет, число 2 из порожденного потока!
    привет, число 3 из главного потока!
    привет, число 3 из порожденного потока!
    привет, число 4 из главного потока!
    привет, число 4 из порожденного потока!
    привет, число 5 из порожденного потока!

Вызовы функции thread::sleep заставляют поток останавливать свое исполнение на короткое время, позволяя другому потоку работать. Потоки, вероятно, будут чередоваться, но это не гарантировано: это зависит от того, как ваша операцион-