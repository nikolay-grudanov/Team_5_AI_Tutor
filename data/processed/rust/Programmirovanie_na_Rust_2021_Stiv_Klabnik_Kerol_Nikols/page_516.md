---
source_image: page_516.png
page_number: 516
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 40.93
tokens: 7644
characters: 2345
timestamp: 2025-12-24T10:59:32.641123
finish_reason: stop
---

О Макрокоманды, подобные атрибутам, которые определяют настраиваемые атрибуты, используемые с любым элементом.

О Макрокоманды, подобные функциям, которые выглядят как вызовы функций, но работают с токенами, указываемыми в качестве их аргумента.

Мы поговорим о каждой из них, но сначала давайте посмотрим, зачем вообще нужны макрокоманды, когда есть функции.

Разница между макрокомандами и функциями

В своей основе макрокоманды — это способ написания кода, именуемый «метапрограммированием», который пишет другой код. В приложении B в конце книги мы обсудим атрибут derive, который генерирует реализацию различных типажей. Мы также использовали макрокоманды println! и vec!. Все эти макрокоманды расширяются, производя больше кода, чем при написании вручную.

Метапрограммирование полезно тем, что оно сокращает объем кода, который вы должны писать и обслуживать, что также является одной из ролей функций. Однако макрокоманды имеют некоторые дополнительные свойства, которых нет у функций.

Сигнатура функции должна объявлять число и тип параметров, которыми обладает функция. Макрокоманды, с другой стороны, могут брать переменное число параметров: мы можем вызвать макрокоманду println!("Здравствуй") с одним аргументом или println!("Здравствуй {}", имя) с двумя аргументами. Кроме того, макрокоманды расширяются перед тем, как компилятор примется за интерпретацию кода, поэтому макрокоманда может, например, реализовать типаж в заданном типе. Функция же не может, потому что она вызывается во время выполнения, а типаж должен быть реализован во время компиляции.

Недостаток реализации макрокоманды вместо функции состоит в том, что определять макрокоманды сложнее, чем функции, потому что вы пишете код Rust, который пишет код Rust. Из-за этой опосредованности определения макрокоманд, как правило, труднее читать, понимать и сопровождать, чем определения функций.

Еще одно важное различие между макрокомандами и функциями заключается в том, что перед вызовом макрокоманд в файле их необходимо определить или ввести в область видимости, в отличие от функций, которые можно определять и вызывать в любом месте.

Декларативные макрокоманды с помощью macro_rules! для общего метапрограммирования

Наиболее широко используемой формой макрокоманд в Rust являются декларативные макрокоманды. Их также иногда называют «макрокомандами на приме-