---
source_image: page_296.png
page_number: 296
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 31.26
tokens: 7526
characters: 1972
timestamp: 2025-12-24T10:53:29.771070
finish_reason: stop
---

Мы свободно использовали ключевое слово pub: со структурой Config, с ее полями и методом new, а также с функцией run. Теперь у нас есть библиотечная упаковка с публичным API, который мы можем протестировать!

Сейчас нужно ввести код, который мы перенесли в src/lib.rs, в область видимости двоичной упаковки в src/main.rs, как показано в листинге 12.14.

Листинг 12.14. Использование упаковки minigrep в src/main.rs

src/main.rs
use std::env;
use std::process;

use minigrep::Config;

fn main() {
    // --пропуск--
    if let Err(e) = minigrep::run(config) {
        // --пропуск--
    }
}

Мы добавляем строку кода use minigrep::Config, чтобы ввести тип Config из библиотечной упаковки в область видимости двоичной упаковки, и предваряем функцию run префиксом с именем нашей упаковки. Теперь все свойства должны работать. Запустите программу с помощью команды cargo run и убедитесь, что все работает правильно.

Ух ты! Мы проделали большую работу и настроились на будущий успех. Теперь обрабатывать ошибки стало гораздо проще, и мы сделали код более модульным. С этого момента почти вся работа будет вестись в src/lib.rs.

Давайте воспользуемся этой модульностью и сделаем то, что было бы трудно осуществить со старым кодом, но легко с новым — напишем несколько тестов!

Развитие функциональности библиотеки с помощью методики разработки на основе тестов

Теперь, когда мы извлекли алгоритм, перенеся его в src/lib.rs, и оставили сбор аргументов и обработку ошибок в src/main.rs, стало гораздо проще писать тесты для основной функциональности кода. Можно вызывать функции с различными аргументами напрямую и проверять возвращаемые значения, не вызывая двоичный код из командной строки. Напишите несколько тестов для функциональности в функциях Config::new и run самостоятельно.

В этом разделе мы добавим в программу minigrep поисковый алгоритм с помощью методики разработки на основе тестирования (TDD от англ. test-driven development). Методика разработки ПО следующая: