---
source_image: page_187.png
page_number: 187
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 26.94
tokens: 7478
characters: 1908
timestamp: 2025-12-24T10:50:34.410731
finish_reason: stop
---

Листинг 8.25. Использование метода entry для вставки, только если ключ еще не имеет значения

use std::collections::HashMap;

let mut scores = HashMap::new();
scores.insert(String::from("Синяя"), 10);

scores.entry(String::from("Желтая")).or_insert(50);
scores.entry(String::from("Синяя")).or_insert(50);

println!("{:?}", scores);

Метод or_insert для перечисления Entry определен для возвращения изменяемой ссылки на значение соответствующего ключа Entry, если этот ключ существует. Если же ключа нет, то он вставляет параметр в качестве нового значения для этого ключа и возвращает изменяемую ссылку на новое значение. Этот прием гораздо яснее, чем самостоятельное написание алгоритма и, вдобавок, более слаженно взаимодействует с контролером заимствования.

При выполнении кода в листинге 8.25 будет выведено

{"Желтая": 50, "Синяя": 10}

При первом вызове метода entry будет вставлен ключ для Желтой команды со значением 50, потому что у Желтой команды еще нет значения. Второй вызов метода entry не изменит хеш-отображение, потому что у Синей команды уже есть значение 10.

Обновление значения на основе старого значения

Еще один распространенный вариант использования хеш-отображений состоит в поиске значения ключа и последующем его обновлении на основе старого значения. Например, в листинге 8.26 показан код, который подсчитывает число вхождений каждого слова в текст. Мы используем хеш-отображение со словами в качестве ключей и увеличиваем значение, отслеживая число появлений этого слова. Если мы встречаем слово впервые, то сначала вставляем значение 0.

Листинг 8.26. Подсчет числа вхождений слов с помощью хеш-отображения, которое хранит слова и количества

use std::collections::HashMap;

let text = "здравствуй мир, чудесный мир";

let mut map = HashMap::new();

for word in text.split_whitespace() {
    let count = map.entry(word).or_insert(0);
    *count += 1;
}

println!("{:?}", map);