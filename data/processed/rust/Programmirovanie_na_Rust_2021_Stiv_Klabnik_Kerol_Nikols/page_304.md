---
source_image: page_304.png
page_number: 304
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 36.53
tokens: 7571
characters: 2289
timestamp: 2025-12-24T10:53:51.449261
finish_reason: stop
---

Обратите внимание, мы также отредактировали содержимое (contents) старого теста. Мы добавили новую строку с текстом "Duct tape." («клейкая лента»), используя заглавную букву D, которая не должна совпасть с искомым словом "duct", когда мы ищем в режиме, чувствительном к регистру. Такое изменение старого теста нужно, чтобы мы ненароком не нарушили функциональность чувствительного к регистру поиска, которую мы уже реализовали. Этот тест должен завершиться успешно сейчас и в дальнейшем, по мере того как мы будем работать над поиском, нечувствительным к регистру.

Новый тест для нечувствительного к регистру поиска использует "rUsT" в качестве запроса. В функции search_case_insensitive, которую мы намерены добавить, запрос "rUsT" должен совпасть со строкой текста, содержащей "Rust:" с большой буквы R, а также совпасть со строкой текста "Trust me.", даже несмотря на то, что регистр обеих строк отличается от запроса. Это провальный тест, он не компилируется, потому что мы еще не определили функцию search_case_insensitive. Добавьте скелетную реализацию, которая всегда возвращает пустой вектор, подобно тому как мы сделали для функции search в листинге 12.16, чтобы удостовериться — тест компилируется и не срабатывает.

Реализация функции search_case_insensitive

Функция search_case_insensitive в листинге 12.21 будет почти такой же, как и функция search. Единственное отличие состоит в том, что мы будем переводить query и каждую строку текста в нижний регистр, поэтому независимо от регистра входных аргументов они будут в одинаковом регистре, когда мы проверяем, содержит ли строка текста запрос.

Листинг 12.21. Определение функции search_case_insensitive с переводом запроса и строки текста в нижний регистр перед их сравнением

src/lib.rs

pub fn search_case_insensitive<'a>(query: &str, contents: &'a str) -> Vec<&'a str> {
    let query = query.to_lowercase();
    let mut results = Vec::new();

    for line in contents.lines() {
        if line.to_lowercase().contains(&query) {
            results.push(line);
        }
    }

    results
}

Сначала мы переводим строку запроса query в нижний регистр и сохраняем ее в затененной переменной с таким же именем ①. Вызов to_lowercase для запроса необходим, чтобы независимо от того, каким является запрос со стороны пользо-