---
source_image: page_486.png
page_number: 486
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 31.29
tokens: 7565
characters: 1986
timestamp: 2025-12-24T10:58:34.391667
finish_reason: stop
---

Листинг 19.1. Создание сырых указателей из ссылок

let mut num = 5;

let r1 = &num as *const i32;
let r2 = &mut num as *mut i32;

Обратите внимание, мы не включаем в этот код ключевое слово unsafe. Можно создавать сырые указатели в безопасном коде. Просто нельзя применять оператор разыменования к сырым указателям за пределами небезопасного блока, как вы увидите немного позже.

Мы создали сырые указатели, используя as для приведения неизменяемой и изменяемой ссылок к соответствующим типам сырых указателей. Поскольку мы создали их непосредственно из ссылок, гарантированно являющихся действительно, мы знаем, что эти сырые указатели действительно, но нельзя утверждать, что это верно для любого сырого указателя.

Далее мы создадим сырой указатель, в действительности которого не можем быть уверены. Листинг 19.2 показывает, как создавать сырой указатель на произвольное место в памяти. Попытка использовать произвольную память не имеет определения: данных по этому адресу может и не быть, компилятор может оптимизировать код так, чтобы не было доступа к памяти, либо программа выдаст ошибку сегментации. В обычных условиях нет веской причины писать такой код, но это возможно.

Листинг 19.2. Создание сырого указателя на произвольный адрес памяти

let address = 0x012345usize;
let r = address as *const i32;

Вспомните, что можно создавать сырые указатели в безопасном коде, но нельзя применять оператор разыменования к сырым указателям и читать данные, на которые они указывают. В листинге 19.3 мы используем оператор разыменования * для сырого указателя, требующего блок unsafe.

Листинг 19.3. Применение оператора разыменования к сырым указателям в небезопасном блоке

let mut num = 5;

let r1 = &num as *const i32;
let r2 = &mut num as *mut i32;

unsafe {
    println!("r1 равно: {}", *r1);
    println!("r2 равно: {}", *r2);
}

Указатель не приносит вреда. Мы можем иметь дело с недействительным значением, только когда пытаемся обратиться к значению, на которое он указывает.