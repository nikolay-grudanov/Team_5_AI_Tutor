---
source_image: page_263.png
page_number: 263
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 27.00
tokens: 7380
characters: 1613
timestamp: 2025-12-24T10:52:37.585560
finish_reason: stop
---

Когда мы выполним тест из листинга 11.8, он не сработает:

    running 1 test
    test tests::greater_than_100 ... FAILED

    failures:
        failures:
            tests::greater_than_100

    test result: FAILED. 0 passed; 1 failed; 0 ignored; 0 measured; 0 filtered out

В этом случае мы получаем не очень полезное сообщение, но, глядя на тестовую функцию, видим, что она аннотирована #[should_panic]. Эта ошибка означает, что код в тестовой функции не вызвал паники.

Тесты, использующие should_panic, бывают неточными, поскольку они только указывают на то, что код вызвал некую панику. should_panic сработает, даже если тест запаникует по другой причине, чем та, которую мы ожидали. Для придания тестам should_panic большей точности мы можем добавить необязательный параметр expected в атрибут should_panic. Тестовая оснастка удостоверится, что сообщение об ошибке содержит предоставленный текст. Рассмотрим модифицированный код для типа Guess в листинге 11.9, где функция new паникует с разными сообщениями в зависимости от того, является ли значение слишком малым либо слишком большим.

Листинг 11.9. Проверка того, что условие вызовет panic! с особым сообщением о панике
src/lib.rs

    // --пропуск--
    impl Guess {
        pub fn new(value: i32) -> Guess {
            if value < 1 {
                panic!("Значение догадки должно быть больше или равно 1, получено {}.", value);
            } else if value > 100 {
                panic!("Значение догадки должно быть меньше или равно 100, получено {}.", value);
            }
            Guess {
                value
            }
        }
    }