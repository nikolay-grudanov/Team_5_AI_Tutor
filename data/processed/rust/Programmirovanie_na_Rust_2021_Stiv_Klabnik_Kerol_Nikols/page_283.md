---
source_image: page_283.png
page_number: 283
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 31.55
tokens: 7495
characters: 2009
timestamp: 2025-12-24T10:53:14.868268
finish_reason: stop
---

Сначала мы добавляем еще одну инструкцию use, чтобы ввести соответствующую часть стандартной библиотеки: нам нужна функция std::fs для обработки файлов ①.

В функцию main мы добавили новую инструкцию: функция fs::read_to_string берет имя файла, открывает его и возвращает Result<String> содержимого файла ②.

После этой инструкции мы снова добавили временную инструкцию println!, которая выводит значение contents после прочтения файла, благодаря чему можно проверить, что программа пока что работает ③.

Давайте выполним этот код с любым строковым значением в качестве первого аргумента командной строки (потому что мы еще не реализовали поисковую часть) и файлом poem.txt в качестве второго аргумента:

$ cargo run the poem.txt
Compiling minigrep v0.1.0 (file:///projects/minigrep)
Finished dev [unoptimized + debuginfo] target(s) in 0.0 secs
    Running `target/debug/minigrep the poem.txt`
Searching for test
In file sample.txt
С текстом:
I'm nobody! Who are you?
Are you nobody, too?
Then there's a pair of us – don't tell!
They'd banish us, you know.

How dreary to be somebody!
How public, like a frog
To tell your name the livelong day
To an admiring bog!

Отлично! Код прочитал, а затем вывел содержимое файла. Но у этого кода есть несколько недостатков. У функции main много обязанностей: в общем, функции более понятны и их проще технически обслуживать, если каждая функция отвечает только за одну идею. Другая проблема заключается в том, что мы не обрабатываем ошибки, как должно, на все сто. Программа пока еще небольшая, так что эти недостатки — небольшая проблема, но по мере расширения программы будет сложнее устранять их безупречно. Рекомендуется начинать рефакторинг на ранних стадиях разработки программы, поскольку гораздо проще рефакторить меньше объемы кода. Мы сделаем это позже.

Рефакторинг с целью улучшения модульности и обработки ошибок

С целью улучшения программы мы устраним четыре проблемы, связанные со структурой программы и с тем, как она обрабатывает потенциальные ошибки.