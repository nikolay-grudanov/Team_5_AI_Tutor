---
source_image: page_119.png
page_number: 119
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 32.44
tokens: 6650
characters: 2294
timestamp: 2025-12-24T03:58:56.251246
finish_reason: stop
---

рая используется, если нужно произвести специальные действия над пакетом, отличные от фильтрации и NAT.

В состав каждой таблицы входят три цепочки: INPUT, OUTPUT и FORWARD. Первая используется для входящих пакетов, вторая - для исходящих, а третья для пересылаемых пакетов. При желании вы можете создать собственную таблицу, но в ней все равно будут цепочки INPUT, OUTPUT и FORWARD.

Теперь поговорим о действиях над пакетом. Действие ACCEPT принимает пакет, DROP - уничтожает пакет. Действие MASQUERADE позволяет скрыть IP-адрес пакета. Если же в качестве действия указано имя цепочки, то пакет будет отправлен для обработки в указанную цепочку.

Рассмотрим процесс обработки входящего пакета. Сначала пакет поступает в цепочку PREROUTING таблицы mangle. После чего, если он не был уничтожен правилами таблицы mangle, он попадает в цепочку PREROUTING таблицы nat. Здесь правила проверяют, нужно ли модифицировать назначение пакета или нет. После этого пакет направляется или в цепочку FORWARD (если его нужно передать дальше - другому компьютеру) или в цепочку INPUT (если пакет адресован этому компьютеру).

Если пакет был адресован этому компьютеру, то он передается правилам цепочки INPUT таблицы mangle и filter. Если эти правила не уничтожили пакет, то он отправляется приложение, например, веб-серверу. Приложение получает данные, обрабатывает их и отправляет ответ. Ответ приложения преобразуется в пакет, который сначала обрабатывается цепочкой OUTPUT таблиц mangle, nat и filter, а затем отправляется в цепочку POSTROUTING и обрабатывается правилами таблиц mangle и nat. Если после всего этого пакет еще жив, он становится исходящим пакетом и отправляется в сеть.

6.3.3. Команда iptables

Для управления правилами брандмауэра используется команда iptables. У этой команды очень и очень много различных параметров. В этой книге не будет полного руководства по iptables, потому что есть документация (man iptables), доступная каждому пользователю. Вместо переписывания руководства другими словами мы остановимся на практическом применении iptables. Сначала рассмотрим часто используемые параметры (чтобы вы понимали, что происходит), а затем настроим шлюз для небольшой организации.

Чтобы добавить правило в цепочку, нужно использовать параметр -A:

# iptables -A <цепочка> <правило>