---
source_image: page_214.png
page_number: 214
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 27.93
tokens: 6461
characters: 1603
timestamp: 2025-12-24T04:00:59.832693
finish_reason: stop
---

втором - база данных. Разрабатаем первую версию нашего сценария backup. Сначала нужно создать сам сценарий:

# cd /bin
# touch backup
# chmod +x backup
# nano backup

Затем введите следующий код:

#!/bin/bash

rm /mnt/backup/*

cd /home

for dn in `ls /home`; do
    echo "Creating backup for $dn"
    tar -czf /mnt/backup/$dn.tar.gz $dn
done

Разберемся, что и к чему. Первым делом мы удаляем старые резервные копии (команда rm). Программа tar с параметром c создает новый архив, но если файл архива существует, он не будет перезаписан. Чтобы добавить файлы в уже существующий архив можно использовать параметр u, но его нельзя использовать вместе с параметром c, поэтому нужно проверять существует ли файл архива. Если нет, тогда нужно создать архив (параметр c), если да, тогда нужно модифицировать архив (параметр u).

Далее мы создаем архив для каждого домашнего каталога пользователя. Например, если в /home у вас есть два подкаталога — user1 и user2, то будут созданы архивы user1.tar.gz и user2.tar.gz. Заметьте: мы не делаем резервную копию всего /home. Тогда мы получим один большой архив, с которым будет очень неудобно работать (да и можем превысить ограничение на максимальный размер файла - все зависит от объемов данных, с которыми вы работаете), поэтому проще и правильнее создать несколько меньших архивов.

Цикл for проходится по всем элементам вывода команды ls /home. В этом каталоге (/home) обычно находятся только каталоги (файлов в нем нет, только в его подкаталогах), то нам достаточно просто вывести его содержимое командой ls, а затем передать каждую строку вывода команде tar.