---
source_image: page_216.png
page_number: 216
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 27.63
tokens: 6466
characters: 1633
timestamp: 2025-12-24T04:00:59.982733
finish_reason: stop
---

for dn in `ls /home`; do
    echo "Creating backup for $dn"
    tar -czf /mnt/backup/$dn.tar.gz $dn
    scp $dn.tar.gz user@example.com:/backups
done

# Сбрасываем буферы на диск (не обязательно)
sync
# Размонтируем файловую систему
umount /mnt/backup

Если вам нужно копировать только содержимое каталога /home, то у вас есть уже рабочая версия сценария. Однако у нас еще есть каталог /var/lib/mysql. Однако код цикла для создания резервной копии будет отличен, поскольку в каталоге /var/lib/mysql кроме подкаталогов с файлами баз данных есть еще и обычные файлы, которые нам не нужно никуда копировать. Поэтому в цикле нужно проверить, является ли элемент, который вывела программа ls, каталогом и заархивировать только его:

echo "Database backup..."
cd /var/lib/mysql
for dn in `ls /var/lib/mysql`; do
    test -d && "$dn" && tar -czf /mnt/backup/db/$dn.tar.gz $dn
done

Обратите внимание: архивы создаются в каталоге /mnt/backup/db: если имя базы данных у нас совпадает с именем пользователя, то ничего хорошего из затеи хранить архив в каталоге /mnt/backup у нас не выйдет. Поэтому мы должны создать каталог db заранее и хранить в нем резервные копии баз данных.

Кроме домашних каталогов и базы данных нужно еще сделать резервную копию почтовых ящиков пользователей, которые обычно хранятся в каталоге /var/mail. Здесь все просто - каждому пользователю соответствует файл почтового ящика, поэтому можем использовать код, подобный созданию резервной копии домашнего каталога, только резервные копии будем хранить в каталоге /mnt/backup/mail:

cd /var/mail

for dn in `ls /var/mail`; do
    echo "Creating backup for $dn [mail]"