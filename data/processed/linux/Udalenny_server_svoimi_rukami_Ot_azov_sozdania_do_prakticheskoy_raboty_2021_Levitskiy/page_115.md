---
source_image: page_115.png
page_number: 115
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 33.35
tokens: 6670
characters: 1729
timestamp: 2025-12-24T03:58:51.515994
finish_reason: stop
---

route add -net 192.168.14.0 netmask 255.255.255.0 gw 192.168.17.254 eth0
route add -net 192.168.22.0 netmask 255.255.255.0 gw 192.168.17.254 eth0

Тогда в файл /etc/network/interfaces нужно добавить следующие строки:

up route add -net 192.168.1.0 netmask 255.255.255.0 gw 192.168.17.254 eth0
up route add -net 192.168.12.0 netmask 255.255.255.0 gw 192.168.17.254 eth0
up route add -net 192.168.21.0 netmask 255.255.255.0 gw 192.168.17.254 eth0

В этом примере пакеты ко всем трем сетям направляются на шлюз 192.168.17.254, а он уже сам решает, что с ними делать. Прежде, чем мы рассмотрим настройку брандмауэра, нужно отметить, как превратить компьютер в шлюз. Для этого нужно разрешить пересылку пакетов протокола IPv4 (IPv4 forwarding). Для этого добавьте значение 1 в файл /proc/sys/net/ipv4/ip_forward:

# echo 1 > /proc/sys/net/ipv4/ip_forward

Конечно, после перезапуска это значение будет потеряно. Чтобы его сохранить, добавьте в файл /etc/sysctl.conf следующую строку:

net.ipv4.ip_forward=0

Итак, ваш компьютер теперь превращен в шлюз. Но сам по себе перенаправлять пакеты он не будет. Нужно задать ряд правил перенаправления пакетов. Для этого мы будем использовать брандмауэр iptables, который имеется во всех современных дистрибутивах. Именно о нем и пойдет речь в следующем разделе. Забегая наперед, скажу, что iptables можно использовать не только для настройки шлюза, но и просто для защиты сервера или рабочей станции от нежелательных подключений.

В новых версиях Ubuntu (начиная с версии 18.04) настройка маршрутов осуществляется через файл /etc/netplan/01-netcfg.yaml. Откройте этот файл:

sudo nano /etc/netplan/01-netcfg.yaml

В нем вы найдете конфигурацию по умолчанию, которая может быть примерно такой: