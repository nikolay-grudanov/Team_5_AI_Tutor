---
source_image: page_194.png
page_number: 194
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 14.25
tokens: 7691
characters: 2562
timestamp: 2025-12-23T23:09:16.015657
finish_reason: stop
---

3 Объявление в нашем сценарии переменной i как локальной — хорошая практика, хотя для нашего сценария это некритично. Тем не менее так ваш цикл for не будет изменять какой-либо другой индекс или счетчик.

4 К каждой строке, отправляемой через данную функцию, мы добавляем указание erase-to-end-of-line («стереть до конца строки») как в текущей, так и в следующей функции printf. После печати пунктирной линии вторая функция printf стирает следующую строку, где курсор будет находиться до следующей итерации.

5 Функция очистки вызывается при выходе из сценария панели мониторинга, когда пользователь для прерывания и выхода из сценария нажмет сочетание клавиш Ctrl+C. Как и наша функция очистки в сценарии tailcount.sh (см. главу 8), эта функция завершит работу функций, находящихся в фоновом режиме.

6 В отличие от предыдущей версии, где системный вызов kill отправляет сигнал определенному процессу, здесь мы используем нотацию %1, чтобы дать системному вызову kill указание, согласно которому сигнал должен быть передан всем процессам, запущенным в результате работы процесса в фоновом режиме. Все эти процессы считаются частью одной и той же «работы». Их рабочие номера (%1, %2, %3 и т. д.) определяются порядком их размещения в фоновом режиме. В этом сценарии у нас есть только один фоновый процесс.

7 Мы перенаправляем вывод в функцию clear таким образом, что все выходные данные, поступающие из stdout или stderr, будут отброшены. Такая очистка гарантирует отсутствие любых неожиданных сообщений, хотя ничего подобного мы и не ожидаем (это плохо для отладки, но экран будет намного чище).

8 Команда tempfile генерирует уникальное имя и проверяет, не используется ли оно в данный момент. В результате нам будет известно, что, независимо от количества запущенных экземпляров сценария и расположенных рядом других файлов, для этого сценария рабочий файл будет доступен. В функции clear есть код, удаляющий данный файл при каждом выходе из сценария.

9 Эта строка запускает два сценария, которые описаны в главе 8. Данные сценарии подсчитывают строки, добавляемые в конце файла. Фигурные скобки группируют все процессы этого конвейера команд вместе и помещают в «фон», отключая их от ввода с клавиатуры. Эти процессы и все, что они создали, являются частью задания 1 (%1), то есть задания, работу которого прекратит функция clear.

10 Каждый раздел вывода отправляется отдельно в функцию prSection. Команды для раздела не нужно группировать внутри фигурных скобок, если для этого раздела одна команда генерирует вывод. Это относится к первым трем разделам,