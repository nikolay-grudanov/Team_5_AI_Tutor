---
source_image: page_283.png
page_number: 283
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 11.97
tokens: 7512
characters: 2063
timestamp: 2025-12-23T23:12:29.228501
finish_reason: stop
---

② В этой версии сценария вместо того, чтобы вернуть все выходные данные из команды curl и только после этого выполнить команду grep, команда grep выполняется сразу. Такая организация вызовов более эффективна, так как вызов подоболочки (через конструкцию $()) происходит один раз, а не дважды (сначала для curl, а затем для grep), как это делалось в исходном сценарии.

③ Вместо того чтобы для редактирования результатов применять cut и tr, мы используем подстановки переменных bash. Это более эффективно, поскольку позволяет избежать затрат системных ресурсов, связанных с системными вызовами fork и exec, которые вызывают две дополнительные программы (cut и tr).

При разовом выполнении данного сценария вы скорее всего не заметите повышения эффективности. Но эта разница будет заметна при написании сценария, который в одном сеансе выполняет множество таких вызовов.

В примере 22.4 показан еще один вариант сценария, уже в кратком виде.

Пример 22.4. checkemail.1liner

#!/bin/bash
#
# checkemail.sh - проверяем, имеется ли адрес электронной почты
#                в базе данных сайта Have I Been Pwned?
#                в одной строке

EMAILIN="$1"
if (( $# == 0 ))    ①
then
    printf 'Enter email address: '
    read EMAILIN
fi
EMAILIN="https://haveibeenpwned.com/api/v2/breachedaccount/$EMAILIN"

echo 'Account pwned in the following breaches:'
curl -s "$EMAILIN" | grep -Po '"Name":".*?"' | cut -d':' -f2 | tr -d '\'' ②

① Это та же проверка, что и раньше, но, чтобы захватить полный URL, мы будем использовать только одну переменную оболочки, EMAILIN, и не станем вводить вторую переменную URL.

② В данном сценарии используется более длинный конвейер, и мы можем выполнить все манипуляции в одной строке. Использование переменных оболочки для анализа наших результатов может быть более эффективным, но требует нескольких строк кода. Некоторые программисты предпочитают краткие команды. Но обратите внимание на одно отличие в поведении этого сценария: заголовок по-прежнему выводится, даже если нет других выходных данных (то есть адрес не был взломан).