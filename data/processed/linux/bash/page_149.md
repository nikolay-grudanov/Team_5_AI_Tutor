---
source_image: page_149.png
page_number: 149
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 9.80
tokens: 7498
characters: 1738
timestamp: 2025-12-23T23:07:26.362070
finish_reason: stop
---

6 Перенаправляя вывод в done, мы делаем это для всего кода внутри цикла while. Если бы было сделано перенаправление в самой команде сканирования, то, чтобы добавить вывод к файлу, мы должны были бы использовать символы >>. В противном случае при каждой итерации цикла сохраняется только один вывод команды, а предыдущий вывод блокируется. Если к файлу добавляется очередная команда, то перед началом цикла нам нужно будет этот файл обрезать. Таким образом, вы можете увидеть, что гораздо лучше просто выполнить перенаправление в цикл while.

Файл вывода с результатами сканирования будет отформатирован так, что разделителем будет пробел. Каждая строка начинается с IP-адреса или имени хоста, а затем перечисляются все открытые TCP-порты.

В примере 9.2 приведен вариант формата вывода, который показывает, что на хосте 192.168.0.1 открыты порты 80 и 443, а на хосте 10.0.0.5 — порт 25.

Пример 9.2. scan_2018-11-27

192.168.0.1 80 443
10.0.0.5 25

Шаг 2. Сравнение с предыдущим выводом

Конечная цель, которой мы хотим достичь с помощью этого инструмента, — обнаружение изменений находящегося в сети хоста. Для этого нам необходимо сохранять в файл результаты каждого сканирования. Далее — сравнить последнее сканирование с предыдущим результатом и обнаружить разницу между предыдущим и текущим состояниями. В частности, мы будем искать устройство, у которого TCP-порт открыт или закрыт. Определив состояние порта, вы можете выяснить, было ли это изменение санкционированным, или это признак злонамеренной активности.

В примере 9.3 сравниваются результаты последней проверки с сохраненными в файле предыдущими результатами и выявляются даже самые незначительные изменения.

Пример 9.3. fd2.sh

#!/bin/bash -
#
# Bash и кибербезопасность