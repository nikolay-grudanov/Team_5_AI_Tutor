---
source_image: page_140.png
page_number: 140
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 7.41
tokens: 7346
characters: 1397
timestamp: 2025-12-23T23:07:02.933152
finish_reason: stop
---

Сценарий tailcount.sh запускает и останавливает сценарий с секундомером (таймер) и ведет подсчет временных интервалов.

Пример 8.4. tailcount.sh

#!/bin/bash -
#
# Bash и кибербезопасность
# tailcount.sh
#
# Описание:
# Подсчет строк каждые n секунд
#
# Использование: ./tailcount.sh [filename]
#    filename: проанализировать looper.sh

# очистка — другие процессы на выходе
function cleanup ()
{
    [[ -n $LOPID ]] && kill $LOPID
}

trap cleanup EXIT
bash looper.sh $1 &
LOPID=$!
# даем возможность начать
sleep 3

while true
do
    kill -SIGUSR1 $LOPID
    sleep 5
done >&2

① Поскольку этот сценарий будет запускать другие сценарии, после работы он должен выполнить очистку. Если идентификатор процесса был сохранен в LOPID, переменная будет хранить значение, поэтому функция с помощью команды kill отправит этому процессу сигнал. Если в команде kill не указать конкретный сигнал, то по умолчанию будет отправлен сигнал SIGTERM.

② Команда EXIT не является сигналом. Это специальный случай, когда оператор trap указывает оболочке вызвать эту функцию (в данном случае cleanup), если оболочка, выполняющая данный сценарий, собирается завершить работу.

③ Теперь начинается настоящая работа. Запускается сценарий looper.sh, который будет работать в фоновом режиме: чтобы этот сценарий работал на протяжении всего цикла (не дожидаясь команды на завершение работы), он отсоединяется от клавиатуры.