---
source_image: page_074.png
page_number: 74
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 10.89
tokens: 7533
characters: 1958
timestamp: 2025-12-23T23:04:23.772521
finish_reason: stop
---

fi
SYSNAM=$(hostname)
LOGDIR=${1:-/tmp/${SYSNAM}_logs}

mkdir -p $LOGDIR
cd ${LOGDIR} || exit -2

wevtutil el | while read ALOG
do
    ALOG="${ALOG%$'\r'}"
    echo "${ALOG}:"
    SAFNAM="${ALOG// /_}"
    SAFNAM="${SAFNAM//\\/-}"
    wevtutil epl "$ALOG" "${SYSNAM}_${SAFNAM}.evtx"
done

if (( TGZ == 1 ))
then
    tar -czvf ${SYSNAM}_logs.tgz *.evtx
fi

1 Сценарий начинается с простой инициализации и оператора if, который проверяет, были ли предоставлены какие-либо аргументы. $# — это специальная переменная оболочки, значением которой является количество аргументов, передаваемых в командной строке при вызове скрипта. Это условие для if из-за двойных скобок является арифметическим выражением, поэтому можно использовать символ «больше» (>) и выполнять численное сравнение. Если этот символ в выражении if используется с квадратными скобками, а не с двойными, символ > выполняет лексическое сравнение — в алфавитном порядке. Для численного сравнения необходимо добавить -gt в квадратных скобках.

Для этого сценария единственным аргументом, который мы поддерживаем, является -z, указывающий, что по окончании процесса все собранные файлы журналов должны быть сжаты в один файл TAR. Это также означает, что мы можем использовать простой тип разбора аргументов. В следующем скрипте воспользуемся более сложным анализатором аргументов (getopts).

2 В ходе этой проверки, начиная с начала строки (смещение 0 байт) длиной 2 байта, принимается подстрока первого аргумента ($1). Если аргумент -z, то мы установим флаг. Для удаления этого аргумента в сценарии выполняется сдвиг (shift). То, что ранее было вторым аргументом (и если таковой имелся), теперь становится первым. Третий (если таковой имеется) становится вторым и т. д.

3 Если пользователь хочет указать расположение журналов, это можно определить в качестве аргумента в сценарии. Необязательный аргумент -z, если он указан, уже был смещен, поэтому любой пользовательский путь теперь станет первым