---
source_image: page_204.png
page_number: 204
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 14.29
tokens: 7655
characters: 2451
timestamp: 2025-12-23T23:09:38.649125
finish_reason: stop
---

Как было показано в главе 9, этот сценарий при попытке открытия или при удачном открытии TCP-порта на хосте также использует специальное имя файла /dev/tcp и номер порта, указанный как часть этого имени файла (например, /dev/tcp/127.0.0.1/631).

① Сценарий начинается функцией isportopen, которая проверяет ошибки, чтобы убедиться, что нам было передано правильное количество параметров. Хотя в программировании полезно проверять ошибки, в предыдущих сценариях мы этого не делали. Проверки не проводились, чтобы в процессе обучения избежать чрезмерного усложнения сценариев. При реальном использовании в производственных средах обязательно проводите такую проверку ошибок, чтобы при отладке сэкономить время.

② Это основа всего сценария. Здесь мы можем посмотреть, открыт ли порт. На первый взгляд три перенаправления могут показаться странными. Но давайте их разберем. Команда echo без аргументов выведет на экран новую строку — пусть нас это не беспокоит. Мы ее отфильтровываем и отправляем в /dev/null. Все остальные сообщения об ошибках (stderr) также будут направлены в этот каталог. По существу, нам нужно только перенаправить ввод. Вы можете подумать, что команда echo ничего не читает из stdin. Тем не менее bash попытается открыть файл, названный как перенаправление stdin, и в зависимости от результата (получилось открыть или нет) мы сможем определить состояние порта — открыт или закрыт. Если перенаправление не получится, общая команда также не будет выполнена и, следовательно, переменной $? будет присвоено значение, отличающееся от нуля. При успешном перенаправлении переменной $? будет присвоено значение 0.

③ Ловушка устанавливается так, чтобы при выходе из сценария с помощью функции очистки наш рабочий файл был обязательно удален.

④ Теперь с помощью команды touch мы создаем пустой файл и убеждаемся, что он находится в целевой системе и готов к использованию. Если в файл ничего не записывать, никакой ошибки не будет (см. ⑩).

⑤ Эта проверка использует нашу вспомогательную функцию, в результате чего мы можем увидеть, открыт ли порт FTP (21) на хосте, имя которого было указано пользователем при вызове сценария.

⑥ Здесь, чтобы дескриптор файла 3 был открыт для чтения и записи (< >), используется команда exes. Файл, к которому мы обращаемся, — это стандартный порт FTP номер 21.

⑦ Чтобы FTP-порт не оставлять открытым, записывается короткое сообщение. Поскольку в наши намерения не входит передача файлов, мы даем коман-