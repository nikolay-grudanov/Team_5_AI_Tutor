---
source_image: page_138.png
page_number: 138
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 9.02
tokens: 7418
characters: 1655
timestamp: 2025-12-23T23:07:02.534444
finish_reason: stop
---

Эту работу можно разделить на два процесса-сценария: один сценарий будет считать строки, а другой — наблюдать за временем. Таймер уведомляет счетчик строк с помощью стандартного механизма межпроцессной связи POSIX, называемого сигналом. Сигнал — это программное прерывание, и существуют различные виды сигналов. Некоторые из них являются фатальными — приводят к завершению процесса (например, исключение в операции с плавающей запятой). Большинство из этих сигналов могут быть как проигнорированы, так и пойманы. Действие предпринимается, когда сигнал пойман. Многие из этих сигналов имеют предопределенное назначение в операционной системе. Мы будем использовать один из двух сигналов, доступных пользователям. Это сигнал SIGUSR1 (другой — это SIGUSR2).

Сценарии оболочки могут перехватывать прерывания, используя встроенную команду trap. С ее помощью можно выбрать команду, определяющую, какое действие требуется выполнить при получении сигнала, и список сигналов, запускающих вызов данной команды. Например:

trap warnmsg SIGINT

Это приводит к тому, что команда warnmsg (наш собственный сценарий или функция) вызывается всякий раз, когда сценарий оболочки получает сигнал SIGINT, например, когда для прерывания запущенного процесса вы нажмете сочетание клавиш Ctrl+C.

В примере 8.3 показан сценарий, выполняющий подсчет.

Пример 8.3. looper.sh

#!/bin/bash -
#
# Bash и кибербезопасность
# looper.sh
#
# Описание:
# Подсчет строк в файле
#
# Использование: ./looper.sh [filename]
# filename — имя файла, который должен проверяться,
# по умолчанию: log.file

function interval () {
    echo $(date '+%y%m%d %H%M%S') $cnt
    cnt=0
}

declare -i cnt=0