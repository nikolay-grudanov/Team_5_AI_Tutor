---
source_image: page_241.png
page_number: 241
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 13.05
tokens: 7591
characters: 2401
timestamp: 2025-12-23T23:10:57.562972
finish_reason: stop
---

2 Первый бит вывода представляет собой строку в виде приглашения ввода, чтобы пользователь в удаленной системе знал, как начать ввод. Параметр -n не учитывает символ новой строки, поэтому это выглядит как приглашение ввода.

3 Оператор read считывает входные данные пользователя (через TCP-сокет). Параметр -r указывает read обрабатывать обратный слеш как обычный символ. При чтении строки, содержащей обратный слеш, никакая специальная интерпретация не выполняется.

4 Если первым символом ответа пользователя является восклицательный знак (он же bang), то (согласно нашему проекту) клиент просит загрузить сценарий.

5 Эта подстрока, начиная с индекса 1 и до конца строки, является ответом без восклицательного знака. Мы могли бы встроить ответ в строку вызова функции runScript и выполнять два отдельных шага.

6 В этой строке находится «сердце» сценария. Клиент отправил строку через TCP-сокет, который считывает этот сценарий. Для выполнения команд следует в этой строке запустить команду eval. Если злоумышленник отправил команду ls, она будет запущена и ее вывод возвратится злоумышленнику.

Мы запускаем команды внутри этого сценария так, если бы они были его частью. На сценарий могут повлиять любые изменения переменных, вносимые этими командами. Возможно, лучше иметь отдельный экземпляр оболочки, в которую мы будем передавать команды. Но здесь мы использовали более простой подход.

7 Когда происходит запрос запуска сценария, вызывается функция runScript и ее первым действием становится отправка имени сценария обратно в систему злоумышленника (где будет находиться сценарий). Перенаправление stdout устанавливает соединение через порт номер два.

8 Задача sleep — дать время для передачи данных в другую систему и предоставить этой системе время для реакции и ответа. Возможно, если передача данных по сети происходит очень медленно, потребуется увеличить значение sleep, определяющее продолжительность сна.

9 Если на другом конце все прошло хорошо, данное соединение — перенаправление stdin — позволяет подключиться к системе атакующего и содержимое запрошенного сценария становится доступным для чтения из stdin. Мы сохраняем вывод во временном файле.

10 Теперь, когда у нас есть файл, мы можем его выполнить с помощью bash. Куда направляется его вывод? Помните перенаправление, которое мы сделали с оператором exes? Поскольку при вызове bash $TMP FILE мы ничего не перенаправляем,