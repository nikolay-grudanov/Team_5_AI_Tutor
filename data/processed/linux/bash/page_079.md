---
source_image: page_079.png
page_number: 79
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 10.26
tokens: 7551
characters: 2223
timestamp: 2025-12-23T23:04:38.034294
finish_reason: stop
---

1 После двух определений функций сценарий начинается вызовом нашего скрипта osdetect.sh (из главы 2). В качестве местоположения сценария osdetect.sh мы указали текущий каталог. Вы можете поместить файл в другое место, но затем обязательно измените заданный путь с ./, указав тот адрес, по которому находится данный сценарий, и/или добавьте это местоположение в переменную PATH.

Чтобы сделать работу более эффективной, можете включить сценарий osdetect.sh непосредственно в getlocal.sh.

2 Затем мы запускаем программу hostname в подоболочке, чтобы получить имя этой системы для использования в следующей строке, а позже — в функции DumpInfo.

3 Мы используем имя хоста как часть временного имени файла, в который мы поместим весь наш вывод.

4 Здесь мы вызываем функцию, которая будет выполнять большую часть работы этого скрипта. При вызове функции мы перенаправляем и stdout, и stderr в один и тот же файл, чтобы функция не устанавливалась перенаправление ни на один из своих выходных операторов; функция может вносить записи в stdout, и при необходимости этот вызов перенаправит весь вывод. Другой способ выполнить перенаправление — поместить его перед закрывающей скобкой определения функции DumpInfo. Вместо этого перенаправление stdout может быть оставлено на усмотрение пользователя, вызывающего скрипт; по умолчанию же все будет записываться в stdout. Но если пользователь хочет, чтобы вывод отправлялся в файл, ему нужно создать файл с именем tempfile и помнить, что stderr перенаправляется именно в него. Наш пример рассчитан на менее опытных пользователей.

5 Здесь начинается самая важная часть сценария. Начало функции — вывод XML-тега <systeminfo>, который будет иметь свой закрывающий тег, записанный в конце этой функции.

6 Команда readarray в bash будет читать все строки ввода (до конца читаемого файла или при нажатии сочетания клавиш Ctrl+D). Каждая строка будет отдельно записана в массив, в данном случае CMDS.

7 for зациклывает значения массива CMDS — по одной строке за один проход.

8 В этой строке используется операция подстроки, чтобы извлечь из переменной ALINE символ в позиции 0 длины 1. Хештег (#) заключен в кавычки, чтобы оболочка не интерпретировала его как начало комментария скрипта.