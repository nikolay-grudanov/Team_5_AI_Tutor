---
source_image: page_342.png
page_number: 342
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 35.17
tokens: 8031
characters: 2544
timestamp: 2025-12-24T04:28:37.577723
finish_reason: stop
---

Первая команда запускает мониторинг TCP-портов, а вторая — заставит программу наблюдать за UDP-портами. Вся активность будет сохраняться в журнале, который можно проверить с помощью программы Logcheck, описанной далее в разд. 12.6.4. Я рекомендую поместить эту программу в задания, чтобы она выполнялась через определенные интервалы времени (не менее 15 минут) и сообщала администратору о событиях в системе.

Но перед этим желательно программу Logcheck правильно настроить. Для этого откройте файл /usr/local/etc/logcheck.sh и добавьте в него следующую строку (если ее нет):

"mailto:SYSADMIN=admin@server.com"

Здесь admin@server.com — это адрес E-mail, на который будут отправляться электронные сообщения с информацией о сохраненных программой PortSentry в журнале записях. Теперь остается только сделать так, чтобы сценарий /usr/local/etc/logcheck.sh выполнялся через определенные промежутки времени. Для этого подойдет программа crontab.

Для тестирования программы PortSentry я сконфигурировал все настройки программы PortSentry, как показано ранее, и запустил сканирование портов. CyD NET Utils (www.cydsoft.com) показал только первые два открытых канала. Все остальные оказались для программы закрыты, хотя реально их больше двух. Тогда я сел за клавиатуру своего Linux-сервера и выполнил команду cat /etc/hosts.deny, чтобы увидеть файл /etc/hosts.deny, который содержит IP-адреса всех компьютеров, которым запрещено подключаться к серверу.

На экране появилось содержимое этого файла, и последней строкой был IP-адрес компьютера, с которого я производил сканирование:

ALL:      192.168.77.10

Программа PortSentry среагировала достаточно быстро и эффективно, прописав в файл /etc/hosts.deny запрет использования любого сервиса с адреса 192.168.77.10. Больше я уже ничего сделать не мог. Единственный способ снова получить доступ — удаление показанной здесь строки из файла /etc/hosts.deny.

Нужно заметить, что к некоторым портам пользователи могут обращаться достаточно часто, и программа будет думать, что это попытки взлома. К таким портам относятся порты ident (113) и NetBIOS (139), и их лучше всего исключить из наблюдения. Для этого в конфигурационном файле /usr/local/psionic/ portsentry/prtsentry.conf найдите строки ADVANCED_EXCLUDE_TCP (для TCP-портов) и ADVANCED_EXCLUDE_UDP (для UDP-портов) и добавьте нужные каналы в список. По умолчанию в программе исключены следующие порты:

ADVANCED_EXCLUDE_TCP="113,139"
ADVANCED_EXCLUDE_UDP="520,138,137,67"

Как видите, порты 113 и 139 по умолчанию уже исключаются из мониторинга.