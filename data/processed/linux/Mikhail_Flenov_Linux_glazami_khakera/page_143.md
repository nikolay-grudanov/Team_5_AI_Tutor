---
source_image: page_143.png
page_number: 143
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 33.13
tokens: 7955
characters: 2407
timestamp: 2025-12-24T04:22:55.115728
finish_reason: stop
---

В каталоге etc можно также увидеть три файла: group, passwd и shadow. Это неполные копии системных файлов. Например, если взглянуть на файл passwd, то он будет содержать только следующие строки:

root:x:0:0:Flenov,Admin:/root:/bin/bash
bin:x:1:1:bin:/bin:/sbin/nologin
daemon:x:2:2:daemon:/sbin:/sbin/nologin
nobody:x:99:99:Nobody:/sbin/nologin

Больше ничего там не будет, и, в частности, не будет пользователя robert, которого мы создавали раньше (см. разд. 4.3).

Однако один недостаток по части безопасности здесь присутствует— в файле /home/chroot/etc/shadow, где содержатся теневые пароли, находится реальный зашифрованный пароль из /etc/shadow. Лучше удалите его, иначе злоумышленник, узнав пароль на сервис, сможет проникнуть на сервер через другую дверь, которая не защищена виртуальным каталогом. Кроме того, проверьте права на этот файл, чтобы они были не более 600 (rw------).

Продолжаем настройку виртуального корневого каталога. Теперь нам нужно выполнить следующую команду:

/usr/local/bin/addjailsw /home/chroot

Во время ее работы по экрану побежит множество информационных строчек о выполняемых действиях, которые заключаются в том, что в каталог /home/chroot копируются основные каталоги и программы. Например, в папку /home/chroot/bin будут скопированы такие программы, как cat, cp, ls, rm и т. д., и сервис будет использовать именно их, а не те, что расположены в основном каталоге /bin.

Программа копирует то, что считает нужным, но далеко не все из этого потребуется будущему сервису, который станет работать в виртуальном корневом каталоге. Лишнее следует удалить, но лучше это делать после того, как вы убедитесь, что все работает.

Итак, необходимые программы перенесены, и окружение готово. Теперь сюда можно установить сервис:

/usr/local/bin/addjailsw /home/chroot -P httpd

В данном примере в новое окружение устанавливается программа httpd и все необходимые ей библиотеки. Программа jail сама определит, что будет нужно.

Теперь в новое окружение можно добавлять пользователя. Это выполняется командой:

/usr/local/bin/addjailuser chroot home sh name

Здесь chroot — виртуальный корневой каталог, в нашем случае должно быть указано /home/chroot. Параметр home — домашний каталог пользователя относительно виртуального каталога. Аргумент sh — командный интерпретатор, а name — имя пользователя, которое мы хотим добавить (оно должно уже существовать в основном окружении ОС).