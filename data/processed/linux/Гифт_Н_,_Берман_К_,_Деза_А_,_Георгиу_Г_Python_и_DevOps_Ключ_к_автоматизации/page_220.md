---
source_image: page_220.png
page_number: 220
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 30.58
tokens: 7552
characters: 2212
timestamp: 2025-12-24T03:06:40.253873
finish_reason: stop
---

python-statsd — прекрасная (и крошечная) библиотека, помещающая метрики в StatsD (далее их можно перенаправить в Graphite), с помощью которой можно легко и удобно организовать мониторинг на основе метрик. Удобно выделить в приложении отдельный модуль в качестве адаптера этой библиотеки, поскольку вам нужно будет добавить свои настройки, а делать это во множестве мест довольно утомительно.

Существует несколько пакетов Python-клиентов для StatsD в PyPI. Для следующих примеров используйте пакет python-statsd. Установите его в виртуальной среде с помощью команды pip install python-statsd. Применение не того клиента может привести к ошибкам импорта!

Один из простейших сценариев использования — счетчик, и примеры для библиотеки python-statsd выглядят примерно вот так:

```python
>>> import statsd
>>> counter = statsd.Counter('app')
>>> counter += 1
```

В этом примере предполагается, что StatsD запущен на локальной машине, а значит, не нужно создавать соединение, настройки по умолчанию прекрасно подходят. Но при обращении к классу Counter передается название (app), что в среде промышленной эксплуатации не сработает. Как рассказывается в разделе «Соглашения о наименованиях» далее, для работы приложения жизненно важна хорошая схема наименования, помогающая легко идентифицировать среду и местоположение данных метрик, но делать это повсюду — избыточно. В некоторых средах Graphite для всех метрик, отправляемых с целью аутентификации, пространству имен должно предшествовать секретное значение. В результате возникает дополнительный слой, который требуется абстрагировать, чтобы не нужно было использовать его при реализации метрик.

Некоторые части пространства имен, например секретное значение, должны гибко настраиваться, а другие могут присваиваться программно. Если у нас есть функция get_prefix() для необязательного добавления префикса к пространству имен, то адаптер для Counter в отдельном модуле для беспрепятственного взаимодействия можно создать следующим образом. Для работы примеров создайте новый модуль, назовите его metrics.py и добавьте в него следующее:

```python
import statsd
import get_prefix

def Counter(name):
    return statsd.Counter("%s.%s" % (get_prefix(), name))
```