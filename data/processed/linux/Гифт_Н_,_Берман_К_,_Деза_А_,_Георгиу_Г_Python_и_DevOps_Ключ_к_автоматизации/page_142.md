---
source_image: page_142.png
page_number: 142
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 27.75
tokens: 7513
characters: 1949
timestamp: 2025-12-24T03:04:37.189624
finish_reason: stop
---

клавишу Y или N и перейти к следующему вхождению. Никакого регулярного выражения вообще не нужно!

При включенных рекурсивных подстановках (shopt -s globstar в Bash 4) следующий замечательный односторочный сценарий проходит по всем подходящим файлам, выполняет поиск и в случае обнаружения в файлах указанного шаблона заменяет элемент в соответствии с реакцией пользователя на запросы подтверждения:

vim -c "bufdo! set eventignore-=Syntax | %s/needs_root/needs_root()/gce" **/*.py

Здесь не помещают развернутые пояснения. Приведенный пример обходит файловую систему рекурсивно, находя все файлы, название которых оканчивается на .py, загружает их в Vim и выполняет внутри них поиск и, обнаружив соответствия шаблону, замену с подтверждением. Если в файле вхождений не найдено, он пропускается. Команда set eventignore-=Syntax необходима, поскольку иначе Vim не загрузит файлы синтаксиса, а нам нравится выделение синтаксических элементов и мы хотели бы видеть его при подобной замене. Следующая часть сценария, после символа |, представляет собой замену с флагом подтверждения и флагом e для игнорирования ошибок, которые могли бы помешать бесперебойной работе.

Существует множество прочих флагов и вариантов усовершенствования команды замены. Узнать больше о специальных флагах при поиске/замене в Vim вы можете с помощью команды :help substitute, особенно в разделе s_flags.

Упростить запоминание приведенного ранее односторочного сценария можно с помощью функции, принимающей два параметра (искомое и замена) и путь:

vsed() {
    search=$1
    replace=$2
    shift
    shift
    vim -c "bufdo! set eventignore-=Syntax| %s/$search/$replace/gce" $*
}

Назовем ее vsed, как смесь Vim и утилиты sed, чтобы проще было запомнить. В терминале команда выглядит очень просто и дает возможность легко и уверенно вносить изменения во много файлов сразу, поскольку позволяет принимать или отклонять каждую замену:

$ vsed needs_root needs_root() **/*.py