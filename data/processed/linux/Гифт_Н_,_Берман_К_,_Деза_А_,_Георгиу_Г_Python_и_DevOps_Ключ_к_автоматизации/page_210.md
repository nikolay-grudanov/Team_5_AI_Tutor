---
source_image: page_210.png
page_number: 210
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 38.46
tokens: 7684
characters: 2543
timestamp: 2025-12-24T03:06:35.538980
finish_reason: stop
---

день примерно в 05:00 нагрузка на базу данных резко возрастала. И ситуация становилась все хуже и хуже.

Администраторы возражали против того, чтобы повысить уровень журналирования и посмотреть, какие запросы расходуют больше всего ресурсов (PostgreSQL может записывать информацию о запросах в журналы) за целый день, так что мы нашли компромисс: повысить уровень журналирования на 15 минут около 05:00. Получив эти журналы, Альфредо сразу же смог найти медленнее всего выполняемые запросы и узнать частоту их выполнения. Среди них немедленно обнаружился лидер: запрос типа SELECT * выполнялся так долго, что выходил за рамки 15-минутного окна. Приложение никаких запросов, выбирающих все данные из какой-либо таблицы, не производило — что же это был за запрос?

После долгих уговоров мы получили доступ к серверу базы данных. Раз всплеск нагрузки происходит около 05:00 каждый день, возможно, он связан с каким-либо регулярно выполняемым сценарием? Мы заглянули в crontab (программа, отслеживающая выполняемые в определенные моменты времени процессы) и обнаружили подозрительный сценарий backup.sh. В нем было несколько SQL-запросов, включавших SELECT *. Администраторы базы данных использовали его для создания резервных копий основной базы данных, и по мере увеличения ее размера росла и нагрузка, пока не вышла за рамки разумного. Решение? Отказаться от применения этого сценария и создавать резервные копии одной из четырех вторичных баз данных (реплик).

Это решало проблему резервных копий, но ничем не помогало с невозможностью доступа к журналам. Лучше всего заранее позаботиться о распределенном журналировании. Для этого предназначены такие утилиты, как rsyslog (https://www.rsyslog.com/), которые, если их использовать с самого начала, могут значительно упростить поиск причин перебоев в обслуживании при промышленной эксплуатации.

Производить или покупать?

Невероятно, насколько большая шумиха поднимается из-за зависимости пользователей от конкретного производителя. Впрочем, зависимость пользователей от конкретного производителя — вещь субъективная. Бросьте камень в любую сторону в деловом центре Сан-Франциско — и почти наверняка попадете в кого-нибудь вещающего об ужасах зависимости пользователей от производителей. Впрочем, если копнуть чуть глубже, становится ясно, что альтернативы-то и нет.

В экономике известен принцип сравнительного преимущества. По существу, он заключается в том, что с экономической точки зрения лучше сосредоточить свое внимание на том, в чем вы сильны, а все остальные задачи делегировать дру-