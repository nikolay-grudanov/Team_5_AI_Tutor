---
source_image: page_233.png
page_number: 233
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 36.86
tokens: 7628
characters: 2433
timestamp: 2025-12-24T03:07:08.351997
finish_reason: stop
---

Некоторые части этого оператора записи в журнал вполне очевидны, например HTTP-метод (GET) и метка даты/времени. Если у вас есть возможность управлять отображением информации, можете отбросить несущественную или включить какие-то нужные данные, главное — четко понимать смысл каждого из компонентов. Вот настройки по умолчанию в конфигурации HTTP-сервера в /etc/nginx/nginx.conf:

http {
    log_format main '$remote_addr - $remote_user [$time_local] "$request" '
                    '$status $body_bytes_sent "$http_referer" '
                    '"$http_user_agent" "$http_x_forwarded_for"';
...
}

При первом взгляде на выводимую информацию может сложиться впечатление, что тире символизируют отсутствующую информацию, но это не совсем так. В нашем примере вывода записей журнала за IP-адресом следуют два тире: одно просто в «косметических» целях, а второе обозначает отсутствие информации. Из конфигурации видно, что за IP-адресом следует одиночное тире, а затем $remote_user, что удобно для аутентификации (захвата аутентифицированного пользователя). Если же речь идет о HTTP-сервере, на котором не включена аутентификация, $remote_user можно из конфигурации убрать (при наличии прав доступа на изменение файла nginx.conf) или проигнорировать с помощью правил извлечения метаданных из журналов. В следующем разделе взглянем, чем в этой ситуации может помочь Logstash с его множеством плагинов обработки входных данных.

Elasticsearch, Logstash и Kibana обычно недоступны в дистрибутивах Linux. В зависимости от вида дистрибутива необходимо импортировать соответствующие ключи подписи, кроме того, система управления пакетами должна быть настроена на работу с нужными репозиториями. Загляните в посвященные установке разделы официальной документации (https://oreil.ly/A-EwN). Убедитесь также, что установлен пакет Filebeat — облегченная, но обладающая большими возможностями утилита для перенаправления журналов. Мы воспользуемся ею в дальнейшем для отправки журналов в Logstash.

Logstash

Первый шаг после того, как выбран стек ELK, — применить правила Logstash для извлечения информации из нужного источника, ее фильтрации, а затем передачи в нужный сервис — в данном случае Elasticsearch. После установки Logstash в файловой системе появляется путь /etc/logstash/ с полезным каталогом conf.d внутри, в который можно добавлять файлы конфигурации для различных сервисов. В нашем случае речь идет о захвате информации Nginx, ее