---
source_image: page_251.png
page_number: 251
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 26.17
tokens: 7496
characters: 1911
timestamp: 2025-12-24T03:07:26.047070
finish_reason: stop
---

Фикстурой служила функция, возвращающая содержимое файла с набором ключей. Создадим новый файл test_keyring.py, включающий фикстуру и маленькую тестовую функцию для проверки ключа по умолчанию:

import pytest
import random

@pytest.fixture
def mon_keyring():
    def make_keyring(default=False):
        if default:
            key = "AQBvaBFZAAAAABAA9VHgwCg3rWn8fMaX8KL01A=="
        else:
            key = "%032x==" % random.getrandbits(128)
        return '"'
        [mon.]
        key = %s
        caps mon = "allow *"
        """" % key
    return make_keyring

def test_default_key(mon_keyring):
    contents = mon_keyring(default=True)
    assert "AQBvaBFZAAAAABAA9VHgwCg3rWn8fMaX8KL01A==" in contents

Фикстура задействует вложенную функцию, выполняющую основную работу, позволяя использовать значение ключа по умолчанию либо вернуть вложенную функцию, если вызывающей стороне нужен случайный ключ. Внутри теста мы получаем фикстуру путем объявления ее частью аргумента тестовой функции (в данном случае mon_keyring) и вызываем фикстуру с параметром default=True, используя ключ по умолчанию, после чего проверяем, было ли сгенерировано то, что ожидалось.

На практике сгенерированное содержимое передавалось бы средству синтаксического разбора, чтобы гарантировать ожидаемое поведение после разбора и отсутствие ошибок в его ходе.

Предназначенный для промышленной эксплуатации код, использующий эту фикстуру, постепенно начал выполнять и другие виды тестирования, и в какой-то момент тест должен был проверять, может ли средство синтаксического разбора обрабатывать файлы при различных условиях. Фикстура возвращала строку, так что необходимо было расширить ее функциональность. Существующие тесты уже использовали фикстуру mon_keyring, поэтому, чтобы расширить функциональность, не затрагивая существующую фикстуру, была создана новая, использующая возможности фреймворка. Фикстуры могут обращаться