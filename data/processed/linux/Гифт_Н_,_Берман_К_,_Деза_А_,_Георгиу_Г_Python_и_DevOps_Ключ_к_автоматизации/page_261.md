---
source_image: page_261.png
page_number: 261
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 26.73
tokens: 7454
characters: 1857
timestamp: 2025-12-24T03:07:43.776924
finish_reason: stop
---

Благодаря использованию флага --hosts=default можно не указывать серверы непосредственно в командной строке и читать их из конфигурации SSH. Даже без Vagrant применять конфигурацию SSH удобно при подключении к большому числу серверов с конкретными инструкциями.

Еще один вариант в случае, если узлы локальные, с доступом по SSH, или контейнеры Docker, — Ansible (https://www.ansible.com). Для тестирования полезным окажется реестр хостов (подобный конфигурации SSH) с группировкой их по различным разделам. Можно также создавать группы хостов для выбора отдельных хостов для тестирования, вместо того чтобы тестировать сразу все.

Файл такого реестра (под названием hosts) для node1 и node2 из предыдущего примера выглядит так:

[all]
node1
node2

Если выполнять для всех хостов, команда меняется на следующую:

$ pytest --connection=ansible --ansible-inventory=hosts test_remote.py

Можно описать в реестре и отдельную группу, если требуется исключить какие-либо хосты из тестирования. Если оба наших узла представляют собой веб-серверы и входят в группу nginx, можно протестировать только эту группу с помощью следующей команды:

$ pytest --hosts='ansible://nginx' --connection=ansible \
    --ansible-inventory=hosts test_remote.py

Для множества системных команд необходимы полномочия суперпользователя. Testinfra позволяет указывать флаг --sudo или --sudo-user для повышения полномочий. Флаг --sudo заставляет движок задействовать sudo при выполнении команд, а флаг --sudo-user позволяет выполнять команду от имени другого пользователя, с более высокими полномочиями. Можно применять и фикстуру напрямую.

Фикстуры и особые фикстуры

Может показаться, что до сих пор для проверки наличия файлов и их содержимого в наших примерах использовалась только фикстура host. Однако такое впечатление обманчиво. Фикстура host включает в себя все прочие фикстуры