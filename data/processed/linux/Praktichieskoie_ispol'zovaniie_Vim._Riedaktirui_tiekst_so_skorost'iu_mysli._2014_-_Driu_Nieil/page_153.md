---
source_image: page_153.png
page_number: 153
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 23.37
tokens: 5728
characters: 1989
timestamp: 2025-12-24T04:12:51.080254
finish_reason: stop
---

Проблема в том, что у нас отсутствует право на запись в файл /etc/hosts file. Если вы помните, владельцем файла является root, а мы запустили Vim с привилегиями пользователя drew. Решить эту проблему можно несколько странной, на первый взгляд, командой:

:w !sudo tee % > /dev/null
Password:
W12: Warning: File "hosts" has changed and the buffer was changed in Vim as well
[O]k, (L)oad File, Load (A)ll, (I)gnore All:

Vim взаимодействует с нами в два этапа: сначала он требует ввести пароль пользователя drew (отвернитесь, пока я ввожу его); затем Vim предупреждает, что файл будет изменен, и предлагает меню с несколькими вариантами на выбор. Я рекомендую нажать l, чтобы снова загрузить файл в буфер.

Теперь разберемся, как все это работает. Команда :write !{cmd} посылает содержимое буфера на стандартный ввод указанной команде {cmd}, которая может быть любой внешней программой (см. :h :write_c http://vimdoc.sourceforge.net/htmldoc/editing.html#:write_c). Сам редактор Vim по-прежнему выполняется с привилегиями пользователя drew, но мы можем сообщить, что внешний процесс должен быть запущен с привилегиями суперпользователя. В данном случае всю работу выполняет утилита tee, которая запускается с помощью команды sudo, благодаря чему она получает возможность выполнить запись в файл /etc/hosts.

Символ % имеет специальное значение в командной строке Vim: он замещается строкой пути к файлу в текущем буфере (см. :h :_% http://vimdoc.sourceforge.net/htmldoc/cmdline.html#:_%), в данном случае — /etc/hosts. То есть заключительная часть команды выглядит так: tee /etc/hosts > /dev/null. Данная команда принимает содержимое буфера через стандартный ввод и записывает его в файл /etc/hosts.

Vim обнаруживает, что файл был изменен внешней программой. Обычно это означает рассинхронизацию содержимого буфера и файла, и именно поэтому Vim предлагает сохранить версию в буфере или загрузить версию с диска. В данном примере так получилось, что буфер и файл содержат один и тот же текст.