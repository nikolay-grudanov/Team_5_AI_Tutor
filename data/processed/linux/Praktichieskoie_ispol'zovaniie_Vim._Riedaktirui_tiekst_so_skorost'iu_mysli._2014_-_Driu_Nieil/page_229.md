---
source_image: page_229.png
page_number: 229
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 24.56
tokens: 5729
characters: 1729
timestamp: 2025-12-24T04:14:29.828625
finish_reason: stop
---

Мы уже знаем пару приемов, как выполнять простые арифметические операции в Vim. Мы можем использовать команды <C-a> и <C-x> (см. рецепт 10 в главе 2) или задействовать регистр выражений (см. рецепт 16 в главе 3). В этом рецепте мы будем использовать регистр выражений и слегка коснемся языка сценариев Vim.

Простой язык сценариев Vim

Начнем с того, что последовательно выполним несколько команд в режиме командной строки. Ключевое слово let позволяет нам создать переменную i и присвоить ей значение 0. Команда :echo дает возможность вывести текущее значение переменной.

⇒ :let i=0
⇒ :echo i
    0

Мы можем увеличить значение i:

⇒ :let i += 1
⇒ :echo i
    1

Команда :echo отлично подходит, чтобы получить значение переменной, но в идеале нам нужен инструмент, позволяющий вставить значение в документ. Сделать это можно посредством регистра выражений. В рецепте 16 (глава 3) было показано, что регистр выражений можно использовать для вычисления простых сумм и вставки результатов в документ. Вставить значение переменной i можно, выполнив команду <C-r>=i<CR> в режиме вставки.

Запись макроса

Теперь объединим все вместе:

<table>
  <tr>
    <th>Нажатия клавиш</th>
    <th>Содержимое буфера</th>
  </tr>
  <tr>
    <td>:let i=1</td>
    <td>partridge in a pear tree</td>
  </tr>
  <tr>
    <td>qa</td>
    <td>partridge in a pear tree</td>
  </tr>
  <tr>
    <td>I<C-r>=i<CR>)<ESC></td>
    <td>1) partridge in a pear tree</td>
  </tr>
  <tr>
    <td>:let i += 1</td>
    <td>1) partridge in a pear tree</td>
  </tr>
  <tr>
    <td>q</td>
    <td>1) partridge in a pear tree</td>
  </tr>
</table>

Перед началом записи макроса мы присвоили переменной i значение 1. Для вставки значения i в текст во время записи макроса