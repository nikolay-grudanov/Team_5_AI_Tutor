---
source_image: page_215.png
page_number: 215
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 22.95
tokens: 5718
characters: 1925
timestamp: 2025-12-24T04:14:11.344926
finish_reason: stop
---

Если команда перемещения потерпит неудачу в ходе выполнения макроса, Vim прервет его выполнение. Рассматривайте это как особенность, а не как ошибку. Команды перемещения можно использовать как простой индикатор возможности выполнения макроса в текущем контексте.

Рассмотрим простой пример: начнем с того, что выполним поиск по шаблону. Допустим, что документ содержит десять совпадений. Запись макроса начинается с выполнения команды n, повторяющей последнюю операцию поиска. После установки курсора в начало совпадения мы выполняем некоторые операции и останавливаем запись макроса. В результате нашей правки измененный текст больше не совпадает с искомым шаблоном. Теперь документ содержит всего девять совпадений.

Когда мы запустим макрос, он перейдет к следующему совпадению и выполнит те же самые операции. Теперь в документе осталось восемь совпадений. Мы выполняем макрос снова и снова, пока не будет изменено последнее совпадение. Если теперь попытаться выполнить макрос еще раз, команда n потерпит неудачу из-за отсутствия совпадений и выполнение макроса прервется.

Допустим, что макрос был сохранен в регистре a. Вместо того чтобы десять раз выполнить команду @a, мы можем снабдить ее счетчиком: 10@a. Вся прелесть этого приема в том, что от нас не требуется высокая точность. Вы не знаете, сколько будет совпадений? Не беда! Вы можете выполнить команду 100@a или даже 1000@a — результат будет тем же.

Рецепт 66. Выполнение со счетчиком

«Формула точки» является весьма эффективной стратегией редактирования для небольшого количества повторений, но она не позволяет использовать счетчик. Преодолеть это ограничение можно, записав небольшой макрос и выполнив его нужное количество раз.

В рецепте 3 (глава 1) мы использовали «формулу точки» для редактирования фрагмента:

the_vim_way/3_concat.js
http://media.pragprog.com/titles/dnvim/code/the_vim_way/3_concat.js

var foo = "method("+argument1+","+argument2+");