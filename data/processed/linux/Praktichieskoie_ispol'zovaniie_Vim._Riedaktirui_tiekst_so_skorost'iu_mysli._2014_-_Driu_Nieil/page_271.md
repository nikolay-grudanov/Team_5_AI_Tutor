---
source_image: page_271.png
page_number: 271
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 18.88
tokens: 5626
characters: 1503
timestamp: 2025-12-24T04:15:15.871189
finish_reason: stop
---

слово. Однако эту возможность легко добавить в Vim, написав небольшой сценарий.

Поиск текущего выделения (прототип)

Если заглянуть в раздел справки :h visual-search http://vim-doc.sourceforge.net/htmldoc/visual.html#visual-search, можно увидеть следующее предложение:

Ниже предлагается вариант реализации поиска выделенного текста и назначения горячей клавиши:

:imap X y/<C-R>"<CR>

Обратите внимание, что присутствие специальных символов в тексте (таких как «.» и «*») будет вызывать проблемы.

Команда y захватывает (копирует) текущее выделение, а последовательность /<C-r>"<CR> инициирует ввод команды поиска, вставляет содержимое регистра по умолчанию и выполняет поиск. Решение достаточно простое, но, согласно предупреждению в справке, имеет некоторые ограничения.
В рецепте 78 (глава 12) мы узнали, как преодолевать подобные ограничения. Теперь попробуем совместить теорию с практикой и создать привязку к клавише, обеспечивающую возможность поиска текущего выделения, решающую проблему наличия специальных символов.

Поиск текущего выделения (окончательная версия)

Следующий сценарий Vim решает поставленную задачу:

patterns/visual-star.vim
http://media.pragprog.com/titles/dnvim/code/patterns/visual-star.vim

xnoremap * :<C-u>call <SID>VSetSearch()<CR>/<C-R>=@/<CR><CR>
xnoremap # :<C-u>call <SID>VSetSearch()<CR>?<C-R>=@/<CR><CR>

function! s:VSetSearch()
    let temp = @s
    norm! gv"sy
    let @/ = '\V' . substitute(escape(@s, '/\'), '\n', '\\n', 'g')
    let @s = temp
endfunction