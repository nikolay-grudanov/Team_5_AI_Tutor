---
source_image: page_114.png
page_number: 114
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 20.35
tokens: 5696
characters: 1804
timestamp: 2025-12-24T04:11:58.492136
finish_reason: stop
---

Рецепт 34. Повторный вызов команд из истории

Преимущество этих комбинаций состоит в том, что они не требуют менять привычное положение рук на клавиатуре. Но, в отличие от клавиш <Up> и <Down>, комбинации <C-p> и <C-n> не фильтруют историю команд.

Мы можем взять все самое лучшее из обоих способов, определив следующее отображение клавиш:

ex_mode/history-scrollers.vim
http://media.pragprog.com/titles/dnvim/code/ex_mode/history-scrollers.vim

cnoremap <C-p> <Up>
cnoremap <C-n> <Down>

Допустим, что мы правим простой сценарий на языке Ruby. Каждый раз, внося изменения, мы обнаруживаем, что выполняем следующие две команды:

⇒ :write
⇒ :!ruby %

Выполнив эти две команды пару раз, мы замечаем, что могли сэкономить на усилиях, заключив обе команды в одну командную строку. Благодаря этому мы сможем выбрать полную команду из истории и повторно выполнить ее:

⇒ :write | !ruby %

Каждая из этих команд по отдельности уже находится в истории, поэтому нам не нужно вводить полную команду «с нуля». Но как объединить две записи из истории в одну? Нажмите q:, и на экране появится окно с историей команд (см. :h cmdwin http://vimdoc.sourceforge.net/htmldoc/cmdline.html#cmdwin).

Окно с историей командной строки напоминает обычный буфер, где каждая строка содержит элемент из истории. Мы можем перемещаться по истории, нажимая клавиши k и j. Или использовать средства поиска в Vim, чтобы найти нужную команду. Нажатие клавиши <CR> приведет к выполнению содержимого текущей строки как команды Ex.

Вся прелесть окна режима командной строки — в том, что оно позволяет изменять строки в истории команд, используя для этого всю мощь редактора Vim. Мы можем перемещаться по окну, применяя команды перемещения, доступные в командном режиме, использовать механизм визуального выделения или переключаться в режим