---
source_image: page_073.png
page_number: 73
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 20.52
tokens: 5704
characters: 1866
timestamp: 2025-12-24T04:11:07.289845
finish_reason: stop
---

Рецепт 16. Выполняйте простые вычисления на месте

Регистр выражений позволяет выполнять вычисления и вставлять результат непосредственно в документ. В этом рецепте вы увидите одно из применений этой мощной возможности.

Большинство регистров в Vim хранят текст либо в виде последовательности символов, либо в виде целых строк текста. Команды удаления и копирования в регистр позволяют сохранять содержимое в регистре, а команда вставки — извлекать содержимое регистра и вставлять его в документ.

Регистр выражений — это нечто иное. Он может вычислять выражения на языке сценариев Vim и возвращать результат. Мы можем использовать его как калькулятор. Передача простого выражения, такого как 1+1, даст результат 2. Возвращаемое значение можно использовать как текстовое содержимое обычного регистра.

Регистр выражений адресуется символом =. Получить доступ к регистру выражений из режима вставки можно командой <C-r>=. В результате в нижней части экрана появится строка ввода, где можно ввести требуемое выражение. Закончив ввод, нажмите <CR>, и Vim вставит результат в документ, в позицию курсора.

Допустим, что мы только что набрали текст:

insert_mode/back-of-envelope.txt
http://media.pragprog.com/titles/dnvim/code/insert_mode/back-of-envelope.txt

6 chairs, each costing $35, totals $

Не нужно вычислять общую стоимость на клочке бумаги. Vim может выполнить вычисления за нас, и нам даже не придется покидать режим вставки:

<table>
  <tr>
    <th>Нажатия клавиш</th>
    <th>Содержимое буфера</th>
  </tr>
  <tr>
    <td>A</td>
    <td>6 chairs, each costing $35, totals $<br></td>
  </tr>
  <tr>
    <td><C-r>=6*35<CR></td>
    <td>6 chairs, each costing $35, totals $210</td>
  </tr>
</table>

Регистр может выполнять не только простые арифметические операции. Более сложный пример использования этого регистра будет представлен в рецепте 70 в главе 11.