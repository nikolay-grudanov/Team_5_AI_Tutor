---
source_image: page_179.png
page_number: 179
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 24.83
tokens: 5824
characters: 2185
timestamp: 2025-12-24T04:13:24.238845
finish_reason: stop
---

Допустим, что мы установили курсор на открывающую фигурную скобку и вводим команду r[, чтобы заменить ее открывающей квадратной скобкой. В результате у нас получилась странная конструкция: [London Berlin New\ York}. Команда % может работать только с парными скобками, поэтому ее нельзя использовать, чтобы перейти к закрывающей фигурной скобке }.

Вся хитрость состоит в том, чтобы использовать команду % до внесения каких-либо изменений. Когда вызывается команда %, Vim автоматически устанавливает метку в позицию, откуда выполняется переход. Благодаря этому появляется возможность вернуться назад командой ```. Ниже приводится частичное решение для нашего примера рефакторинга кода:

<table>
  <tr>
    <th>Нажатия клавиш</th>
    <th>Содержимое буфера</th>
  </tr>
  <tr>
    <td>{start}</td>
    <td>cities = %w{London Berlin New\ York}</td>
  </tr>
  <tr>
    <td>dt{</td>
    <td>cities = {London Berlin New\ York}</td>
  </tr>
  <tr>
    <td>%</td>
    <td>cities = {London Berlin New\ York}</td>
  </tr>
  <tr>
    <td>r]</td>
    <td>cities = {London Berlin New\ York}</td>
  </tr>
  <tr>
    <td>``</td>
    <td>cities = {London Berlin New\ York}</td>
  </tr>
  <tr>
    <td>r[</td>
    <td>cities = [London Berlin New\ York}</td>
  </tr>
</table>

Обратите внимание, что в этом примере вместо команды ``` можно было бы использовать команду <C-o> (см. рецепт 55 в главе 9). Расширение surround.vim поддерживает команды, еще более упрощающие эту задачу. Подробнее об этом рассказывается во врезке «Surround.vim» ниже.

Переход между парными ключевыми словами

В состав дистрибутива Vim входит расширение matchit, увеличивающее возможности команды %. Когда это расширение включено, с помощью команды % оказывается возможным переходить между парными ключевыми словами. Например, в тексте с разметкой HT-ML команда % сможет переходить между открывающими и закрывающими тегами. В коде на языке Ruby она сможет переходить между парами ключевых слов class/end, def/end и if/end.

Но даже при том, что расширение matchit входит в состав дистрибутива Vim, оно выключено по умолчанию. Следующие строки в файле vimrc обеспечат автоматическую загрузку расширения matchit при запуске Vim: