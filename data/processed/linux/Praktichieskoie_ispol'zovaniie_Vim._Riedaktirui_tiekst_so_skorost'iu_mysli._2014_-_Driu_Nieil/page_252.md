---
source_image: page_252.png
page_number: 252
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 22.77
tokens: 5751
characters: 1986
timestamp: 2025-12-24T04:14:55.608473
finish_reason: stop
---

Символы обратного слэша должны экранироваться всегда, независимо от направления поиска, вперед или назад.

Экранируйте символы программно

Экранирование символов вручную — довольно утомительная процедура, при выполнении которой легко можно ошибиться. К счастью, существует библиотека функций на языке сценариев Vim, которые могут взять всю тяжелую работу на себя: escape({string}, {chars}) (см. :h escape() http://vimdoc.sourceforge.net/htmldoc/eval.html#escape()).

Аргумент {chars} определяет экранируемый символ. Выполняя поиск вперед, можно произвести вызов escape(@u, '/\'), который добавит обратный слэш перед каждым символом / и \. Выполняя поиск назад, можно произвести вызов escape(@u, '?\').

Прежде всего убедимся, что искомая строка URL все еще хранится в регистре u. Затем перейдем в строку ввода команды поиска, нажав / или ?; для демонстрации подойдет любая из них. Введите ключ \V и затем нажмите <C-r>=. Последняя команда переключит редактор из режима ввода команды поиска в режим ввода выражения. Теперь введите следующую строку:

⇒ =escape(@u, getcmdtype().'\')

После нажатия клавиши <CR> редактор выполнит функцию escape() и вставит результат в команду поиска. Функция getcmdtype() просто возвращает символ /, если выполняется поиск вперед, и символ ?, если выполняется поиск назад (см. :h getcmdtype() http://vimdoc.sourceforge.net/htmldoc/eval.html#getcmdtype()). В языке сценариев Vim оператор . выполняет конкатенацию строк, то есть выражение getcmdtype().'\' вернет строку «/\», если выполняется поиск вперед, и строку «?\», если выполняется поиск назад. В результате, независимо от направления поиска, это выражение экранирует содержимое регистра u так, что его можно использовать в команде поиска.

Переключение в режим ввода выражения и вызов функции escape() вручную требуют большого количества нажатий на клавиши. Однако решение этой задачи можно автоматизировать, написав небольшой сценарий Vim. Пример такого сценария вы найдете в рецепте 86 в главе 13.