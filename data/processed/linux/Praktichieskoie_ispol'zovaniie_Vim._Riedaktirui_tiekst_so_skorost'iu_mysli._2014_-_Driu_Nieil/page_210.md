---
source_image: page_210.png
page_number: 210
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 22.55
tokens: 5746
characters: 1762
timestamp: 2025-12-24T04:14:05.235523
finish_reason: stop
---

Рецепт 64. Запись и выполнение макроса

Рецепт 64. Запись и выполнение макроса

Механизм поддержки макросов позволяет записывать последовательности нажатий на клавиши и затем воспроизводить их. Данный рецепт демонстрирует, как это делается.
Многие повторяющиеся задачи включают множество изменений. При желании мы можем автоматизировать их, записав макрос и затем выполняя его многократно.

Запись последовательности команд в виде макроса

Клавиша q действует как своеобразная кнопка «Запись» и одновременно как кнопка «Стоп». Чтобы начать запись последовательности нажатий на клавиши, необходимо ввести q{register}, указав имя регистра, где будет сохранен макрос. Если все было сделано правильно, в строке состояния появится слово «recording» («запись»). После этого будет производиться запись всех выполняемых команд, пока повторно не будет нажата клавиша q, останавливающая запись.
Давайте рассмотрим, как это выполняется на практике:

<table>
  <tr>
    <th>Нажатия клавиш</th>
    <th>Содержимое буфера</th>
  </tr>
  <tr>
    <td>qa</td>
    <td>foo = 1<br>bar = 'a'<br>foobar = foo + bar</td>
  </tr>
  <tr>
    <td>A;<Esc></td>
    <td>foo = 1;<br>bar = 'a'<br>foobar = foo + bar</td>
  </tr>
  <tr>
    <td>Ivar<Esc></td>
    <td>varfoo = 1;<br>bar = 'a'<br>foobar = foo + bar</td>
  </tr>
  <tr>
    <td>q</td>
    <td>varfoo = 1;<br>bar = 'a'<br>foobar = foo + bar</td>
  </tr>
</table>

Последовательность qa запускает запись макроса в регистр a. Затем выполняются два изменения в первой строке: добавление в конец точки с запятой и вставка в начало слова var. После внесения изменений запись останавливается нажатием q (:h q http://vim-doc.sourceforge.net/htmldoc/repeat.html#q).
Мы можем исследовать содержимое регистра, выполнив следующую команду: