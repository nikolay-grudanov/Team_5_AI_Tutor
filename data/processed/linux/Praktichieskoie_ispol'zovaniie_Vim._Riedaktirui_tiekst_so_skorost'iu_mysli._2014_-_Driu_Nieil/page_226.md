---
source_image: page_226.png
page_number: 226
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 22.51
tokens: 5686
characters: 1804
timestamp: 2025-12-24T04:14:22.663038
finish_reason: stop
---

Рецепт 69. Выполнение операций над множеством файлов

forge.net/htmldoc/editing.html#:argdo). Но если выполнить команду :argdo normal @a прямо сейчас, мы получим побочный эффект.

Представьте: команда :argdo normal @a выполнит только что записанный макрос для всех буферов в списке аргументов, включая и первый, в который мы уже внесли изменения во время записи макроса. Как результат содержимое первого буфера будет обернуто объявлением дважды.

Чтобы избежать этого, мы отменим все изменения, выполненные в первом буфере, командой :edit! (см. :h :edit! http://vimdoc.sourceforge.net/htmldoc/editing.html#:edit!):

⇒ :edit!

Если вы уже сохранили изменения в файле, команда :edit! не даст желаемого результата. В этом случае просто выполните несколько раз команду u, пока содержимое файла не примет первоначальный вид.

Теперь можно выполнить макрос во всех буферах в списке аргументов:

⇒ :argdo normal @a

Описанный выше прием требует выполнения подготовительных операций, но зато позволяет одной командой выполнить массу работы. А теперь посмотрим, как можно адаптировать этот макрос для последовательного выполнения.

Последовательное выполнение макроса

Наш макрос выполняет единицу правки в одном буфере. Если необходимо обеспечить его воздействие на несколько буферов, следует добавить в конец команду, выполняющую переход к следующему буферу в списке (см. табл. 11.3).

Мы могли бы вызвать команду 3@a, чтобы выполнить макрос для каждого из оставшихся файлов в списке буферов, однако нам не нужна такая точность. Достигнув последнего буфера в списке аргументов, команда :next потерпит неудачу и прервет выполнение макроса. Поэтому вместо точного значения счетчика можно указать любое число, заведомо превышающее количество буферов: 22 как раз является таким числом, к тому же оно легко вводится.