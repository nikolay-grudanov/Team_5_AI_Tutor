---
source_image: page_289.png
page_number: 289
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 23.48
tokens: 5690
characters: 1761
timestamp: 2025-12-24T04:15:39.786799
finish_reason: stop
---

Шаблон поиска

Единственное, что нам нужно изменить, — числовую часть в тегах заголовков, поэтому в идеале нам нужно создать шаблон, который будет совпадать только с ней и ни с чем больше. Нам не нужно совпадение со случайными цифрами в документе — только с теми, которым предшествуют символы <h или </h. Необходимое совпадение обеспечивает следующий шаблон:

⇒ /\v<\/?h\zs\d

Специальный символ \zs позволяет ограничить совпадение. Для простоты можно сказать, что шаблон h\zs\d будет совпадать с буквой «h», за которой следует любая цифра («h1», «h2» и т. д.). Местоположение специального символа \zs указывает, что сам символ «h» должен исключаться из совпадения, даже при том что он является составной частью шаблона (мы уже встречались со специальным символом \zs в рецепте 77 главы 12, где сравнивали его с положительной ретроспективной проверкой в языке Perl). Наш шаблон выглядит немного сложнее только потому, что нам требуется, чтобы он совпадал не просто с «h1» и «h2», а с «<h1>», «</h1>», «<h2>», «</h2>» и т. д.

Попробуйте выполнить поиск по этому шаблону у себя. В результате все числовые части тегов заголовков должны быть подсвечены, а остальные цифры, имеющиеся в документе, — нет.

Команда подстановки

Нам нужно выполнить арифметическую операцию в поле замены команды подстановки. Для этого следует использовать выражение на языке сценариев Vim. Извлечь текущее совпадение можно с вызовом функции submatch(0). Так как наш шаблон соответствует только цифре и ничему другому, можно смело полагать, что submatch(0) вернет число. Нам остается только вычесть из него единицу и вернуть результат, чтобы команда подстановки вставила его на место совпадения.

С этой работой должна справиться следующая команда подстановки:

⇒ :%s/\/=submatch(0)-1/g