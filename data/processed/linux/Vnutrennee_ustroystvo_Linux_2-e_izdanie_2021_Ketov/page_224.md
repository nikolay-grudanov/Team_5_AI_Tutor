---
source_image: page_224.png
page_number: 224
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 32.64
tokens: 7590
characters: 2168
timestamp: 2025-12-24T04:38:19.416522
finish_reason: stop
---

if закончился неуспешно, и ветвь else в противном случае. В примере 3 стоит обратить внимание на то, что списки, использующиеся в конструкции if, могут отделяться символом ;, а не символом перевода строки \(\leftarrow\), как в примерах 1 и 2.

В листинге 5.43 приведен маленький сценарий на языке командного интерпретатора, исполняющийся интерактивно в режиме трассировки команд. В нем используются практически все конструкции командного интерпретатора: перенаправление потоков, конвейер, подстановки команд, параметров, арифметических выражений, экранирование и составной список ветвлений.

Листинг 5.43. Простое ветвление по результату проверки условий

bender@ubuntu:~$ set -x
1 bender@ubuntu:~$ load=$(awk '{printf "%d", $1*100 + $2*10 + $3}' < /proc/loadavg)
++ awk '{printf "%d", $1*100 + $2*10 + $3}'
+ load=86
2 bender@ubuntu:~$ power=$(( $(nproc)*100 ))
++ nproc
+ power=400
3 bender@ubuntu:~$ temp=$(( $(cat /sys/class/thermal/thermal_zone0/temp)/1000 ))
++ cat /sys/class/thermal/thermal_zone0/temp
+ temp=55
4 bender@ubuntu:~$ if [ $load -ge $power -a $temp -gt 80 ] \leftarrow
> then \leftarrow
> notify-send "Обнаружена перегрузка: t=$temp C" "$(top -bn1 | head -5)" \leftarrow
> fi \leftarrow
7 + '[' 86 -ge 400 -a 55 -gt 80']'

Сначала 1 вычисляется «интегральная» нагрузка на систему load путем «взвешивания» с весами 100, 10 и 1 статистики за последние 1, 5 и 15 мин о среднем количестве процессов, стоящих в очереди на получение процессорного времени или доступа к устройству ввода-вывода. Измеряемая ядром статистика считывается из трех столбцов одной строки файла /proc/loadavg псевдофайловой системы proc(5). Взвешивание выполняется при помощи процессора текстовых таблиц W:[AWK] (см. разд. 5.8.3), основное назначение которого состоит в разбиении строк на столбцы и построчном выполнении указанных действий над ними. В данном случае awk(1) выводит в формате (printf) целого числа (%d) результат взвешивания на основе значений статистики из первого ($1), второго ($2) и третьего ($3) столбцов.

Затем 2 вычисляется «мощность» вычислительной системы power путем умножения 100 (процентов) на количество ядер процессора. Следующим шагом 3 вычисляет-