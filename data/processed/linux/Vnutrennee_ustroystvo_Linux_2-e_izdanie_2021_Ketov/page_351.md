---
source_image: page_351.png
page_number: 351
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 28.39
tokens: 7691
characters: 2616
timestamp: 2025-12-24T04:42:20.788486
finish_reason: stop
---

Ожидаемым результатом создания новых пространств (процессов -p, монтирования -m и сети -n) стала недоступность информации о процессах других пространств 1 кроме своего собственного 2, недоступность 3 в нем сетевых интерфейсов других пространств 4 (за исключением одноименного, но собственного экземпляра loopback интерфейса) и недоступность другим пространствам смонтированных файловых систем 5 (сравните с 2 в листинге 9.4). Особенном комментарием к листингу 9.6 нужно отметить, что утилита unshare(2) умеет самостоятельно использовать системный вызов chroot(1) для изоляции дерева каталогов (-R) и монтировать файловую систему /proc внутри контейнера, что очень удобно.

Получаемые таким образом контейнеры почти полностью¹ изолированы от основной операционной системы (и друг от друга), что позволяет использовать подобный подход для изолированного запуска сетевых служб или организации виртуального хостинга. Однако вместе с тем возникает обратная задача организации связи этих изолированных окружений с внешним миром. Например, для сетевого взаимодействия контейнеру должны быть так или иначе доступны сетевые интерфейсы. Для связи с основной ОС² или другими контейнерами зачастую удобно использовать общие каталоги и файлы, в том числе файлы локальных сокетов (см. разд. 4.9.4). Кроме того, возникает необходимость и просто выполнять те или иные программы в уже существующих пространствах, где работают изолированные программы.

В листинге 9.7 показано обеспечение сетевой связи между изолированным контейнером c-137 и хост-системой при помощи создания виртуального Ethernet-коммутатора 2 (type veth) с двумя виртуальными интерфейсами net0 2 и c137net0 1 для контейнера и хост-системы соответственно. Затем интерфейс net0 был помещен 3 в то сетевое пространство имен, которое было создано при запуске первой программы контейнера 1 и которому впоследствии было назначено имя anotherdimension 1.

Интерфейсы контейнера и хост-системы конфигурируются обычным способом (см. разд. 6.2.1), им назначаются IP-адреса 5 и 6, мастер-интерфейс активируется 7, после чего проверяется работоспособность соединения 8 и 9.

Листинг 9.7. Перемещение сетевых интерфейсов между сетевыми пространствами имен

rick@ubuntu:~$ sudo unshare --mpn -f -R c-137 --mount-proc busybox sh 1
/ # ip link
1: lo: <LOOPBACK> mtu 65536 qdisc noop qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00

1 Осталось еще несколько пространств, подлежащих изоляции, которые таким же образом можно создать при запуске изолируемой программы утилитой unshare(1).
2 Называемой зачастую «хост»-системой, другими словами, «ведущей» системой.