---
source_image: page_163.png
page_number: 163
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 35.58
tokens: 7718
characters: 2289
timestamp: 2025-12-24T04:36:41.648031
finish_reason: stop
---

Листинг 4.36. Виртуальная и резидентная память процесса

fitz@ubuntu:~$ ps fux
USER    PID %CPU %MEM   VSZ   RSS TTY STAT START TIME COMMAND
jake    4257 1.4 1.2 962016 49072 ? Ssl 20:46 0:00 \_ .../gnome-terminal-server
jake    4267 0.0 0.1 12948 4808 pts/0 Ss+ 20:46 0:00 | \_ bash
jake    4276 20.5 5.9 2930660 240788 ? Sl 20:46 0:05 \_ .../firefox -new-window
jake    4378 8.6 3.5 2427016 141300 ? Sl 20:46 0:01 \_ .../firefox ...
jake    4475 6.8 2.6 2390580 107920 ? Sl 20:46 0:01 \_ .../firefox ...
jake    4521 3.2 2.0 2374856 84480 ? Sl 20:46 0:00 \_ .../firefox ...

4.7.2. Отображение файлов в память

Страницный обмен, помимо организации виртуальной памяти, имеет еще одно важнейшее применение. Именно на его основе реализуется незаменимый механизм отображения файлов в память процесса, доступный при помощи системных вызовов mmap(2)/munmap(2) (и дополнительных mlock(2), mprotect(2), msync(2), madvise(2) и др.).

Для отображения файла (рис. 4.5) в память процесса ему выделяют страницы ① в необходимом количестве (VSZ), но не страничные кадры (RSS). Вместо этого в таблице страниц формируются такие записи ①, как будто эти страницы уже были выгружены ранее (!) в отображаемый файл ②. При последующем обращении (on demand) процесса к какой-либо странице отображенной памяти под нее выделяют ① страницный кадр и заполняют ② (read) соответствующим содержимым файла. Любые последующие изменения, сделанные процессом в отображенных страницах, сохраняются ① обратно (write back) в файл, если отображение выполнено «разделяемым»¹ (shared) способом. Для страниц, отображенных «частным» (private) способом, используется принцип COW (copy-on-write) ①, согласно которому любые попытки их изменений (write) приводят к созданию их копий (сопу), куда и попадают изменения.

Таким образом, страницы отображенного файла, которые никогда не были востребованы процессом, не будут вовсе занимать оперативной памяти (не попадут в RSS). Это обстоятельство широко используется для «загрузки» в процесс его программы и библиотек. В листинге 4.37 при помощи команды pmap(1) показана карта (отображения файлов) памяти процесса командного интерпретатора bash(1).

¹ Такие понятия и поведение механизма отображения выбраны не случайно, ведь файл может быть отображен в несколько процессов одновременно.