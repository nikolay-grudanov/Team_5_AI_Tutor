---
source_image: page_158.png
page_number: 158
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 28.88
tokens: 7568
characters: 2231
timestamp: 2025-12-24T04:36:24.454604
finish_reason: stop
---

ройству, за которую ранее состязались процессы, выполняющиеся на разных процессорах, организовали индивидуальные очереди (multi-queue) по числу процессоров, что позволило существенно повысить эффективность работы подсистемы. Это привело к переделке драйверов устройств и планировщиков ввода-вывода к новому виду, которая закончилась к началу ядер серии 5.x. Вместе с тем планировщик deadline превратился в mq-deadline, место CFQ занял BFQ, а позднее был добавлен планировщик kyber (листинг 4.33) для работы с высокоскоростными накопителями.

Листинг 4.33. I/O планировщики устройств (multi-queue)

fitz@ubuntu:~$ cat /sys/block/{sda,sr0}/queue/scheduler
mq-deadline [bfq] none
[mq-deadline] bfq none
fitz@ubuntu:~$ uname -r
5.3.0-24-lowlatency
fitz@ubuntu:~$ modinfo bfq
filename:      /lib/modules/5.3.0-26-generic/kernel/block/bfq.ko
description:   MQ Budget Fair Queueing I/O Scheduler
fitz@ubuntu:~$ modinfo kyber-iosched
filename:      /lib/modules/5.3.0-26-generic/kernel/block/kyber-iosched.ko
description:   Kyber I/O scheduler

Планировщик BFQ изначально базировался на коде CFQ и до сих пор сохраняет практически все его свойства, но вместо интервалов времени, отводимых на обработку запросов, использует понятие «бюджета» обработки, исчисляемого в количестве (дисковых) секторов, которые будут обслужены из той или иной очереди. Бюджет BFQ (как и интервалы обработки CFQ) пропорционален приоритетам процессов, что делает планировщик «справедливым»1 в отношении доли пропускной способности устройства, выделяемой отдельным процессам. Кроме этого, планировщик следит, чтобы потребление выделенного «бюджета» не занимало много времени (например, процесс может читать секторы, далеко отстоящие друг от друга), в противном случае очередь «наказывается» путем снятия с обработки до исчерпания своего бюджета.

В листинге 4.34 показано управление классами и приоритетами планировщиков CFQ и BFQ, а в листинге 4.35 — пропорциональное распределение пропускной способности между конкурирующими процессами.

1 Процессам в одном классе с одинаковыми приоритетами будет выделена одинаковая доля пропускной способности, а процессам с разными приоритетами — разная, но пропорциональная их приоритетам. И пусть никто не уйдет обиженным.