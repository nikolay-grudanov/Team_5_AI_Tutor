---
source_image: page_156.png
page_number: 156
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 33.03
tokens: 7623
characters: 2260
timestamp: 2025-12-24T04:36:24.656136
finish_reason: stop
---

тов. Для обработки запросов на запись базовый интервал составляет всего лишь 40 мс (см. 2 в листинге 4.32).

Кроме того, приоритеты так же используются для определения «времени начала» обработки запросов каждой очереди (slice offset), как \( SO_p = (n - 1) \cdot (S_0 - S_p) \), где \( n \) — количество непустых очередей планировщика. Например, если есть три активно читающих процесса \( n = 3 \), то для процессов с приоритетом 0 время начала обработки определяется как \( SO_0 = 0 \) мс, а для процессов с приоритетом 7 — как \( SO_7 = 2 \cdot (180 - 40) = 360 \) мс соответственно.

Запросы в очередях класса realtime обрабатываются в первую очередь, и если все запросы исчерпаны, то планировщик переходит к обработке best-effort-очередей, а при их исчерпании — к очередям класса idle. Внутри каждого класса очереди обрабатываются в порядке «времени начала» обработки и в течение интервала обработки, а сами запросы — в порядке номеров их дисковых блоков. Вместе с тем, как было сказано раньше, CFQ-планировщик попроцессно отслеживает максимально установленные «сроки» обработки запросов, что составляет 250 мс для запросов записи и 125 мс для запросов чтения (см. 3 в листинге 4.32). При исчерпании запросов в обрабатываемой очереди (если еще не истек ее интервал) CFQ-планировщик выжидает 8 мс (см. 1 в листинге 4.32), предвидя появление нового запроса на чтение, «продолжающего» только что обработанный.

Внутреннее устройство CFQ-планировщика, надо заметить, изначально не было направлено (в отличие от «классического», deadline и anticipatory) на увеличение пропускной способности накопителя, а преследовало несколько иные цели. Однако его современная реализация оказалась весьма эффективной для самых разнообразных применений, что и сделало его планировщиком по умолчанию вплоть до ядер версии 5.x (см. листинги 4.31 и 4.32), где он был заменен планировщиком BFQ (Budget Fair Queue).

Листинг 4.31. I/O планировщики устройств (single-queue)

1 fitz@ubuntu:~$ lsblk -s

NAME HCTL TYPE VENDOR MODEL REV TRAN
sda 0:0:0:0 disk ATA WDC WD2500BEKT-7 1A01 sata
sr0 1:0:0:0 rom TSSTcorp DVD+-RW TS-U633J D600 sata

2 fitz@ubuntu:~$ cat /sys/block/{sda,sr0}/queue/scheduler
noop deadline [cfq]
noop deadline [cfq]

fitz@ubuntu:~$ uname -r
4.18.0-25-lowlatency