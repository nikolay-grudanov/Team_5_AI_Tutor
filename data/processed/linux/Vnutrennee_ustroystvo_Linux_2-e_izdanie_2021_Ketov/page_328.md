---
source_image: page_328.png
page_number: 328
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 18.47
tokens: 7273
characters: 1406
timestamp: 2025-12-24T04:41:24.620194
finish_reason: stop
---

Из трассы в листинге 7.40 видно, что для обращений к менеджеру DRM и DRM-драйверу видеоускорителя используются системные вызовы ioctl(2), как и всегда для взаимодействия с любыми драйверами устройств (см. разд. 3.3 и листинг 3.19). Кроме того, интересным оказывается тот факт, что файловый дескриптор для работы X-клиента с видеоускорителем дисплея X-сервера возвращается сразу в «готовом» виде, при ответе ① на запрос подключения этого клиента к DRI-инфраструктуре. Для этого задействуется механизм передачи файловых дескрипторов через специальные служебные (ancillary) сообщения SCM_RIGHTS файловых сокетов (см. cmsg(3) и unix(7)). Идентификатор нужного DRI-драйвера ② выясняется специальным запросом непосредственно к DRM, после чего соответствующий драйвер загружается ③ для выполнения последующего рендеринга. Перед началом рендеринга у DRM запрашивается несколько буферов (буфер команд GPU, z-буфер, stencil-буфер и пр.) в памяти видеоускорителя ④, которые отображаются в память процесса X-клиента ⑤ (листинг 7.41).

Идентификатор буфера, в который непосредственно будет рендерится изображение, запрашивается у DRM ⑥ в виде файлового дескриптора, который так же при помощи служебного сообщения SCM_RIGHTS отправляется ⑦ X-серверу. В результате сервер создаст объект pixmap, который затем будет использоваться в качестве источника изображения окна клиента. В результате получается, что клиент и сервер