---
source_image: page_235.png
page_number: 235
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 40.48
tokens: 7683
characters: 2486
timestamp: 2025-12-24T04:38:48.376100
finish_reason: stop
---

В листинге 5.53 приведен сценарий ldr (loader requirements), обратный утилите ldd(1) (loader dependencies). Если при помощи ldd(1) можно увидеть библиотеки, от которых зависит заданная программа, то сценарий ldr, наоборот, показывает программу, использующую заданную библиотеку (листинг 5.54).

В сценарии объявлена ① функция usage, формирующая сообщение пользователю о правильных параметрах запуска сценария и использующаяся при некорректно заданных параметрах ② и ⑤-①. В соответствии с соглашениями о выводе сообщение об «ошибке» перенаправлено ①-① на поток stderr при помощи перенаправления потока stdin конструкцией [n]>&m. По соглашению о статусе завершения с «ошибкой» встроенная команда exit возвращает ненулевое значение ①-②. Корректность параметра $1 — имени искомой библиотеки — проверяется на «пустоту» ③ при помощи «красивой» формы [ команды test(1).

Сам сценарий выполняется следующим образом: сначала ③ переменной ldpath присваивается список имен каталогов, используемых динамическим компоновщиком ld.so(8) для поиска библиотек. Для этого из конфигурационных файлов компоновщика /etc/ld.so.conf.d/*.conf фильтруются (см. листинг 5.57) строки, незакомментированные символом #. Затем ④, в зависимости от формы задания имени целевой библиотеки, переменной what присваивается имя ее файла. Если библиотека была сразу задана абсолютным путевым именем своего файла, соответствующим шаблонному выражению /*/lib*.so.[0-9], то оно используется непосредственно. Если библиотека была задана «предметным» именем NAME, то при помощи команды find(1) организуется поиск абсолютного путевого имени файла библиотеки по шаблону libNAME.so.[0-9] в каталогах компоновщика ld.so(8), перечисленных в переменной $ldpath, а найденные имена присваиваются переменной what. Корректность результата «вычисления» имен файлов библиотеки проверяется ⑤ при помощи «красивой» формы [ команды test(1) на предмет непустоты (-z) результатов поиска. На очередном шаге сценария ⑥ переменной where присваивается список каталогов (перечисленных в переменной окружения PATH), содержащих «доступные» пользователю исполняемые файлы программ. Для этого при помощи транслитератора tr(1) символы-разделители PATH- списка — двоеточия — заменяются требуемыми символами-разделителями — пробелами.

Листинг 5.53. Сценарий поиска программ, использующих указанную библиотеку

bender@ubuntu:~$ cd bin
bender@ubuntu:~/bin$ cat ldr
#!/bin/sh
① usage() {
|① echo "Usage: $(basename $0) name | /.../libname.so.0" >&2
|② exit 1
}