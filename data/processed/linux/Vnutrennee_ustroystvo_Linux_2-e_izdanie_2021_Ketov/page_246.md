---
source_image: page_246.png
page_number: 246
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 29.06
tokens: 7501
characters: 2019
timestamp: 2025-12-24T04:38:59.534530
finish_reason: stop
---

В очень большом количестве случаев sed(1) применяется для редактирования конфигурационных файлов системы, например в сценариях установки и удаления пакетов программного обеспечения. В примере из листинга 5.68 показан небольшой сценарий интерпретатора, позволяющий «включать»/«выключать» параметры в конфигурационном файле /etc/sysctl.conf, используя удаление/установку символа комментария # в начало строк при помощи sed(1). Для этого в трех инструкциях sed(1) используются две команды подстановки s и команда ветвлений t (test). Первая подстановка s/^#// удаляет комментарий из начала строки, а вторая подстановка s/^/#/ добавляет его в начало. Команда t тестирует результат выполнения первой инструкции подстановки и в случае успеха передает управление на конец списка инструкций. В результате выполнения инструкций либо комментарий удаляется из начала строки первой инструкцией, если он там присутствует (на чем список инструкций завершается), либо комментарий добавляется в начало строки второй инструкцией.

Листинг 5.68. Редактирование конфигурационных файлов

bender@ubuntu:~$ grep net.ipv4.ip_forward /etc/sysctl.conf
#net.ipv4.ip_forward=1
bender@ubuntu:~$ sudo sed -i '/net.ipv4.ip_forward/ s/^#//' /etc/sysctl.conf
bender@ubuntu:~$ grep net.ipv4.ip_forward /etc/sysctl.conf
net.ipv4.ip_forward=1

bender@ubuntu:~$ cat /usr/local/bin/toggle-comment
#!/bin/sh
[ -n "$1" -a -f "$2" ] &&
    sed -i -e "/$1/ s/^#//" -e t -e "/$1/ s/^/#/" $2 ||
echo "Usage: toggle-comment RE file"
bender@ubuntu:~$ sudo toggle-comment net.ipv4.ip_forward /etc/sysctl.conf
bender@ubuntu:~$ grep net.ipv4.ip_forward /etc/sysctl.conf
#net.ipv4.ip_forward=1

Несмотря на простоту инструментальных средств обработки текста, таких как awk(1) и sed(1), энтузиасты реализуют с их помощью (вкупе с управляющими ESC-последовательностями терминала и символами кодировки utf-8) даже простые игры, такие как крестики-нолики (tic-tac-toe), тетрис (tetris), sokoban, arkanoid, 2048 и даже (!) шахматы¹.

¹ См. https://habrahabr.ru/post/191006/.