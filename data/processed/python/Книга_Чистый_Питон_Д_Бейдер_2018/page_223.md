---
source_image: page_223.png
page_number: 223
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 24.99
tokens: 7322
characters: 1404
timestamp: 2025-12-24T02:32:32.962673
finish_reason: stop
---

Совместимость с Python 2.x

Все примеры кода, которые я здесь показал, были написаны на Python 3. Существует одна небольшая, но важная разница между Python 2 и Python 3 в том, что касается реализации итераторов на основе класса:

- в Python 3 метод, который извлекает следующее значение из итератора, называется __next__;
- в Python 2 тот же самый метод называется next (без символов подчеркивания).

Эта разница в обозначении может привести к небольшой проблеме при попытке писать итераторы на основе класса, которые должны работать в обеих версиях Python. К счастью, существует простой подход, который можно применить, чтобы обойти эту разницу.

Ниже приведена обновленная версия класса InfiniteRepeater, который будет работать как в Python 2, так и в Python 3:

class InfiniteRepeater(object):
    def __init__(self, value):
        self.value = value

    def __iter__(self):
        return self

    def __next__(self):
        return self.value

    # Совместимость с Python 2:
    def next(self):
        return self.__next__()

Чтобы сделать этот класс-итератор совместимым с Python 2, я внес в него два небольших изменения.

Во-первых, я добавил метод next, который просто вызывает оригинальный метод __next__ и пересылает возвращаемое из него значение. По существу, тем самым создается псевдоним для существующей реализации метода __next__ для того, чтобы его нашел Python 2. Благодаря этому мы