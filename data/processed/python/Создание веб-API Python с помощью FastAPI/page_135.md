---
source_image: page_135.png
page_number: 135
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 41.96
tokens: 8478
characters: 1850
timestamp: 2025-12-24T02:19:40.384874
finish_reason: stop
---

async get_user_details(user: User = Depends(get_user)):
    return user

Функция маршрута здесь зависит от функции get_user, которая служит ее зависимостью. Это означает, что для доступа к предыдущему маршруту должна быть удовлетворена зависимость get_user.

Класс Depends, который импортируется из библиотеки FastAPI, отвечает за прием функции, переданной в качестве аргумента, и выполнение ее при вызове конечной точки, автоматически делая доступными для конечной точки, они возвращают значение переданной ей функции.

Теперь, когда у вас есть представление о том, как создается зависимость и как она используется, давайте создадим зависимость аутентификации для приложения планировщика событий.

Защита приложения с помощью OAuth2 и JWT

В этом разделе мы создадим систему аутентификации для приложения планировщика событий. Мы будем использовать поток паролей OAuth2, который требует от клиента отправки имени пользователя и пароля в качестве данных формы. Имя пользователя в нашем случае — это электронная почта, используемая при создании учетной записи.
Когда данные формы отправляются на сервер от клиента, в качестве ответа отправляется токен доступа, который является подписаным JWT. Обычно выполняется фоновая проверка для проверки учетных данных, отправленных на сервер, перед созданием токена для дальнейшей авторизации. Чтобы авторизовать аутентифицированного пользователя, JWT имеет префикс Bearer при отправке через заголовок для авторизации действия на сервере.

Что такое JWT и почему он подписан?
JWT — это закодированная строка, обычно содержащая словарь, содержащий полезную нагрузку, подпись и алгоритм. JWT подписываются с использованием уникального ключа, известного только серверу и клиенту, чтобы избежать подделки закодированной строки внешним органом.

![Схема аутентификации](image.png)

Рисунок 7.1 – Схема аутентификации