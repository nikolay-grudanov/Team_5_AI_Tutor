---
source_image: page_333.png
page_number: 333
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 36.88
tokens: 7835
characters: 2018
timestamp: 2025-12-24T02:49:16.597041
finish_reason: stop
---

Объект DataFrame будет содержать иерархические столбцы, только если хотя бы к одному столбцу было применено несколько функций.

Возврат агрегированных данных без индексов строк
Во всех рассмотренных выше примерах агрегированные данные сопровождались индексом, иногда иерархическим, составленным из уникальных встретившихся комбинаций групповых ключей. Такое поведение не всегда желательно, поэтому его можно подавить, передав методу groupby аргумент as_index=False:

In [81]: tips.groupby(["day", "smoker"], as_index=False).mean()
Out[81]:
    day smoker  total_bill   tip   size  tip_pct
0   Fri   No     18.420000  2.812500  2.250000  0.151650
1   Fri   Yes    16.813333  2.714000  2.066667  0.174783
2   Sat   No     19.661778  3.102889  2.555556  0.158048
3   Sat   Yes    21.276667  2.875476  2.476190  0.147906
4   Sun   No     20.506667  3.167895  2.929825  0.160113
5   Sun   Yes    24.120000  3.516842  2.578947  0.187250
6   Thur  No     17.113111  2.673778  2.488889  0.160298
7   Thur  Yes    19.190588  3.030000  2.352941  0.163863

Разумеется, для получения данных в таком формате всегда можно вызвать метод reset_index результата. Аргумент as_index=False просто позволяет избежать некоторых лишних вычислений.

10.3. Метод apply: общий принцип разделения — применения — объединения
Самым общим из методов класса GroupBy является apply, ему мы и посвятим остаток этого раздела. apply разделяет обрабатываемый объект на части, вызывает для каждой части переданную функцию, а затем пытается конкатенировать все части вместе.
Возвращаясь к набору данных о чаевых, предположим, что требуется выбрать первые пять значений tip_pct в каждой группе. Прежде всего нетрудно написать функцию, которая отбирает строки с наибольшими значениями в указанном столбце:

In [82]: def top(df, n=5, column="tip_pct"):
    ....:     return df.sort_values(column, ascending=False)[:n]

In [83]: top(tips, n=6)
Out[83]:
    total_bill   tip smoker  day   time  size  tip_pct
172      7.25  5.15   Yes  Sun Dinner    2  0.710345