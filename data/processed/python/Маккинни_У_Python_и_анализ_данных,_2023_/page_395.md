---
source_image: page_395.png
page_number: 395
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 20.82
tokens: 7454
characters: 1376
timestamp: 2025-12-24T02:51:01.630485
finish_reason: stop
---

Бинарные скользящие оконные функции

Для некоторых статистических операций, в частности корреляции и ковариации, необходимы два временных ряда. Например, финансовых аналитиков часто интересует корреляция цены акции с основным биржевым индексом типа S&P 500. Чтобы найти эту величину, мы сначала вычислим относительные изменения в процентах для всего нашего временного ряда:

In [273]: spx_px = close_px_all["SPX"]

In [274]: spx_rets = spx_px.pct_change()

In [275]: returns = close_px.pct_change()

Если теперь вызвать rolling, а за ней функцию агрегирования corr, то мы сможем вычислить скользящую корреляцию с spx_rets (получающийся график показан на рис. 11.8):

In [276]: corr = returns["AAPL"].rolling(125, min_periods=100).corr(spx_rets)

In [277]: corr.plot()

![Корреляция доходности AAPL с индексом S&P 500, рассчитанная за шесть месяцев](../images/11-8.png)

Рис. 11.8. Корреляция доходности AAPL с индексом S&P 500, рассчитанная за шесть месяцев

Пусть требуется вычислить корреляцию индекса S&P 500 сразу с несколькими акциями. Можно было бы написать цикл, в котором она вычисляется для каждой акции, как было сделано для Apple выше, но если каждая акция представлена столбцом в одном объекте DataFrame, то можно вычислить все корреляции за один прием, вызвав от имени DataFrame метод rolling и передав ему временной ряд spx_rets.

Результат показан на рис. 11.9.