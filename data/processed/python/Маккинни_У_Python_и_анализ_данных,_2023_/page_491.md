---
source_image: page_491.png
page_number: 491
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 37.56
tokens: 7903
characters: 1917
timestamp: 2025-12-24T02:54:03.454779
finish_reason: stop
---

In [217]: mmap = np.memmap('mymmap', dtype='float64', mode='w+',
.....: shape=(10000, 10000))

In [218]: mmap
Out[218]:
memmap([[0., 0., 0., ..., 0., 0., 0.],
        [0., 0., 0., ..., 0., 0., 0.],
        [0., 0., 0., ..., 0., 0., 0.],
        ...,
        [0., 0., 0., ..., 0., 0., 0.],
        [0., 0., 0., ..., 0., 0., 0.],
        [0., 0., 0., ..., 0., 0., 0.]])]

При вырезании из memmap возвращается представление данных на диске:

In [219]: section = mmap[:5]

Если присвоить такому срезу значения, то они буферизуются в памяти, т. е. при попытке прочитать файл в другом приложении изменения могут быть не видны. Чтобы синхронизировать модификации с диском, воспользуйтесь методом flush.

In [220]: section[:] = rng.standard_normal((5, 10000))

In [221]: mmap.flush()

In [222]: mmap
Out[222]:
memmap([[-0.9074, -1.0954, 0.0071, ..., 0.2753, -1.1641, 0.8521],
        [-0.0103, -0.0646, -1.0615, ..., -1.1003, 0.2505, 0.5832],
        [0.4583, 1.2992, 1.7137, ..., 0.8691, -0.7889, -0.2431],
        ...,
        [0., 0., 0., ..., 0., 0., 0.],
        [0., 0., 0., ..., 0., 0., 0.],
        [0., 0., 0., ..., 0., 0., 0.]])]

In [223]: del mmap

Сброс на диск всех изменений автоматически происходит и тогда, когда объект memmap выходит из области видимости и передается сборщику мусора. При открытии существующего файла все равно необходимо указывать тип и форму данных, поскольку файл на диске — это просто блок двоичных данных, не содержащий информации о типе, форме и шагах:

In [224]: mmap = np.memmap('mymmap', dtype='float64', shape=(10000, 10000))

In [225]: mmap
Out[225]:
memmap([[-0.9074, -1.0954, 0.0071, ..., 0.2753, -1.1641, 0.8521],
        [-0.0103, -0.0646, -1.0615, ..., -1.1003, 0.2505, 0.5832],
        [0.4583, 1.2992, 1.7137, ..., 0.8691, -0.7889, -0.2431],
        ...,
        [0., 0., 0., ..., 0., 0., 0.],
        [0., 0., 0., ..., 0., 0., 0.],
        [0., 0., 0., ..., 0., 0., 0.]])