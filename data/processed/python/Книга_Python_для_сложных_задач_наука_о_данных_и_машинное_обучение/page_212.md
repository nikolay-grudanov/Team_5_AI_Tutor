---
source_image: page_212.png
page_number: 212
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 33.14
tokens: 7717
characters: 1915
timestamp: 2025-12-24T00:56:54.733008
finish_reason: stop
---

Синтаксис сводных таблиц

Вот эквивалентный вышеприведенной операции код, использующий метод pivot_table объекта DataFrame:

In[5]: titanic.pivot_table('survived', index='sex', columns='class')

Out[5]: class      First   Second   Third
         sex
         female   0.968085  0.921053  0.500000
         male     0.368852  0.157407  0.135447

Такая запись несравненно удобнее для чтения, чем подход с GroupBy, при том же результате. Как и можно было ожидать от трансатлантического круиза начала XX века, судьба благоприятствовала женщинам и первому классу. Женщины из первого класса выжили практически все (привет, Роуз!), из мужчин третьего класса выжила только десятая часть (извини, Джек!).

Многоуровневые сводные таблицы

Группировку в сводных таблицах, как и при операции GroupBy, можно задавать на нескольких уровнях и с множеством параметров. Например, интересно взглянуть на возраст в качестве третьего измерения. Разобъем данные на интервалы по возрасту с помощью функции pd.cut:

In[6]: age = pd.cut(titanic['age'], [0, 18, 80])
       titanic.pivot_table('survived', ['sex', age], 'class')

Out[6]:    class      First   Second   Third
           sex   age
           female (0, 18]   0.909091  1.000000  0.511628
                     (18, 80]  0.972973  0.900000  0.423729
           male   (0, 18]   0.800000  0.600000  0.215686
                     (18, 80]  0.375000  0.071429  0.133663

Мы можем применить ту же стратегию при работе со столбцами. Добавим сюда информацию о стоимости билета, воспользовавшись функцией pd.qcut для автоматического вычисления квантилей:

In[7]: fare = pd.qcut(titanic['fare'], 2)
       titanic.pivot_table('survived', ['sex', age], [fare, 'class'])

Out[7]:
fare        [0, 14.454]
class
sex   age
female (0, 18]    NaN  1.000000  0.714286
       (18, 80]   NaN  0.880000  0.444444
male   (0, 18]    NaN  0.000000  0.260870
       (18, 80]   0.0  0.098039  0.125000