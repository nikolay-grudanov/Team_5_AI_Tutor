---
source_image: page_454.png
page_number: 454
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 35.11
tokens: 7647
characters: 2311
timestamp: 2025-12-24T01:03:05.714550
finish_reason: stop
---

В этом разделе мы соединим данные по велосипедам с другим набором данных и попробуем установить, насколько погода и сезонные факторы — температура, осадки и световой день — влияют на объем велосипедного трафика по этому коридору. NOAA открыло доступ к ежедневным данным с их метеорологических станций (я воспользовался станцией с ID USW00024233), а библиотека Pandas дает нам возможность с легкостью соединить эти два источника данных. Мы установим отношение между погодой и другой информацией с количеством велосипедов, выполнив простую линейную регрессию, чтобы оценить, как изменения этих параметров повлияют на число велосипедистов в заданный день.

В частности, это пример использования подобных библиотеке Scikit-Learn инструментов в фреймворке статистического моделирования, где предполагается осмысленность параметров модели. Это отнюдь не стандартный подход для машинного обучения, но для некоторых моделей подобная трактовка возможна.

Начнем с загрузки двух наборов данных, индексированных по дате:

In[14]:
import pandas as pd
counts = pd.read_csv('fremont_hourly.csv', index_col='Date', parse_dates=True)
weather = pd.read_csv('599021.csv', index_col='DATE', parse_dates=True)

Далее вычислим общий ежедневный поток велосипедов и поместим эти данные в отдельный объект DataFrame:

In[15]: daily = counts.resample('d', how='sum')
    daily['Total'] = daily.sum(axis=1)
    daily = daily[['Total']] # удаляем остальные столбцы

Мы видели ранее, что паттерны использования варьируются день ото дня. Учтем это в наших данных, добавив двоичные столбцы-индикаторы дня недели:

In[16]: days = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun']
    for i in range(7):
        daily[days[i]] = (daily.index.dayofweek == i).astype(float)

Следует ожидать, что велосипедисты будут вести себя иначе по выходным. Добавим индикаторы и для этого:

In[17]: from pandas.tseries.holiday import USFederalHolidayCalendar
    cal = USFederalHolidayCalendar()
    holidays = cal.holidays('2012', '2016')
    daily = daily.join(pd.Series(1, index=holidays, name='holiday'))
    daily['holiday'].fillna(0, inplace=True)

Логично предположить, что свое влияние на количество едущих на велосипедах людей окажет и световой день. Воспользуемся стандартными астрономическими расчетами для добавления этой информации (рис. 5.51):