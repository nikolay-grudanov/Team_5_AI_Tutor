---
source_image: page_452.png
page_number: 452
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 32.01
tokens: 7790
characters: 2691
timestamp: 2025-12-24T01:21:32.474928
finish_reason: stop
---

Расширенный синтаксис списковых включений

На практике списковые включения могут быть более развитыми и в своих самых полных формах даже вводить своего рода мини-язык итераций. Давайте бегло взглянем на их синтаксические средства.

Конструкции фильтров: if

В качестве одного особенно полезного расширения цикл for, вложенный в выражение спискового включения, может иметь ассоциированную конструкцию if, позволяющую отфильтровывать элементы результата, для которых проверка дала ложное значение.

Предположим, что нам необходимо повторить пример с просмотром файла из предыдущего раздела, но накапливать только строки, которые начинаются с буквы p (возможно, первый символ в каждой строке определяет код какого-то действия). Задача решается добавлением к выражению конструкции фильтра if:

```python
>>> lines = [line.rstrip() for line in open('script2.py') if line[0] == 'p']
>>> lines
['print(sys.path)', 'print(x ** 32)']
```

Здесь конструкция if проверяет каждую строку, прочитанную из файла, чтобы выяснить, начинается ли она с символа p; если нет, тогда строка не включается в результирующий список. Хотя выражение довольно большое, его легко понять, если перевести в простой эквивалентный оператор цикла for. В общем случае мы всегда можем транслировать списковое включение в оператор for, добавляя отступы к каждой последующей части:

```python
>>> res = []
>>> for line in open('script2.py'):
...     if line[0] == 'p':
...         res.append(line.rstrip())
...
>>> res
['print(sys.path)', 'print(x ** 32)']
```

Такой оператор for работает равноценно, но он занимает до четырех строк вместо одной и может выполнять медленнее. На самом деле при необходимости в списковое включение можно помещать значительный объем логики. Следующий код работает подобно предыдущему, но выбирает только строки, которые оканчиваются цифрой (перед завершающим символом новой строки), выполняя фильтрацию с помощью более сложного выражения в правой части (для файлов с пустыми строками [-1] понадобится заменить на [-1:] ):

```python
>>> [line.rstrip() for line in open('script2.py') if line.rstrip()[-1].isdigit()]
['x = 2']
```

Ниже приведен еще один пример фильтра if. Первое выражение дает общее количество строк в текстовом файле, а второе отбрасывает пробельные символы в начале и конце, чтобы не учитывать при подсчете пустые строки (этот файл, не входящий в состав кода примеров, содержит строки с описанием опечаток, найденных корректором в черновом варианте настоящей книги):

```python
>>> fname = r'd:\books\5e\lp5e\draft1typos.txt'
>>> len(open(fname).readlines())                # Все строки
263
>>> len([line for line in open(fname) if line.strip() != ''])   # Непустые строки
185
```