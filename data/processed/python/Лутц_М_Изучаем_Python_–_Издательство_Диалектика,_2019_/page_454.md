---
source_image: page_454.png
page_number: 454
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 36.59
tokens: 7881
characters: 2913
timestamp: 2025-12-24T01:21:39.769953
finish_reason: stop
---

Другие итерационные контексты

Позже в книге будет показано, что определяемые пользователем классы также могут реализовывать протокол итерации. По указанной причине иногда важно знать, какие встроенные инструменты их используют — любой инструмент, применяющий протокол итерации, будет автоматически работать с любым встроенным типом или определяемым пользователем классом, который данный протокол поддерживает.

До сих пор итераторы демонстрировались в контексте оператора цикла for, т.к. текущая часть книги сосредоточена на операторах. Однако имейте в виду, что любой встроенный инструмент, который просматривает объекты слева направо, задействует протокол итерации. Это относится и к рассмотренным ранее циклам for:

```python
>>> for line in open('script2.py'): # Использование итератора файлового объекта
...     print(line.upper(), end='')
...
IMPORT SYS
PRINT(SYS.PATH)
X = 2
PRINT(X ** 32)
```

Но инструментов намного больше. Скажем, списковые включения и встроенная функция map используют тот же протокол, что и родственный им цикл for. В случае применения к файлу они оба автоматически используют итератор файлового объекта для его просмотра строка за строкой, извлекая итератор с помощью __iter__ и вызывая по мере продвижения __next__:

```python
>>> uppers = [line.upper() for line in open('script2.py')]
>>> uppers
['IMPORT SYS\n', 'PRINT(SYS.PATH)\n', 'X = 2\n', 'PRINT(X ** 32)\n']
>>> map(str.upper, open('script2.py')) # В Python 3.x функция map возвращает итерируемый объект
<map object at 0x0000000029476D8>
>>> list(map(str.upper, open('script2.py')))
['IMPORT SYS\n', 'PRINT(SYS.PATH)\n', 'X = 2\n', 'PRINT(X ** 32)\n']
```

Вызов map был кратко представлен в предыдущей главе (и мимоходом в главе 4); этот встроенный инструмент применяет вызов функции к каждому элементу в переданном итерируемом объекте. Инструмент map похож на списковое включение, но он более ограничен, т.к. требует функцию, а не произвольное выражение. Он также возвращает итерируемый объект в Python 3.x, так что для вывода сразу всех значений его придется поместить внутрь вызова list; более подробно об указанном изменении речь пойдет позже в главе. Поскольку встроенная функция map подобно списковому включению имеет отношение к циклам for и функциям, мы продолжим ее исследовать в главах 19 и 20.

Многие другие встроенные функции Python также обрабатывают итерируемые объекты. Например, sorted сортирует элементы в итерируемом объекте; zip объединяет элементы из итерируемых объектов; enumerate формирует пары из элементов в итерируемом объекте и их относительных позиций; filter выбирает элементы из итерируемого объекта, для которых заданная функция дает истинное значение; reduce прогонает пары элементов в итерируемом объекте через указанную функцию. Все они принимают итерируемые объекты, а zip, enumerate и filter подобно map также возвращают итерируемый объект в Python 3.x. Ниже перечисленные инструменты