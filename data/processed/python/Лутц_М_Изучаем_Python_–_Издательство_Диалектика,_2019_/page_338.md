---
source_image: page_338.png
page_number: 338
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 35.15
tokens: 7897
characters: 2366
timestamp: 2025-12-24T01:17:58.118547
finish_reason: stop
---

>>> L[1] = 0        # Воздействует на Y, но не на X
>>> X
[4, 5, 6, 4, 5, 6, 4, 5, 6]
>>> Y
[[4, 0, 6], [4, 0, 6], [4, 0, 6], [4, 0, 6]]

Сценарий может показаться искусственным или учебным, но до тех пор, пока неожиданно не случится в вашем коде! Здесь применимы те же самые решения проблемы, как и в предыдущем разделе, потому что фактически это лишь еще один способ создания ситуации с разделяемыми ссылками на изменяемые объекты — создавайте копии, когда разделяемые ссылки нежелательны:

>>> L = [4, 5, 6]
>>> Y = [list(L)] * 4    # Встраивание (разделяемой) копии L
>>> L[1] = 0
>>> Y
[[4, 5, 6], [4, 5, 6], [4, 5, 6], [4, 5, 6]]

Есть даже более тонкий момент: хотя имя Y больше не разделяет объект с L, оно по-прежнему встраивает четыре ссылки на одну и ту же копию объекта. Чтобы избежать и такого разделения, можно обеспечить уникальность каждой встроенной копии:

>>> Y[0][1] = 99        # Все четыре копии по-прежнему одинаковы
>>> Y
[[4, 99, 6], [4, 99, 6], [4, 99, 6], [4, 99, 6]]
>>> L = [4, 5, 6]
>>> Y = [list(L) for i in range(4)]
>>> Y
[[4, 5, 6], [4, 5, 6], [4, 5, 6], [4, 5, 6]]
>>> Y[0][1] = 99
>>> Y
[[4, 99, 6], [4, 5, 6], [4, 5, 6], [4, 5, 6]]

Если вы вспомните, что повторение, конкатенация и нарезание копируют только верхний уровень объектов своих операндов, тогда ситуации подобного рода обретут гораздо больший смысл.

Остерегайтесь циклических структур данных

Фактически мы столкнулись с этой концепцией в предыдущем примере: если объект коллекции содержит ссылку на самого себя, то он называется циклическим объектом. Всякий раз, когда Python обнаруживает цикл в объекте, он выводит [...] вместо того, чтобы застрять в бесконечном цикле (как когда-то давно):

>>> L = ['grail']
>>> L.append(L)        # Добавление ссылки на тот же самый объект
>>> L.append(L)        # Создает цикл в объекте: [...]
>>> L
['grail', [...]]

Кроме понимания, что три точки в квадратных скобках представляют цикл в объекте, о таком случае надлежит знать, поскольку он способен приводить к затруднениям — циклические структуры могут стать причиной того, что ваш код попадет в неожиданные циклы, если вы не предупредите их.

Например, определенные программы, проходящие через структурированные данные, должны хранить список, словарь или множество уже посещенных элементов и проверять его, когда собираются войти в цикл, который мог бы вызвать нежелатель-