---
source_image: page_665.png
page_number: 665
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 28.77
tokens: 7848
characters: 2803
timestamp: 2025-12-24T01:27:51.062542
finish_reason: stop
---

Модуль и сценарий оценочных испытаний: timeit

Вместо того чтобы вдаваться в дополнительные подробности касательно модуля timeit, давайте изучим программу, которая его применяет для измерения времени кодовых альтернатив и версий Python. Файл pybench.py с показанным ниже содержимым настроен на измерение времени набора операторов в сценариях, которые импортируют и используют данный файл под управлением либо версии, выполняющей его, либо всех версий Python, перечисленных в списке. Он задействует ряд описываемых далее инструментов уровня приложения. Тем не менее, поскольку в нем по большей части применяются идеи, которые уже исследованы и щедро документированы, я склонен отнести его к категории материалов для самостоятельного изучения и упражнений по чтению кода Python.

"""
pybench.py: тестирует скорость одной и более версий Python на наборе простых эталонных тестов в виде строк кода.
Функция runner допускает разнообразные операторы в stmts.
Сама система выполняется в Python 2.x и 3.x и может порождать вывод в обеих линейках.

Использует модуль timeit для тестирования либо версии Python, выполняющей этот сценарий, через вызовы API-интерфейса, либо набора версий Python за счет чтения порожденного вывода командной строки (os.popen) посредством флага -m интерпретатора Python, позволяющего находить timeit в пути поиска модулей.

Заменяет $listif3 на list в генераторах для Python 3.x и на пустую строку для Python 2.x, заставляя Python 3.x делать ту же самую работу, что и Python 2.x.
В режиме командной строки многострочные операторы должны разделяться на отдельные
аргументы в кавычках для каждой строки и все символы \t в отступах должны заменяться четырьмя пробелами ради единообразия.

Предостережения: режим командной строки (только) может потерпеть неудачу, если внутри оператора содержатся двойные кавычки, строка оператора в кавычках вообще несовместима с командной оболочкой или командная строка превышает предел длины в командной оболочке платформы -- применяйте режим вызовов API-интерфейса или любительский таймер; пока не поддерживает оператор настройки: в том виде, как есть, время всех операторов в stmts учитывается в суммарном времени.
"""

import sys, os, timeit
defnum, defrep=1000, 5      # Может варьироваться от оператора к оператору
def runner(stmts, pythons=None, tracecmd=False):
    """
    Основная логика: запускать тесты на входных списках, режимами использования управляет вызывающий код.
    stmts: [(количество?, повторений?, строка-оператора)], заменяет $listif3 в строке оператора
    pythons: None = только эта версия Python или [(версия-Python-3?, путь-к-исполняемому-файлу-Python)]
    """
    print(sys.version)
    for (number, repeat, stmt) in stmts:
        number = number or defnum
        repeat = repeat or defrep   # 0 = стандартное значение