---
source_image: page_162.png
page_number: 162
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 30.93
tokens: 7561
characters: 2142
timestamp: 2025-12-24T02:25:32.730415
finish_reason: stop
---

nationality_vocab = Vocabulary()

    for index, row in surname_df.iterrows():
        for char in row.surname:
            char_vocab.add_token(char)
        nationality_vocab.add_token(row.nationality)

    return cls(char_vocab, nationality_vocab)

От RNN Элмана к GRU

На практике переход от «наивной» RNN к шлюзовому варианту очень прост. В следующих моделях можно с легкостью использовать и LSTM, хотя мы применяем GRU вместо «наивной» RNN. Для использования GRU мы создаем экземпляр класса torch.nn.GRU с теми же параметрами, что и для ElmanRNN из главы 6.

Модель 1. Контекстно не обусловленная модель SurnameGenerationModel

Первая из двух наших моделей будет контекстно не обусловленной: перед генерацией фамилии она не наблюдает никаких национальностей. На практике необусловленность контекстом означает, что выполняемые GRU вычисления не смешены в сторону какой-либо национальности. В примере 7.4 это смещение создается искусственно с помощью исходного скрытого вектора. В этом же примере исходный вектор скрытого состояния состоит из всех нулей и не вносит никакого вклада в вычисления¹.

В целом SurnameGenerationModel (пример 7.3) включает вложение индексов символов, вычисление их последовательного состояния с помощью GRU и вычисление вероятности предсказаний токенов с помощью линейного слоя. Если подробнее, контекстно не обусловленная модель SurnameGenerationModel начинается с инициализации слоя вложений, GRU и линейного слоя. Подобно моделям последовательностей из главы 6, входными данными для модели служит матрица целых чисел. Для преобразования этих целых чисел в трехмерный тензор (последовательность векторов для каждого элемента пакета) используется экземпляр Embedding фреймворка PyTorch, char_emb. Этот тензор передается в GRU, вычисляющий векторы состояния для всех позиций во всех последовательностях.

Пример 7.3. Контекстно не обусловленная модель для генерации фамилий

class SurnameGenerationModel(nn.Module):
    def __init__(self, char_embedding_size, char_vocab_size,

_____________________
¹ Матричное умножение на состоящий из нулей вектор скрытого состояния даст в результате матрицу из всех нулей.