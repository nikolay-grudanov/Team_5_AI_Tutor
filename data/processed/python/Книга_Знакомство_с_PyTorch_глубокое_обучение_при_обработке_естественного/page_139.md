---
source_image: page_139.png
page_number: 139
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 32.32
tokens: 7598
characters: 2309
timestamp: 2025-12-24T02:24:55.693047
finish_reason: stop
---

Модель NewsClassifier

Ранее в этой главе мы показали вам, как загрузить с диска предобученные вложения и эффективно использовать их с помощью алгоритма приближенного вычисления ближайших соседей из библиотеки annoy сервиса Spotify. В этом примере в результате сравнения векторов друг с другом мы обнаружим интересные лингвистические закономерности. Впрочем, предобученные векторы слов можно использовать с гораздо большей отдачей: для инициализации матрицы вложений слоя Embedding.

Для использования вложений слов в качестве начальной матрицы вложений необходимо сначала загрузить вложения с диска, затем выбрать нужное подмножество вложений для имеющихся в наших данных слов и, наконец, задать загруженное подмножество в качестве матрицы весов слоя вложений. Первый и второй из этих этапов показаны в примере 5.13. Одна из часто возникающих при этом проблем состоит в наличии в наборе данных слов, отсутствующих в предобученных вложениях GloVe. Распространенный метод решения — использовать один из методов инициализации из библиотеки PyTorch, например метод равномерной инициализации Ксавье¹, как показано в примере 5.13 (см. статью Глоро и Бенжио² [Glorot, Bengio, 2010]).

Пример 5.13. Выбор подмножества вложений слов в соответствии со словарем

def load_glove_from_file(glove_filepath):
    """ Загрузка вложений GloVe
    Аргументы:
        glove_filepath (str): путь к файлу вложений GloVe
    Возвращает:
        word_to_index (dict), embeddings (numpy.ndarray)
    """
    word_to_index = {}
    embeddings = []
    with open(glove_filepath, "r") as fp:
        for index, line in enumerate(fp):
            line = line.split(" ") # each line: word num1 num2 ...
            word_to_index[line[0]] = index # word = line[0]
            embedding_i = np.array([float(val) for val in line[1:]])
            embeddings.append(embedding_i)
    return word_to_index, np.stack(embeddings)

def make_embedding_matrix(glove_filepath, words):
    """ Создает матрицу вложений для конкретного мультимножества слов
    Аргументы:
        glove_filepath (str): путь к файлу вложений GloVe
        words (list): список слов в наборе данных

    ¹ Получил название в честь Ксавье Глоро (Xavier Glorot), также известен как инициализатор Глоро. — Примеч. пер.
    ² См. https://ru.wikipedia.org/wiki/Бенжио,_Йошуа.