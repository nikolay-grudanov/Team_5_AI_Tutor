---
source_image: page_325.png
page_number: 325
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 47.26
tokens: 11872
characters: 2295
timestamp: 2025-12-24T01:49:36.879893
finish_reason: stop
---

Резюме

1 Импортируем itertools, чтобы можно было воспользоваться функцией chain в методе __format__.
2 Вычисляем одну из угловых координат по формулам, взятым из статьи по адресу http://en.wikipedia.org/wiki/N-sphere.
3 Создаем генераторное выражение для вычисления всех угловых координат по запросу.
4 Используем itertools.chain для порождения генераторного выражения, которое перебирает модуль и угловые координаты вектора.
5 Конфигурируем отображение сферических координат в угловых скобках.
6 Конфигурируем отображение декартовых координат в круглых скобках.
7 Создаем генераторное выражение для форматирования координат по запросу.
8 Подставляем отформатированные компоненты, разделенные запятыми, в угловые или круглые скобки.

Мы вовсю пользуемся генераторными выражениями в методах __format__, angle и angles, но наша цель здесь — просто написать метод __format__, чтобы класс Vector не уступал в полноте реализации классу Vector2d. При рассмотрении генераторов в главе 14 мы воспользуемся в качестве примера кодом из класса Vector, и тогда все хитрости будут подробно объяснены.

Итак, все задачи, которые мы ставили перед собой в этой главе, решены. В главе 13 мы пополним класс Vector инфиксными операторами, но пока хотели лишь изучить, как писать специальные методы, полезные в различных классах коллекций.

Резюме

Класс Vector из этой главы был задуман совместимым с классом Vector2d во всем, кроме использования другой сигнатуры конструктора, — теперь он принимает один итерируемый объект, как конструкторы встроенных типов последовательностей. Чтобы класс Vector вел себя так же, как последовательность, оказалось достаточно реализовать методы __getitem__ и __len__, и этот факт подвиг нас на обсуждение протоколов — неформальных интерфейсов в языках с динамической типизацией.

Далее мы разобрались, как на самом деле работает конструкция my_seq[a:b:c], для чего создали объект slice(a, b, c) и передали его методу __getitem__. Вооружившись этими знаниями, мы переделали класс Vector, так чтобы операция получения среза выполнялась для него корректно, т. е. возвращала экземпляр типа Vector, как и положено последовательности в Python.

Нашим следующим шагом было обеспечение доступа для чтения к нескольким первым компонентам объекта Vector по именам, т. е. с помощью нотации