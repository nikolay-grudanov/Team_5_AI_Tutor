---
source_image: page_546.png
page_number: 546
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 52.67
tokens: 11957
characters: 2378
timestamp: 2025-12-24T02:00:22.173523
finish_reason: stop
---

flags2_threadpool.py
Параллельный HTTP-клиент, основанный на классе futures.ThreadPoolExecutor; демонстрирует обработку ошибок и интеграцию с индикатором хода выполнения.

flags2_asyncio.py
Та же функциональность, что в предыдущем примере, но на основе asyncio и aiohttp. Будет рассмотрен в разделе «Улучшение скрипта загрузки на основе asyncio» главы 18.

Будьте осторожны при тестировании параллельных клиентов
При тестировании параллельных HTTP-клиентов, обращающихся к публичным HTTP-серверам, количество запросов в секунду может быть довольно велико, а это признак DoS-атаки. Однако мы не хотим никого атаковать, наша цель — научиться писать высокопроизводительные клиенты. Поэтому искусственно ограничивайте производительность клиентов, посылающих запросы публичным серверам. А для проведения экспериментов со скриптами, где уровень параллелизма высок, поднимайте свой локальный HTTP-сервер. Инструкции о том, как это сделать, приведены в файле README.rst (http://bit.ly/1Jlsg2L), который находится в каталоге 17-futures/countries/ в репозитории кода к этой книге (http://bit.ly/1JltSti).

Самое заметное визуальное отличие flags2-скриптов состоит в том, что они выводят анимированный текстовый индикатор хода выполнения, реализованный с помощью пакета TQDM (https://github.com/noamraph/tqdm). Я разместил на YouTube ролик продолжительностью 108 с (https://www.youtube.com/watch?v=M8Z65tAl5l4), в котором показан индикатор и сравнивается скорость работы всех трех скриптов. В этом ролике я сначала запустил последовательный загрузчик, но через 32 с прервал его, потому что для обращения к 676 URL-адресам и загрузки 194 флагов ему требуется больше 5 минут. Затем я по три раза прогнал многопоточный и асинхронный скрипт, и всякий раз они завершали работу не более чем за 6 с (т. е. в 60 с лишним раз быстрее). На рис. 17.1 показаны два снимка экрана: во время и после работы flags2_threadpool.py.

Пользоваться пакетом TQDM очень легко, простейший пример приведен в анимированном GIF-файле в файле проекта README.md (https://github.com/noamraph/tqdm/blob/master/README.md). Установив пакет tqdm и набрав следующий код в оболочке Python, вы увидите анимированный индикатор хода выполнения на месте комментария:

```python
>>> import time
>>> from tqdm import tqdm
>>> for i in tqdm(range(1000)):
...     time.sleep(.01)
...
# -> здесь будет индикатор хода выполнения <-
```