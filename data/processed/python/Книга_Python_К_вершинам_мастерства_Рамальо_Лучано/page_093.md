---
source_image: page_093.png
page_number: 93
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 38.07
tokens: 11715
characters: 1937
timestamp: 2025-12-24T01:38:48.687309
finish_reason: stop
---

Отображения с гибким поиском по ключу

for word in sorted(index, key=str.upper):
    print(word, index[word])

1 Получаем список вхождений слова word или устанавливаем его равным [], если оно не найдено; теперь список можно обновить без повторного поиска.

Иными словами, строка...

my_dict.setdefault(key, []).append(new_value)

...дает такой же результат, как ...

if key not in my_dict:
    my_dict[key] = []
my_dict[key].append(new_value)

...с тем отличием, что во втором фрагменте производится по меньшей мере два поиска ключа (три, если ключ не найден), тогда как setdefault довольствуется единственным поиском.

Смежный вопрос — обработка отсутствия ключа при любом поиске (а не только при вставке) — тема следующего раздела.

Отображения с гибким поиском по ключу

Иногда удобно, чтобы отображение возвращало некоторое специальное значение, если искомый ключ отсутствует. К решению этой задачи есть два подхода: первый — использовать класс defaultdict вместо dict, второй — создать подкласс dict или любого другого типа отображения и добавить метод __missing__. Ниже рассматриваются оба способа.

defauldtict: еще один подход к обработке отсутствия ключа

В примере 3.5 показано элегантное применение класса collections.defaultdict для решения той же задачи, что в примере 3.4. Объект defaultdict сконфигурирован так, что по запросу возвращает элементы, когда искомый ключ отсутствует.

Работает это следующим образом: при конструировании объекта defaultdict задается вызываемый объект, который порождает значение по умолчанию всякий раз, как методу __getitem__ передается ключ, отсутствующий в словаре.

Например, пусть defaultdict создан как dd = defaultdict(list). Тогда, если ключ 'new-key' отсутствует в dd, то при вычислении выражения dd['new-key'] выполняются следующие действия:

1. Вызвать list() для создания нового списка.
2. Вставить список в dd в качестве значения ключа 'new-key'.
3. Вернуть ссылку на этот список.