---
source_image: page_319.png
page_number: 319
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 57.59
tokens: 12096
characters: 2426
timestamp: 2025-12-24T01:49:37.060199
finish_reason: stop
---

**Vector, попытка № 5: форматирование**

гиперсферами). Соответственно специальный суффикс форматной строки 'р' мы заменим на 'h'.

В разделе «Форматированное отображение» главы 9 мы видели, что при расширении миниязыка спецификации формата (https://docs.python.org/3/library/string.html#format-spec) лучше не использовать форматные коды, предназначенные для встроенных типов. В частности, в нашем расширенном миниязыке коды 'eEfFgGn%' используются в своем изначальном смысле, поэтому их-то точно нельзя переопределять. Для форматирования целых чисел служат коды 'bcdoxXn', а для строк — код 's'. Для вывода объекта Vector2d в полярных координатах я выбрал код 'p', а для гиперсферических координат возьму код 'h'.

Например, для объекта Vector в четырехмерном пространстве (len(v) == 4) код 'h' порождает представление вида <r, Ф1, Ф2, Ф3>, где r — модуль вектора (abs(v)), а Ф1, Ф2, Ф3 — угловые координаты.

Ниже приведены примеры вывода 4-мерного вектора в сферических координатах, взятые из doctest-скриптов в файле vector_v5.py (см. пример 10.16):

```python
>>> format(Vector([-1, -1, -1, -1]), 'h')
'<2.0, 2.0943951023931957, 2.186276035465284, 3.9269908169872414>'
>>> format(Vector([2, 2, 2, 2]), '.3eh')
'<4.000e+00, 1.047e+00, 9.553e-01, 7.854e-01>'
>>> format(Vector([0, 1, 0, 0]), '0.5fh')
'<1.00000, 1.57080, 0.00000, 0.00000>'
```

Прежде чем вносить мелкие изменения в метод __format__, мы должны написать два вспомогательных метода: angle(n) будет вычислять одну из угловых координат (например, Ф₁), а angles() — возвращать итерируемый объект, содержащий все угловые координаты. Не стану останавливаться здесь на математической теории, интересующиеся читатели могут найти формулы преобразования из декартовых координат в сферические в статье из википедии (http://en.wikipedia.org/wiki/N-sphere).

В примере 10.16 приведен полный код из файла vector_v5.py, в который вошло все, что мы сделали, начиная с раздела «Vector, попытка № 1: совместимость с Vector2d», включая форматирование.

Пример 10.16. vector_v5.py: doctest-скрипты и окончательный код класса Vector; выноски описывают добавления, необходимые для поддержки метода __format__

"""
Многомерный класс ``Vector``, попытка 5

7 На сайте Wolfram Mathworld имеется статья о гиперсферах (http://mathworld.wolfram.com/Hypersphere.html); в википедии запрос по слову «hypersphere» переадресуется на статью «n-sphere» (http://en.wikipedia.org/wiki/Nsphere).