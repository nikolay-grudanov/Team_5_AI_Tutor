---
source_image: page_518.png
page_number: 518
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 44.11
tokens: 11899
characters: 2364
timestamp: 2025-12-24T01:58:56.969564
finish_reason: stop
---

Пример 16.20. taxi_sim.py: реализация действий каждого такси в сопрограмме taxi_process

def taxi_process(ident, trips, start_time=0):
    """Отдает модели событие при каждой смене состояния"""
    time = yield Event(start_time, ident, 'leave garage')
    for i in range(trips):
        time = yield Event(time, ident, 'pick up passenger')
        time = yield Event(time, ident, 'drop off passenger')
    yield Event(time, ident, 'going home')
    # конец процесса такси

1 taxi_process вызывается один раз для каждого такси и создает объект-генератор, представляющий его действия. ident — это номер такси (в нашем примере 0, 1, 2), trips — сколько поездок должно совершить такси, перед тем как вернуться в гараж; start_time — когда такси выезжает из гаража.
2 Первый отданный объект Event — 'leave garage' (выезд из гаража). Выполнение сопрограммы приостанавливается, так что главный цикл моделирования может перейти к следующему запланированному событию. Когда настанет время возобновить этот процесс, главный цикл отправит (методом send) текущее модельное время, которое будет присвоено переменной time.
3 Этот блок повторяется по одному разу для каждой поездки.
4 Отдается событие посадки пассажира. Здесь сопрограмма приостанавливается. Когда настанет время возобновить этот процесс, главный цикл снова отправит текущее время.
5 Отдается событие высадки пассажира. Сопрограмма снова приостанавливается и ждет, когда главный цикл отправит ее время возобновления.
6 Цикл for заканчивается после заданного числа поездок и отдаётся последнее событие 'going home' (еду в гараж). Сопрограмма приостанавливается в последний раз. При возобновлении она получит от главного цикла модельное время, но я не присваиваю его никакой переменной, потому что оно не будет использоваться.
7 Когда сопрограмма доходит до конца, объект-генератор возбуждает исключение StopIteration.

Вы можете сами «поуправлять» такси, вызывая функцию taxi_process из оболочки Python¹⁴. В примере 16.21 показано, как это делается.

Пример 16.21. Управление сопрограммой taxi_process

>>> from taxi_sim import taxi_process
>>> taxi = taxi_process(ident=13, trips=2, start_time=0)

¹⁴ Глагол «управлять» (drive) обычно употребляется для описания работы сопрограммы: клиентский код управляет сопрограммой, отправляя ей значения. В примере 16.21 то, что вы вводите в оболочке, и есть клиентский код.