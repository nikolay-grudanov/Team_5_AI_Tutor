---
source_image: page_517.png
page_number: 517
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 47.22
tokens: 11972
characters: 2488
timestamp: 2025-12-24T01:58:56.379212
finish_reason: stop
---

Пример: применение сопрограмм для моделирования...

Главное, что нужно отметить на рис. 16.3, — чередование поездок всех трех такси. Я вручную добавил стрелки, чтобы поездки было лучше видно: стрелка начинается в момент посадки пассажира и кончается в момент высадки. Это дает интуитивное представление о том, как можно использовать сопрограммы для управления параллельными действиями

Вот на что еще стоит обратить внимание:

• Интервал между выездами такси из гаража составляет 5 минут.
• В такси 0 первый пассажир сел через 2 минуты после выезда, в момент времени time=2; в такси 1 — через 3 минуты (time=8), а в такси 2 — через 5 минут (time=15).
• Водитель такси 0 сделал только две поездки: первая началась в момент time=2 и закончилась в момент time=18; вторая началась в момент time=28 и закончилась в момент time=65 — это самая длинная поездка в данном прогоне модели.
• Такси 1 сделало 4 поездки, после чего вернулось в гараж в момент time=110.
• Такси 2 сделало 6 поездок и вернулось в гараж в момент time=109. Его последняя поездка длилась всего одну минуту, начавшись в момент time=9713.
• Пока такси 1 совершает свою первую поездку, начавшуюся в момент time=8, такси 2 выезжает из гаража в момент time=10 и успевает совершить две поездки (короткие стрелки).
• В этом прогоне все запланированные события завершились в отведенное по умолчанию время моделирования 180 минут; последнее событие произошло в момент time=110.

Но может случиться и так, что время моделирование закончилось, а события еще остались. В таком случае последнее сообщение выглядело бы так:

*** end of simulation time: 3 events pending ***

Полный текст скрипта taxi_sim.py приведен в примере А.6. В этой главе показаны только части, имеющие отношение к сопрограммам. По-настоящему важны всего две функции: taxi_process (сопрограмма) и метод Simulator.run, в котором выполняется главный цикл моделирования.

В примере 16.20 показан код функции taxi_process. В ней используются два объекта, определенных где-то в другом месте: функция compute_delay, которая возвращает временной интервал в минутах, и класс Event — именованный кортеж, определенный следующий образом:

Event = collections.namedtuple('Event', 'time proc action')

В экземпляре Event атрибут time — это модельное время события, proc — идентификатор процесса такси, а action — строка, описывающая действие.

Рассмотрим подробнее код taxi_process, представленный в примере 16.20.

13 Я был в нем пассажиром. Я понял, что оставил дома бумажник.