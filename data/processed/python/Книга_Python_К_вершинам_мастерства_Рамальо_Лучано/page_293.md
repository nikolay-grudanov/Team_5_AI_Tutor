---
source_image: page_293.png
page_number: 293
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 56.39
tokens: 11970
characters: 2535
timestamp: 2025-12-24T01:48:22.273730
finish_reason: stop
---

Резюме

данных: предлагает различные представления объекта, реализует специализированный код форматирования, раскрывает атрибуты, доступные только для чтения, и поддерживает метод hash() для интеграции с множествами и отображениями.

Резюме

Целью этой главы была демонстрация специальных методов и соглашений в процессе разработки класса Python, который ведет себя ожидаемо.

Можно ли сказать, что реализация в файле vector2d_v3.py (пример 9.9) лучше соответствует духу Python, чем та, что находится в файле vector2d_v0.py (пример 9.2)? Конечно, в классе Vector2d из файла vector2d_v3.py задействовано больше механизмов Python. Но какую версию считать более идиоматичной, зависит от контекста использования. В «Дзен Python» Тима Питера сказано:

Простое лучше, чем сложное.

Объект Python должен быть настолько простым, насколько возможно при соблюдении требований, — а не выставкой языковых средств.

Но, развивая код Vector2d, я ставил себе целью предложить контекст для обсуждения специальных методов и соглашений о кодировании. В листингах из этой главы продемонстрированы следующие средства, упомянутые в табл. 1.1:

• все методы строкового и байтового представления: __repr__, __str__, __format__ и __bytes__.
• несколько методов преобразования объекта в число: __abs__, __bool__, __hash__.
• оператор __eq__ для тестирования преобразования в bytes и поддержки хэширования (наряду с методом __hash__).

Обеспечивая поддержку преобразования в bytes, мы заодно реализовали альтернативный конструктор Vector2d.frombytes() и попутно получили предлог для обсуждения декораторов @classmethod (очень полезного) и @staticmethod (не столь полезного, поскольку функции уровня модуля проще). Идея метода frombytes позаимствована у его тезки из класса array.array.

Мы видели, что миниязык спецификации формата (https://docs.python.org/3/library/string.html#formatspec) можно расширить путем реализации метода __format__, который осуществляет несложный разбор строки format_spec, передаваемой встроенной функции format(obj, format_spec) или включенной в поле подстановки '{:"format_spec"}' в случае метода str.format.

Прежде чем сделать экземпляры класса Vector2d хэшируемыми, мы постарались обеспечить их неизменяемость или, по крайней мере, предотвратить случайное изменение. Для этого мы сделали атрибуты x и y закрытыми и предоставили к ним доступ через свойства, доступные только для чтения. Затем мы реализовали метод __hash__, применяя рекомендуемую технику: объединить хэши атрибутов экземпляра с помощью оператора ИСКЛЮЧАЮЩЕЕ ИЛИ.