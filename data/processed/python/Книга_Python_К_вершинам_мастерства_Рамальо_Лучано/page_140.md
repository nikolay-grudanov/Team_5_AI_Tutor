---
source_image: page_140.png
page_number: 140
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 38.45
tokens: 11813
characters: 2191
timestamp: 2025-12-24T01:41:04.759218
finish_reason: stop
---

В GNU/Linux и OS X все эти кодировки по умолчанию совпадают с UTF-8, и такое положение существует уже несколько лет, поэтому подсистема ввода-вывода обрабатывает все символы Unicode. В Windows не только используются различные кодировки в одной и той же системе, но обычно это еще и кодовые страницы, например 'cp850' или 'cp1252', которые поддерживают только ASCII и еще 127 символов, отличающиеся в разных кодировках. Поэтому у пользователей Windows гораздо больше шансов столкнуться с ошибками кодирования при малейшей небрежности.

Подводя итоги, можно сказать, что самым важным из всех относящихся к кодировкам параметров является значение, возвращаемое методом locale.getpreferredencoding(): оно подразумевается по умолчанию при открытии текстовых файлов и или вводе-выводе на sys.stdout/stdin/stderr, если поток перенаправлен на файл. Однако в документации (http://bit.ly/1IqvYLp) мы читаем:

locale.getpreferredencoding(do_setlocale=True)

Вернуть кодировку, используемую для текстовых данных, с соответствием с предпочтениями пользователя. Предпочтения задаются по-разному в разных системах и не всегда доступны из программы, поэтому данная функция возвращает только предположительное значение [...]

Таким образом, лучшее, что можно посоветовать в части кодировок по умолчанию: не полагайтесь на них.

Если вы будете поступать, как рекомендует сэндвич Unicode, и всегда явно указывать кодировку, то избежите множества неприятностей. К сожалению, проблемы работы с Unicode не заканчиваются, даже если вы правильно преобразуете bytes в str. В следующих двух разделах рассматриваются темы, которые не вызывают ни малейших трудностей в стране ASCII, но становятся весьма сложными на планете Unicode: нормализация текста (т. е. приведение его к единому представлению для сравнения) и сортировка.

Нормализация Unicode для правильного сравнения

Сравнение строк осложняется тем, что в Unicode есть модифицирующие символы: диакритические и другие знаки, присоединяемые к предыдущему символу, так что при печати оба символа выглядят, как единое целое.

Например, слово «café» можно составить двумя способами, из четырех или из пяти кодовых позиций, хотя результат будет выглядеть одинаково: