---
source_image: page_652.png
page_number: 652
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 38.31
tokens: 11853
characters: 2111
timestamp: 2025-12-24T02:04:52.487261
finish_reason: stop
---

>>> truffle = LineItem('White truffle', 100, 0)
Traceback (most recent call last):
    ...
ValueError: value must be > 0

Кодируя метод __set__, не забывайте, что означают аргументы self и instance: self — это экземпляр дескриптора, а instance — управляемый экземпляр. Дескрипторы, управляющие атрибутами экземпляра, должны хранить значения в управляемых экземплярах. Потому-то Python и передает аргумент instance методам дескриптора.

Может возникнуть соблазн хранить значения всех управляемых атрибутов в экземпляре самого дескриптора, т. е. в методе __set__ вместо кода

    instance.__dict__[self.storage_name] = value

написать:

    self.__dict__[self.storage_name] = value

Но это совершенно неправильно! Чтобы понять, почему, вспомните, что означают первые два аргумента __set__: self и instance. Здесь self — экземпляр дескриптора, т. е. фактически атрибут класса, принадлежащий управляемому классу. Одновременно в памяти могут находиться тысячи экземпляров LineItem, но экземпляров дескрипторов будет только два: LineItem.weight и LineItem.price. Поэтому все, что вы сохраняете в самих экземплярах дескрипторов, становится частью атрибута класса LineItem и, следовательно, распространяется на все экземпляры LineItem.

В примере 20.1 есть недостаток — необходимость повторять имена атрибутов, когда в теле управляемого класса создаются экземпляры дескрипторов. Хорошо было бы иметь возможность объявить класса LineItem как-то так:

class LineItem:
    weight = Quantity()
    price = Quantity()

    # прочие методы не изменяются

Проблема в том — и мы видели это в главе 8, — что правая часть присваивания вычисляется еще до того, как начинает существовать переменная. Выражение Quantity() призвано создать экземпляр дескриптора, но в этот момент код в классе Quantity никак не может узнать имя переменной, с которой этот дескриптор должен быть связан (weight или price).

В версии из примера 20.1 задавать имя при каждом вызове Quantity необходимо явно, а это не только неудобно, но и опасно: если при копировании и вставке кода программист забудет изменить имена, т. е. напишет что-то вроде price =