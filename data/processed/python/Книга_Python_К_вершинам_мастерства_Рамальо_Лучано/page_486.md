---
source_image: page_486.png
page_number: 486
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 55.34
tokens: 12001
characters: 2503
timestamp: 2025-12-24T01:57:38.634173
finish_reason: stop
---

Глава 15. Контекстные менеджеры и блоки else

Он также продемонстрировал несколько интересных применений контекстных менеджеров в выступлении «Преобразование кода в красивую идиоматичную программу на Python» (http://bit.ly/1MMagmB) на той же конференции.

Статья в блоге Джеффа Прешинга (Jeff Preshing) «The Python with Statement by Example» (http://bit.ly/1MMakmtm) интересна примерами использования контекстных менеджеров в графической библиотеке pycairo.

Бизли и Джонс предлагают контекстные менеджеры для разных целей в своей книге «Python Cookbook», издание 3 (O'Reilly). В рецепте 8.3 «Наделение объектов средствами поддержки протокола управления контекстом» реализован класс LazyConnection, экземпляры которого являются контекстными менеджерами, которые автоматически открывают и закрывают сетевое соединение в блоке with. В рецепте 9.22 «Простой способ определения контекстных менеджеров» описываются контекстные менеджеры для хронометража кода транзакционного изменения объекта list: в блоке with создается копия списка, и все изменения производятся в этой копии. И лишь если блок with завершается без исключений, рабочая копия заменяет исходный список. Просто и остроумно.

Поговорим

Выделение хлеба из бутерброда

В тезисах к докладу на конференции PyCon US 2013 «What Makes Python Awesome» (http://pyvideo.org/video/1669/keynote-3) Раймонд Хэттингер признался, что, впервые увидев предложение по реализации предложения with, он счел его «несколько заумным». И у меня поначалу была такая же реакция. Читать PEP'ы зачастую довольно трудно, и PEP 343 в этом отношении типичен.

Но потом — как сказал нам Хэттингер — его посетило озарение: подпрограммы — самое важное изобретение в истории языков программирования. Если имеются последовательности операций A;B;C и P;B;Q, то В можно выделить в виде подпрограммы. Это как выделение начинки сэндвича: тунца можно положить на разные куски хлеба. Но что если требуется выделить сам хлеб и использовать пшеничный хлеб с разными начинками? Именно в этом и состоит смысл предложения with. Это дополнение к подпрограммам. Хэттингер продолжает:

Предложение with — могучая штука. Я всем советую не ограничиваться поверхностным знакомством, а копнуть глубже. С его помощью можно делать поразительные вещи. И самые интересные из них еще не открыты. Я полагаю, что если мы сможем найти этому механизму хорошие применения, то он войдет и в другие языки, во все будущие языки. Вы можете принять участие в деянии столь же великом, как изобретение подпрограмм.