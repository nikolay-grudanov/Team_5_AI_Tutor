---
source_image: page_615.png
page_number: 615
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 45.35
tokens: 11784
characters: 1990
timestamp: 2025-12-24T02:03:24.239174
finish_reason: stop
---

Применение динамических атрибутов для обработки данных

>>> getattr(grad, 'class')
1982

Но идея класса FrozenJSON заключалась в том, чтобы предоставить удобный доступ к данным, поэтому лучше проверять, является ли ключ отображения, переданного методу FrozenJSON.__init__, зарезервированным словом, и, если да, то добавлять в конец символ _, чтобы атрибут можно было прочитать так:

>>> grad.class_
1982

Для этого достаточно заменить однорядочный метод __init__ из примера 19.5 кодом, показанным ниже.

Пример 19.6. explore1.py: добавление _ в имена атрибутов, являющиеся зарезервированными словами Python

def __init__(self, mapping):
    self.__data = {}
    for key, value in mapping.items():
        if keyword.iskeyword(key): ①
            key += '_'
        self.__data[key] = value

① Функция keyword.iskeyword(...) — именно то, что нам нужно; для ее использования необходимо импортировать модуль keyword.

Похожая проблема может возникнуть, если ключ в JSON-данных не является допустимым идентификатором Python:

>>> x = FrozenJSON({'2be': 'or not'})
>>> x.2be
File "<stdin>", line 1
    x.2be
    ^
SyntaxError: invalid syntax

Такие проблематичные ключи легко выявить в Python 3, где класс str предоставляет метод s.isidentifier(), который сообщает, является ли s допустимым идентификатором с точки зрения грамматики языка Python. Но преобразование ключа, не являющегося допустимым идентификатором, в допустимое имя атрибута — нетривиальная задача. Есть два простых решения: возбудить исключение или заменять недопустимые ключи синтетическими, например: attr_0, attr_1 и т. д. Для простоты я проигнорирую этот случай.

Уделив внимание именам динамических атрибутов, обратимся к другой важной особенности класса FrozenJSON: логике метода класса build, который вызывается из __getattr__ для получения объектов разных типов в зависимости от значения обрабатываемого атрибута, так чтобы вложенные структуры преобразовывались в экземпляры FrozenJSON или списки экземпляров FrozenJSON.