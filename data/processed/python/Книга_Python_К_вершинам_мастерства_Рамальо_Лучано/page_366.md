---
source_image: page_366.png
page_number: 366
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 61.71
tokens: 12075
characters: 2942
timestamp: 2025-12-24T01:51:57.638632
finish_reason: stop
---

Глава 11. Интерфейсы: от протоколов до абстрактных базовых...

Познакомившись с общей картиной имеющихся в модуле collections.abc абстрактных базовых классов (рис. 11.3), мы написали свой ABC с нуля. Дуг Хеллманн, создатель интереснейшего сайта PyMOTW.com (http://pymotw.com/) (Python Module of the Week) так объясняет мотивацию:

Определение абстрактного базового класса позволяет зафиксировать общий API для множества подклассов. Эта возможность особенно полезна в ситуации, когда человек, слабо знакомый с исходным кодом приложения, собирается написать для него подключаемый модуль...18

Желаю продемонстрировать ABC Tombola в действии, мы создали три конкретных подкласса: два из них наследовали Tombola, а третий был зарегистрирован в качестве виртуального подкласса. И все три прошли один и тот же набор тестов.

В заключение мы упомянули, каким образом несколько встроенных типов зарегистрированы в качестве виртуальных подклассов ABC из модуля collections.abc, в результате чего вызов isinstance(memoryview, abc.Sequence) возвращает True, хотя memoryview не наследует abc.Sequence. И наконец, мы раскрыли секрет метода __subclasshook__, который позволяет ABC распознавать незарегистрированный класс в качестве своего подкласса при условии, что он проходит некоторую проверку, которая может быть такой простой или сложной, как нужно разработчику, — классы из стандартной библиотеки всего лишь проверяют имена методов.

Резюмируя, я хотел бы присоединиться к увещеванию Алекса Мартелли воздержаться от создания собственных ABC за исключением разработки расширяемых каркасов, чем большинство из нас не занимается. В повседневной же работе общение с ABC следует ограничить созданием подклассов или регистрацией классов для существующих ABC. Реже ABC могут использоваться для проверок с помощью функции isinstance. А еще реже — скорее всего, никогда — возникают ситуации, когда нужно создать ABC с нуля.

После 15 лет программирования на Python первым абстрактным классом, который я написал не в педагогических целях, был класс Board (https://github.com/garoa/pingo/blob/master/pingo/board.py) из проекта Pingo (http://pingo.io/). Драйверы, поддерживающие различные одноплатные компьютеры и контроллеры, являются подклассами Board и, следовательно, разделяют общий интерфейс. На самом деле, хотя pingo.Board задуман и реализован как абстрактный класс, он не является подклассом abc.ABC19. Когда-нибудь я собираюсь сделать Board явным ABC, но пока в проекте есть более важные вещи.

Напоследок приведу цитату, удачно завершающую эту главу.

Хотя ABC упрощают проверку типов, злоупотреблять ими в программе не следует. По сути своей, Python — динамический язык, обладающий большой гибкостью. Попытка всюду навязывать огра-

18 PyMOTW, страница модуля abc, раздел «Why use Abstract Base Classes?» (http://bit.ly/1QOGle5).
19 И в стандартной библиотеке Python вы встретите классы, по существу абстрактные, хотя явно никто их таковыми не делал.