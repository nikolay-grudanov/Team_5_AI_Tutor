---
source_image: page_307.png
page_number: 307
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 42.64
tokens: 11855
characters: 2088
timestamp: 2025-12-24T01:48:49.491918
finish_reason: stop
---

Vector, попытка № 2: последовательность, допускающая срезку

Иначе говоря, метод indices раскрывает нетривиальную логику, применяемую во встроенных последовательностях для корректной обработки отсутствующих или отрицательных индексов и срезов, длина которых превышает длину конечной последовательности. Этот метод возвращает «нормализованные» кортежи, содержащие неотрицательные целые числа start, stop и stride, скорректированные так, чтобы не выходить за границы последовательности заданной длины.

Ниже приведено два примера для последовательности длины 5, например 'ABCDE':

```python
>>> slice(None, 10, 2).indices(5) # ①
(0, 5, 2)
>>> slice(-3, None, None).indices(5) # ②
(2, 5, 1)
```

① 'ABCDE'[1:10:2] — то же самое, что 'ABCDE'[0:5:2].
② 'ABCDE'[-3] — то же самое, что 'ABCDE'[2:5:1].

На момент написания этой книги метод slice.indices не был документирован в справочном руководстве по языку Python. В справочном руководстве по Python/C API описана аналогичная C-функция PySlice_GetIndicesEx (https://docs.python.org/3/c-api/slice.html#c.PySlice_GetIndicesEx). Я обнаружил метод slice.indices, когда исследовал объекты срезов в оболочке Python с помощью dir() и help(). Еще одно свидетельство ценности интерактивной оболочки в качестве инструмента познания.

В классе Vector нам не нужен метод slice.indices(), потому что, получив в аргументе срез, мы делегируем его обработку массиву _components. Но если опереться на средства, предоставляемые внутренней последовательностью, не получается, то этот метод может сэкономить уйму времени.

Теперь, разобравшись, как обрабатывать срезы, рассмотрим улучшенную реализацию метода Vector.__getitem__.

Метод __getitem__ с учетом срезов

В примере 10.6 приведено два метода, необходимых для того, чтобы класс Vector вел себя, как последовательность: __len__ и __getitem__ (последний теперь правильно обрабатывает срезы).

Пример 10.6. Часть файла vector_v2.py: в класс Vector из файла vector_v1.py (пример 10.2) добавлены методы __len__ и __getitem__:

def __len__(self):
    return len(self._components)

def __getitem__(self, index):