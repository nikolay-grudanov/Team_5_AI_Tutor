---
source_image: page_399.png
page_number: 399
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 50.83
tokens: 11917
characters: 2353
timestamp: 2025-12-24T01:53:17.305130
finish_reason: stop
---

Унарные операторы

В главе «Модель данных» (https://docs.python.org/3/reference/datamodel.html#object.__neg__) справочного руководства по языку Python встроенная функция abs(...) также названа унарным оператором. Ранее (раздел «Эмуляция числовых типов» главы 1) мы видели, что с ней связан специальный метод __abs__.

Поддержать унарные операторы легко. Достаточно реализовать соответствующий специальный метод, который принимает единственный аргумент self. Логика этого метода может быть произвольной, но должно удовлетворяться фундаментальное правило: оператор всегда возвращает новый объект. Иначе говоря, не модифицируйте self, а создавайте и возвращайте новый экземпляр подходящего типа.

В случае операторов - и + результат, вероятно, должен быть экземпляром того же класса, что и self; для + чаще всего имеет смысл возвращать копию self. Для abs(...) результатом должен быть скаляр. Результат же оператора ~ очевиден, только если речь идет о битах целого числа, но, скажем, в случае ORM (объектно-ориентированное отображение) имело бы смысл вернуть SQL-команду с противоположным условием WHERE.

Как и было обещано, мы реализуем еще несколько операторов в классе Vector в дополнение к тем, что было сделано в главе 10. В примере 13.1 показан метод __abs__ — тот же, что в примере 10.16, — и новые методы __neg__ и __pos__ для поддержки унарных операторов.

Пример 13.1. vector_v6.py: унарные операторы - и + в дополнение к примеру 10.16

def __abs__(self):
    return math.sqrt(sum(x * x for x in self))

def __neg__(self):
    return Vector(-x for x in self) ①

def __pos__(self):
    return Vector(self) ②

① Для вычисления -v строим новый объект Vector, в котором все компоненты self имеют противоположный знак.
② Для вычисления +v строим новый объект Vector с точно такими же компонентами, как у self.

Напомним, что экземпляры Vector — итерируемые объекты, а Vector.__init__ принимает в качестве аргумента итерируемый объект, поэтому реализации __neg__ и __pos__ оказались очень короткими и элегантными.

Мы не станем реализовывать метод __invert__, поэтому при попытке выполнить операцию ~v для объекта Vector Python возбудит исключение TypeError с не оставляющим сомнений сообщением: «bad operand type for unary ~: 'Vector'».

Прочитав об одном курьезе на врезке ниже, вы сможете как-нибудь при случае выиграть пари, касающееся унарного +.