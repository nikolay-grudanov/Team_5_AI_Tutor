---
source_image: page_229.png
page_number: 229
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 44.74
tokens: 11823
characters: 2149
timestamp: 2025-12-24T01:45:18.074319
finish_reason: stop
---

Декораторы в стандартной библиотеке

def _(n):
    return '<pre>{0} (0x{0:x})</pre>'.format(n)

@htmlize.register(tuple)
@htmlize.register(abc.MutableSequence)
def _(seq):
    inner = '</li>\n<li>'.join(htmlize(item) for item in seq)
    return '<ul>\n<li>' + inner + '</li>\n</ul>'

1 @singledispatch помечает базовую функцию, которая обрабатывает тип object.
2 Каждая специализированная функция снабжается декоратором @«base_function».register(«type»).
3 Имена специализированных функций несущественны, и это подчеркнуто выбором _ в качестве имени.
4 Для каждого типа, нуждающегося в специальной обработке, регистрируется новая функция. numbers.Integral — виртуальный суперкласс int.
5 Можно указывать несколько декораторов register, если требуется, чтобы одна функция поддерживала несколько типов.

По возможности старайтесь регистрировать специализированные функции для обработки абстрактных базовых классов, например numbers.Integral или abc.MutableSequence, а не конкретных реализаций типа int и list. Тогда ваш код сможет поддержать больше совместимых типов. Например, гипотетическое расширение Python могло бы предложить альтернативы типу int с фиксированным количеством разрядов в виде подклассов numbers.Integral.

Использование абстрактных базовых классов для проверки типов открывает возможность для поддержки существующих и будущих классов, являющихся как фактическими, так и виртуальными подклассами этих АВС. Применение АВС и концепция виртуального подкласса — темы главы 11.

Замечательное свойство механизма singledispatch состоит в том, что специализированные функции можно зарегистрировать в любом месте системы, в любом модуле. Если впоследствии вы добавите модуль, содержащий новый пользовательский тип, то сможете без труда написать новую специализированную функцию для обработки этого типа. А также реализовать функции обработки для классов, которые вы не писали и не можете изменить.

Декоратор singledispatch — продуманное дополнение к стандартной библиотеке, его возможности шире, чем описано выше. Лучше всего он описан в документе «РЕР 443 — Single-dispatch generic functions» (https://www.python.org/dev/peps/pep-0443/).