---
source_image: page_201.png
page_number: 201
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 43.81
tokens: 11807
characters: 2100
timestamp: 2025-12-24T01:44:04.642304
finish_reason: stop
---

Функционально-ориентированная стратегия

3 С помощью генераторного выражения мы применяем к order каждую функцию из списка promos и возвращаем максимальную вычисленную скидку.

Код в примере 6.6 работает бесхитростно: promos — это список функций. Сжившись с идеей о том, что функции — полноправные объекты, вы будете воспринимать и структуры, содержащие функции, как нечто естественное.
Пример 6.6 работает и читать код легко, но все же в нем есть некоторое дублирование, которое может приводить к тонкой ошибке: чтобы добавить новую стратегию скидки, нужно написать функцию и не забыть добавить ее в список promos, иначе новая стратегия будет работать, если явно передать ее в качестве аргумента Order, но best_promotion ее рассматривать не будет.
Ниже описано два решения этой проблемы. Читайте дальше.

Поиск стратегий в модуле

Модули в Python также являются полноправными объектами, и в стандартной библиотеке есть несколько функций для работы с ними. В документации встроенная функция globals описана следующим образом:

globals()
Возвращает словарь, представляющий текущую таблицу глобальных символов. Это всегда словарь текущего модуля (внутри функции или метода это тот модуль, где данная функция или метод определены, а не модуль, из которого они вызваны).

В примере 6.7 показан не вполне честный способ использования globals, позволяющий best_promo автоматически находить все доступные функции *_promo.

Пример 6.7. Список promos строится путем просмотра глобального пространства имен модуля

promos = [globals()[name] for name in globals() if name.endswith('_promo') and name != 'best_promo']
def best_promo(order):
    """Выбрать максимально возможную скидку
    """
    return max(promo(order) for promo in promos)

1 Перебираем все имена в словаре, возвращенном функцией globals().
2 Оставляем только имена с суффиксом _promo.
3 Отфильтровываем саму функцию best_promo, чтобы не было бесконечной рекурсии.
4 Сама функция best_promo не изменилась.

Другой способ собрать вместе все стратегии скидки — создать отдельный модуль и поместить в него все функции-стратегии, кроме best_promo.