---
source_image: page_547.png
page_number: 547
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 37.20
tokens: 11800
characters: 1851
timestamp: 2025-12-24T02:00:07.598276
finish_reason: stop
---

Загрузка с индикацией хода выполнения и обработкой ошибок

![Скриншоты терминала с индикатором хода выполнения и окном после завершения скрипта](https://i.imgur.com/3Q5z5QG.png)

Рис. 17.1. Слева вверху: скрипт flags2_threadpool.py с динамическим индикатором хода выполнения, созданным с помощью tqdm.
Справа внизу: то же окно терминала после завершения скрипта

Помимо зрительно приятного эффекта, функция tqdm интересна и с концептуальной точки зрения: она принимает произвольный итерируемый объект и порождает итератор, при обходе которого отображается индикатор хода выполнения и оценка времени, оставшегося до завершения всех итераций. Чтобы вычислить эту оценку, tqdm должна получать либо итерируемый объект, имеющий метод len, либо второй аргумент, который содержит ожидаемое количество элементов. Включение TQDM в наши flags2-примеры дает возможность ближе познакомиться с внутренним устройством параллельных скриптов, поскольку заставляет использовать функции futures.as_completed (http://bit.ly/1JIsEOW) и asyncio.as_completed (http://bit.ly/1JIufV1), чтобы tqdm мог показать индикатор в момент завершения каждого будущего объекта.

Еще одна особенность flags2-примеров — интерфейс командной строки. Все три скрипта принимают одни и те же параметры, а чтобы увидеть их, нужно запустить скрипт с флагом -h. Текст справки показан в примере 17.8.

Пример 17.8. Справка для скриптов из серии flags2

$ python3 flags2_threadpool.py -h
usage: flags2_threadpool.py [-h] [-a] [-e] [-l N] [-m CONCURRENT] [-s LABEL]
    [-v]
    [CC [CC ...]]

Загружает флаги стран с указанными кодами. По умолчанию: 20 стран с наибольшим населением.

Позиционные аргументы:
CC        код страны или первая буква (например, B вместо BA...BZ)

Необязательные аргументы:
-h, --help   вывести это сообщение и выйти
-a, --all    вывести все имеющиеся флаги (от AD до ZW)