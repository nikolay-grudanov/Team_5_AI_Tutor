---
source_image: page_447.png
page_number: 447
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 38.87
tokens: 11887
characters: 2345
timestamp: 2025-12-24T01:55:29.151161
finish_reason: stop
---

Другой пример: генератор арифметической прогрессии

5 Порождается текущее значение result.
6 Вычисляется следующий потенциальный результат. Возможно, он никогда не будет отдан, потому что цикл while завершится раньше.

В последней строке я вместо того чтобы прибавлять к result значение self.step на каждой итерации, решил воспользоваться переменной index и вычислять result путем сложения self.begin с величиной self.step, умноженной на индекс. Это уменьшает накопление погрешности при работе с числами с плавающей точкой.

Показанный выше класс ArithmeticProgression работает, как и было задумано, и дает понятный пример использования генераторной функции для реализации специального метода __iter__. Однако если единственная цель класса — сконструировать генератор в методе __iter__, то класс можно свести к генераторной функции. Ведь генераторная функция — это не что иное, как фабрика генераторов.

В примере 14.12 показана генераторная функция aritprog_gen, которая делает то же самое, что класс ArithmeticProgression, но короче. Все тесты в примере 14.10 проходят, если вызывать aritprog_gen вместо ArithmeticProgression9.

Пример 14.12. Генераторная функция aritprog_gen

def aritprog_gen(begin, step, end=None):
    result = type(begin + step)(begin)
    forever = end is None
    index = 0
    while forever or result < end:
        yield result
        index += 1
        result = begin + step * index

Пример 14.12, конечно, впечатляет, но не забывайте: в стандартной библиотеке немало готовых генераторов, и в следующем разделе мы покажем еще более впечатляющую реализацию с использованием модуля itertools.

Построение арифметической прогрессии с помощью itertools

Модуль itertools в версии Python 3.4 содержит 19 генераторных функций, который можно комбинировать разными интересными способами.

Например, функция itertools.count возвращает генератор, порождающий числа. Без аргументов порождается ряд целых чисел, начиная с 0. А если задать аргументы start и step, то получится результат очень похожий на тот, что дают наши функции aritprog_gen:

>>> import itertools
>>> gen = itertools.count(1, .5)

9 Каталог 14-it-generator/directory в репозитории кода к этой книге (http://bit.ly/1JItSti) содержит doctest-скрипты, а также скрипт aritprog_runner.py, который прогонает все тесты для различных вариантов скриптов aritprog*.py.