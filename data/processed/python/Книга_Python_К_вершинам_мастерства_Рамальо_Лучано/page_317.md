---
source_image: page_317.png
page_number: 317
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 38.26
tokens: 11836
characters: 2150
timestamp: 2025-12-24T01:49:10.610866
finish_reason: stop
---

Vector, попытка № 4: хэширование и ускорение оператора ==

2 Функция zip порождает генератор кортежей, содержащих соответственные элементы каждого переданного ей итерируемого объекта. Если вы с ней незнакомы, см. врезку «Удивительная функция zip» ниже. Сравнение длин в предыдущем предложении необходимо, потому что zip без предупреждения перестает порождать значения, как только хотя бы один входной аргумент оказывается исчерпаным.

3 Как только встречаются две различных компоненты, выходим и возвращаем False.

4 В противном случае объекты равны.

Код из примера 10.13 эффективен, но функция all может вычислить тот же агрегат, что и цикл for, всего в одной строчке: если все сравнения соответственных компонент операндов возвращают True, то и результат равен True. Как только какое-нибудь сравнение возвращает False, так all сразу возвращает False. В примере 10.14 показано, как выглядит метод __eq__, в котором используется all.

Пример 10.14. Оператор Vector.eq с использованием zip и all: логика та же, что в примере 10.13

def __eq__(self, other):
    return len(self) == len(other) and all(a == b for a, b in zip(self, other))

Отметим, что сначала проверяется равенство длин операндов, потому что zip остановится по исчерпании более короткого операнда.
Реализацию из примера 10.14 мы включили в файл vector_v4.py.
И в завершение этой главы перенесем метод __format__ из класса Vector2d в класс Vector.

Удивительная функция zip

Наличие цикла for, в котором можно обойти элементы коллекции без возни с индексной переменной, — отличное дело, и многие ошибки так можно предотвратить, только для этого нужны специальные служебные функции. Одна из них — встроенная функция zip, позволяющая параллельно обходить два и более итерируемых объекта: она возвращает кортежи, которые можно распаковать в переменные, — по одной для каждого входного объекта. См. пример 10.15.

Свое название функция zip получила от застежки-молнии (zipper), принцип работы которой основан на сцеплении зубьев, расположенных с двух сторон, — наглядная аналогия того, что происходит при обращении zip(left, right). Никакого отношения к сжатым файлам эта функция не имеет.