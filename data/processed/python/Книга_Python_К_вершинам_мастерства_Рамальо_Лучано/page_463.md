---
source_image: page_463.png
page_number: 463
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 52.33
tokens: 12033
characters: 2637
timestamp: 2025-12-24T01:56:34.037714
finish_reason: stop
---

Пример: генераторы в утилите преобразования базы данных

d6_iter после исчерпания становится бесполезен. Чтобы начать сначала, необходимо получить новый итератор, еще раз вызвав iter(...).

Полезный пример имеется в документации по встроенной функции iter (http://bit.ly/1HGq70). В этом фрагменте мы читаем строки из файла, пока не встретится пустая строка или конец файла:

with open('mydata.txt') as fp:
    for line in iter(fp.readline, ''):
        process_line(line)

В заключение главы я приведу практический пример использования генераторов для эффективной обработки данных очень большого объема.

Пример: генераторы в утилите преобразования базы данных

Несколько лет назад я работал в BIREME, цифровой библиотеке под патронажем РАНО/WHO (Панамериканская организация здравоохранения/Всемирная организация здравоохранения) в Сан-Паулу, Бразилия. В числе библиографических наборов данных, создаваемых BIREME, есть LILACS (Библиографический указатель по здравоохранению в Латинской Америке и на Карибских островах) и SciELO (Онлайновая научная электронная библиотека). Это две очень полные базы данных с описанием научно-технической литературы, издаваемой в регионе.

С конца 1980-х годов для управления базой данных LILACS используется CDS/ISIS, нереляционная документная СУБД, созданная ЮНЕСКО и в конечном итоге переписанная на С силами BIREME для выполнения на серверах GNU/Linux. Частью моей работы было исследование возможностей переноса LILACS, а затем и гораздо более объемной SciELO, на современную СУБД с открытым исходным кодом, например CouchDB или MongoDB.

По ходу дела я написал на Python скрипт isis2json.py, который читает файл CDS/ISIS и записывает файл в формате JSON, пригодный для импорта в CouchDB или MongoDB. Первоначально скрипт читал файлы в формате ISO-2709, экспортимые CDS/ISIS. Чтение и запись приходилось выполнять по частям, потому что полный набор данных был гораздо больше объема оперативной памяти. Это было не очень сложно: на каждой итерации главного цикла for прочитать одну запись из iso-файла, обработать ее и записать в json-файл.

Однако по причинам эксплуатационного свойства необходимо было, чтобы скрипт isis2json.py поддерживал еще один формат данных CDS/ISIS: двоичные mst-файлы, используемые в производственной системе BIREME, — чтобы избежать дорогостоящего экспорта в формат ISO-2709.

Но тут возникла проблема: библиотеки для чтения файлов в формате ISO-2709 и mst-файлов имели совершенно разные API. А цикл вывода JSON и так уже был достаточно сложным, поскольку скрипт принимал разнообразные параметры командной строки, управляющие структурой выходной записи. Чтение данных с по-