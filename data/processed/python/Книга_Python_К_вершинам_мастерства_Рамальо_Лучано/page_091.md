---
source_image: page_091.png
page_number: 91
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 41.12
tokens: 11803
characters: 2067
timestamp: 2025-12-24T01:38:43.362904
finish_reason: stop
---

Обзор наиболее употребительных методов отображений

Обработка отсутствия ключей с помощью setdefault

В полном соответствии с философией «быстрого прекращения» доступ к словарю dict с помощью конструкции d[k] возбуждает исключение, если ключ k отсутствует. Любой питонист знает об альтернативной конструкции d.get(k, default), которая применяется вместо d[k], если иметь значение по умолчанию удобнее, чем обрабатывать исключение KeyError. Однако если нужно обновить найденное значение (при условии, что оно изменяемо), то и __getitem__, и get оказываются неудобны и неэффективны. В примере 3.2 показан неоптимальный скрипт, демонстрирующий одну ситуацию, когда dict.get — не лучший способ обработки отсутствия ключа.

Пример 3.2 основан на примере Алекса Мартелли1, он генерирует индекс, показанный в примере 3.3.

Пример 3.2. index0.py: применение метода dict.get для выборки и обновления списка вхождений слова в индекс (в примере 3.4 показано лучшее решение)

"""Строит индекс, отображающий слово на список его вхождений"""

import sys
import re

WORD_RE = re.compile(r'\w+')

index = {}

with open(sys.argv[1], encoding='utf-8') as fp:
    for line_no, line in enumerate(fp, 1):
        for match in WORD_RE.finditer(line):
            word = match.group()
            column_no = match.start() + 1
            location = (line_no, column_no)
            # некрасиво; написано только для демонстрации идеи
            occurrences = index.get(word, []) ①
            occurrences.append(location) ②
            index[word] = occurrences ③

# напечатать в алфавитном порядке
for word in sorted(index, key=str.upper): ④
    print(word, index[word])

① Получить список вхождений слова word или [], если оно не найдено.
② Добавить новое вхождение в occurrences.
③ Поместить модифицированный список occurrences в словарь dict; при этом производится второй поиск в индексе.

1 Оригинальный скрипт представлен на слайде 41 презентации Мартелли «Учим Python заново» (http://bit.ly/1QmmPFj). Его скрипт демонстрирует использование dict.setdefault, показанное в примере 3.4.