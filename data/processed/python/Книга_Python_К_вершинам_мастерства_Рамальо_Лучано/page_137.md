---
source_image: page_137.png
page_number: 137
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 36.41
tokens: 11718
characters: 1801
timestamp: 2025-12-24T01:40:56.837195
finish_reason: stop
---

Обработка текстовых файлов

4 В результате открытия текстового файла без явного указания кодировки возвращается объект TextIOWrapper, в котором установлена кодировка, взятая из локали.
5 В объекте TextIOWrapper имеется атрибут encoding, который можно опросить, в данном случае он равен cp1252.
6 В кодировке Windows cp1252 байт 0xc3 соответствует символу «Â» (А с тильдой), а 0xa9 — знаку копирайта.
7 Открытие того же файла с указанием правильной кодировки.
8 Ожидаемый результат: те же самые четыре символа Unicode 'café'.
9 При задании флага 'rb' файл открывается в двоичном режиме.
10 Возвращенный объект имеет тип BufferedReader, а не TextIOWrapper.
11 Чтение возвращает те байты, которые ожидаются.

Не открывайте текстовые файлы в двоичном режиме, если не собираетесь анализировать содержимое файла на предмет определения кодировки, да и в этом случае лучше пользоваться библиотекой Chardet, а не изобретать велосипед (см. раздел «Как определить кодировку последовательности байтов» выше). В обычной программе двоичный режим следует использовать только для открытия двоичных файлов, например растровых изображений.

Проблема, встретившаяся нам в примере 4.10, возникла из-за неверного предположения о кодировке по умолчанию при открытии текстового файла. Как показано в следующем разделе, существует несколько источников таких умолчаний.

Кодировки по умолчанию: сумасшедший дом

На установку кодировки по умолчанию в Python влияют несколько параметров. См. скрипт default_encodings.py в примере 4.11.

Пример 4.11. Исследование кодировок по умолчанию

import sys, locale

expressions = """
locale.getpreferredencoding()
type(my_file)
my_file.encoding
sys.stdout.isatty()
sys.stdout.encoding
sys.stdin.isatty()
sys.stdin.encoding
sys.stderr.isatty()
sys.stderr.encoding
sys.getdefaultencoding()