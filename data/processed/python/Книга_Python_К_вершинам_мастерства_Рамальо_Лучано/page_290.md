---
source_image: page_290.png
page_number: 290
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 48.32
tokens: 11969
characters: 2537
timestamp: 2025-12-24T01:48:07.082403
finish_reason: stop
---

Существует еще один специальный атрибут экземпляра, который имеет смысл сохранить: __weakref__ необходим, чтобы объект поддерживал слабые ссылки (см. раздел «Слабые ссылки» главы 8). По умолчанию этот атрибут присутствует в экземплярах всех пользовательских классов. Однако если в классе определен атрибут __slots__, а вам нужно, чтобы его экземпляры могли быть объектами слабых ссылок, то '__weakref__' необходимо явно включить в список имен атрибутов в __slots__.

Подведем итоги. С атрибутом __slots__ связаны некоторые подводные камни, его не следует использовать, чтобы запретить пользователям динамически расширять состав атрибутов объекта. Наибольшую пользу от него можно получить при работе с табличными данными, например, записями из базы данных, когда схема по определению фиксирована, а набор данных может быть очень велик. Но если вы регулярно занимаетесь такими задачами, то следует изучить не только пакет NumPy (http://www.numpy.org), но и библиотеку для анализа данных pandas (http://pandas.pydata.org), которая умеет работать с нечисловыми данными, а также производить импорт и экспорт в различных табличных форматах.

Проблемы при использовании __slots__

Таким образом, атрибут __slots__ при правильном использовании может дать значительную экономию памяти, но есть несколько подводных камней.

• Не забывайте заново объявлять __slots__ в каждом подклассе, потому что унаследованный атрибут интерпретатор игнорирует.
• Экземпляры класса могут иметь только атрибуты, явно перечисленные в __slots__, если не включено также имя '__dict__' (однако при этом вся экономия памяти может быть сведена на нет).
• Экземпляры класса не могут быть объектами слабых ссылок, если не включить в __slots__ имя '__weakref__'.

Создавать необычный и неочевидный класс, экземпляры которого не всегда допускают динамическое создание атрибутов и, возможно, не поддерживают слабые ссылки, имеет смысл, только если программа работает с миллионами экземпляров. Как и любую оптимизацию, атрибут __slots__ следует использовать лишь в случае, когда это оправдано, а выигрыш доказан путем аккуратного профилирования.

Последняя тема этой главы — переопределение атрибутов класса в экземплярах и подклассах.

Переопределение атрибутов класса

Отличительной особенностью Python является использование атрибутов класса в качестве значений по умолчанию для атрибутов экземпляра. В классе Vector2d имеется атрибут класса typecode. Он дважды используется в методе __bytes__, но там мы осознанно писали self.typecode. Поскольку экземпляры класса Vector2d