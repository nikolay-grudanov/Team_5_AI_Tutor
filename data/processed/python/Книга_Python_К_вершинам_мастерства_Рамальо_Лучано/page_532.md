---
source_image: page_532.png
page_number: 532
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 34.01
tokens: 11821
characters: 2028
timestamp: 2025-12-24T01:59:25.645347
finish_reason: stop
---

5 Обратите внимание на порядок стран: в случае параллельных скриптов загрузка каждый раз происходит в другом порядке.

Между двумя параллельными скриптами разница в производительности несущественна, но тот и другой работают в пять раз быстрее последовательного скрипта — и это на совсем небольшой задаче. Если бы количество загружаемых файлов исчислялось сотнями, то параллельные скрипты показали бы рост производительности в 20 и более раз.

При тестировании параллельных HTTP-клиентов в открытом вебе можно случайно организовать DoS-атаку или навлечь на себя такие подозрения. В случае примера 17.1 ничего страшного не случится, потому что в скрипты зашито ограничение: только 20 запросов. Но для тестирования нетривиальных клиентов следует поднять собственный тестовый сервер. В файле 17-futures/countries/README.rst (http://bit.ly/1Jlsg2L) в репозитории кода к книге (https://github.com/fluentpython/example-code) на GitHub есть инструкции по настройке локального сервера Nginx.

Теперь рассмотрим реализации двух скриптов, протестированных в примере 17.1: flags.py и flags_threadpool.py. Скрипт flags_asyncio.py я отложу до главы 18, но продемонстрировать хотел сразу три, чтобы подчеркнуть важный момент: при любой стратегии распараллеливания — многопоточность или asyncio — производительность приложения, занятого вводом-выводом, оказывается намного выше, чем у последовательного кода.
Итак, перейдем к коду.

Скрипт последовательной загрузки

Пример 17.2 не очень интересен, но большая часть его кода и параметров будет использована для реализации параллельных скриптов, поэтому уделим ему немного внимания.

Для большей ясности в примере 17.2 нет никакой проверки ошибок. Исключениями мы займемся позже, а пока хотим сосредоточиться на структуре кода, чтобы было проще сравнить этот скрипт с параллельными.

Пример 17.2. flags.py: последовательный скрипт загрузки; некоторые функции будут использованы и в других скриптах

import os
import time
import sys

import requests ①

POP20_CC = ('CN IN US ID BR PK NG BD RU JP'