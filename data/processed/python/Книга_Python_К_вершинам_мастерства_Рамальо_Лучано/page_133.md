---
source_image: page_133.png
page_number: 133
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 55.51
tokens: 12125
characters: 2512
timestamp: 2025-12-24T01:41:04.758850
finish_reason: stop
---

Проблемы кодирования и декодирования

сто встречается последовательность b'\x20\x00', то это, наверное, символ пробела (U+0020) в кодировке UTF-16LE, а не малоизвестный символ U+2000 EN QUAD.

Именно так и работает пакет Chardet — универсальный детектор кодировки символов (https://pypi.python.org/pypi/chardet) — который пытается распознать одну из 30 поддерживаемых кодировок. Chardet — написанная на Python библиотека, которую вы можете включить в свою программу, а, кроме нее, пакет содержит также командную утилиту chardetect. Вот что она сообщает о файле с исходным кодом к данной главе:

$ chardetect 04-text-byte.asciidoc
04-text-byte.asciidoc: utf-8 with confidence 0.99

Хотя в самих двоичных последовательностях закодированного текста обычно нет явных указаний на кодировку, в некоторых UTF-форматах в начале файла может находиться маркер порядка байтов. Это объясняется в следующем разделе.

ВОМ: полезный крокозябр

Возможно, вы заметили, что в примере 4.5 в начале последовательности в кодировке UTF-16 находились два дополнительных байта. Приведем их еще раз:

>>> u16 = 'El Niño'.encode('utf_16')
>>> u16
b'\xff\xfeE\x001\x00 \x00N\x00i\x00\xf1\x00o\x00'

Речь идет о байтах b'\xff\xfe'. Это BOM — byte-order mark (маркер порядка байтов). В данном случае он говорит, что порядок «остроконечный», т. е. принятый в процессоре Intel, на котором производилось кодирование.

На «остроконечной» машине для каждой кодовой позиции первым идет младший байт: буква 'Е' с кодовой позицией U+0045 (десятичное 69) представлена в позициях со смещением 2 и 3 от начала последовательности числами 69 и 0:

>>> list(u16)
[255, 254, 69, 0, 108, 0, 32, 0, 78, 0, 105, 0, 241, 0, 111, 0]

На машине с «тупоконечным» процессором кодировка была бы противоположной; буква 'Е' была бы закодирована числами 0 и 69.

Во избежание недоразумений в начало текстовых файлов в кодировке UTF-16 добавляется специальный невидимый символ НЕРАЗРЫВНЫЙ ПРОБЕЛ НУЛЕВОЙ ШИРИНЫ (U+FEFF). В «остроконечной» системе он кодируется байтами b'\xff\xfe' (десятичные 255, 254). Поскольку символ в кодовой позиции U+FFFFE не существует — это задумано специально — последовательность байтов b'\xff\xfe' должна означать НЕРАЗРЫВНЫЙ ПРОБЕЛ НУЛЕВОЙ ШИРИНЫ в остроконечной кодировке, поэтому кодек знает, каким должен быть порядок байтов.

Существует вариант кодировки UTF-16 — UTF-16LE — специально предназначенный для остроконечных систем, а также его аналог для тупоконечных систем — UTF-16BE. В случае их использования маркер BOM не добавляется: