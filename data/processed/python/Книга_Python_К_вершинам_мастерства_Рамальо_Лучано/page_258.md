---
source_image: page_258.png
page_number: 258
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 50.43
tokens: 11882
characters: 2112
timestamp: 2025-12-24T01:46:45.384350
finish_reason: stop
---

В CPython основной алгоритм сборки мусора основан на подсчете ссылок. В каждом объекте хранится счетчик указывающих на него ссылок — refcount. Как только этот счетчик обратится в нуль, объект сразу же уничтожается: CPython вызывает метод __del__ объекта (если он определен), а затем освобождает выделенную ему память. В CPython 2.0 был добавлен алгоритм сборки мусора, основанный на поколениях, который обнаруживает группы объектов, ссылающихся друг на друга и образующих замкнутую группу. Такие объекты могут оказаться недостижимыми, хотя в каждом из них счетчик ссылок больше нуля. В других реализациях Python применяются более сложные сборщики мусора, не опирающиеся на подсчет ссылок, а это означает, что метод __del__ может вызываться не сразу после того, как на объект не осталось ссылок. См. статью А. Jesse Jiryu Davis «PyPy, Garbage Collection, and a Deadlock» (http://bit.ly/1GsWTa7), в которой обсуждается правильное и неправильное использование метода __del__.

Для демонстрации завершения жизни объекта в примере 8.16 используется функция weakref.finalize, которая регистрирует функцию обратного вызова, вызываемую перед уничтожением объекта.

Пример 8.16. Наблюдение за гибелью объекта, на который не осталось ссылок

```python
>>> import weakref
>>> s1 = {1, 2, 3}
>>> s2 = s1    # 1
>>> def bye():    # 2
...     print('Унесен ветром...')
...
>>> ender = weakref.finalize(s1, bye)    # 3
>>> ender.alive    # 4
True
>>> del s1
>>> ender.alive    # 5
True
>>> s2 = 'spam'    # 6
Унесен ветром...
>>> ender.alive
False
```

1 s1 и s2 — синонимы, ссылающиеся на одно и то же множество {1, 2, 3}
2 Эта функция не должна быть связанным методом уничтожаемого объекта, иначе она будет хранить ссылку на него.
3 Регистрируем обратный вызов bye объекта, на который ссылается s1.
4 Атрибут .alive равен True, перед тем как вызвана функция, зарегистрированная finalize.
5 Как было сказано, del удаляет не объект, а только ссылку на него.
6 После перепривязки последней ссылки, s2, объект {1, 2, 3} оказывается недоступен. Он уничтожается, вызывается функция bye и атрибут ender.alive становится равен False.