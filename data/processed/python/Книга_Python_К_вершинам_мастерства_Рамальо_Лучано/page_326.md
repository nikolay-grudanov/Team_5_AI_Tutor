---
source_image: page_326.png
page_number: 326
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 49.83
tokens: 11971
characters: 2758
timestamp: 2025-12-24T01:49:42.714335
finish_reason: stop
---

Глава 10. Рубим, перемешиваем и нарезаем последовательности

my_vec.x. Для этого мы реализовали метод __getattr__. При этом у пользователя могло возникнуть искушение присвоить значение таким компонентам, написав my_vec.x = 7, однако это приводило к ошибке. Мы исправили ошибку, реализовав еще и метод __setattr__, запрещающий присваивать значения атрибутам с однобуквенными именами. Очень часто бывает, что методы __getattr__ и __setattr__ необходимо реализовывать совместно во избежание несогласованного поведения.

Реализация метода __hash__ предоставила нам отличную возможность воспользоваться функцией functools.reduce, поскольку необходимо было применить оператор ^ к хэшам всех компонент Vector, чтобы создать агрегированное хэш-значение объекта Vector в целом. Применив функцию reduce в методе __hash__, мы затем воспользовались встроенной функцией all для создания более эффективной версии метода __eq__.

И последним усовершенствованием класса Vector стала новая реализация метода __format__ из класса vector2d, поддерживающая гиперсферические координаты в дополнение к декартовым. Тут нам понадобились кое-какие математические формулы и несколько генераторов, но все это детали реализации (к генераторам мы еще вернемся в главе 14). В последнем разделе нашей целью было поддержать специальный формат и тем самым выполнить данное ранее обещание, что класс Vector сможет делать все, что умел vector2d, и кое-что сверх того.

Как и в главе 9, мы часто оглядывались на поведение стандартных объектов Python, стремясь имитировать его, чтобы класс Vector соответствовал духу Python.

В главе 13 мы реализуем в классе Vector несколько инфиксных операторов. Математика будет куда проще, чем в методе angle(), зато изучение работы инфиксных операторов в Python станет отличным уроком по объектно-ориентированному проектированию. Однако прежде чем заняться перегрузкой операторов, мы на время отвлечемся от разработки отдельного класса и посмотрим, как можно организовать несколько классов с помощью интерфейсов и наследования. Это темы глав 11 и 12.

Дополнительная литература

Большинство специальных методов, рассмотренных при разработке класса Vector, встречаются и в классе Vector2d из главы 9, поэтому актуальны все библиографические ссылки, приведенные в предыдущей главе.

Мощную функцию высшего порядка reduce называют также fold, accumulate, aggregate, compress и inject. Дополнительные сведения можно найти в статье из википедии «Fold (higher-order function)» (http://en.wikipedia.org/wiki/Fold_(higher-order_function)), где описаны применения этой функции с упором на функциональное программирование с рекурсивными структурами данных. В этой статье имеется также таблица, в которой перечислены похожие функции в десятках языков программирования.