---
source_image: page_280.png
page_number: 280
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 40.43
tokens: 11767
characters: 1676
timestamp: 2025-12-24T01:47:26.348944
finish_reason: stop
---

>>> format(Vector2d(1, 1), '.3er')
'<1.414e+00, 7.854e-01>'
>>> format(Vector2d(1, 1), '0.5fp')
'<1.41421, 0.78540>'

Как видно из этого раздела, совсем несложно расширить миниязык спецификации формата для поддержки пользовательских типов.

Теперь перейдем к вопросу, не относящемуся к видимому представлению: мы сделаем класс Vector2d хэшируемым, чтобы можно было создавать множества векторов и использовать векторы в качестве ключей словаря. Но прежде необходимо научиться делать векторы неизменяемыми.

Хэшируемый класс Vector2d

До сих пор экземпляры класса Vector2d не были хэшируемыми, поэтому мы не могли поместить их в множество:

>>> v1 = Vector2d(3, 4)
>>> hash(v1)
Traceback (most recent call last):
    ...
TypeError: unhashable type: 'Vector2d'
>>> set([v1])
Traceback (most recent call last):
    ...
TypeError: unhashable type: 'Vector2d'

Чтобы класс Vector2d был хэшируемым, мы должны реализовать метод __hash__ (необходим еще метод __eq__, но он у нас уже есть). Нужно также, чтобы векторы были неизменяемыми, как было сказано на врезке «Что значит "хэшируемый"?» в главе 3.

Пока ничто не мешает любому пользователю написать v1.x = 7, т. к. нигде в коде не говорится, что изменение Vector2d запрещено. Вот какое поведение мы хотим получить:

>>> v1.x, v1.y
(3.0, 4.0)
>>> v1.x = 7
Traceback (most recent call last):
    ...
AttributeError: can't set attribute

Мы добьемся этого, сделав компоненты x и y свойствами, доступными только для чтения.

Пример 9.7. vector2d_v3.py: показаны только изменения, необходимые, чтобы сделать класс Vector2d неизменяемым, полный листинг см. в примере 9.9

class Vector2d:
    typecode = 'd'

    def __init__(self, x, y):