---
source_image: page_200.png
page_number: 200
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 43.84
tokens: 11819
characters: 1933
timestamp: 2025-12-24T01:43:58.952835
finish_reason: stop
---

Глава 6. Реализация паттернов проектирования с помощью...

ция обходится дешевле экземпляра пользовательского класса и отпадает надобность в паттерне Приспособленец, потому что каждая функция-стратегия создается только один раз — когда Python компилирует модуль. Обычная функция как раз и является «разделяемым объектом, который можно использовать одновременно в нескольких контекстах».

Теперь, когда мы знаем, как реализовать паттерн Стратегия, перед нами открываются и другие возможности. Допустим, мы хотим создать «метастратегию», которая выбирает наилучшую скидку для данного объекта order. В следующих разделах мы продолжим переработку и покажем различные подходы к реализации этого требования, используя функции и модули как объекты.

Выбор наилучшей стратегии: простой подход

Используя тех же заказчиков и корзины покупок, что в примере 6.4, мы добавим еще три теста.

Пример 6.5. Функция best_promo применяет все стратегии и возвращает наибольшую скидку

>>> Order(joe, long_order, best_promo) ①
<Order total: 10.00 due: 9.30>
>>> Order(joe, banana_cart, best_promo) ②
<Order total: 30.00 due: 28.50>
>>> Order(ann, cart, best_promo) ③
<Order total: 42.00 due: 39.90>

① Для покупателя joe функция best_promo выбрала стратегию larger_order_promo.
② Здесь joe получил скидку от bulk_item_promo за заказ большого числа бананов.
③ Несмотря на очень простую корзину, best_promo дала лояльному покупателю ann скидку согласно стратегии fidelity_promo.

Реализация best_promo очень проста и показана в примере 6.6.

Пример 6.6. best_promo находит максимальную скидку, перебирая все функции

promos = [fidelity_promo, bulk_item_promo, large_order_promo] ①

def best_promo(order): ②
    """Выбрать максимально возможную скидку
    """
    return max(promo(order) for promo in promos) ③

① promos: список стратегий, реализованных в виде функций.
② best_promo получает объект Order в качестве аргумента, как и другие функции *_promo.