---
source_image: page_622.png
page_number: 622
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 48.88
tokens: 11827
characters: 2097
timestamp: 2025-12-24T02:03:48.739220
finish_reason: stop
---

На рис. 19.1 изображены классы, которые мы будем изучать в этом разделе.

![UML-диаграмма класса Record и двух его подклассов: DbRecord и Event](https://i.imgur.com/3Q5z5QG.png)

Рис. 19.1. UML-диаграмма класса Record и двух его подклассов: DbRecord и Event

Record
Метод __init__ такой же, как в файле schedule1.py (пример 19.9); метод __eq__ добавлен, чтобы упростить тестирование.

DbRecord
Подкласс Record, в который добавлены атрибут класса __db, статические методы set_db и get_db для установки и чтения этого атрибута, метод класса fetch для выборки записей из базы данных и метод экземпляра __repr__ для отладки и тестирования.

Event
Подкласс DbRecord, в который добавлены свойства venue и speakers для выборки связанных записей, а также специализированный метод __repr__.

В атрибуте класса DbRecord.__db хранится ссылка на открытую базу данных shelve.Shelf, чтобы к ней можно было обратиться из метода DbRecord.fetch и из свойств Event.venue и Event.speakers. Я сделал __db закрытым атрибутом класса с обычными методами чтения и установки, потому что хотел защитить его от случайного перезаписывания. Я не стал использовать свойства для управления атрибутом __db из-за принципиального соображения: свойства — это атрибуты класса, предназначенные для управления атрибутами экземпляра¹⁰.

Приведенный в этом разделе код находится в модуле schedule2.py в репозитории кода к этой книге (https://github.com/fluentpython/example-code). Поскольку в модуле больше 100 строк, я буду описывать его по частям¹¹.

В примере 19.11 показано начало скрипта schedule2.py.

Пример 19.11. schedule2.py: предложения импорта, константы и дополненный класс Record

import warnings

¹⁰ На сайте StackOverflow в вопросе под названием «Class-level read only properties in Python» (http://bit.ly/1cPMnNZ) приведено несколько решений проблемы доступных только для чтения атрибутов класса, в том числе предложенное Алексом Мартелли. Во всех них используются метаклассы, поэтому предварительно рекомендуется прочитать главу 21.
¹¹ Полный текст файла schedule2.py имеется в примере А.13 вместе со скриптами py.test.