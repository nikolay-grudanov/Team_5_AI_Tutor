---
source_image: page_113.png
page_number: 113
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 33.48
tokens: 11831
characters: 2079
timestamp: 2025-12-24T01:39:39.674853
finish_reason: stop
---

Под капотом dict и set

(found_key: found_value) — и тогда Python проверяет, верно ли, что search_key == found_key. Если да, то элемент найден и возвращается found_value.

Если же search_key и found_key не совпали, то имеет место коллизия хэширования. Это возможно, потому что хэш-функция отображает произвольные объекты на ограниченное количество комбинаций битов, да к тому же в индексировании хэш-таблицы принимают участие не все комбинации. Для разрешения коллизии алгоритм берет различные биты хэш-значения, производит над ними определенные действия и использует результат как смещение другой ячейки7. Если она пуста, возбуждается исключение KeyError; если нет, то либо ключи совпадают и тогда возвращается значение элемента, либо процесс разрешения коллизии повторяется. Блок-схема алгоритма показана на рис. 3.3.

![Блок-схема алгоритма поиска элемента в словаре](https://i.imgur.com/3Q5z5QG.png)

Рис. 3.3. Блок-схема алгоритма поиска элемента в словаре; для каждого ключа эта процедура либо возвращает его значение, либо возбуждает исключение KeyError

Процесс вставки или изменения элемента такой же с тем отличием, что при обнаружении пустой ячейки в нее помещается новый элемент, а если найдена ячейка с указанным ключом, то хранящееся в ней значение замещается новым.

Кроме того, в ходе вставки элемента Python может решить, что таблица слишком плотно заполнена, и перестроить ее в новой области памяти, освободив место. По мере роста хэш-таблицы растет и количество битов, используемых в качестве смещения ячейки, поэтому вероятность коллизий уменьшается.

На первый взгляд, эта реализация подразумевает большой объем работы, но даже если словарь содержит миллионы элементов, многие операции поиска завершаются вообще без коллизий, а среднее число коллизий на одну операцию находится в диапазоне от 1 до 2. В обычных обстоятельствах даже для поиска самого неудачливого ключа потребуется разрешить всего несколько коллизий.

7 С-функция, которая перетасовывает биты хэш-значения, называется perturb. Детали см. в исходном файле dictobject.c (http://bit.ly/1JzB8rA).