---
source_image: page_635.png
page_number: 635
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 47.06
tokens: 11747
characters: 1861
timestamp: 2025-12-24T02:04:19.176159
finish_reason: stop
---

Программирование фабрики свойств

1 Используем фабрику для определения первого свойства, weight, в виде атрибута класса.
2 Здесь создается второе свойство, price.
3 Здесь свойство уже работает, и поэтому попытка присвоить weight нулевое или отрицательное значение отвергается.
4 Здесь свойства также работают: с их помощью производится доступ к значениям, хранящимся в экземпляре.

Напомним, что свойства — атрибуты класса. При создании каждого свойства с помощью quantity мы должны передать имя атрибута LineItem, который будет управляться этим свойством. Необходимость дважды писать слово weight в следующей строке удручает:

weight = quantity('weight')

Но избежать такого повторения трудно, потому что свойство понятия не имеет, с каким атрибутом оно связывается. Помните: сначала вычисляется правая часть присваивания, поэтому в момент вызова функции quantity() атрибут класса price еще даже не существует.

Улучшить свойство quantity, так чтобы пользователю не приходилось дважды набирать имя атрибута, — нетривиальная задача метапрограммирования. В главе 20 мы познакомимся с обходным решением, а настоящее решение будет приведено только в главе 21, потому что в нем требуется использовать либо декоратор класса, либо метакласс.

В примере 19.24 показана реализация фабрики свойств quantity¹⁴.

Пример 19.24. bulkfood_v2prop.py: фабрика свойств quantity

def quantity(storage_name): ①
    def qty_getter(instance): ②
        return instance.__dict__[storage_name] ③
    def qty_setter(instance, value): ④
        if value > 0:
            instance.__dict__[storage_name] = value ⑤
        else:
            raise ValueError('value must be > 0')
    return property(qty_getter, qty_setter) ⑥

¹⁴ Идея кода заимствована из рецепта 9.21 «Как избежать повторения методов свойств» в книге David Beazley, Brian K. Jones «Python Cookbook», издание 3 (O'Reilly).