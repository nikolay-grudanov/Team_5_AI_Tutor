---
source_image: page_489.png
page_number: 489
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 52.94
tokens: 11943
characters: 2442
timestamp: 2025-12-24T01:57:42.818541
finish_reason: stop
---

Эволюция: от генераторов к сопрограммам

После краткого обзора использования генераторов в роли сопрограммы мы перейдем к основному материалу. Вот темы этой главы:

• поведение и состояния генератора, работающего как сопрограмма;
• автоматическая инициализация сопрограммы с помощью декоратора;
• как вызывающая программа может управлять сопрограммой с помощью методов .close() и .throw(...) объекта-генератора;
• как сопрограмма может вернуть значение по завершении;
• применение и семантика новой конструкции yield from;
• пример: использование сопрограмм для управления параллельными операциями в ходе моделирования.

Эволюция: от генераторов к сопрограммам

Инфраструктура для сопрограмм впервые была описана в документе «PEP 342 – Coroutines via Enhanced Generators» (https://www.python.org/dev/peps/pep-0342/), реализованном в версии Python 2.5 (2006): с того времени ключевое слово yield можно использовать в выражениях, а в состав API генераторов добавлен метод .send(value). С помощью метода .send(...) программа, вызывающая генератор, может отправлять данные, которые становятся значением выражения yield внутри генераторной функции. Это позволяет использовать генератор как сопрограмму: процедуру, которая взаимодействует с вызывающей стороной, принимая от нее значения и отдавая ей результаты.

Помимо .send(...), в документе PEP 342 были описаны также методы .throw(...) и .close(), позволявшие соответственно возбудить исключение, обрабатываемое в генераторе, и завершить генератор. Эти средства рассматриваются в следующем разделе и в разделе «Завершение сопрограммы и обработка исключений» ниже.

Последним этапом эволюции сопрограмм стал документ «PEP 380 – Syntax for Delegating to a Subgenerator» (https://www.python.org/dev/peps/pep-0380/), реализованный в версии Python 3.3 (2012). В нем были описаны два изменения в синтаксисе генераторных функций, призванные сделать их более полезными в качестве сопрограмм:

• генератор теперь может возвращать значение в предложении return; раньше наличие return с указанием значения внутри генератора приводило к исключению SyntaxError;
• синтаксическая конструкция yield from позволяет разбить большие и сложные генераторы на более мелкие, вложенные, одновременно избавившись от стереотипного кода, который раньше был необходим для делегирования работы субгенераторам.

Эти изменения будут рассмотрены в разделах «Возврат значения из сопрограммы» и «Использование yield from» ниже.