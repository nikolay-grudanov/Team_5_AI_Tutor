---
source_image: page_260.png
page_number: 260
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 49.65
tokens: 11871
characters: 2049
timestamp: 2025-12-24T01:46:45.384318
finish_reason: stop
---

<weakref at 0x100637598; to 'set' at 0x100636748>
>>> wref() ②
{0, 1}
>>> a_set = {2, 3, 4} ③
>>> wref() ④
{0, 1}
>>> wref() is None ⑤
False
>>> wref() is None ⑥
True

① Объект слабой ссылки wref создается, а в следующей строке инспектируется.
② Вызов wref() возвращает объект ссылки {0, 1}. Поскольку это сеанс оболочки, результат {0, 1} связывается с переменной _.
③ a_set больше не ссылается на {0, 1}, поэтому счетчик ссылок уменьшается. Но на {0, 1} все еще ссылается переменная _.
④ Вызов wref() по-прежнему возвращает {0, 1}.
⑤ В момент вычисления выражения объект {0, 1} жив, поэтому wref() не совпадает с None. Но затем _ связывается с результирующим значением False. Больше сильных ссылок на {0, 1} не осталось.
⑥ Поскольку объект {0, 1} уничтожен, этот последний вызов wref() возвращает None.

В документации по модулю weakref (http://docs.python.org/3/library/weakref.html) специально сказано, что класс weakref.ref — низкоуровневый интерфейс для особых приложений, а большинству программ хватает коллекций из модуля weakref и функции finalize. Иными словами, подумайте, не стоит ли использовать коллекции WeakKeyDictionary, WeakValueDictionary, WeakSet и функцию finalize (которые внутри себя пользуются слабыми ссылками), вместо того чтобы вручную создавать и обрабатывать экземпляры weakref.ref. В примере 8.17 мы сделали это в надежде, что демонстрация weakref.ref в действии развеет окружающую его завесу тайны. Но на практике большинство программ на Python вполне могут обойтись коллекциями из модуля weakref.

В следующем разделе мы их вкратце обсудим.

Коллекция WeakValueDictionary

Класс WeakValueDictionary реализует изменяемое отображение, в котором значениями являются слабые ссылки на объекты. Когда сборщик мусора где-то в программе уничтожает объект ссылки, соответствующий ключ автоматически удаляется из WeakValueDictionary. Обычно этот класс используется для кэширования.

Идея нашей демонстрации класса WeakValueDictionary навеяна классическим скетчем Монти Пайтон «Сырная лавка», в котором покупатель пытается купить