---
source_image: page_308.png
page_number: 308
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 41.96
tokens: 11833
characters: 1938
timestamp: 2025-12-24T01:48:49.140323
finish_reason: stop
---

314 Глава 10. Рубим, перемешиваем и нарезаем последовательности

cls = type(self) ①
if isinstance(index, slice): ②
    return cls(self._components[index]) ③
elif isinstance(index, numbers.Integral): ④
    return self._components[index] ⑤
else:
    msg = '{cls.__name__} indices must be integers'
    raise TypeError(msg.format(cls=cls)) ⑥

① Получаем класс экземпляра (т. е. Vector), он понадобится позже.
② Если аргумент index принадлежит типу slice...
③ ... то вызываем класс для построения нового экземпляра Vector по срезу массива _components.
④ Если index принадлежит типу int или другому целочисленному типу...
⑤ ... то просто возвращаем один конкретный элемент из _components.
⑥ Иначе возбуждаем исключение.

Злоупотребление функцией isinstance иногда является признаком неудачного объектно-ориентированного проектирования, но применение ее для обработки срезов в __getitem__ оправдано. Отметим, что в примере 10.6 мы сравниваем тип с numbers.Integral — абстрактным базовым классом (ABC). Указание ABC в функции isinstance делает API более гибким и защищенным относительно будущих изменений. В главе 11 объясняется, почему это так. К сожалению, в стандартной библиотеке Python 3.4 нет ABC для класса slice.

Чтобы понять, какое исключение возбуждать в ветви else в методе __getitem__, я воспользовался интерактивной оболочкой для инспекции выражения 'ABC'[1, 2]. В результате я выяснил, что интерпретатор Python возбуждает исключение TypeError, а заодно скопировал текст сообщения об ошибке: «indices must be integers». Создавая свои объекты в духе Python, имитируйте поведение объектов, которые создает сам Python.

После добавления кода из примера 10.6 в класс Vector поведение операции среза исправилось, что доказывает пример 10.7.

Пример 10.7. Тесты улучшенного метода Vector.__getitem__ из примера 10.6

>>> v7 = Vector(range(7))
>>> v7[-1] ①
6.0
>>> v7[1:4] ②
Vector([1.0, 2.0, 3.0])
>>> v7[-1:] ③
Vector([6.0])
>>> v7[1,2]