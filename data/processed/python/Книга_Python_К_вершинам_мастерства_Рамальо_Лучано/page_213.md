---
source_image: page_213.png
page_number: 213
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 38.24
tokens: 11750
characters: 1942
timestamp: 2025-12-24T01:44:26.122624
finish_reason: stop
---

Правила видимости переменных

if item.quantity >= 20:
    discount += item.total() * .1
return discount

@promotion
def large_order(order):
    """7%-ая скидка для заказов, включающих не менее 10 различных позиций"""
    distinct_items = {item.product for item in order.cart}
    if len(distinct_items) >= 10:
        return order.total() * .07
    return 0

def best_promo(order): ④
    """Выбрать максимально возможную скидку
    """
    return max(promo(order) for promo in promos)

① В начале список promos пуст.
② Декоратор promotion возвращает функцию promo_func без изменения, но добавляет ее в список promos.
③ Все функции, декорированные @promotion, добавлены в promos.
④ Функция best_promo не изменяется, поскольку зависит только от списка promos.

По сравнению с другими решениями, представленными в разделе «Практический пример: переработка паттерна Стратегия» в главе 6, у этого есть несколько преимуществ.

• Функции, реализующие стратегии вычисления скидки, не обязаны иметь специальные имена (с суффиксом _promo).
• Декоратор @promotion ясно описывает назначение декорируемой функции и без труда позволяет временно отменить предоставление ссылки: достаточно закомментировать декоратор.
• Стратегии скидки можно определить в других модулях, в любом месте системы; главное — чтобы к ним применялся декоратор @promotion

Большинство декораторов все же изменяют декорируемую функцию. Обычно для этого определяется некая внутренняя функция, которая заменяет декорируемую. Код, в котором используются внутренние функции, неизбежно опирается на замыкания. Чтобы понять, что такое замыкания, нам придется отступить назад и тщательно разобраться с тем, как в Python работают области видимости переменных.

Правила видимости переменных

В примере 7.4 мы определяем и тестируем функцию, которая читает две переменные: локальную переменную a, определенную как параметр функции, и переменную b, которая внутри функции вообще не определена.