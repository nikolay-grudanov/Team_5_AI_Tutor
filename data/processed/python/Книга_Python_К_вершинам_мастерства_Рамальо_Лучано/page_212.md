---
source_image: page_212.png
page_number: 212
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 39.48
tokens: 11789
characters: 1978
timestamp: 2025-12-24T01:44:26.754077
finish_reason: stop
---

• Функция-декоратор определена в том же модуле, что и декорируемые функции. Настоящий декоратор обычно определяется в одном модуле и применяется к функциям из других модулей.
• Декоратор register возвращает ту же функцию, что была передана в качестве аргумента. На практике декоратор обычно определяет внутреннюю функцию и возвращает именно ее.

Хотя декоратор register из примера 7.2 возвращает декорированную функцию без изменения, эта техника не бесполезна. Подобные декораторы используются во многих веб-каркасах, написанных на Python, с целью добавления функций в некий центральный реестр, например, для отображения образцов URL на функции, генерирующие HTTP-ответы. Такие регистрационные декораторы могут изменять декорируемую функцию, но это необязательно. В следующем разделе мы приведем практический пример.

Паттерн Стратегия, дополненный декоратором

Регистрационный декоратор послужит отличным дополнением к примеру применения скидки в Интернет-магазине из главы 6.

Напомним, что в примере 6.6 мы столкнулись с проблемой повторения имен функций в определениях и в списке promos, который используется функцией best_promo для вычисления максимально возможной скидки. Такое повторение плохо тем, что программист может добавить новую функцию-стратегию, забыв включить ее в список promos, и тогда best_promo молча проигнорирует новую стратегию, а в системе появится тонкая ошибка. В примере 7.3 эта проблема решается с помощью регистрационного декоратора.

Пример 7.3. Список promos заполняется декоратором promotion

promos = [] ①

def promotion(promo_func): ②
    promos.append(promo_func)
    return promo_func

@promotion ③
def fidelity(order):
    """5%-ая скидка для заказчиков, имеющих не менее 1000 баллов лояльности"""
    return order.total() * .05 if order.customer.fidelity >= 1000 else 0

@promotion
def bulk_item(order):
    """10%-ая скидка для каждой позиции LineItem, в которой заказано не менее 20 единиц"""
    discount = 0
    for item in order.cart: