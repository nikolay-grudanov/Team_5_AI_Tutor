---
source_image: page_095.png
page_number: 95
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 42.15
tokens: 11765
characters: 2017
timestamp: 2025-12-24T01:38:56.666036
finish_reason: stop
---

Метод __missing__

В основе механизма обработки отсутствия ключей в отображениях лежит метод, которому как нельзя лучше подходит имя __missing__. Он не определен в базовом классе dict, но dict знает о нем: если создать подкласс dict и реализовать в нем метод __missing__, то стандартный метод dict.__getitem__ будет обращаться к нему всякий раз, как не найдет ключ, — вместо того чтобы возбуждать исключение KeyError.

Метод __missing__ вызывается только из метода __getitem__ (т. е. при выполнении оператора d[k]). Наличие __missing__ никак не влияет на поведение других методов, которые производят поиск по ключу, например get или __contains__ (который поддерживает оператор in). Именно поэтому атрибут default_factory объекта defaultdict работает только с __getitem__, как отмечалось в предостережении в конце предыдущего раздела.

Допустим, нам нужно отображение, в котором ключ перед поиском преобразуется в тип str. Конкретный пример дает проект Pingo.io (http://www.pingo.io/docs/), в котором программируемая плата с контактами GPIO (например, Raspberry Pi или Arduino) представлена объектом board с атрибутом board.pins, который является отображением мест расположения физических контактов на объекты контактов, а физическое местоположение может задаваться числом или строкой вида "A0" либо "P9_12". Для единообразия желательно, чтобы все ключи board.pins были строками, но хорошо бы, чтобы и обращение вида my_arduino.pin[13] тоже работало, тогда начинающие не будут впадать в ступор, желая зажечь светодиод, подключенный к контакту 13 на плате Arduino. В примере 3.6 показано, как такое отображение могло бы быть реализовано.

Пример 3.6. При поиске по нестроковому ключу объект StrKeyDict0 преобразует его в тип str в случае отсутствия

Tests for item retrieval using `d[key]` notation::

>>> d = StrKeyDict0([('2', 'two'), ('4', 'four')])
>>> d['2']
'two'
>>> d[4]
'four'
>>> d[1]
Traceback (most recent call last):
...
KeyError: '1'

Tests for item retrieval using `d.get(key)` notation::

>>> d.get('2')