---
source_image: page_683.png
page_number: 683
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 73.35
tokens: 12060
characters: 2901
timestamp: 2025-12-24T02:06:49.369729
finish_reason: stop
---

Что когда происходит: этап импорта и этап выполнения

Хотя компиляция, безусловно, является действием, выполняемым на этапе импорта, на этой стадии могут происходить и другие вещи, потому что почти каждое предложение в Python является исполняемым в том смысле, что в нем может выполняться пользовательский код, изменяющий состояние программы. В частности, предложение import — не просто объявление3, оно еще и выполняет весь код, находящийся на верхнем уровне импортируемого модуля, при первом его импорте в память процесса — при последующих операциях импорта того же модуля используется кэшированный код, так что происходит только связывание имен. Этот верхнеуровневый код может делать все, что угодно, включая такие типичные для «этапа выполнения» действия, как подключение к базе данных4. Потому-то граница между «этапом импорта» и «этапом выполнения» размыта: предложение import может активировать любые действия, которые принято считать частью «этапа выполнения».

В предыдущем абзаце я написал, что на этапе импорта выполняется «весь код, находящийся на верхнем уровне импортируемого модуля», но понятие «код, находящийся на верхнем уровне» требует уточнения. Интерпретатор выполняет предложение def на верхнем уровне модуле, когда этот модуль импортируется, но что получается в результате? Интерпретатор компилирует тело функции (если данный модуль импортируется впервые) и связывает объект функции с глобальным именем, но он отнюдь не выполняет тело функции. Проще говоря, это означает, что интерпретатор определяет верхнеуровневую функцию на этапе импорта, но выполняет ее тело, когда — и если — она будет вызвана на этапе выполнения.

Для классов все выглядит по-другому: на этапе импорта интерпретатор выполняет тело каждого класса, даже классов, вложенных в другие классы. Это означает, что определяются атрибуты и методы класса, а затем строится сам объект класса. В этом смысле тело класса является «верхнеуровневым кодом»: оно выполняется на этапе импорта.

Все это довольно тонкие и абстрактные материи, поэтому ниже приведено упражнение, которое позволит разобраться, что когда происходит.

Демонстрация работы интерпретатора

Рассмотрим скрипт evaltime.py, который импортирует модуль evalsupport.py. В обоих модулях есть несколько вызовов print, в которых печатаются маркеры в формате <[N]>, где N — число. Цель следующих упражнений — определить, в какой момент производится каждый вызов.

Мои студенты говорили, что эти упражнения помогают лучше понять, как Python обрабатывает исходный код. Потратьте некоторое время, чтобы решить их на бумаге, прежде чем заглядывать в раздел «Решение упражнения 1» ниже.

3 В отличие от предложения import в Java, которое служит только объявлением, извещающим компилятор о необходимости загрузить некоторые пакеты.
4 Я не хочу сказать, что подключение к базе данных по самому факту импорта модуля — хорошая идея, а лишь отмечаю, что это возможно.