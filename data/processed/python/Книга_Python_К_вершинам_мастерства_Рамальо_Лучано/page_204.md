---
source_image: page_204.png
page_number: 204
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 47.94
tokens: 11824
characters: 2143
timestamp: 2025-12-24T01:44:17.115856
finish_reason: stop
---

Пример 6.9. В каждом объекте MacroCommand хранится внутренний список команд

class MacroCommand:
    """Команда, выполняющая список команд"""
    def __init__(self, commands):
        self.commands = list(commands) # 1

    def __call__(self):
        for command in self.commands: # 2
            command()

1 Построение списка, инициализированного аргументом commands, гарантирует, что это итерируемый объект, и сохраняет локальную копию ссылок на команды в каждом экземпляре MacroCommand.
2 При вызове экземпляра MacroCommand последовательно вызываются все команды из списка self.commands.

Для менее тривиальных применений паттерна Команда — например, для поддержки операции отмены — простой функции обратного вызова может не хватить. Но даже в этом случае Python предлагает две альтернативы, заслуживающие внимания.

• Вызываемый объект наподобие MacroCommand из примера 6.9 может хранить произвольное состояние и предоставлять другие методы в дополнение к __call__.
• Для запоминания внутреннего состояния функции между ее вызовами можно воспользоваться замыканием.

На этом мы завершаем переосмысление паттерна Команда, навеянное применением полноправных функций. На верхнем уровне этот подход близок к использованному в паттерне Стратегия: заменить вызываемыми объектами экземпляры класса-участника, реализующего интерфейс с единственным методом. Ведь любой вызываемый объект в Python и так реализует интерфейс с единственным методом, а именно методом __call__.

Резюме

Как отметил Петер Норвиг спустя два года после выхода классической книги «Паттерны проектирования»: «16 из 23 паттернов в языках Lisp и Dylan имеют существенно более простую реализацию, чем в C++, по крайней мере, в некоторых ситуациях» (слайд 9 из презентации Норвига «Паттерны проектирования в динамических языках» (http://bit.ly/1HGC0r5)). Python обладает некоторыми динамическими средствами, имеющимися в языках Lisp и Dylan, в частности, полноправными функциями, которым, в основном, и посвящена эта часть книги.

В том же выступлении на праздновании 20-й годовщины выхода «Паттернов проектирования», цитата из которого послужила эпиграфом к этой главе, Ральф