---
source_image: page_135.png
page_number: 135
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 37.26
tokens: 11771
characters: 1880
timestamp: 2025-12-24T01:40:53.047377
finish_reason: stop
---

Обработка текстовых файлов

при записи файлов в текстовом режиме, т. е. от метода my_file.read() мы получаем объекты str и их же передаем методу my_file.write(text)5.

Сэндвич Unicode

bytes → str   Декодировать байты при вводе,
100% str       обрабатывать только текст,
str → bytes    кодировать текст при выводе.

Рис. 4.2. Сэндвич Unicode – рекомендуемый способ обработки текста

Таким образом, работать с текстовыми файлами просто. Но, всегда полагаясь на кодировку по умолчанию, вы можете горько пожалеть.
Взгляните на сеанс оболочки в примере 4.9. Сможете найти ошибку?

Пример 4.9. Проблема платформенно-зависимой кодировки (выполнив этот код на своей машине, вы, возможно, наткнетесь на проблему, а, возможно, и нет)

>>> open('cafe.txt', 'w', encoding='utf_8').write('café')
4
>>> open('cafe.txt').read()
'cafÃ©'

Ошибка заключается в том, что я задал кодировку UTF-8 при записи в файл, но забыл сделать это при чтении, поэтому Python предположил, что используется системная кодировка по умолчанию — Windows 1252 — и декодировал два последних байта в файле как символы 'Ã©' вместо 'é'.

Я выполнял пример 4.9 на машине под управлением Windows 7. Те же самые предложения в последних версиях GNU/Linux и Mac OS X работают без ошибок, потому что в них по умолчанию предполагается кодировка UTF-8, и это создает ложное впечатление, будто все хорошо. Если бы мы опустили аргумент encoding при открытии файла для записи, то была бы использована местная кодировка по умолчанию, и мы правильно прочитали бы файл в той же самой кодировке. Но тогда этот скрипт генерировал бы файлы с разным байтовым содержимым на разных платформах и даже при различных настройках локали на одной и той же платформе, и мы получили бы проблему совместимости.

5 Пользователи Python 2.6 и 2.7 вынуждены использовать функцию io.open() для автоматического кодирования и декодирования при чтении-записи.