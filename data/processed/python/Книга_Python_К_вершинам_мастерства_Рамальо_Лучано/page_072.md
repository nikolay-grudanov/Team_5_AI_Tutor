---
source_image: page_072.png
page_number: 72
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 44.34
tokens: 11970
characters: 2357
timestamp: 2025-12-24T01:37:48.684171
finish_reason: stop
---

Глава 2. Массив последовательностей

Если вы часто работаете с массивами и ничего не знаете о типе memoryview, то много теряете в жизни. Читайте следующий раздел.

Представления областей памяти

Встроенный класс memoryview — это тип последовательности в общей памяти, который позволяет работать со срезами массивов, ничего не копируя. Он появился под влиянием библиотеки NumPy (которую мы вкратце обсудим ниже). Трэвис Олифант (Travis Oliphant), основной автор NumPy, на вопрос «Когда использовать memoryview?» (http://bit.ly/1Vm6C8B) отвечает так:

По существу, memoryview — это обобщенная структура массива NumPy, встроенная в сам язык Python (но без математических операций). Она позволяет разделять память между структурами данных (например, изображениями в библиотеке PIL, базами данных SQLite, массивами NumPy и т. д.) без копирования. Для больших наборов данных это очень важно.

С применением нотации, аналогичной той, что используется в модуле array, метод memoryview.cast позволяет изменить способ чтения и записи нескольких байтов в виде блоков, не перемещая ни одного бита (как оператор приведения типа в C). Метод memoryview.cast возвращает другой объект memoryview, занимающий то же самое место в памяти.

В примере 2.21 показано, как изменить один байт в массиве 16-разрядных целых чисел.

Пример 2.21. Изменение значения элемента массива путем манипуляции одним из его байтов

```python
>>> numbers = array.array('h', [-2, -1, 0, 1, 2])
>>> memv = memoryview(numbers)  # Построить объект memoryview из массива пяти целых чисел типа short signed (код типа 'h').
>>> len(memv)
5
>>> memv[0]  # memv видит те же самые 5 элементов массива.
-2
>>> memv_oct = memv.cast('B')  # Создать объект memv_oct, приведя элементы memv к коду типа 'B' (unsigned char).
>>> memv_oct.tolist()  # Экспортировать элементы memv_oct в виде списка для инспекции.
[254, 255, 255, 255, 0, 0, 1, 0, 2, 0]
>>> memv_oct[5] = 4  # Присвоить значение 4 байту со смещением 5.
>>> numbers
array('h', [-2, -1, 1024, 1, 2])  # numbers изменен
```

1 Построить объект memoryview из массива пяти целых чисел типа short signed (код типа 'h').
2 memv видит те же самые 5 элементов массива.
3 Создать объект memv_oct, приведя элементы memv к коду типа 'B' (unsigned char).
4 Экспортировать элементы memv_oct в виде списка для инспекции.
5 Присвоить значение 4 байту со смещением 5.