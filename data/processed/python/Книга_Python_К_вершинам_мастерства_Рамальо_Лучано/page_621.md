---
source_image: page_621.png
page_number: 621
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 54.16
tokens: 11819
characters: 2104
timestamp: 2025-12-24T02:03:48.048964
finish_reason: stop
---

Применение динамических атрибутов для обработки данных

(документация находится по адресу http://bit.ly/1cPLZzd, а исходный код — по адресу http://bit.ly/1cPM2uJ) и argparse.Namespace (документация — по адресу http://bit.ly/1cPM1qG, исходный код — по адресу http://bit.ly/1cPM4Ti). Я написал класс Record, чтобы проиллюстрировать существо этой идеи: обновление атрибута __dict__ экземпляра в методе __init__.

После проделанной реорганизации набора данных мы можем расширить класс Record, включив в него полезную функциональность: автоматическая выборка записей venue и speaker, на которые ссылается запись event. Примерно то же самое делает Django ORM, когда мы обращаемся к полю models.ForeignKey: вместо ключа мы получаем связанный объект модели. Для реализации этой идеи мы воспользуемся свойствами.

Выборка связанных записей с помощью свойств

Цель следующего примера такова: пусть имеется запись event, взятая с «полки», тогда чтение ее атрибута venue или speakers должно возвращать не порядковые номера, а объекты, представляющие соответствующие записи. Как это должно выглядеть, показано в следующем интерактивном примере.

Пример 19.10. Фрагмент doctest-скриптов для файла schedule2.py

```python
>>> DbRecord.set_db(db)
>>> event = DbRecord.fetch('event.33950')
>>> event
<Event 'There *Will* Be Bugs'>
>>> event.venue
<DbRecord serial='venue.1449'>
>>> event.venue.name
'Portland 251'
>>> for spkr in event.speakers:
...     print('{0.serial}: {0.name}'.format(spkr))
...
speaker.3471: Anna Martelli Ravenscroft
speaker.5199: Alex Martelli
```

1 Класс DbRecord расширяет Record, добавляя поддержку базы данных; его конструктору необходимо передать ссылку на базу.
2 Метод класса DbRecord.get выбирает записи любого типа.
3 Отметим, что event — экземпляр класса Event, расширяющего DbRecord.
4 Доступ к атрибуту event.venue возвращает экземпляр DbRecord.
5 Теперь легко найти название места проведения event.venue. Такое автоматическое разыменование и является целью данного примера.
6 Мы также можем обойти список event.speakers, извлекая объекты DbRecord, представляющие каждого докладчика.