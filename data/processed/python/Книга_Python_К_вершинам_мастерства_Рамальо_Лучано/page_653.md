---
source_image: page_653.png
page_number: 653
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 33.20
tokens: 11777
characters: 1844
timestamp: 2025-12-24T02:04:52.486795
finish_reason: stop
---

Пример дескриптора: проверка значений атрибутов

Quantity('weight'), то программа будет работать совершенно неправильно: затирать значение weight при изменении price.

Ниже представлено не очень элегантное, но работающее решение проблемы повторения имен. Есть решения получше, но они требуют либо декоратора класса, либо метакласса, поэтому я отложу их рассмотрение до главы 21.

LineItem попытка № 4: автоматическая генерация имен атрибутов хранения

Чтобы не вводить повторно имя атрибута в объявлении дескриптора, мы будем генерировать уникальную строку для storage_name в каждом экземпляре Quantity. На рис. 20.4 показана измененная UML-диаграмма классов Quantity и LineItem.

![UML-диаграмма классов Quantity и LineItem](../images/20_04.png)

Рис. 20.4. UML-диаграмма классов для примера 20.2. Теперь в классе Quantity есть оба метода get и set, а в экземплярах LineItem — атрибуты хранения со сгенерированными именами: _Quantity#0 и _Quantity#1

Для генерации storage_name мы берем общий префикс '_Quantity#' и добавляем к нему целое число: текущее значение атрибута класса Quantity.__counter, которое увеличивается на единицу всякий раз, как к классу присоединяется новый экземпляр дескриптора Quantity. Знак решетки гарантирует, что storage_name не совпадет с именем, созданным в результате применения пользователем нотации с точкой, поскольку nutmeg._Quantity#0 — недопустимый идентификатор в Python. Однако читать и устанавливать атрибуты с такими «недопустимыми» именами можно как с помощью встроенных функций getattr и setattr, так и посредством прямых манипуляций с атрибутом экземпляра __dict__. Новая реализация показана в примере 20.2.

Пример 20.2. bulkfood_v4.py: каждый дескриптор Quantity получает уникальное имя storage_name

class Quantity:
    __counter = 0  # 1

    def __init__(self):
        cls = self.__class__  # 2