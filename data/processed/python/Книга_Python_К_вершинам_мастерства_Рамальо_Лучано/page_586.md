---
source_image: page_586.png
page_number: 586
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 36.19
tokens: 11734
characters: 1869
timestamp: 2025-12-24T02:01:57.725903
finish_reason: stop
---

msg = 'OK'

if verbose and msg:
    print(cc, msg)

return Result(status, cc)

1 Получаем ссылку на объект, представляющий цикл обработки событий.
2 Первый аргумент run_in_executor — экземпляр исполнителя; если он равен None, то используется исполнитель по умолчанию, основанный на пуле потоков.
3 Остальные аргументы — вызываемый объект и его позиционные аргументы.

При тестировании примера 18.9 использование run_in_executor не дало значимого прироста производительности, поскольку файлы изображений невелики (в среднем 13 КБ). Однако эффект станет заметен, если изменить функцию save_flag в файле flags2_common.py, так чтобы она сохраняла в 10 раз больше байтов, — просто написав fp.write(img*10) вместо fp.write(img).
При среднем размере файла 130 КБ выигрыш от использования run_in_executor становится очевидным. А если вы скачиваете мегапиксельные изображения, то ускорение окажется весьма значительным.

Преимущества сопрограмм по сравнению с обратными вызовами становится несомненным, когда мы пытаемся координировать асинхронные запросы, а не просто выполнять независимые запросы. В следующем разделе объясняется, в чем состоит проблема и как ее решить.

От обратных вызовов к будущим объектам и сопрограммам

Для освоения событийно-ориентированного стиля программирования с сопрограммами придется приложить усилия, поэтому неплохо с самого начала уяснить, чем он лучше классического подхода на основе обратных вызовов. Это и есть предмет настоящего раздела.

Всякому имеющему опыт событийно-ориентированного программирования с обратными вызовами знаком термин «ад обратных вызовов»: вложенность обратных вызовов в случае, когда следующая операция зависит от результата предыдущей. Если три асинхронных вызова должны происходить в определенной последовательности, то уровень вложенности будет равен трем. В примере 18.10 показан код, написанный на JavaScript.