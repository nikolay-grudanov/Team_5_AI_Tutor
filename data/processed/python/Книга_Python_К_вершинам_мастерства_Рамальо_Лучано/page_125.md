---
source_image: page_125.png
page_number: 125
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 36.72
tokens: 11881
characters: 2093
timestamp: 2025-12-24T01:40:20.939032
finish_reason: stop
---

Структуры и представления областей памяти

Модуль struct содержит функции для разбора упакованных байтов и построения из них кортежей полей различных типов, а также для обратного преобразования из кортежа в упакованные байты. Функции из модуля struct применимы к объектам типа bytes, bytearray и memoryview.

В разделе «Представления областей памяти» на стр. 78 мы видели, что класс memoryview не позволяет ни создавать, ни сохранять последовательности байтов, но предоставляет общий доступ к областям памяти, содержащим срезы других двоичных последовательностей, упакованных массивов и буферов типа тех, что используются в библиотеке Python Imaging Library (PIL)2, не копируя ни одного байта.

В примере 4.4 показано совместное использование memoryview и struct для извлечения ширины и высоты GIF-изображения.

Пример 4.4. Использование memoryview и struct для извлечения полей из заголовка GIF-изображения

```python
>>> import struct
>>> fmt = '<3s3sHH' # 1
>>> with open('filter.gif', 'rb') as fp:
...     img = memoryview(fp.read()) # 2
...
>>> header = img[:10] # 3
>>> bytes(header) # 4
b'GIF89a\x02\xe6\x00'
>>> struct.unpack(fmt, header) # 5
(b'GIF', b'89a', 555, 230)
>>> del header # 6
>>> del img
```

1 Формат struct: < — остроконечный порядок байтов, 3s3s — две последовательности по три байта, HH — два 16-разрядных целых.
2 Создать memoryview из содержимого файла в памяти...
3 ... и еще один memoryview, представляющий собой срез первого; ни один байт при этом не копируется.
4 Преобразовать в bytes только для отображения, здесь копируется 10 байтов.
5 Распаковать memoryview в кортеж: тип, номер версии, ширина, высота.
6 Удалить ссылки, чтобы освободить память, занятую экземплярами memoryview.

Отметим, что операция получения среза memoryview возвращает новый объект memoryview без копирования байтов (Леонардо Рохаэль, один из технических рецензентов книги, указал, что можно было бы и еще уменьшить число операций копирования байтов, если воспользоваться модулем mmap для проецирования на

2 Pillow (https://pillow.readthedocs.org/en/latest/) — самый активный клон PIL.