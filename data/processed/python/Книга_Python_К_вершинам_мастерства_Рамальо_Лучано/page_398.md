---
source_image: page_398.png
page_number: 398
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 46.22
tokens: 11845
characters: 2024
timestamp: 2025-12-24T01:53:12.021660
finish_reason: stop
---

Глава 13. Перегрузка операторов: как правильно?

• специальное поведение операторов сравнения (например, ==, >, <=);
• подразумеваемая по умолчанию обработка операторов составного присваивания, например +=, и их корректная перегрузка.

Основы перегрузки операторов

У перегрузки операторов сложилась дурная репутация в некоторых кругах. Это языковое средство, которое легко использовать неправильно (что не раз происходило), а результат — недоумение программиста, ошибки и неожиданные провалы производительности. Зато при правильном употреблении мы получаем приятный API и удобочитаемый код. Python стремится найти баланс между гибкостью, удобством и безопасностью, для чего вводятся некоторые ограничения:

• запрещается перегружать операторы для встроенных типов;
• запрещается создавать новые операторы, можно только перегружать существующие;
• несколько операторов перегружать нельзя вовсе: is, and, or, not (на поразрядные операторы &, |, ~ это не распространяется).

В классе Vector из главы 10 нам уже встречался инфиксный оператор ==, поддерживаемый методом __eq__. В этой главе мы улучшим реализацию __eq__, чтобы правильнее обрабатывать операнды, типы которых отличаются от Vector. Однако операторы сравнения (==, !=, >, <, >=, <=) — это особые случаи перегрузки операторов, поэтому начнем с перегрузки четырех арифметических операторов в классе Vector: сначала унарных - и +, а затем инфиксных + и *.

Унарные операторы

В разделе 6.5 «Унарные арифметические и поразрядные операции» (http://bit.ly/1JHV4bN) справочного руководства по языку Python перечислены три унарных оператора, которые ниже показаны вместе с относящимися к ним специальными методами.

- (__neg__)
  Унарный арифметический минус. Если x равно -2, то -x == 2.

+ (__pos__)
  Унарный арифметический плюс. Обычно x == +x, но есть несколько особых случаев, когда это неверно. Если вам интересно, см. врезку «Когда x не равно +x» ниже.

~ (__invert__)
  Поразрядная инверсия целого числа, определяется как ~x == -(x+1). Если x равно 2, то ~x == -3.