---
source_image: page_602.png
page_number: 602
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 48.62
tokens: 11971
characters: 2577
timestamp: 2025-12-24T02:02:53.479789
finish_reason: stop
---

Глава 18. Применение пакета asyncio для организации...

новую сопрограмму downloader_coro, так чтобы можно было воспользоваться выражением yield from для поочередного получения результатов будущих объектов, порождаемых методом asyncio.as_completed.

Затем мы видели, как делегировать блокирующие действия — например, сохранение файла — пулу потоков с помощью метода loop.run_in_executor.

После этого мы обсудили, как сопрограммы решают основные проблемы обратных вызовов: потерю контекста при выполнении многошаговых асинхронных задач и отсутствие надлежащего контекста для обработки ошибок.

В следующем примере — получении от сервера не только изображений флагов, но и названий стран — мы продемонстрировали, как совместное использование сопрограмм и выражений yield from позволяет избежать так называемого ада обратных вызовов. Многошаговая процедура, в которой асинхронные вызовы производятся с помощью yield from, выглядит как простой последовательный код, если не обращать внимания на ключевые слова yield from.

И напоследок мы разработали на основе пакета asyncio TCP- и HTTP-версию сервера, позволяющего искать символы Unicode по имени. Описание HTTP-сервера мы завершили обсуждением важности клиентского JavaScript-кода для обеспечения более высокого уровня параллелизма на стороне сервера — за счет того, что клиент отправляет более простые запросы по мере необходимости вместо того, чтобы сразу загружать массивные HTML-страницы.

Дополнительная литература

Ник Кофлин, один из разработчиков ядра Python, в январе 2013 года сделал следующее замечание по поводу предварительного варианта документа «PEP-3156 — Asynchronous IO Support Rebooted: the "asyncio" Module» (http://bit.ly/1HGuPPE):

Где-то в начале PEP нужно поместить краткое описание следующих двух API для ожидания асинхронного объекта Future:

1. f.add_done_callback(...).
2. yield from f в сопрограмме (возобновляет сопрограмму по завершении будущего объекта, отдавая результат или исключение).

В настоящий момент эти описания закопаны среди множества других, хотя именно они дают ключ к пониманию взаимодействия всех механизмов, расположенных выше уровня цикла обработки событий11.

Гвидо ван Россум, автор документа PEP-3156 (https://www.python.org/dev/peps/pep-3156/) не прислушался к совету Кофлина. Начиная с самого документа PEP-3156, документация по пакету asyncio очень подробна, но неудобна для пользования. Девять RST-файлов, составляющих эту документацию (http://bit.

11 Замечание к PEP-3156 в сообщении, отправленном в список рассылки python-ideas 20 января 2013 (http://bit.ly/1f6DGRi).