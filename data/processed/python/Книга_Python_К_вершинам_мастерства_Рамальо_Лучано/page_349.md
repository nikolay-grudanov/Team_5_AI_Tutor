---
source_image: page_349.png
page_number: 349
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 47.90
tokens: 11984
characters: 2716
timestamp: 2025-12-24T01:50:52.307481
finish_reason: stop
---

Определение и использование ABC

ними библиотеками, которые зарегистрировали свои типы как подклассы ABC из модуля numbers. А чтобы проверка наверняка прошла, вы (или пользователи вашего API) всегда можете зарегистрировать любой совместимый тип в качестве виртуального подкласса numbers.Integral.

Если, с другой стороны, значение может быть числом с плавающей точкой, то проверка isinstance(x, numbers.Real) радостно согласится принять типы bool, int, float, fractions.Fraction и прочие не комплексные числовые типы, предоставляемые внешними библиотеками, например NumPy, при условии, что они правильно зарегистрированы.

Как это ни удивительно, тип decimal.Decimal не зарегистрирован в качестве виртуального подкласса numbers.Real. Причина в том, что если программе нужна точность типа Decimal, то следует защититься от случайного смешения таких чисел с другими, менее точными числами и, в первую очередь, с числами с плавающей точкой.

Познакомившись с некоторыми имеющимися ABC, попрактикуемся в гусиной типизации, для чего реализуем ABC с нуля и воспользуемся им. Цель не в том, чтобы очертя голову бросаться писать ABC, а в том, чтобы научиться читать исходный код ABC, находящихся в стандартной библиотеке и в других пакетах.

Определение и использование ABC

Чтобы оправдать создание абстрактного базового класса, нам необходим контекст для использования его в качестве точки расширения в каком-то каркасе. Возьмем такой контекст: пусть требуется отображать на сайте или в мобильном приложении рекламные объявления в случайном порядке, но при этом не повторять никакое объявление, пока будут показаны все остальные из имеющегося набора. Допустим, мы разрабатываем систему управления рекламой под названием ADAM. Одно из требований — поддержать предоставляемые пользователем классы случайного выбора без повторений8. Чтобы у пользователей ADAM не было сомнений, что понимается под «случайным выбором без повторений», мы определим ABC.

Позаимствовав идею у слов «стек» и «очередь» (которые описывают абстрактные интерфейсы в терминах физической организации объектов), я назову наш ABC, руководствуясь следующей метафорой из реального мира: барабаны для бинго и лотереи — это машины, предназначенные для случайного выбора элемента из конечного множества, без повторений, до полного исчерпания множества.

Наш ABC будет называться Tombola, это итальянское название игры в бинго и опрокидывающегося контейнера, в котором перемешиваются номера9.

8 Быть может, клиент захочет подвергнуть рандомизатор аудиту или рекламное агентство решит предоставить какой-то особо хитрый рандомизатор. Заранее никогда не скажешь...
9 Оксфордский словарь английского языка определяет tombola как «вид лотереи, напоминающий лото».