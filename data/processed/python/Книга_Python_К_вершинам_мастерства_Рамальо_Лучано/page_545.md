---
source_image: page_545.png
page_number: 545
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 44.28
tokens: 11866
characters: 2428
timestamp: 2025-12-24T02:00:10.446517
finish_reason: stop
---

Загрузка с индикацией хода выполнения и обработкой ошибок

если первой вызванной функции для получения результата понадобилось 10 с, а всем остальным — по 1 с, то программа будет блокирована в течение 10 с, поскольку пытается получить первый результат генератора, возвращенного функцией map. После этого все остальные результаты будут получены вообще без блокировки, потому что соответствующие функции уже завершились. Это годится, если для продолжения обработки так или иначе нужны все результаты, но часто предпочтительнее получать результаты по мере готовности вне зависимости от того, в каком порядке подавались задачи. Для этого понадобится комбинация метода Executor.submit и функции futures.as_completed, как в примере 17.4. Мы вернемся к этому приему в разделе «Использование futures.as_completed» ниже.

Комбинация Executor.submit и futures.as_completed обладает большей гибкостью, чем Executor.map, потому что ей можно по- давать различные вызываемые объекты и аргументы, тогда как executor.map предназначен для выполнения одного и того же вызываемого объекта с разными аргументами. Кроме того, множество будущих объектов, передаваемых futures.as_completed, может поступать от нескольких исполнителей — одни из них могли быть созданы экземпляром ThreadPoolExecutor, другие — экземпляром ProcessPoolExecutor.

В следующем разделе мы вернемся к программам загрузки флагов, но предъявим новые требования, которые заставят нас обходить результаты futures.as_completed вместо использования executor.map.

Загрузка с индикацией хода выполнения и обработкой ошибок

Как уже отмечалось, в скриптах из раздела «Пример: три способа загрузки из веба» нет обработки ошибок. Это сделано для того, чтобы их было проще читать и сравнивать три подхода: последовательный, многопоточный и асинхронный.

Для тестирования обработки различных ошибок я создал следующие скрипты:

flags2_common.py
Этот модуль содержит общие функции и параметры, используемые во всех flags2-скриптах, в том числе функцию main, которая занимается разбором командной строки, хронометражем и выводом результатов. Это чисто вспомогательный модуль, не имеющий прямого отношения к теме главы, поэтому его исходный код приведен только в примере A.10 в приложении А.

flags2_sequential.py
Последовательный HTTP-клиент с корректной обработкой ошибок и индикацией хода выполнения. Функция download_one из этого модуля используется также в скрипте flags2_threadpool.py.