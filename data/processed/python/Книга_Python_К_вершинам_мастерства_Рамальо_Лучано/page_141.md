---
source_image: page_141.png
page_number: 141
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 45.66
tokens: 11923
characters: 2177
timestamp: 2025-12-24T01:41:17.564356
finish_reason: stop
---

Нормализация Unicode для правильного сравнения

```python
>>> s1 = 'café'
>>> s2 = 'cafe\u0301'
>>> s1, s2
('café', 'café')
>>> len(s1), len(s2)
(4, 5)
>>> s1 == s2
False
```

Кодовая позиция U+0301 называется МОДИФИЦИРУЮЩИЙ АКУТ. Если она следует за «е», то результат отображается как «é». В стандарте Unicode последовательности вида 'é' и 'e\u0301' называются «каноническими эквивалентами» и предполагается, что приложения будут считать их одинаковыми. Но Python видит две разные последовательности кодовых позиций и одинаковыми их не считает.

Решение состоит в том, чтобы использовать нормализацию Unicode, реализуемую функцией unicodedata.normalize. Первым аргументом функции передается одна из четырех строк: 'NFC', 'NFD', 'NFKC' или 'NFKD'. Сначала рассмотрим первые две.

Форма нормализации C (NFC) производит композицию двух кодовых позиций с целью получения самой короткой эквивалентной строки, а форма нормализации D (NFD) производит декомпозицию, т. е. разложение составного символа на базовый и модифицирующие. В результате выполнения обеих нормализаций сравнение работает, как и ожидается:

```python
>>> from unicodedata import normalize
>>> s1 = 'café' # composed "e" with acute accent
>>> s2 = 'cafe\u0301' # decomposed «e» and acute accent
>>> len(s1), len(s2)
(4, 5)
>>> len(normalize('NFC', s1)), len(normalize('NFC', s2))
(4, 4)
>>> len(normalize('NFD', s1)), len(normalize('NFD', s2))
(5, 5)
>>> normalize('NFC', s1) == normalize('NFC', s2)
True
>>> normalize('NFD', s1) == normalize('NFD', s2)
True
```

Западные клавиатуры обычно генерируют составные символы, поэтому набранный пользователем текст по умолчанию оказывается в формате NFC. Но для пущей уверенности лучше прогнать строки через normalize('NFC', user_text) перед сохранением. Форма нормализации NFC рекомендуется также консорциумом W3C в документе «Character Model for the World Wide Web: String Matching and Searching (http://www.w3.org/TR/charmod-norm/).

Некоторые одиночные символы форма NFC преобразует в другие одиночные символы. Символ ома (\( \Omega \)), единицы электрического сопротивления, преобразуется в греческую букву омега в верхнем регистре. Визуально они ничем не отличают-