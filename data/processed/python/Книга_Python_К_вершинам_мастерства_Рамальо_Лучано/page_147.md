---
source_image: page_147.png
page_number: 147
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 40.51
tokens: 11746
characters: 1772
timestamp: 2025-12-24T01:41:30.146543
finish_reason: stop
---

Нормализация Unicode для правильного сравнения

1 Разложить все символы на базовые и модифицирующие.
2 Пропустить модифицирующие символы, если базовый из набора Latin.
3 В противном случае сохранить текущий символ.
4 Распознать новый базовый символ и определить, принадлежит ли он набору Latin.
5 Произвести обратную композицию.

Еще более радикальный шаг — заменить часто встречающиеся в западных текстах символы (например, фигурные кавычки, длинные тире, маркеры списков и т. д.) эквивалентными символами из набора ASCII. Этим занимается функция asciize из примера 4.17.

Пример 4.17. Преобразование некоторых западных типографических символов в ASCII (этот код также входит составной частью в модуль sanitize.py из примера 4.14)

single_map = str.maketrans("'''", "f"'^<''"'•--~>"'"", '"'"'f"*^<''"'--->""")
multi_map = str.maketrans({
    '€': '<euro>',
    '...': '...',
    'Œ': 'OE',
    '™': '(TM)',
    'œ': 'oe',
    '‰': '<per mille>',
    '‡': '**',
})
multi_map.update(single_map)
def dewinize(txt):
    """Заменить символы Win1252 символами ASCII или их последовательностями"""
    return txt.translate(multi_map)
def asciize(txt):
    no_marks = shave_marks_latin(dewinize(txt))
    no_marks = no_marks.replace('ß', 'ss')
    return unicodedata.normalize('NFKC', no_marks)

1 Построить таблицу соответствия для замены одного символа другим.
2 Построить таблицу соответствия для замены символа строкой символов.
3 Объединить таблицы соответствия.
4 Функция dewinize не изменяет символы из наборов ASCII и latin1, а затрагивает только добавления к latin1, включенные Майкрософт в набор cp1252.
5 Применить dewinize и удалить диакритические знаки.
6 Заменить эсцет на «ss» (мы не пользуемся сворачиванием регистра, потому что хотим сохранить исходный регистр).