---
source_image: page_493.png
page_number: 493
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 46.13
tokens: 11874
characters: 1988
timestamp: 2025-12-24T01:57:48.841762
finish_reason: stop
---

Пример: сопрограмма для вычисления накопительного среднего

2. my_coro2.send(28) приводит к присваиванию значения 28 переменной b, печати второго сообщения и выполнению до точки yield a + b, в которой отдается число 42.
3. my_coro2.send(99) приводит к присваиванию значения 99 переменной c, печати третьего сообщения и завершению сопрограммы.

def simple_coro2(a):
    print('-> Started: a =', a)
    b = yield a
    print('-> Received: b =', b)
    c = yield a + b
    print('-> Received: c =', c)

>>> my_coro2 = simple_coro2(14)
>>> next(my_coro2)
-> Started: a = 14
14
>>> my_coro2.send(28)
-> Received: b = 28
42
>>> my_coro2.send(99)
-> Received: c = 99
Traceback (most recent call last):
    File "<stdin>", line 1, in <module>
StopIteration

Рис. 16.1. Три стадии выполнения сопрограммы simple_coro2
(обратите внимание, что каждая стадия заканчивается выражением yield,
а следующая стадия начинается в той же строке, когда значение
выражения yield присваивается переменной)

Теперь рассмотрим чуть более сложный пример сопрограммы.

Пример: сопрограмма для вычисления накопительного среднего

При обсуждении замыканий в главе 7 мы рассматривали объект для вычисления накопительного среднего: в примере 7.8 приведен простой класс, а в примере 7.14 — функция высшего порядка, порождающая замыкание для запоминания переменных total и count между вызовами. В примере 16.3 показано, как то же самое сделать с помощью сопрограммы².

Пример 16.3. coroaverager0.py: сопрограмма для вычисления накопительного среднего

def averager():
    total = 0.0
    count = 0
    average = None
    while True:
        term = yield average
        total += term

² В основу этого примера положен фрагмент, приведенный Джекобом Холмом (Jacob Holm) в списке рассылки Python-ideas, его сообщение называется «Yield-From: Finalization guarantees» (http://bit.ly/1MMc9zy). Позже в той же ветке появились вариации на эту тему, а сам Холм объяснил ход своих мыслей в сообщении 003912 (http://bit.ly/1MMcano).