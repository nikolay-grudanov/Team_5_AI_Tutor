---
source_image: page_520.png
page_number: 520
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 44.67
tokens: 11821
characters: 2152
timestamp: 2025-12-24T01:59:01.650423
finish_reason: stop
---

Здесь DEPARTURE_INTERVAL равно 5; если num_taxis равно 3, как в демонстрационном примере, то показанные выше строчки делают то же самое, что:

taxis = {0: taxi_process(ident=0, trips=2, start_time=0),
         1: taxi_process(ident=1, trips=4, start_time=5),
         2: taxi_process(ident=2, trips=6, start_time=10)}
sim = Simulator(taxis)

Поэтому значениями в словаре taxis будут три объекта-генератора с разными параметрами. Например, такси 1 совершит 4 поездки и начнет поиск пассажиров в момент start_time=5. Этот словарь — единственный аргумент, необходимый для создания объекта Simulator.

Метод Simulator.__init__ показан в примере 16.22. Перечислим главные структуры данных Simulator:

self.events
Очередь с приоритетами PriorityQueue для хранения объектов Event.
Структура PriorityQueue позволяет помещать элементы методом put и извлекать их методом get в порядке, определяемом элементом item[0]; в случае именованных кортежей Event это атрибут time.

self.procs
Словарь dict, отображающий номер процесса на активный процесс моделирования — объект-генератор, представляющий одно такси. Он будет связан с копией словаря taxis, показанного выше.

Пример 16.22. taxi_sim.py: инициализатор класса Simulator

class Simulator:
    def __init__(self, procs_map):
        self.events = queue.PriorityQueue() ①
        self.procs = dict(procs_map) ②

① Очередь PriorityQueue для хранения запланированных событий, упорядоченная по возрастанию времени.
② Мы получаем аргумент procs_map в виде словаря (или произвольного отображения), но строим из него другой словарь, чтобы иметь локальную копию, потому что по ходу моделирования каждое такси, возвращающееся в гараж, удаляется из self.procs, а мы не хотим изменять объект, переданный пользователем.

Очереди с приоритетами — важнейшая структура данных в моделировании дискретных событий: события создаются в произвольном порядке, помещаются в очередь, а впоследствии извлекаются в порядке запланированного времени события. Например, мы могли бы в самом начале поместить в очередь такие два события:

Event(time=14, proc=0, action='pick up passenger')
Event(time=11, proc=1, action='pick up passenger')