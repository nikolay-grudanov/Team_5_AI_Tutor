---
source_image: page_695.png
page_number: 695
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 46.65
tokens: 11691
characters: 1655
timestamp: 2025-12-24T02:06:55.558441
finish_reason: stop
---

Специальный метод метакласса __prepare__

Рис. 21.4. UML-диаграмма классов, аннотированная хреновинами и штуковинами (MGN – Mills & Gizmos Notation): метахреновина EntityMeta создает хреновину LineItem. Конфигурирование дескрипторов (например, weight и price) производится в методе EntityMeta.__init__.
Обратите внимание на границу пакета model_v7

Специальный метод метакласса __prepare__

В некоторых приложениях интересно знать порядок определения атрибутов класса. Например, библиотеке для чтения и записи CSV-файлов, управляемой пользовательскими классами, возможно, необходимо сопоставить поля, объявленные в классе, с полями столбцов CSV-файла в правильном порядке.

Как мы видели, конструктор type, а равно методы метаклассов __new__ и __init__ получают тело класса, представленное в виде отображения имен на атрибуты. Однако по умолчанию это отображение является словарем dict, т. е. порядок следования атрибутов в теле класса теряется к тому моменту, когда их видит метакласс или декоратор класса.

Решение проблемы дает специальный метод __prepare__, добавленный в Python 3. Этот специальный метод относится только к метаклассам и обязан быть методом класса (т. е. должен быть снабжен декоратором @classmethod). Интерпретатор вызывает метод __prepare__ до метода __new__, чтобы тот создал отображение, которое будет заполнено атрибутами из тела класса. Первым аргументом __prepare__ получает сам метакласс, а за ним имя конструируемого класса и кортеж его базовых классов, а вернуть он должен отображение, которое будет передано в последнем аргументе методу __new__ и далее методу __init__, когда метакласс примется за построение нового класса.