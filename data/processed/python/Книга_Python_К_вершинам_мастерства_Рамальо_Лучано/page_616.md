---
source_image: page_616.png
page_number: 616
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 43.20
tokens: 11766
characters: 2002
timestamp: 2025-12-24T02:03:24.035063
finish_reason: stop
---

Глава 19. Динамические атрибуты и свойства

Как мы увидим ниже, ту же логику можно было бы реализовать не в методе класса, а в специальном методе __new__.

Гибкое создание объектов с помощью метода __new__

Мы часто называем __init__ конструктором, но это только потому, что позаимствовали терминологию из других языков. На самом деле, конструирует экземпляр специальный метод __new__. Это метод класса (однако он обрабатывается особым образом, поэтому декоратор @classmethod не используется), и возвращать он должен экземпляр. Этот экземпляр затем передается в качестве первого аргумента self методу __init__. Поскольку __init__ при вызове уже получает экземпляр, что-то возвращать ему запрещено, по существу, метод __init__ является «инициализатором». Настоящий конструктор — это метод __new__, но мы о нем редко вспоминаем, потому что реализации, унаследованной от класса object, обычно достаточно.

Описанный только что путь — от __new__ к __init__ — самый распространенный, но не единственный. Метод __new__ может возвращать и экземпляр другого класса; если такое происходит, то интерпретатор не вызывает __init__.

Иными словами, процесс построения объекта в Python можно описать следующим псевдокодом:

# псевдокод конструирования объекта
def object_maker(the_class, some_arg):
    new_object = the_class.__new__(some_arg)
    if isinstance(new_object, the_class):
        the_class.__init__(new_object, some_arg)
    return new_object

# следующие предложения приблизительно эквивалентны
x = Foo('bar')
x = object_maker(Foo, 'bar')

В примере 19.7 показан вариант класса FrozenJSON, в котором логика метода класса build перенесена в метод __new__.

Пример 19.7. explore2.py: использование __new__ вместо build для конструирования новых объектов, которые могут быть или не быть экземплярами FrozenJSON

from collections import abc

class FrozenJSON:
    """Допускающий только чтение фасад для навигации по JSON-подобному объекту с применением нотации атрибутов
    """
    def __new__(cls, arg):