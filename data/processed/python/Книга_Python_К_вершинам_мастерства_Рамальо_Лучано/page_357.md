---
source_image: page_357.png
page_number: 357
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 50.76
tokens: 11867
characters: 2424
timestamp: 2025-12-24T01:51:20.862682
finish_reason: stop
---

Определение и использование ABC

потому что аргумент iterable может быть произвольным итерируемым объектом. Однако элементы из него сохраняются во внутреннем списке, так что нам доступен метод pop. И даже если в аргументе iterable всегда передается список, вызов list(iterable) создает копию аргумента, и это хорошо, поскольку мы удаляем из списка элементы, а клиент может не ожидать, что переданный им список изменится14.

Теперь мы подходим к важнейшей динамической особенности гусиной типизации: объявлению виртуальных подклассов методом register.

Виртуальный подкласс Tombola

Важнейшая характеристика гусиной типизации, благодаря которой она и заслужила «водоплавающее» имя, — возможность регистрировать класс как виртуальный подкласс ABC, даже без наследования. При этом мы обещаем, что класс честно реализует интерфейс, определенный в ABC, а Python верит нам на слово, не производя проверку. Если мы соврем, то будем наказаны исключением во время выполнения.

Это делается путем вызова метода register абстрактного базового класса. В результате зарегистрированный класс становится виртуальным подклассом ABC и распознается в качестве такового функциями issubclass и isinstance, однако не наследует ни методы, ни атрибуты ABC.

Виртуальный подкласс не наследует ABC, для которого зарегистрированы, и проверка согласованности с интерфейсом ABC для них не производится никогда, даже в момент создания объектов. Подкласс обязуется реализовать все методы, необходимые, чтобы не возникало ошибок во время выполнения.

Метод register обычно вызывается как обычная функция (см. раздел «Использование метода register на практике» главы 11), но может использоваться и как декоратор. В примере 11.4 мы применяем синтаксис декоратора и реализуем TomboList, виртуальный подкласс Tombola, изображенный на рис. 11.5.

TomboList работает в соответствии с обещанием, а доказывающие это doctest-скрипты приведены в разделе «Как тестировались подклассы Tombola» ниже.

Пример 11.14. tombolist.py: TomboList — виртуальный подкласс Tombola

from random import randrange
from tombola import Tombola

@Tombola.register # 1
class TomboList(list): # 2

    def pick(self):
        if self: # 3
            position = randrange(len(self))
            return self.pop(position) # 4
        else:

14 Раздел «Защитное программирование при наличии изменяемых параметров» главы 8 посвящен проблемам синонимии, которых мы здесь счастливо избежали.