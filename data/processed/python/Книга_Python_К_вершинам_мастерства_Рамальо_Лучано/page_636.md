---
source_image: page_636.png
page_number: 636
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 56.51
tokens: 12043
characters: 2740
timestamp: 2025-12-24T02:04:32.196947
finish_reason: stop
---

Глава 19. Динамические атрибуты и свойства

1 Аргумент storage_name определяет, где хранятся данные свойства; в случае свойства weight данные будут храниться в атрибуте с именем 'weight'.
2 Называть первый аргумент метода qty_getter именем self было бы не совсем правильно, т. к. это не тело класса; instance ссылается на экземпляр LineItem, в котором будет храниться атрибут.
3 Метод qty_getter ссылается на storage_name, поэтому будет сохранен в замыкании этой функции; значение берется непосредственно из instance.__dict__, чтобы обойти свойство и избежать бесконечной рекурсии.
4 В определении метода qty_setter первым аргументом также является instance.
5 Значение сохраняется непосредственно в instance.__dict__, снова в обход свойства.
6 Конструируем и возвращаем объект свойства.

Особого внимания заслуживают части этого кода, связанные с использованием переменной storage_name. Когда мы реализуем свойство традиционным способом, имя атрибута, в котором хранится значение, зашито в код методов чтения и установки. Здесь же функции qty_getter и qty_setter обобщенные, им необходима переменная storage_name, чтобы знать, из какого места атрибута __dict__ экземпляра читать и в какое место записывать значение управляемого свойством атрибута. При каждом вызове фабрики quantity для порождения нового свойства переменная storage_name должна принимать уникальное значение.

Функции qty_getter и qty_setter обертываются объектом property в последней строке фабричной функции. Когда впоследствии любая из этих функций будет вызвана для выполнения своих обязанностей, она прочитает storage_name из своего замыкания и определит, откуда читать или куда записывать значение управляемого атрибута.

В примере 19.25, где я создаю и инспектирую экземпляр LineItem, видны атрибуты, в которых хранятся значения свойств.

Пример 19.25. bulkfood_v2prop.py: фабрика свойств quantity

```python
>>> nutmeg = LineItem('Moluccan nutmeg', 8, 13.95)
>>> nutmeg.weight, nutmeg.price  # Чтение weight и price с помощью свойств маскирует одноименные атрибуты экземпляра.
(8, 13.95)
>>> sorted(vars(nutmeg).items())   # Используем метод vars, чтобы проинспектировать экземпляр nutmeg: видно, в каких точно атрибутах экземпляра хранятся значения.
[('description', 'Moluccan nutmeg'), ('price', 13.95), ('weight', 8)]
```

1 Чтение weight и price с помощью свойств маскирует одноименные атрибуты экземпляра.
2 Используем метод vars, чтобы проинспектировать экземпляр nutmeg: видно, в каких точно атрибутах экземпляра хранятся значения.

Обратите внимание, как в свойствах, построенных нашей фабрикой, используется поведение, описанное в разделе «Свойства переопределяют атрибуты экземпляра» выше: свойство weight переопределяет атрибут экземпляра weight, поэто-