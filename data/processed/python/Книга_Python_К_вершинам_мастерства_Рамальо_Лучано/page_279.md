---
source_image: page_279.png
page_number: 279
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 51.92
tokens: 11840
characters: 2010
timestamp: 2025-12-24T01:47:37.442496
finish_reason: stop
---

Форматирование при выводе

При выборе буквы для специального форматного кода я стремился избежать совпадения с кодами для других типов. В мини-языке спецификации формата (http://bit.ly/1Gt4vJF) для целых чисел используются коды 'bcdoxXn', для чисел с плавающей точкой — 'eEfFgGn%', а для строк — 's'. Поэтому для полярных координат я взял код 'p'. Поскольку каждый класс интерпретирует коды независимо от остальных, использование одной и той же буквы в разных классах не является ошибкой, но может вызвать недоумение у пользователей.

Для вычисления полярных координат у нас уже есть метод __abs__, возвращающий модуль, а для получения угла напишем простой метод angle, в котором используется функция math.atan2(). Вот его код:

# в классе Vector2d
def angle(self):
    return math.atan2(self.y, self.x)

Теперь мы можем обобщить метод __format__ для вывода представления в полярных координатах.

Пример 9.6. Метод Vector2d.format, попытка № 2 — теперь и в полярных координатах

def __format__(self, fmt_spec=''):
    if fmt_spec.endswith('p'):
        fmt_spec = fmt_spec[:-1]
        coords = (abs(self), self.angle())
        outer_fmt = '<{}, {}>'  # Конфигурируем внешний формат, используя угловые скобки.
    else:
        coords = self
        outer_fmt = '({}, {})'
        components = (format(c, fmt_spec) for c in coords)
        return outer_fmt.format(*components)

1 Формат заканчивается буквой 'p': полярные координаты.
2 Удаляем суффикс 'p' из fmt_spec.
3 Строим кортеж полярных координат: (magnitude, angle).
4 Конфигурируем внешний формат, используя угловые скобки.
5 Иначе используем компоненты x, y вектора self для представления в прямоугольных координатах.
6 Конфигурируем внешний формат, используя круглые скобки.
7 Порождаем итерируемый объект, компонентами которого являются отформатированные строки.
8 Подставляем строки во внешний формат.

Ниже показаны результаты, полученные с помощью кода из примера 9.6.

>>> format(Vector2d(1, 1), 'p')
'<1.4142135623730951, 0.7853981633974483>'