---
source_image: page_149.png
page_number: 149
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 24.61
tokens: 6213
characters: 1583
timestamp: 2025-12-24T10:05:37.270949
finish_reason: stop
---

Давайте рассмотрим обновленную функцию onConsoleMessage из сценария PhantomJS (эта функция — единственное, что изменилось в нашем сценарии):

page.onConsoleMessage = function(msg) {
    var obj = JSON.parse(msg);
    if (obj.results) {
        window.setTimeout(function () {
            console.log(obj.results);
            page.render('output.png');
            phantom.exit();
        }, 200);
    } else {
        console.log(msg);
    }
};

Если не учитывать JSON-разбор консольного вывода, этот сценарий получает результаты тестирования и сразу же завершает свое выполнение. При этом вы должны гарантировать, что ничто другое (например, другие ваши тесты или тестируемый код) ничего не пишет в файл console.log!

При особом желании можно получить снимок экрана раньше, чем до/во время/после каждого теста, чтобы получить фактический ход тестирования (вы будете знать, что делает каждый тест).

В завершение нашего разговора о PhantomJS хотелось бы отметить, что PhantomJS — превосходное средство модульного тестирования во время автоматического процесса сборки. Так, во время сборки вы можете передать этому сценарию список файлов/URL, которые будут выполнены в WebKit-браузере. В то же время не забывайте, что вам нужно выполнить тестирование и в реальных браузерах перед тем, как использовать ваш код в производственной среде. Но об этом мы поговорим в следующем разделе, посвященном Selenium'у.

4.8.2. Selenium

Тестирование в реальных браузерах

Используя Selenium Remote Control (RC) или Selenium2 (WebDriver), вы можете произвести модульное тестирование в реальных бра-