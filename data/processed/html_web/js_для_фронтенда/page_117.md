---
source_image: page_117.png
page_number: 117
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 27.79
tokens: 6305
characters: 1842
timestamp: 2025-12-24T10:05:01.698606
finish_reason: stop
---

Одноадресные события

Одноадресные события вроде depositMoney в нижеприведенном коде должны иметь только одного слушателя. В этом случае слушатель должен уведомить коммутатор событий, что это событие является одноадресным, и что только он должен его прослушивать.

Когда мы будем готовы к обновлению/замене какого-либо модуля, нам нужно запустить новую версию модуля, который объявит коммутатору события, что теперь он будет единственным слушателем определенного события. Коммутатор уведомит более старый модуль, что тот будет заменен и теперь может закрыться после обработки текущих событий. В результате не будут потеряны события, будет закрыт старый модуль и введен в рабочее состояние новый модуль без перерывов в работе приложения:

eventSwitch.on('depositMoney', function(data) {
    cash += data.depositAmount;
    eventSwitch.emit('depositedMoney', cash);
}, { type: 'unicast' });

Когда мы начнем прослушивать событие depositMoney, данный код информирует коммутатор событий, что данное событие depositMoney является одноадресным и что все события с этим именем должны быть отправлены только этому слушателю. Все, что мы должны сделать, — это добавить третий параметр методу on с некоторыми метаданными о событии, который клиент будет передавать коммутатору.

Тем временем коммутатор заменит текущего слушателя для этого события новым слушателем и отправит событие «кто-то заменил вас» предыдущему слушателю (если таковой был установлен). Любой слушатель должен также прослушивать это событие:

eventHub.on('eventClient:done', function(event) {
    console.log('DONE LISTENING FOR ' + event);
    // заканчиваем обработку событий:
    process.exit(0);
});

Событие eventClient:done информирует, что этот слушатель больше не будет получать события и что как только он обработает оставшиеся события, он может безопасно завершить работу.