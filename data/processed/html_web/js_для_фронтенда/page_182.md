---
source_image: page_182.png
page_number: 182
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 31.65
tokens: 6338
characters: 1892
timestamp: 2025-12-24T10:06:24.615067
finish_reason: stop
---

Как только вы получите список модулей, для которых нужно определить значение метрики покрытия кода, следующий код сгенерирует файлы покрытия для этих модулей:

```javascript
var tempFile = PATH.join(coverageBase, PATH.basename(file));
    , realFile = require.resolve(file)
;
exec('java -jar ' + coverageJar + " -O " + tempFile + " " + realFile
    , function(err) {
        FILES_FOR_COVERAGE[keep] = 1;
    });
```

Данный код «проходит» по результатам регулярного выражения, запрашивая Node.js, где находится тот или иной файл, и запуская утилиту покрытия кода YUI.

Последнее, что мы должны сделать, — выполнить тесты на инструментированных версиях файлов и сохранить полученные результаты о покрытии кода. При этом переменная yuitest_coverage является объектом JavaScript, который должен быть преобразован в формат JSON и сохранен. В завершение его можно преобразовать в формат LCOV, и по этому формату может быть сгенерирован симпатичный HTML-код. На этом можно считать, что наша задача выполнена:

```javascript
var coverOutFile = 'cover.json';
fs.writeFileSync(coverOutFile, JSON.stringify(_yuitest_coverage));
exec([ 'java', '-jar', coverageReportJar, '--format', 'lcov', '-o'
    , dirname, coverOutFile ].join(' '), function(err, stdout, stderr) {
});
```

В принципе, есть много разных способов получения информации о покрытии кода с использованием Node.js. Для широты кругозора рассмотрим еще один, основанный на использовании расширений. По умолчанию загрузчик Node.js «понимает» три вида расширений файлов — .js, .json и .node. При поиске загрузчиком Node.js файла для загрузки будут использоваться эти расширения, если расширение файла не было предоставлено явно. Из-за синхронной природы загрузчика мы, к сожалению, не можем динамически генерировать информацию о покрытии во время загрузки, таким образом, мы все еще нуждаемся в приеме require ('модуль', true), чтобы опреде-