---
source_image: page_183.png
page_number: 183
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 29.76
tokens: 6301
characters: 1778
timestamp: 2025-12-24T10:06:22.770480
finish_reason: stop
---

лить, для каких файлов нужно предварительно создать файлы покрытия. Напомню, что инструкция require используется для указания, нужно ли для модуля, заданного в первом параметре, создавать файл покрытия. Если второй параметр равен true, будет создан файл покрытия.

Если второй параметр require не задан, тогда инструкция require используется для загрузки файла покрытия. Мы можем указать полный путь к файлу покрытия, но чтобы было понятнее, что мы загружаем именно файл покрытия, мы рекомендуем для таких файлов использовать расширение .cover.

Также нам нужно вывести сгенерированный файл покрытия в тот же каталог, что и исходный файл, и назначить ему новое расширение, чтобы исходный загрузчик загрузил его для нас. Давайте сделаем это. Для начала заглянем в наш тестовый сценарий:

require('./src/myModule.cover');

Этот оператор загрузит файл покрытия для нашего файла (то есть для файла модуля myModule.js используется файл покрытия myModule.cover). Регулярное выражение в свою очередь будет изменено так:

/require\s*\(\s*["']([^\"]+)\.cover["']\)/g

Как только что было сказано, мы договорились хранить вместе исходные файлы и их файлы покрытия. Поэтому при создании файла покрытия вместо его дампа в coverageBase (обычно это каталог /tmp) мы просто помещаем его в каталог, в котором находится исходный файл, но используем расширение .cover:

var realFile = require.resolve(file)
    , coverFile = realFile.replace('.js', '.cover');
exec('java -jar ' + coverageJar + " -o " + coverFile + " " + realFile,
    function(err) {});

Нам больше не нужно отслеживать, для каких файлов созданы файлы покрытия, поскольку загрузчик загрузит нужный файл в зависимости от расширения.

Наконец, мы говорим загрузчику, что он должен сделать, когда встретит файл с расширением .cover: