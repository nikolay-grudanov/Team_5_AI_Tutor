---
source_image: page_027.png
page_number: 27
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 47.78
tokens: 7711
characters: 2419
timestamp: 2025-12-24T09:54:47.677553
finish_reason: stop
---

Как работают большие целые числа

Реализация, представляемая в этой книге, не была оптимизирована в области скорости или лаконичности, вместо этого вся ее оптимизация была направлена на объяснимость. Я хочу представить полную библиотеку, не отведя на это слишком много страниц.

Я собираюсь хранить большие целые числа в массивах. Массивы — удачный выбор, поскольку они могут иметь любой размер. (Неплохим вариантом станут строки, в которых каждый символ может рассматриваться как 16-разрядное целое число без знака.) В каждом элементе массива хранится число, содержащее разряды большого целого числа. Важный конструктивный вопрос: сколько разрядов будет приходиться на один элемент? Ответ: максимум 53, размер положительного безопасного целого числа. Язык подсказывает, что разумнее выбрать 32 разряда или еще меньше, поскольку это позволит задействовать поразрядные операторы. Если размер нашего слова будет больше 32 разрядов, тогда поразрядные операторы не смогут использоваться и реализация усложнится.

Но, учитывая потребности в умножении и делении, и 32 разряда будут слишком большой величиной. При реализации умножения и деления больших целых чисел хотелось бы использовать оператор умножения JavaScript, сохраняющий точность только до 53 разрядов. Это означает, что размер нашего слова должен быть не более половины этой величины. Я выбрал 24 разряда. Мог бы остановиться и на 26, но мне нравится число 24, оно мне ближе. (Моя первая программа работала на 24-разрядной универсальной машине Control Data Corporation 3150.) Назовем эти 24-разрядные блоки мегацифрами, потому что они могут представлять более чем в миллион раз больше значений, чем обычные цифры.

Я выбрал представление числовой величины со знаком. Нулевой элемент массива содержит знак числа — либо «+», либо «−». В первом элементе содержатся наименее значимые мегацифры. В последнем элементе — наиболее значимые мегацифры. В результате 90000000000000000000 будет выглядеть так:

["+", 8650752, 7098594, 31974]

Особой красоты в этом представлении нет, но оно работает, поскольку:

90000000000000000000 = 8650752 + ((7098594 + (31974 * 16777216)) * 16777216)

Чтобы легче было добраться до внутреннего устройства большого целого числа, я создал константы и функции.

const radix = 16777216;
const radix_squared = radix * radix;
const log2_radix = 24;
const plus = "+";
const minus = "-";
const sign = 0;
const least = 1;

function last(array) {