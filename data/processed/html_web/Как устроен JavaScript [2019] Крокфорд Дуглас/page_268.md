---
source_image: page_268.png
page_number: 268
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 29.34
tokens: 7361
characters: 1553
timestamp: 2025-12-24T10:00:47.128087
finish_reason: stop
---

Глава 28

Как работает генерация кода

Отвлекись от всего, Нео. Страх, сомнения и неверие отбрось. Освободи свой разум.

Морфеус

Следующий шаг заключается в том, чтобы взять дерево, сплетенное парсером, и превратить его в исполняемую форму. Это называется генерацией кода, но на самом деле это преобразование.

У нас богатый выбор целевых языков. Можно создать машинный код или код для виртуальной машины либо другого языка программирования. Имея подходящую среду выполнения, мы могли бы нацелиться на язык C, но собираемся ориентироваться на JavaScript.

JavaScript — на удивление удачный целевой язык. Он обеспечивает замечательный (и невидимый) механизм управления памятью, который зачастую является наиболее сложным аспектом доводки нового языка. Генерация кода для реальной машины может потребовать управления ограниченным набором регистров. JavaScript позволяет иметь какие угодно переменные. Объекты — это универсальная структура данных. За объекты JavaScript достоин гораздо более существенных похвал.

Начнем с создания некоторых наборов. Нам нужны наборы, производящие булевые значения и зарезервированные слова JavaScript.

function make_set(array, value = true) {
    const object = Object.create(null);
    array.forEach(function (element) {
        object[element] = value;
    });
    return $NEO.stone(object);
}

const boolean_operator = make_set([
    "array?", "boolean?", "function?", "integer?", "not", "number?", "record?",
    "stone?", "text?", "true", "=", "#", "<", ">", "≤", "≥", "/\\", "\\/"
]);

const reserved = make_set([