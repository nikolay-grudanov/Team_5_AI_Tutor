---
source_image: page_148.png
page_number: 148
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 30.37
tokens: 7445
characters: 1830
timestamp: 2025-12-24T09:57:37.340160
finish_reason: stop
---

Глава 18

Как работают концевые вызовы

Бывает момент, когда настоящий мужчина должен взять быка за рога и достойно справиться со сложившейся ситуацией.

У. К. Филдс (W. C. Fields)

Ускорение наших программ зависит от оптимизации наших систем. Оптимизация — это ломка правил, но при этом отход от них должен быть таким, чтобы она не прослеживалась. В результате оптимизации хорошая программа не должна превращаться в плохую. Оптимизация не должна привносить ошибки.

Самое важное в оптимизации не только то, что она не добавляет ошибок, но и то, что она избавляет хорошие программы от целого класса ошибок, привнося новые парадигмы программирования. Я имею в виду оптимизацию концевых вызовов (Tail Call Optimization). Некоторые специалисты придают этой оптимизации настолько большое значение, что призывают не умалять его, называя данный прием оптимизацией. Они назвали его правильным концевым вызовом (Proper Tail Calls). Любой другой способ реализации концевых вызовов считается неправильным.

Я предпочитаю называть это оптимизацией, поскольку основная масса программистов не придает особого значения правильности, но любит оптимизацию, даже если она не дает ощутимого эффекта. Я же хочу, чтобы у них возникло желание пользоваться этим приемом.

Концевой вызов получается, когда своим последним действием функция возвращает результат вызова функции. В следующем примере continuize — это фабрика, получающая тип функции any и возвращающая функцию hero. Функция hero вызывает any и передает возвращаемое значение функции continuation:

function continuize(any) {
    return function hero(continuation, ...args) {
        return continuation(any(...args)); // <!-- концевой вызов
    };
}

Когда функция возвращает результат вызова функции, мы называем этот вызов концевым. Плохо, что мы называем его концевым, а не возвращающим.