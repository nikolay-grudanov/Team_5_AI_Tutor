---
source_image: page_280.png
page_number: 280
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 31.25
tokens: 7346
characters: 1464
timestamp: 2025-12-24T10:01:05.394319
finish_reason: stop
---

Глава 29

Как работает среда выполнения

Я знаю, почему ты здесь, Нео. Знаю, что тебя гнетет...
Почему ты плохо спишь, почему живешь один
и почему ночи напролет сидишь за компьютером.

Тринити

Среда выполнения — это программное средство, поддерживающее выполнение программ. Популярность JavaScript в качестве цели для транспиляции отчасти обусловлена качеством поддержки, предоставляемой этим языком во время их выполнения. Если семантика исходного языка отличается от целевой, должна быть добавлена специализированная поддержка среды выполнения. Форма среды выполнения Neo в JavaScript — это объект, содержащий функции, помогающие выполнению программ.

Два наиболее существенных семантических улучшения Neo — это усовершенствованные тип чисел и объект. Разработка числового типа была показана в главе 4. Записи языка Neo объединяют объекты и weakmap-коллекции. Подведем итоги.

• Ключом может быть текст, запись или массив. Перечислить с помощью функции array реально только текстовые ключи.
• Значение null приводит к удалению поля.
• Выражения пути с отсутствующими объектами не вызывают сбой — они выдают null.
• Массивы в качестве ключей принимают только целые числа и обеспечивают соблюдение их границ.

Начнем с централизованной функции fail.

function fail(what = "fail") {
    throw new Error(what);
}

Единственная переменная, сохраняющая состояние в этом файле, — это weakmap_of_weakmaps. Она связывает weakmap-коллекции с записями. Большинству записей