---
source_image: page_385.png
page_number: 385
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 62.15
tokens: 11494
characters: 1917
timestamp: 2025-12-24T06:38:39.909511
finish_reason: stop
---

В-Tree-Insert-Nonfull(x, k)

1   i ← n[x]
2   if leaf[x]
3   then while i ≥ 1 and k < key_i[x]
4       do key_{i+1}[x] ← key_i[x]
5       i ← i - 1
6       key_{i+1}[x] ← k
7       n[x] ← n[x] + 1
8       Disk-Write(x)
9   else while i ≥ 1 and k < key_i[x]
10      do i ← i - 1
11      i ← i + 1
12      Disk-Read(c_i[x])
13      if n[c_i[x]] = 2t - 1
14         then B-Tree-Split-Child(x, i, c_i[x])
15         if k > key_i[x]
16            then i ← i + 1
17      B-Tree-Insert-Nonfull(c_i[x], k)

Эта процедура работает следующим образом. Если вершина x — лист, то ключ k в него добавляется (строки 3–8; напомним, что вершина x предполагается неполной). В противном случае нам нужно добавить k к поддереву, корень которого является ребёнком x. В строках 9–11 мы находим нужного ребёнка вершины x. Если этот ребёнок оказывается полной вершиной (строка 13), то в строке 14 он разделяется на две неполных вершины, и в строках 15–16 определяется, в какое из новых поддеревьев следует добавить k. (Заметим, что после изменения i в строке 16 нет необходимости обращаться к диску — вновь созданная вершина, к которой мы обратимся в строке 17, уже находится в оперативной памяти.) Таким образом, мы знаем, что вершина c_i[x] — неполная, и в строке 17 добавляем ключ k в соответствующее поддерево с помощью рекурсивного вызова процедуры B-Tree-Insert-Nonfull. На рис. 19.7 показаны разные случаи добавления элемента в Б-дерево.

Процедура B-Tree-Insert-Nonfull использует O(1) операций Disk-Read и Disk-Write (если не считать рекурсивного вызова). Следовательно, для Б-дерева высоты h процедура B-Tree-Insert обращается к диску O(h) раз. Время вычислений есть O(th) = O(t \log_t h). В процедуре B-Tree-Insert-Nonfull рекурсивный вызов является последним оператором (tail recursion), и поэтому мы могли бы заменить рекурсию циклом. Отсюда видно, что число секторов, которые необходимо держать в оперативной памяти, есть O(1).