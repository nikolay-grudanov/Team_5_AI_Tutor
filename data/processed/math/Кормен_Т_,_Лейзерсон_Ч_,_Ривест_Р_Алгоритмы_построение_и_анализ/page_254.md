---
source_image: page_254.png
page_number: 254
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 82.66
tokens: 11866
characters: 2766
timestamp: 2025-12-24T06:32:33.764027
finish_reason: stop
---

Тогда ключи на пути из корня в \( k_j \) — в точности \( G_j \cup L_j \), а глубина \( k_j \) в дереве \( T \) равна

\[
d(k_j, T) = |G_j| + |L_j|.
\]

На рисунке 13.5 изображены множества \( G_j \) и \( L_j \). Их построение можно объяснить так. Считая для наглядности ключи числами, будем отмечать их на числовой оси: сначала \( k_1 \), потом \( k_2 \) и так далее вплоть до \( k_j \). В каждый момент на оси отмечено несколько точек \( k_1, \ldots, k_t \) (где \( 1 \leq t \leq j-1 \)). Посмотрим, какая из этих точек будет ближайшей справа к будущему положению ключа \( k_j \). Множество всех таких ближайших точек (для всех моментов времени \( t = 1, 2, \ldots, j-1 \)) и есть \( G_j \). Ближайшие слева точки образуют множество \( L_j \).

Наша цель — оценить сверху количество элементов в \( G_j \) и \( L_j \), поскольку сумма этих количеств равна глубине ключа \( k_j \). Фиксируем некоторое \( j \). Число элементов в \( G_j \) будет случайной величиной, зависящей от порядка ключей на входе (имеет значение лишь порядок на ключах \( k_1, \ldots, k_j \)). Мы хотим оценить это число сверху (доказать, что вероятность события "это число велико" мала).

Следующий факт из теории вероятностей играет центральную роль при этой оценке.

**Лемма 13.5.** Пусть \( k_1, k_2, \ldots, k_n \) есть случайная перестановка \( n \) различных чисел. Для каждого \( i \) от 1 до \( n \) рассмотрим минимальный элемент в множестве \( \{k_1, k_2, \ldots, k_i\} \). Множество всех таких элементов назовём \( S \):

\[
S = \{k_i : 1 \leq i \leq n \text{ и } k_l > k_i \text{ для всех } l < i\}.
\] (13.1)

Тогда \( \mathbb{P}\{|S| \geq (\beta + 1)H_n\} \leq 1/n^2 \), где \( H_n \) — \( n \)-я частичная сумма гармонического ряда, а \( \beta \approx 4,32 \) — корень уравнения \( (\ln \beta - 1)\beta = 2 \).

**Доказательство.** Будем следить за тем, как меняется множество \( \{k_1, \ldots, k_i\} \) с ростом \( i \). На \( i \)-м шаге к нему добавляется элемент \( k_i \), причём он с равными вероятностями может оказаться первым, вторым,..., \( i \)-м по величине (каждой из этих возможностей соответствует равная доля входных перестановок). Таким образом, вероятность увеличения множества \( S \) на \( i \)-м шаге равна \( 1/i \) при любом порядке среди ключей \( k_1, \ldots, k_{i-1} \), так что для разных \( i \) эти события независимы.

Мы приходим к ситуации, описанной в теореме 6.6: имеется последовательность независимых испытаний, вероятность успеха в \( i \)-м испытании равна \( 1/i \). Нам надо оценить число успехов.

Математическое ожидание этого числа равно \( 1 + 1/2 + \ldots + 1/i = H_i = \ln i + O(1) \), см. формулу (3.5) и задачу 6-2. Нам надо оценить вероятность того, что число успехов больше своего математического ожидания в \( \beta + 1 \) раз.