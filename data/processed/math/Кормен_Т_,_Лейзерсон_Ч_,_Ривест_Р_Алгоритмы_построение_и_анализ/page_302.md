---
source_image: page_302.png
page_number: 302
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 57.16
tokens: 11539
characters: 2086
timestamp: 2025-12-24T06:34:27.729177
finish_reason: stop
---

Умножение может происходить на границе между k-й и (k + 1)-й матрицами. До этого мы отдельно вычисляем произведение первых k и остальных n − k матриц. Поэтому

\[
P(n) = \begin{cases}
1, & \text{если } n = 1, \\
\sum_{k=1}^{n-1} P(k)P(n-k), & \text{если } n \geq 2.
\end{cases}
\]

В задаче 13-4 мы просили вас доказать, что это соотношение задаёт последовательность чисел Каталана

\[
P(n) = C(n-1),
\]

где

\[
C(n) = \frac{1}{n+1} C_{2n}^n = \Omega(4^n / n^{3/2}).
\]

Стало быть, число решений экспоненциально зависит от n, так что полный перебор неэффективен. [Другой способ понять, что число вариантов экспоненциально: разобьём матрицы на группы по три; произведение для каждой группы можно вычислить двумя способами, так что для 3n матриц есть не менее \(2^n\) вариантов.]

Шаг 1: строение оптимальной расстановки скобок

Если мы собираемся воспользоваться динамическим программированием, то для начала должны описать строение оптимальных решений. Для задачи об умножении последовательности матриц это выглядит следующим образом. Обозначим для удобства через \(A_{i..j}\) матрицу, являющуюся произведением \(A_i A_{i+1} ... A_j\). Оптимальная расстановка скобок в произведении \(A_1 A_2 ... A_n\) разрывает последовательность между \(A_k\) и \(A_{k+1}\) для некоторого k, удовлетворяющего неравенству \(1 \leq k < n\). Иными словами, при вычислении произведения, диктуемом этой расстановкой скобок, мы сначала вычисляем произведения \(A_{1..k}\) и \(A_{k+1..n}\), а затем перемножаем их и получаем окончательный ответ \(A_{1..n}\). Стало быть, стоимость этой оптимальной расстановки равна стоимости вычисления матрицы \(A_{1..k}\), плюс стоимость вычисления матрицы \(A_{k+1..n}\), плюс стоимость перемножения этих двух матриц.

Чем меньше умножений нам потребуется для вычисления \(A_{1..k}\) и \(A_{k+1..n}\), тем меньше будет общее число умножений. Стало быть, оптимальное решение задачи о перемножении последовательности матриц содержит оптимальные решения задач о перемножении её частей. Как мы увидим в разделе 16.2, это и позволяет применить динамическое программирование.