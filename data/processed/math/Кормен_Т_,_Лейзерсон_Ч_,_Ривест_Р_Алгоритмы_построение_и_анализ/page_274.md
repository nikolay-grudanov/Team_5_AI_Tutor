---
source_image: page_274.png
page_number: 274
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 92.79
tokens: 11920
characters: 3098
timestamp: 2025-12-24T06:33:46.452063
finish_reason: stop
---

**Глава 14 Красно-чёрные деревья**

свойство остаётся верным.

Цикл завершается, если (1) \( x \) указывает на красную вершину (тогда мы в строке 23 красим её в чёрный цвет) или если (2) \( x \) указывает на корень (тогда лишняя чернота может быть просто удалена из дерева). Может оказаться также, что (3) внутри тела цикла удаётся выполнить несколько вращений и перекрасить несколько вершин, после чего дважды чёрная вершина исчезнет. В этом случае присваивание \( x \leftarrow root[T] \) позволяет выйти из цикла.

Внутри цикла \( x \) указывает на дважды чёрную вершину, не являющуюся корнем. В строке 2 мы определяем, каким ребёнком является \( x \) — левым или правым. (Подробно выписана часть процедуры для первого случая, второй случай симметричен и скрыт в строке 22.) Переменная \( w \) (строка 3) указывает на второго ребёнка вершины \( p[x] \) ("брата" вершины \( x \)). Так как вершина \( x \) — дважды чёрная, \( w \) не может быть равно \( nil[T] \), поскольку в этом случае вдоль одного пути от \( p[x] \) вниз (через \( w \)) было бы меньше чёрных вершин, чем вдоль другого (через \( x \)).

Четыре возможных случая показаны на рис. 14.7. Прежде чем разбираться с ними детально, посмотрим, как проверить, что преобразования не нарушают свойство 4. Достаточно убедиться, что количество чёрных вершин от корня показанного поддерева до каждого из поддеревьев \( \alpha, \beta, \ldots, \zeta \) не изменилось. Например, на рис. 14.7а, иллюстрирующем случай 1, количество чёрных вершин от корня до каждого из поддеревьев \( \alpha \) и \( \beta \) равно 3 как до, так и после преобразования. (Напомним, что вершина \( x \) считается за две.) Аналогично, количество чёрных вершин от корня до \( \gamma, \delta, \varepsilon \) и \( \zeta \), равно 2 до и после преобразования. На рис. 14.7б вершина \( B \) может быть и чёрной, и красной. Если она красная, то число чёрных вершин от корня до \( \alpha \) (до и после преобразования) равно 2, если чёрная — то 3. Остальные случаи проверяются аналогично (упр. 14.4-5).

Итак, рассмотрим все случаи по порядку. Случай 1 (строки 5–8 процедуры RB-DELETE-FIXUP, рис. 14.7а) имеет место, когда вершина \( w \), брат \( x \), красная (в этом случае их родитель, \( p[x] \), чёрный). Так как оба ребёнка вершины \( w \) чёрные, мы можем поменять цвета \( w \) и \( p[x] \) и произвести левое вращение вокруг \( p[x] \), не нарушая RB-свойств. Вершина \( x \) остаётся дважды чёрной, а её новый брат — чёрный, так что мы свели дело к одному из случаев 2, 3 или 4.

Если вершина \( w \) чёрная, имеет место один из случаев 2–4. Они различаются между собой цветом детей вершины \( w \). В случае 2 (строки 10–11, рис. 14.7б) оба ребёнка вершины \( w \) чёрные. Так как вершина \( w \) тоже чёрная, мы можем снять чёрную окраску с \( x \) (лишнюю) и с \( w \) (сделав её красной), и добавить черноту родителю, \( p[x] \). После этого продолжим выполнение цикла. Заметим, что если мы попали в случай 2 из случая 1, то вершина \( p[x] \) — красная, поэтому цикл сразу же завершится (добавив чёрного к красной вершине, мы красим её в обычный чёрный цвет).