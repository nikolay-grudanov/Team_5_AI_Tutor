---
source_image: page_529.png
page_number: 529
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 64.56
tokens: 11856
characters: 2452
timestamp: 2025-12-24T06:45:34.455101
finish_reason: stop
---

найти вес этого пути, зная веса всех таких путей (для всех пар вершин) для меньших \( k \)?

Для пути \( p \) есть две возможности.

Если \( k \) не входит в \( p \), все промежуточные вершины пути \( p \) содержатся в множестве \( \{1, 2, \ldots, k-1\} \). Тогда путь \( p \) является кратчайшим путём из \( i \) в \( j \), промежуточные вершины которого принадлежат множеству \( \{1, 2, \ldots, k-1\} \).

Если \( k \) является промежуточной вершиной пути \( p \), она разбивает его на два участка \( p_1 \) и \( p_2 \) (вершина \( k \) встречается лишь однажды, так как \( p \) — простой путь), см. рис. 26.3. По лемме 25.1 путь \( p_1 \) будет кратчайшим путём из \( i \) в \( k \) с промежуточными вершинами из множества \( \{1, 2, \ldots, k-1\} \). Путь \( p_2 \) является кратчайшим путём из \( k \) в \( j \) с промежуточными вершинами из множества \( \{1, 2, \ldots, k-1\} \).

Рекурентная формула для длин кратчайших путей

Эти рассуждения позволяют написать другую (по сравнению с приведённой в разделе 26.1) рекурентную формулу для длин кратчайших путей. Обозначим через \( d_{ij}^{(k)} \) вес кратчайшего пути из вершины \( i \) в вершину \( j \) с промежуточными вершинами из множества \( \{1, 2, \ldots, k\} \). При \( k = 0 \) промежуточных вершин нет вовсе, поэтому \( d_{ij}^{(0)} = w_{ij} \). В общем случае

\[
d_{ij}^{(k)} = \begin{cases}
w_{ij} & \text{если } k = 0, \\
\min(d_{ij}^{(k-1)}, d_{ik}^{(k-1)} + d_{kj}^{(k-1)}) & \text{если } k \geq 1.
\end{cases}
\]

Матрица \( D^{(n)} = (d_{ij}^{(n)}) \) содержит искомое решение. Другими словами, \( d_{ij}^{(n)} = \delta(i, j) \) для всех \( i, j \in V \), поскольку разрешены любые промежуточные вершины.

Вычисление кратчайших путей снизу вверх

Напишем процедуру, которая вычисляет веса кратчайших путей, последовательно находя значения \( d_{ij}^{(k)} \) для \( k = 1, 2, \ldots, n \). Её входом является матрица \( W \) размером \( n \times n \) (веса рёбер графа), результатом является матрица \( D^{(n)} \) весов кратчайших путей.

{\sc Floyd-Warshall}$(W)$\\
\verb|1 |$n \leftarrow rows[W]|\\
\verb|2 |$D^{(0)} \leftarrow W|\\
\verb|3 |for $k \leftarrow 1$ to $n$|\\
\verb|4 |do for $i \leftarrow 1$ to $n$|\\
\verb|5 |do for $j \leftarrow 1$ to $n$|\\
\verb|6 |$d^{(k)}_{ij} \leftarrow \min(d^{(k-1)}_{ij}, d^{(k-1)}_{ik} + d^{(k-1)}_{kj})$|\\
\verb|7 |return $D^{(n)}$|

На рисунке 26.4 показан ориентированный граф и матрицы \( D^{(k)} \), вычисляемые этим алгоритмом.