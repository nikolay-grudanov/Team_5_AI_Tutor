---
source_image: page_301.png
page_number: 301
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 71.30
tokens: 11736
characters: 2428
timestamp: 2025-12-24T06:34:36.978420
finish_reason: stop
---

MATRIX-MULTIPLY(A, B)
1 if columns[A] ≠ rows[B]
2 then error "умножить нельзя"
3 else for i ← 1 to rows[A]
4     do for j ← 1 to columns[B]
5         do C[i, j] ← 0
6         for k ← 1 to columns[A]
7             do C[i, j] ← C[i, j] + A[i, k] · B[k, j]
8 return C

Матрицы \(A\) и \(B\) можно перемножать, только если число столбцов у \(A\) равно числу строк у \(B\). Если \(A\) — это \(p \times q\)-матрица, а \(B\) — это \(q \times r\)-матрица, то их произведение \(C\) является \(p \times r\)-матрицей. При выполнении этого алгоритма делается \(pq r\) умножений (строка 7) и примерно столько же сложений. Для простоты мы будем учитывать только умножения. [В главе 31 приведён алгоритм Штрассена, требующий меньшего числа умножений. В этой главе мы принимаем как данность простейший способ умножения матриц и ищем оптимум за счёт расстановки скобок.]

Чтобы увидеть, как расстановка скобок может влиять на стоимость, рассмотрим последовательность из трех матриц \(\langle A_1, A_2, A_3 \rangle\) размеров \(10 \times 100, 100 \times 5\) и \(5 \times 50\) соответственно. При вычислении \(((A_1 A_2) A_3)\) нужно \(10 \cdot 100 \cdot 5 = 5000\) умножений, чтобы найти \(10 \times 5\)-матрицу \(A_1 A_2\), а затем \(10 \cdot 5 \cdot 50 = 2500\) умножений, чтобы умножить эту матрицу на \(A_3\). Всего 7500 умножений. При расстановке скобок \((A_1 (A_2 A_3))\) мы делаем \(100 \times 5 \times 50 = 25000\) умножений для нахождения \(100 \times 50\)-матрицы \(A_2 A_3\), плюс ещё \(10 \times 100 \times 50 = 50000\) умножений (умножение \(A_1\) на \(A_2 A_3\)), итого 75000 умножений. Тем самым, первый способ расстановки скобок в 10 раз выгоднее.

Задача об умножении последовательности матриц (matrix-chain multiplication problem) может быть сформулирована следующим образом: дана последовательность из \(n\) матриц \(\langle A_1, A_2, \ldots, A_n \rangle\) заданных размеров (матрица \(A_i\) имеет размер \(p_{i-1} \times p_i\)); требуется найти такую (полную) расстановку скобок в произведении \(A_1 A_2 \ldots A_n\), чтобы вычисление произведения требовало наименьшего числа умножений.

Количество расстановок скобок

Прежде чем применять динамическое программирование к задаче об умножении последовательности матриц, стоит убедиться, что простой перебор всех возможных расстановок скобок не даст эффективного алгоритма. Обозначим символом \(P(n)\) количество полных расстановок скобок в произведении \(n\) матриц. Последнее