---
source_image: page_779.png
page_number: 779
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 67.11
tokens: 11740
characters: 2548
timestamp: 2025-12-24T06:57:11.256557
finish_reason: stop
---

Глава 34 Поиск подстрок

предварительного вычисления функции перехода (в терминах конечных автоматов).

К префикс-функции приводит следующий ход мыслей. Пусть простейший алгоритм ищет вхождения подстроки \( P = ababac \) в текст \( T \). Предположим, что для некоторого сдвига \( s \) оказалось, что \( q \) первых символов образца совпадают с символами текста, а в следующем символе имеется расхождение (рис. 34.9 (а), где \( q = 5 \)). Стало быть, мы знаем \( q \) символов текста, от \( T[s+1] \) до \( T[s+q] \), и из этой информации можно заключить, что некоторые последующие сдвиги будут заведомо недопустимы. В примере на рис. 34.9, скажем, сразу видно, что недопустим сдвиг \( s+1 \), поскольку при этом сдвиге первый символ образца (буква \( a \)) окажется напротив \( s+2 \)-го символа текста, совпадающего со вторым символом образца, — а это буква \( b \). А вот при сдвиге на \( s+2 \) (рис. 34.9 (б)) первые три символа образца совпадают с тремя последними из известных нам символов текста, так что этот сдвиг априори отбросить нельзя. В общем случае хотелось бы уметь отвечать на такой вопрос:

Пусть \( P[1..q] = T[s+1..s+q] \); каково наименьшее значение сдвига \( s' > s \), для которого

\[
P[1..k] = T[s'+1..s'+k],
\]

где \( s'+k = s+q \)?

Число \( s' \) — это наименьшее значение сдвига, большее \( s \), которое нельзя отбросить с порога, исходя из равенства \( T[s+1..s+q] = P[1..q] \). Больше всего нам повезёт, если \( s' = s+q \): тогда мы можем не рассматривать сдвиги \( s+1, s+2, \ldots, s+q-1 \). И во всяком случае, при проверке нового сдвига \( s' \) мы можем не рассматривать первые \( k \) символов образца: из формулы (34.5) мы знаем, что они заведомо совпадают с соответствующими символами в тексте.

Чтобы найти \( s' \), нам не нужно ничего знать о тексте \( T \): достаточно знания образца \( P \) и числа \( q \). Именно, \( T[s'+1..s'+k] \) — суффикс строки \( P_q \). Поэтому число \( k \) в формуле (34.5) — это наибольшее число \( k < q \), для которого \( P_k \) является суффиксом \( P_q \). Практически удобно хранить информацию именно об этом числе \( k \) — количестве символов, заведомо совпадающих при проверке нового сдвига \( s' \). Само значение \( s' \) вычисляется по формуле \( s' = s + (q - k) \).

Теперь дадим формальное определение. Префикс-функцией (prefix function), ассоциированной со строкой \( P[1..m] \), называется функция \( \pi : \{1, 2, \ldots, m\} \to \{0, 1, \ldots, m-1\} \), определенная следующим образом:

\[
\pi[q] = \max\{k : k < q \text{ и } P_k \sqsupseteq P_q\}.
\]