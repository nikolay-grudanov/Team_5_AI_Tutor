---
source_image: page_780.png
page_number: 780
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 48.34
tokens: 11514
characters: 1880
timestamp: 2025-12-24T06:56:53.987472
finish_reason: stop
---

Рис. 34.9. Префикс-функция \( \pi \). (а) Образец \( P = ababasa \) расположен так, что первые 5 букв образца совпадают с буквами в тексте \( T \) (совпадающие буквы серые и соединены отрезками). (б) Исходя только из совпадения этих 5 букв, мы можем заключить, что сдвиг \( s+1 \) недопустим. Допустимость сдвига \( s+2 \) не противоречит тому, что мы к данному моменту знаем о тексте, и отбросить этот сдвиг заранее нельзя. (в) Информацию о том, какие сдвиги заведомо недопустимы, можно получить, исходя только из образца \( P \). В нашем случае мы видим, что наибольший префикс строки \( P \), являющийся суффиксом \( P_5 \) [и отличный от всей \( P_5 \)], имеет длину 3. На языке префикс-функций это означает, что \( \pi[5] = 3 \). В общем случае: если при проверке сдвига \( s \) первые \( q \) символов образца совпали с соответствующими символами текста, то следующий сдвиг, который надо проверять, равен \( s' = s + (q - \pi[q]) \).

Иными словами, \( \pi[q] \) — длина наибольшего префикса \( P \), являющегося (собственным) суффиксом \( P_q \). На рис. 34.10 (а) приведена префикс-функция для строки ababababab.

Алгоритм Кнута — Морриса — Пратта мы запишем в виде процедуры KMP-MATCHER. Как мы увидим, KMP-MATCHER можно рассматривать как усовершенствование алгоритма FINITE-AUTOMATON-MATCHER. Процедура Compute-Prefix-Function, вызываемая алгоритмом KMP-MATCHER, вычисляет префиксную функцию \( \pi \).

KMP-Matcher(T,P)
1 n \gets length[T]
2 m \gets length[P]
3 \pi \gets Compute-Prefix-Function(P)
4 q \gets 0
5 for i \gets 1 to n
6 do while q>0 and P[q+1] \neq T[i]
7 do q \gets \pi[q]
8 if P[q+1]=T[i]
9 then q \gets q+1
10 if q=m
11 then print 'Образец входит со сдвигом ' i-m
12 q \gets \pi[q]

Compute-Prefix-Function(P)
1 m \gets length[P]
2 \pi[1] \gets 0
3 k \gets 0
4 for q \gets 2 to m
5 do while k>0 and P[k+1] \neq P[q]
6 do k \gets \pi[k]
7 if P[k+1]=P[q]