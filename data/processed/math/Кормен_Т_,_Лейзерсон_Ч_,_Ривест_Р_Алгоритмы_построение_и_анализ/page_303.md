---
source_image: page_303.png
page_number: 303
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 80.48
tokens: 11798
characters: 2590
timestamp: 2025-12-24T06:34:51.280064
finish_reason: stop
---

Шаг 2: рекуррентное соотношение

Теперь надо выразить стоимость оптимального решения задачи через стоимости оптимальных решений её подзадач. Такими подзадачами будут задачи об оптимальной расстановке скобок в произведениях \( A_{i..j} = A_i A_{i+1} \ldots A_j \) для \( 1 \leq i \leq j \leq n \). Обозначим через \( m[i, j] \) минимальное количество умножений, необходимое для вычисления матрицы \( A_{i..j} \); в частности, стоимость вычисления всего произведения \( A_{1..n} \) есть \( m[1, n] \).

Числа \( m[i, j] \) можно вычислить так. Если \( i = j \), то последовательность состоит из одной матрицы \( A_{i..i} = A_i \) и умножения вообще не нужны. Стало быть, \( m[i, i] = 0 \) для \( i = 1, 2, \ldots, n \). Чтобы посчитать \( m[i, j] \) для \( i < j \), мы воспользуемся информацией о строении оптимального решения, полученной на шаге 1. Пусть при оптимальной расстановке скобок в произведении \( A_i A_{i+1} \ldots A_j \) последним идет умножение \( A_i \ldots A_k \) на \( A_{k+1} \ldots A_j \), где \( i \leq k < j \). Тогда \( m[i, j] \) равно сумме минимальных стоимостей вычисления произведений \( A_{i..k} \) и \( A_{k+1..j} \) плюс стоимость перемножения этих двух матриц. Поскольку для вычисления произведения \( A_{i..k} A_{k+1..j} \) требуется \( p_{i-1} p_k p_j \) умножений,

\[
m[i, j] = m[i, k] + m[k + 1, j] + p_{i-1} p_k p_j.
\]

В этом соотношении подразумевается, что оптимальное значение \( k \) нам известно; на деле это не так. Однако число \( k \) может принимать всего лишь \( j - i \) различных значений: \( i, i + 1, \ldots, j - 1 \). Поскольку одно из них оптимально, достаточно перебрать эти значения \( k \) и выбрать наилучшее. Получаем рекуррентную формулу:

\[
m[i, j] = \begin{cases}
0 & \text{при } i = j, \\
\min\limits_{i \leq k < j} \{ m[i, k] + m[k + 1, j] + p_{i-1} p_k p_j \} & \text{при } i < j.
\end{cases}
\]

Числа \( m[i, j] \) — стоимости оптимальных решений подзадач. Чтобы проследить за тем, как получается оптимальное решение, обозначим через \( s[i, j] \) оптимальное место последнего умножения, то есть такое \( k \), что при оптимальном вычислении произведения \( A_i A_{i+1} \ldots A_j \) последним идет умножение \( A_i \ldots A_k \) на \( A_{k+1} \ldots A_j \). Иными словами, \( s[i, j] \) равно числу \( k \), для которого \( m[i, j] = m[i, k] + m[k + 1, j] + p_{i-1} p_k p_j \).

Шаг 3: вычисление оптимальной стоимости

Пользуясь соотношениями (16.2), теперь легко написать рекурсивный алгоритм, определяющий минимальную стоимость вычисления произведения \( A_1 A_2 \ldots A_n \) (т.е. число \( m[1, n] \)). Однако время