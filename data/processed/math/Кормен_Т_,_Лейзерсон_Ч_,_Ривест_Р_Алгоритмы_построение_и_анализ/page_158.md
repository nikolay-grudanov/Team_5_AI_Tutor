---
source_image: page_158.png
page_number: 158
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 57.43
tokens: 11550
characters: 2346
timestamp: 2025-12-24T06:27:36.646891
finish_reason: stop
---

8.4.2 Анализ среднего времени работы

Как мы уже видели в разделе 8.2, если разбиения производятся так, что отношение размеров частей ограничено, то глубина дерева рекурсии равна \( \Theta(\lg n) \), а время работы — \( \Theta(n \lg n) \). Чтобы получить оценку среднего времени работы алгоритма RANDOMIZED-QUICKSORT, мы сначала проанализируем работу процедуры PARTITION, затем получим рекуррентное соотношение на среднее время работы и решим его (попутно получив одну полезную оценку).

**Анализ разбиений**

Напомним, что перед тем как в строке 3 процедуры RANDOMIZED-PARTITION вызывается процедура PARTITION, элемент \( A[p] \) переставляется со случайно выбранным элементом массива \( A[p..r] \). Для простоты мы будем предполагать, что все числа в массиве различны. Хотя оценка среднего времени сохраняется и в том случае, когда в массиве есть одинаковые элементы, получить её сложнее, и мы этого делать не будем.

Прежде всего, заметим, что значение \( q \), которое возвратит процедура PARTITION, зависит только от того, сколько в массиве элементов, не больших \( x = A[p] \) (число таких элементов мы будем называть **рангом** (rank) элемента \( x \) и обозначать \( \operatorname{rank}(x) \)). Если \( n = r - p + 1 \) — число элементов в массиве, то, поскольку все элементы имеют равные шансы попасть на место \( A[p] \), все значения \( \operatorname{rank}(x) \), от 1 до \( n \), равновероятны (имеют вероятность \( 1/n \)).

Если \( \operatorname{rank}(x) > 1 \), то, как легко видеть, при разбиении левая часть будет содержать \( \operatorname{rank}(x) - 1 \) элементов — в ней окажутся все элементы, меньше \( x \). Если же \( \operatorname{rank}(x) = 1 \), то левая часть будет содержать один элемент (после первого же выполнения цикла будет \( i = j = p \)). Отсюда следует, что с вероятностью \( 1/n \) левая часть будет содержать \( 2, 3, \ldots, n - 1 \) элементов, а с вероятностью \( 2/n \) — один элемент.

**Рекуррентное соотношение для среднего времени работы**

Обозначим среднее время работы алгоритма RANDOMIZED-QUICKSORT для массива из \( n \) элементов через \( T(n) \). Ясно, что \( T(1) = \Theta(1) \). Время работы состоит из времени работы процедуры PARTITION, которое составляет \( \Theta(n) \), и времени работы для двух массивов размера \( q \) и \( n - q \), причём \( q \) с вероятностью \( 2/n \) принимает