---
source_image: page_526.png
page_number: 526
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 62.68
tokens: 11774
characters: 2161
timestamp: 2025-12-24T06:45:20.876607
finish_reason: stop
---

\[
D^{(1)} = \begin{pmatrix}
0 & 3 & 8 & \infty & -4 \\
\infty & 0 & \infty & 1 & 7 \\
\infty & 4 & 0 & \infty & \infty \\
2 & \infty & -5 & 0 & \infty \\
\infty & \infty & \infty & 6 & 0
\end{pmatrix}
\quad
D^{(2)} = \begin{pmatrix}
0 & 3 & 8 & 2 & -4 \\
3 & 0 & -4 & 1 & 7 \\
\infty & 4 & 0 & 5 & 11 \\
2 & -1 & -5 & 0 & -2 \\
8 & \infty & 1 & 6 & 0
\end{pmatrix}
\]
\[
D^{(3)} = \begin{pmatrix}
0 & 3 & -3 & 2 & -4 \\
3 & 0 & -4 & 1 & -1 \\
7 & 4 & 0 & 5 & 11 \\
2 & -1 & -5 & 0 & -2 \\
8 & 5 & 1 & 6 & 0
\end{pmatrix}
\quad
D^{(4)} = \begin{pmatrix}
0 & 1 & -3 & 2 & -4 \\
3 & 0 & -4 & 1 & -1 \\
7 & 4 & 0 & 5 & 3 \\
2 & -1 & -5 & 0 & -2 \\
8 & 5 & 1 & 6 & 0
\end{pmatrix}
\]

Рисунок 26.1 26.1 Ориентированный граф \( G \) и последовательность матриц \( D^{(m)} \). Можно убедиться, что матрица \( D^{(5)} = D^{(4)} \cdot W \) (а значит, и все последующие) будет равна \( D^{(4)} \).

\verb|3 |for $m \leftarrow 2$ to $n-1$\\
\verb|4 |do $D^{(m)} \leftarrow \mbox{\sc Extend-Shortest-Paths}(D^{(m-1)},W)$\\
\verb|5 |return $D^{(n-1)}$\\

На рис. 26.1 показан пример графа и соответствующих ему матриц \( D^{(m)} \).

Более быстрый способ
Заметим, что мы вычисляем все матрицы \( D^{(m)} \), хотя нас интересует лишь матрица \( D^{(n-1)} \) или любая из следующих за ней (при отсутствии циклов с отрицательными весами все они равны). Продолжим аналогию с умножением: степень числа \( a \) можно вычислить быстрее, если не домножать всё время на \( a \), а возводить в квадрат (такой метод заведомо применим, если показатель степени есть \( 2, 4, 8, \ldots \)).

Аналогичным образом мы мы можем определить \( D^{(n-1)} \), выполнив всего \( \lceil \lg(n-1) \rceil \) умножений матриц, вычисляя матрицы в последовательности

\[
\begin{align*}
D^{(1)} &= W \\
D^{(2)} &= W^2 = W \cdot W, \\
D^{(4)} &= W^4 = W^2 \cdot W^2, \\
D^{(8)} &= W^8 = W^4 \cdot W^4,
\end{align*}
\]

то тех пор, пока показатель степени станет большим или равным \( n-1 \) (при этом он будет равен \( 2^{\lceil \lg(n-1) \rceil} \), как легко видеть).

Реализуем этот метод повторного возведения в квадрат (repeated squaring) в виде процедуры:

{\sc Faster-All-Pairs-Shortest-Paths}$(W)$