---
source_image: page_267.png
page_number: 267
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 53.72
tokens: 11485
characters: 2034
timestamp: 2025-12-24T06:32:43.213276
finish_reason: stop
---

14.3 Добавление вершины

Добавление вершины в красно-чёрное дерево проводится за время \( O(\lg n) \). Сначала мы применяем процедуру Tree-Insert, как делалось для двоичных деревьев поиска, и красим новую вершину в красный цвет. После этого надо восстановить RB-свойства, для чего приходится перекрасить некоторые вершины и произвести вращения. При этом возможны различные ситуации, с которыми надо аккуратно разобраться.

RB-INSERT\((T, x)\)

1   Tree-Insert\((T, x)\)
2   color\[x\] \leftarrow RED
3   while \(x \neq root[T]\) и color\[p[x]] = RED
4     do if \(p[x] = left[p[p[x]]]\)
5       then \(y \leftarrow right[p[p[x]]]\)
6         if color\[y\] = RED
7           then color\[p[x]] \leftarrow BLACK ▷ Случай 1
8             color\[y\] \leftarrow BLACK ▷ Случай 1
9             color\[p[p[x]]\] \leftarrow RED ▷ Случай 1
10             \(x \leftarrow p[p[x]]\) ▷ Случай 1
11         else if \(x = right[p[x]]\)
12           then \(x \leftarrow p[x]\) ▷ Случай 2
13             LEFT-ROTATE\((T, x)\) ▷ Случай 2
14             color\[p[x]] \leftarrow BLACK ▷ Случай 3
15             color\[p[p[x]]\] \leftarrow RED ▷ Случай 3
16             RIGHT-ROTATE\((T, p[p[x]])\) ▷ Случай 3
17         else (аналогичный текст с заменой left \leftrightarrow right)
18   color[root[T]] \leftarrow BLACK

На рисунке 14.4 показан пример применения процедуры RB-INSERT.

Процедура RB-INSERT проще, чем кажется на первый взгляд. После выполнения строк 1–2 выполняются все RB-свойства, кроме одного: красная вершина \(x\) может иметь красного родителя. (см. рис. 14.4а). В остальном всё в порядке — другие свойства "не замечают" добавления красной вершины (отметим, что новая красная вершина имеет двух чёрных NIL-детей).

Такая ситуация (выполнены все RB-свойства, за исключением того, что красная вершина \(x\) может иметь красного родителя) будет сохраняться после любого числа итераций цикла. На каждом шаге вершина \(x\) поднимается вверх по дереву (если только не удалось устранить нарушения полностью; в этом случае мы выходим из цикла).