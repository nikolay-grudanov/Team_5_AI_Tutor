---
source_image: page_790.png
page_number: 790
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 71.19
tokens: 11927
characters: 2888
timestamp: 2025-12-24T06:57:45.478810
finish_reason: stop
---

**Алгоритм Бойера — Мура**

силу (34.7), имеем \( P[j + 1..m] \sim P_{\pi[m]} \) для любого \( j \). Следовательно, максимум в правой части определения величины \( \gamma[j] \) не меньше \( \pi[m] \), так что \( \gamma[j] \leq m - \pi[m] \) для всех \( j \).
Стало быть, можно переписать наше определение \( \gamma \) так:

\[
\gamma[j] = m - \max \{ k : \pi[m] \leq k < m \text{ и } P[j + 1..m] \sim P_k \}.
\]

Условие \( P[j + 1..m] \sim P_k \) может выполняться в двух случаях: либо когда \( P[j + 1..m] \sqsupseteq P_k \), либо когда \( P_k \sqsubseteq P[j + 1..m] \). Во втором случае, однако, имеем \( P_k \sqsubseteq P_m \), откуда \( k \leq \pi[m] \) и потому \( k = \pi[m] \). Поэтому определение \( \gamma \) можно переписать еще и так:

\[
\gamma[j] = m - \max (\{\pi[m]\} \cup \{ k : \pi[m] < k < m \text{ и } P[j + 1..m] \sqsubseteq P_k \})
\]

Второе из этих множеств может оказаться пустым. В самом деле, мы ищем префикс \( P_k \) образца \( P \), в котором \( P[j + 1..m] \) является суффиксом; другими словами, мы ищем в образце участок равный его суффиксу \( P[j + 1..m] \) и расположенный левее (\( k < m \))

Нам нужно найти самый правый из таких участков (числа \( k \), из которых берется максимальное — это правые границы таких участков). Для этого полезно рассмотреть строку \( P' \), являющуюся обращением строки \( P \) и соответствующую ей префикс-функцию \( \pi' \) (иными словами, \( P'[i] = P[m + 1 - i] \) и \( \pi'[t] \) — максимальное \( u < t \), для которого \( P'_u \sqsubseteq P'_t \)).

Пусть участок \( X \) строки \( P \) заканчивается в позиции \( k \) (то есть является суффиксов строки \( P_k \)) и равен \( P[j + 1..m] \). Длины обоих равных участков равны \( m - j \), и легко понять, что эти участки (в перевёрнутом виде) будут суффиксом и префиксом строки \( P'_l \), где \( l = (m - k) + (m - j) \) (здесь \( (m - k) \) — расстояние от конца участка \( X \) до конца образца, \( (m - j) \) — длина участка). Поэтому \( \pi'[l] \geq m - j \). Докажем, что на самом деле имеет место равенство

\[
\pi'[l] = m - j.
\]

В самом деле, если бы более длинный участок \( X' \), начинающийся в той же позиции, что и \( X \), был бы суффиксом образца, то некоторый его суффикс совпадал бы с \( P[j + 1..m] \) и поэтому \( X \) не был бы самым правым участком строки \( P \), совпадающим с \( P[j + 1..m] \).

Равенство (34.8) можно переписать как \( j = m - \pi'[l] \); кроме того, из него следует, что \( k = m - l + \pi'[l] \). Поэтому можно окончательно переписать нашу формулу для \( \gamma[j] \) так:

\[
\gamma[j] = m - \max(\{\pi[m]\} \cup \{ m - l + \pi'[l] : 1 \leq l \leq m \text{ и } j = m - \pi'[l] \})
= \min(\{ m - \pi[m] \} \cup \{ l - \pi'[l] : 1 \leq l \leq m \text{ и } j = m - \pi'[l] \}) \tag{34.9}
\]

(опять-таки, второе множество может оказаться пустым).

Теперь можно выписать псевдокод для функции, вычисляющей \( \gamma \):