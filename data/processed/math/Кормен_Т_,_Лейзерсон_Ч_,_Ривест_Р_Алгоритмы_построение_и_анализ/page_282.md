---
source_image: page_282.png
page_number: 282
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 38.41
tokens: 11326
characters: 1528
timestamp: 2025-12-24T06:33:11.752871
finish_reason: stop
---

Рисунок 15.1 Порядковое дерево. Красные вершины изображены как светло-серые, чёрные — как тёмные. Помимо обычных полей красно-чёрного дерева, у каждой вершины x есть поле size[x], где хранится размер поддерева с корнем в x.

4-й элемент поддерева с корнем 30. В этом дереве корень имеет порядковый номер 2, поэтому ищем (4 - 2) = 2-й элемент правого поддерева. В этом дереве корень 38 оказался вторым по порядку (размер левого поддерева равен 1), поэтому мы возвращаем указатель на вершину 38.

При каждом рекурсивном вызове процедуры мы спускаемся по дереву на один уровень, поэтому время работы в худшем случае пропорционально высоте. Высота красно-чёрного дерева с n вершинами равна O(log n), так что время работы процедуры OS-SELECT на n-элементном множестве есть O(log n).

Определение порядкового номера элемента

Процедура OS-RANK получает указатель на элемент x порядкового дерева T и находит порядковый номер (rank) элемента в дереве.

OS-RANK(T, x)
1 r ← size[left[x]] + 1
2 y ← x
3 while y ≠ root[T]
4 do if y = right[p[y]]
5 then r ← r + size[left[p[y]]] + 1
6 y ← p[y]
7 return r

Порядковый номер элемента x на единицу больше количества элементов, меньших x. Цикл в строках 3–6 имеет такой инвариант: r есть порядковый номер вершины x в поддереве с корнем y. Перед первым выполнением цикла это так: r есть порядковый номер x в дереве с корнем в x (строка 1), а y = x (строка 2). Как надо изменить r при переходе от вершины y к её родителю p[y]? Если y — левый ребёнок вершины p[y], то вершина x имеет один и тот же