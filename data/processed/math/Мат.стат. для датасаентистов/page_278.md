---
source_image: page_278.png
page_number: 278
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 76.48
tokens: 11966
characters: 2296
timestamp: 2025-12-24T06:19:05.601863
finish_reason: stop
---

В R функция hclust может использоваться для выполнения иерархической кластеризации. Одно большое отличие hclust от kmeans состоит в том, что данная функция оперирует на попарных расстояниях \( d_{i,j} \) нежели самих данных, как таковых. Вы можете их вычислить при помощи функции dist. Например, приведенный далее фрагмент кода применяет иерархическую кластеризацию к доходностям акций для ряда компаний:

syms1 <- c('GOOGL', 'AMZN', 'AAPL', 'MSFT', 'CSCO', 'INTC', 'CVX',
           'XOM', 'SLB', 'COP', 'JPM', 'WFC', 'USB', 'AXP',
           'WMT', 'TGT', 'HD', 'COST')
# транспонировать: чтобы кластеризовать компании, нужно
# разместить акции в строках
df <- t(sp500_px[row.names(sp500_px)>='2011-01-01', syms1])
d <- dist(df)
hcl <- hclust(d)

Алгоритм кластеризации будет распределять записи (строки) кадра данных по кластерам. Поскольку мы хотим кластеризовать компании, мы должны транспонировать кадр данных и распределить акции по строкам, а даты — по столбцам.

Дендрограмма

Иерархическая кластеризация поддается естественному графическому отображению в виде дерева, которое называется дендрограммой. Это название происходит от греческих слов dendro (дерево) и gramma (рисунок). В R вы можете легко произвести дендрограмму при помощи команды plot:

plot(hcl)

Результат показан на рис. 7.7. Листья дерева соответствуют записям. Длина ветви дерева говорит о степени различия между соответствующими кластерами. Доходности акций Google и Amazon довольно отличаются от доходности других акций. Другие акции попадают в естественные группы: энергетические акции, финансовые акции и акции потребительского сектора — все они распределены по собственным поддеревьям.

В отличие от метода K средних, нет необходимости предварительно определять количество кластеров. Для того чтобы извлечь конкретное количество кластеров, вы можете воспользоваться функцией cutree:

cutree(hcl, k=4)
GOOGL AMZN AAPL MSFT CSCO INTC CVX XOM SLB COP JPM WFC
   1   2   3   3   3   3   4   4   4   4   3   3
USB AXP WMT TGT HD COST
   3   3   3   3   3   3

Количество извлекаемых кластеров принимается равным 4, и вы видите, что акции Google и Amazon каждые в отдельности принадлежат своему кластеру. Нефтяные акции (XOM, CVS, SLB, COP) принадлежат другому кластеру. Оставшиеся акции находятся в четвертом кластере.