---
source_image: page_186.png
page_number: 186
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 41.78
tokens: 7943
characters: 2675
timestamp: 2025-12-24T09:15:24.503355
finish_reason: stop
---

открытого текста и тем самым предотвращает утечку информации об открытом тексте.
Схема МАС-затем-шифрование много лет использовалась в протоколе TLS, но в версии TLS 1.3 была заменена шифрами с аутентификацией (подробнее о TLS 1.3 см. главу 13).

Шифрование-затем-МАС

В схеме шифрование-затем-МАС получателю отправляется два значения: шифртекст \( C = \mathbf{E}(K_1, P) \) и вычисленный по шифртексту жетон \( T = \mathbf{MAC}(K_2, C) \). Получатель вычисляет жетон \( \mathbf{MAC}(K_2, C) \) и проверяет, совпадает ли он с полученным жетоном \( T \). Если значения одинаковы, то вычисляется открытый текст \( P = \mathbf{D}(K_1, C) \), в противном случае шифртекст отбрасывается.

Преимущество этого метода заключается в том, что для обнаружения поврежденных сообщений получателю нужно вычислить только МАС, а дешифрировать поврежденный шифртекст нет необходимости. Еще одно преимущество — то, что противник не может отправить получателю пару \( C \) и \( T \) для дешифрирования, не взломав МАС, поэтому противнику труднее передать вредоносные данные.

Благодаря такому сочетанию особенностей схема шифрование-затем-МАС более стойкая, чем две другие. Именно по этой причине в широко используемом наборе протоколов IPSec она и применяется для защиты пакетов (например, в VPN-туннелях).

Но почему тогда эта схема не используется в протоколах SSH и TLS? Ответ прост: когда создавались SSH и TLS, другие подходы казались вполне адекватными — не потому, что теоретических слабостей не существовало, а потому, что наличие теоретических слабостей еще не означает фактической уязвимости.

Шифры с аутентификацией

Шифры с аутентификацией — альтернатива комбинации шифра и МАС. Они похожи на обычные шифры, но возвращают аутентификационный жетон наряду с шифртекстом.

Шифрование с аутентификацией описывается формулой \( \mathbf{AE}(K, P) = (C, T) \). Акроним \( \mathbf{AE} \) означает authenticated encryption, и, как мы видим, шифру передается ключ (\( K \)) и открытый текст (\( P \)), а возвращает он шифртекст (\( C \)) и сгенерированный жетон (\( T \)). Иначе говоря, один шифртекст с аутентификацией делает то же самое, что комбинация шифра и МАС, только проще, быстрее и зачастую безопаснее.

Дешифрирование шифра с аутентификацией описывается формулой \( \mathbf{AD}(K, C, T) = P \). Здесь \( \mathbf{AD} \) означает authenticated decryption; алгоритм получает шифртекст (\( C \)), жетон (\( T \)), ключ (\( K \)) и возвращает открытый текст (\( P \)). Если \( C \) или \( T \) некорректны, то \( \mathbf{AD} \) возвращает ошибку, и получатель отказывается от обработки открытого текста, который может быть подделан. С другой стороны, если \( \mathbf{AD} \) вернул от-