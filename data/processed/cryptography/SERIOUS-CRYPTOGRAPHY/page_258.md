---
source_image: page_258.png
page_number: 258
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 43.68
tokens: 7931
characters: 2750
timestamp: 2025-12-24T09:17:37.709192
finish_reason: stop
---

рушает секретность прошлого, потому что Ева смогла восстановить разделяемый ключ для предыдущего исполнения протокола. Однако на практике этот риск можно устранить, добавив шаг подтверждения ключа, благодаря которому Алиса и Боб могут осознать, что разделяют не один и тот же ключ. После этого они прервут выполнение протокола, не приступая к выводу сеансовых ключей.

Несмотря на элегантность и безопасность, MQV редко используется на практике. Связано это, в частности, с тем, что раньше он был обременен патентами, мешавшими широкому распространению. Другая причина — тот факт, что правильно реализовать MQV труднее, чем кажется. В общем, с учетом повышенной сложности преимущества MQV с точки зрения безопасности не кажутся такими весомыми, чтобы отказаться от более простого протокола DH с аутентификацией.

Какие возможны проблемы

Протоколы Диффи–Хеллмана подвержены впечатляющим провалам — и не одним способом. В следующих разделах я расскажу о самых распространенных.

Пренебрежение хешированием разделяемого секрета

Я упоминал, что разделяемый секрет, который вырабатывается в результате обмена сообщениями в сеансе DH (в наших примерах — \( g^{ab} \)), служит исходной точкой для вывода сеансовых ключей, но сам ключом не является. И не должен являться. Симметричный ключ должен казаться случайным, все его биты должны принимать значение 0 или 1 с одинаковой вероятностью. Но \( g^{ab} \) — вовсе не случайная строка; это случайный элемент некоторой математической группы, и его биты могут иметь статистическое смещение. Случайный элемент группы отличается от случайной строки битов.

Представьте, к примеру, что мы работаем с мультипликативной группой \( \mathbb{Z}_{13}^* = \{1, 2, 3, ..., 12\} \), для которой \( g = 2 \) является порождающим элементом, т. е. множество значений \( g^i, i = 1, 2, ..., 12 \), совпадает со всем множеством элементов \( \mathbb{Z}_{13}^* \): \( g^1 = 2, g^2 = 4, g^3 = 8, g^4 = 3 \) и т. д. При случайном выборе показателя степени \( g \) мы получим случайный элемент \( \mathbb{Z}_{13}^* \), но представление элемента \( \mathbb{Z}_{13}^* \) в виде 4-битовой строки не будет иметь равномерного распределения: не все биты принимают значение 0 или 1 с одинаковой вероятностью. В \( \mathbb{Z}_{13}^* \) у семи элементов (с номерами от 1 до 7) старшим битом является 0, и только у пяти (от 8 до 12) он равен 1. Следовательно, этот бит равен 0 с вероятностью \( 7/12 \approx 0.58 \), тогда как в идеале вероятность должна быть равна 0.5. Более того, 4-битовые последовательности 1101, 1110 и 1111 вообще ни разу не встречаются.

Чтобы избежать такого смещения сеансовых ключей, сформированных по разделяемому секрету DH, следует использовать криптографическую функцию хеширования, например BLAKE2 или SHA-3,