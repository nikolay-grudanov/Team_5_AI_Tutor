---
source_image: page_287.png
page_number: 287
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 36.84
tokens: 7748
characters: 2343
timestamp: 2025-12-24T09:18:24.025902
finish_reason: stop
---

ность реализаций и гарантировать, что любой сервер, реализующий TLS 1.3, сможет прочитать данные, отправленные любым клиентом, реализующим TLS 1.3 (даже если используются разные библиотеки или языки программирования), в спецификации TLS 1.3 описан также формат отправляемых данных.

На рис. 13.1 показан обмен данными в процессе квитирования в соответствии со спецификацией TLS 1.3. Как видим, клиент отправляет серверу сообщение «я хочу установить с тобой TLS-соединение. Вот какие шифры я поддерживаю для шифрования TLS-записей, а вот мой открытый ключ Диффи–Хеллмана». Открытый ключ должен быть сгенерирован специально для этого сеанса TLS, и клиент хранит у себя ассоциированный с ним закрытый ключ. Отправленное клиентом сообщение включает также 32-байтовое случайное значение и факультативную информацию (дополнительные параметры и все такое). Первое сообщение называется ClientHello, это последовательность байтов определенного формата, описанного в спецификации TLS 1.3.

Клиент
Сгенерировать пару ключей (c, C = cQ)
ClientHello
- поддерживаемые шифры
- открытый ключ C

Сервер
Сгенерировать пару ключей (s, S = sQ)
Вычислить secret = DH(s, C)
Сформировать ключи keys = KDF(secret)

Проверить сертификат
Проверить подпись
Вычислить secret = DH(c, S)
Сформировать ключи keys = KDF(secret)
Проверить МАС с помощью ключей

ServerHello
- выбранные шифры
- открытый ключ S
Сертификат
Подпись тройки ClientHello, ServerHello, сертификат
МАС четверки ClientHello, ServerHello, сертификат, подпись

Рис. 13.1. Процесс подтверждения связи в TLS 1.3 при подключении к HTTPS-сайту

Отметим, что в спецификации описано также, в каком формате следует отправлять данные, чтобы гарантировать интероперабельность реализаций.

Сервер получает сообщение ClientHello, проверяет, что оно правильно отформатировано, и посылает в ответ сообщение ServerHello. В этом сообщении куча информации: шифр для шифрования записей TLS, открытый ключ Диффи–Хеллмана, 32-байтовое случайное значение (обсуждается в разделе «Защита от понижения версии»), сертификат, подпись, вычисленная по всей информации в сообщениях ClientHello и ServerHello (с применением ключа, ассоциированного с открытым ключом сертификата), имитовставка (МАС), вычисленная по той же информации плюс подпись. МАС вычисляется с применением симметричного ключа, сформированного по разделяемому сек-