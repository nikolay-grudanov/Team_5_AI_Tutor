---
source_image: page_173.png
page_number: 173
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 39.02
tokens: 7867
characters: 2362
timestamp: 2025-12-24T09:14:58.497251
finish_reason: stop
---

Для этого СМАС сначала формирует два ключа \( K_1 \) и \( K_2 \) на основе главного ключа \( K \), так что \( K, K_1 \) и \( K_2 \) различаются. В СМАС последний блок обрабатывается с применением \( K_1 \) или \( K_2 \), а предыдущие — с применением \( K \).

Чтобы сформировать \( K_1 \) и \( K_2 \), СМАС сначала вычисляет временное значение \( L = E(0, K) \), где 0 выступает в роли ключа блочного шифра, а \( K \) в роли блока открытого текста. Затем СМАС полагает \( K_1 \) равным (\( L << 1 \)), если старший бит \( L \) равен 0, или (\( L << 1 \) \( \oplus \) 87, если старший бит \( L \) равен 1 (число 87 выбрано за его математические свойства в случае, когда длина блока данных равна 128 бит; если длина блока иная, то нужно выбирать другое число).

Значение \( K_2 \) полагается равным (\( K_1 << 1 \)), если старший бит \( K_1 \) равен 0, или \( K_2 = (K_1 << 1) \oplus 87 \) в противном случае.

При известных \( K_1 \) и \( K_2 \) СМАС работает, как CBC-МАС, для всех блоков, кроме последнего. Если длина последнего куска сообщения \( M_n \) в точности равна длине блока, то СМАС возвращает в качестве жетона значение \( E(K, M_n \oplus C_{n-1} \oplus K_1) \), как показано на рис. 7.3. Но если \( M_n \) содержит меньше битов, чем полный блок, то СМАС дополняет его одним единичным битом и нулями и возвращает в качестве жетона \( E(K, M_n \oplus C_{n-1} \oplus K_2) \), как показано на рис. 7.4. Заметим, что в первом случае используется только \( K_1 \), а во втором только \( K_2 \), но в обоих случаях для обработки всех блоков, кроме последнего, применяется главный ключ \( K \).

![Рис. 7.3. Построение имитовставки СМАС на основе блочного шифра в случае, когда сообщение точно делится на блоки равной длины](https://i.imgur.com/3Q5z5QG.png)

![Рис. 7.4. Построение имитовставки СМАС на основе блочного шифра в случае, когда последний кусок сообщения дополняется одним единичным битом и нулями до полного блока](https://i.imgur.com/3Q5z5QG.png)

Заметим, что, в отличие от режима работы CBC, СМАС не принимает параметра IV и детерминирована: СМАС всегда возвращает один и тот же жетон для данного сообщения \( M \), потому что вычисление СМАС(\( M \)) не рандомизировано. И это хорошо, т. к., в отличие от шифрования, вычисление МАС не обязано быть рандомизированным, чтобы считаться безопасным, что снимает с нас бремя выбора случайного IV.