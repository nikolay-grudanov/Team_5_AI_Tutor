---
source_image: page_103.png
page_number: 103
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 31.98
tokens: 7736
characters: 2171
timestamp: 2025-12-24T09:12:43.958015
finish_reason: stop
---

На рис. 4.9 показано три блока, из которых последний, \( P_3 \), неполон (недостающие биты представлены нулем). \( P_3 \) объединяется с помощью операции XOR с последними битами предыдущего блока шифртекста, и зашифрованный результат возвращается в виде \( C2 \). А последний блок шифртекста, \( C_3 \), состоит из начальных битов предыдущего блока шифртекста. В процессе дешифрирования эта операция просто инвертируется.

![Схема заимствования шифртекста в режиме шифрования CBC](https://i.imgur.com/3Q5z5QG.png)

Рис. 4.9. Заимствование шифртекста в режиме шифрования CBC

У заимствования шифртекста нет никаких серьезных проблем, но оно неэлегантно и его трудно реализовать правильно, особенно учитывая, что в стандарте NIST описано три способа его реализации (см. специальную публикацию 800-38A).

**Режим счетчика (CTR)**

Чтобы избежать проблем, присущих заимствованию шифртекста, сохраняя в то же время все его преимущества, следует использовать режим счетчика (counter mode – CTR). Режим CTR трудно назвать блочным шифром, он преобразует блочный шифр в потоковый, который принимает и отдает отдельные биты, не утруждая себя понятием блока. (Потоковые шифры подробно обсуждаются в главе 5.)

В режиме CTR (см. рис. 4.10) алгоритм блочного шифра не преобразует данные открытого текста. Вместо этого шифруются блоки, состоящие из счетчика и одноразового числа (nonce). Счетчик — это целое число, увеличивающееся на единицу для каждого блока. Никакие два блока одного сообщения не должны использовать одно и то же значение счетчика, но для разных сообщений возможны одинаковые последовательности значений счетчиков (1, 2, 3, ...). Одноразовое число, как следует из названия, можно использовать только один раз. Оно одинаково для всех блоков одного сообщения, но для разных сообщений одинаковые одноразовые числа не допускаются.

Как видно по рис. 4.10, в режиме CTR шифрование заключается в применении XOR к открытому тексту и потоку, полученному «шифрованием» одноразового числа \( N \) и счетчика \( Ctr \). Дешифрирование производится точно так же, поэтому для шифрования и дешифрирования нужен только алгоритм шифрования. Пример на Python приведен в листинге 4.6.