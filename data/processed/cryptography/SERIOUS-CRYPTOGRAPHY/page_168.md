---
source_image: page_168.png
page_number: 168
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 32.79
tokens: 7752
characters: 2315
timestamp: 2025-12-24T09:14:43.172896
finish_reason: stop
---

Однако не стоит волноваться: таких построений МАС в реальных приложениях вы не встретите. На самом деле многие реально встречающиеся или стандартизованные МАС являются также безопасными PRF и нередко используются в качестве шифров. Например, в TLS алгоритм HMAC-SHA-256 используется и как МАС, и как PRF.

Создание хешей с секретным ключом по хешам без ключа

На протяжении всей истории криптографии МАС и PRF редко проектировались с нуля, обычно они строятся на основе уже существующих алгоритмов, чаще всего хеш-функций блочных шифров. Один кажущийся очевидным способ построения хеш-функции с секретным ключом — подать на вход хеш-функции без ключа сообщение и ключ, но это проще сказать, чем сделать. Обсудим подробнее.

Построение секретного префикса

Для начала рассмотрим метод построения секретного префикса, который превращает обычную хеш-функцию в функцию с секретным ключом, для чего дописывает ключ в начало сообщения и возвращает Hash(K||M). Хотя этот подход не всегда дефектный, он может оказаться небезопасным, если хеш-функция уязвима к атаке удлинением сообщения (см. обсуждение в главе 6) или поддерживает ключи разной длины.

Небезопасность относительно атак удлинением сообщения

Напомним (см. главу 6), что хеш-функции из семейства SHA-2 позволяют противнику вычислить хеш частично неизвестного сообщения, зная хеш его укороченного варианта. Формально атака удлинением сообщения позволяет вычислить Hash(K||M_1||M_2), если известен только Hash(K||M_1), а M_1 и K неизвестны. Такие функции дают противнику возможность подделать действительно аутентификационные жетоны, потому что не предполагается, что они в состоянии угадать МАС конкатенации M_1||M_2, зная только МАС M_1. Из-за этого построение секретного префикса оказывается таким же небезопасным, как МАС и PRF, при использовании, например, с функциями хеширования SHA-256 или SHA-512. Сама возможность атак удлинением сообщения — слабость построения Меркла–Дамгора, финалисты конкурса на звание SHA-3 ее лишены. Способность противостоять атакам удлинением сообщения была одним из требований к SHA-3.

Небезопасность относительно ключей разной длины

Построение секретного префикса небезопасно также, если допускается использование ключей разной длины. Например, если ключ K — 24-битовая шестнадцатеричная строка 123abc, а M равно def00, то