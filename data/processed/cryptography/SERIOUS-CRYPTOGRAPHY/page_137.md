---
source_image: page_137.png
page_number: 137
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 30.44
tokens: 7676
characters: 1921
timestamp: 2025-12-24T09:13:45.475684
finish_reason: stop
---

static unsigned char S[256];
static int i=0, j=0;

void init(char *passphrase) {
    int passlen = strlen(passphrase);
    for (i=0; i<256; i++)
        S[i] = i;
    for (i=0; i<256; i++) {
        j = TOBYTE(j + S[TOBYTE(i)] + passphrase[j % passlen]);
        SWAP(S[TOBYTE(i)], S[j]);
    }
    i = 0; j = 0;
}

unsigned char encrypt_one_byte(unsigned char c) {
    int k;
    i = TOBYTE(i+1);
    j = TOBYTE(j + S[i]);
    SWAP(S[i], S[j]);
    k = TOBYTE(S[i] + S[j]);
    return c ^ S[k];
}

Теперь сделайте паузу и попытайтесь найти в листинге 5.5 проблему, связанную с обменом посредством XOR.

Беда происходит, когда i = j. Вместо того чтобы оставить состояние неизменным, обмен посредством XOR присваивает S[i] значение S[i] ⊕ S[i] = 0. В результате байт состояния будет обнулен каждый раз, как i оказывается равно j в алгоритме развертки ключа или в процессе шифрования, и в конечном итоге состояние, а значит, и гамма будут состоять из одних нулей. Например, после обработки 68 КБ данных большая часть байтов 256-байтового состояния равна нулю, а выходная гамма выглядит следующим образом:

00 00 00 00 00 00 00 00 53 53 00 00 00 00 00 00 00 00 00 00 00 00 13 13 00 5c 00 a5 00 00 ...

Урок такой — не нужно чрезмерно оптимизировать реализации криптографических алгоритмов. В криптографии понятность и уверенность всегда важнее производительности.

Слабые аппаратно реализованные шифры

Когда выясняется, что криптосистема небезопасна, некоторые системы способны быстро отреагировать, ненавязчиво обновив программное обеспечение дистанционно (как в некоторых системах платного телевидения) или выпустив новую версию и уведомив пользователей о необходимости выполнить обновление (как в случае мобильных приложений). Но старым системам не так повезло, и они вынуждены некоторое время работать со скомпрометированной криптосистемой до перехода на безопасную версию, как в случае некоторых спутниковых телефонов.