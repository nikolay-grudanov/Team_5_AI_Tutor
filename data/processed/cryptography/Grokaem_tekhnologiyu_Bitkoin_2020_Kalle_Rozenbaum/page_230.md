---
source_image: page_230.png
page_number: 230
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 43.22
tokens: 7719
characters: 1930
timestamp: 2025-12-24T08:36:59.342995
finish_reason: stop
---

230 Глава 6. Блокчейн

Проверка частичного дерева Меркла

Кошелек получает от полного узла заголовок блока, частичное дерево Меркла и транзакцию Tx_2. Это все, что ему нужно, чтобы убедиться, что Tx_2 действительно включена в блок. Далее кошелек должен проверить существование пути, «связывающего» Tx_2 с корнем дерева Меркла в заголовке блока. Сначала проверяется частичное дерево Меркла (рис. 6.28).

На каждом шаге (обход в глубину):
• Получить следующий флаг из списка.
• Если установлен флаг X или достигнут самый нижний уровень, использовать следующий хеш из списка и прекратить дальнейший спуск по дереву.

Эти хеши вычисляются, когда движение вниз завершится

Шаги
Описывает форму дерева
Неизвестны, не имеют значения

Отправляется в кошелек:
Число транзакций: 3
Флаги: √√X√X
Хеши:

Рис. 6.28. Кошелек проверяет частичное дерево Меркла

Исходя из количества транзакций (три), полученного от полного узла, выстраивается структура дерева Меркла. Кошелек знает, как выглядит дерево Меркла с тремя транзакциями.

Списки флагов и хешей используются, чтобы прикрепить хеши к дереву Меркла в порядке обхода в глубину, как показано ниже.

<table>
  <tr>
    <th>Шаг</th>
    <th>Следующий флаг в списке</th>
    <th>Оставшиеся флаги в списке</th>
    <th>Установлен флаг x или достигнут самый нижний уровень?</th>
    <th>Прикрепить хеш</th>
    <th>Список хешей</th>
  </tr>
  <tr>
    <td>1</td>
    <td>√</td>
    <td>√×√×</td>
    <td>Нет</td>
    <td>—</td>
    <td>3 4 5</td>
  </tr>
  <tr>
    <td>2</td>
    <td>√</td>
    <td>×√×</td>
    <td>Нет</td>
    <td>—</td>
    <td>3 4 5</td>
  </tr>
  <tr>
    <td>3</td>
    <td>×</td>
    <td>√×</td>
    <td>Да</td>
    <td>3</td>
    <td>4 5</td>
  </tr>
  <tr>
    <td>4</td>
    <td>√</td>
    <td>×</td>
    <td>Да</td>
    <td>4</td>
    <td>5</td>
  </tr>
  <tr>
    <td>5</td>
    <td>×</td>
    <td></td>
    <td>Да</td>
    <td>5</td>
    <td></td>
  </tr>
</table>