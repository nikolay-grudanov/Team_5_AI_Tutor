---
source_image: page_391.png
page_number: 391
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 29.18
tokens: 7547
characters: 1885
timestamp: 2025-12-24T08:41:11.690000
finish_reason: stop
---

Расширение языка сценариев — это сложно

Иногда возникает необходимость расширить язык сценариев новыми операциями. Например, в 2015 и 2016 годах в язык сценариев были введены операторы OP_CHECKSEQUENCEVERIFY (OP_CSV) и OP_CHECKLOCKTIMEVERIFY (OP_CLTV). Давайте посмотрим, как вводился оператор OP_CLTV.

Для начала разберемся, как выглядят операторы OP_ в сценариях. Каждый из них занимает единственный байт. Оператор OP_EQUAL, например, представлен байтом 87 в шестнадцатеричном виде. Каждый узел знает, что встретив байт 87 в сценарии, он должен снять два верхних элемента со стека, сравнить их и положить результат обратно на стек. OP_CHECKMULTISIG тоже занимает один байт, ае. Все операторы представлены разными байтами.

Когда создавалась система Биткоин, в языке сценариев было определено несколько операторов NOP: OP_NOP1 — OP_NOP10. Они представлены байтами b0 — b9. Их назначение — представлять ничего не делающие операции. Название NOP происходит от No OPeration (нет операции), что фактически означает: «когда появляется эта инструкция, пропустить ее и двигаться дальше».

Эти операторы NOP могут использоваться для расширения языка сценариев, но только до определенной степени. Оператор OP_CLTV на самом деле — это бывший OP_NOP2, представленный байтом b1. Оператор OP_CLTV был введен в обращение в очередном выпуске Bitcoin Core, переопределившем OP_NOP2. Но сделать это было необходимо совместимым способом, чтобы не нарушить работоспособность со старыми, не обновленными узлами.

Вернемся к примеру из раздела «Временная блокировка выходов по абсолютному значению» в главе 9, где вы заранее перевели деньги своей дочери, которые она могла потратить 1 мая (рис. 10.9).

Блокировка выхода до 1 мая

<table>
  <tr>
    <th>1</th>
    <th>1 на PKH<sub>D</sub> 1 мая<br>9 PKH<sub>Y</sub></th>
  </tr>
</table>

Рис. 10.9. Использование OP_CLTV для блокировки выхода до 1 мая