---
source_image: page_362.png
page_number: 362
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 33.53
tokens: 7566
characters: 1722
timestamp: 2025-12-24T08:40:26.396477
finish_reason: stop
---

и не выполнить свою часть сделки. По этой причине она не посылает свою транзакцию, пока не увидит, что транзакция Джона благополучно подтверждена в блокчейне. Джон, напротив, может отправить свою контрактную транзакцию, не опасаясь остаться без денег, потому что Фатима не знает секретного числа S.

Джон посылает свою контрактную транзакцию в сеть. Напомню, что выход его контрактной транзакции — это платеж на хеш сценария (pay-to-script-hash, p2sh). Проще говоря, выход содержит адрес p2sh, который ничего не говорит о том, что это выход контрактной транзакции Джона. Чтобы идентифицировать контрактную транзакцию Джона в блокчейне Биткоин, Фатима должна создать тот же сценарий погашения, что и в контрактной транзакции Джона, и сгенерировать адрес p2sh, на который контрактная транзакция Джона переводит деньги. Затем она сможет найти этот адрес p2sh в блокчейне Биткоин.

<table>
  <tr>
    <th>OP_IF</th>
    <td>OP_SHA256 <H> OP_EQUALVERIFY<br><b>Открытый ключ Фатимы</b></td>
  </tr>
  <tr>
    <th>OP_ELSE</th>
    <td><48h> OP_CHECKSEQUENCEVERIFY OP_DROP<br><b>Открытый ключ Джона</b></td>
  </tr>
  <tr>
    <th>OP_ENDIF</th>
    <td>OP_CHECKSIG</td>
  </tr>
</table>

Сценарий погашения Джона

SHA256+RIPEMD160

Кодирование base58check

Адрес p2sh

3HhgHhcBQfN2uPL7BFKPuosG4Pf7FvshCs

Когда Фатима обнаружит, что транзакция Джона подтверждена, она отправит свою контрактную транзакцию. Джон дождется, пока транзакция Фатимы получит достаточное количество подтверждений в блокчейне Namecoin. Затем в два этапа выполнится фактический обмен. На рис. 9.12 показан первый этап.

Джон посылает свою обменную транзакцию. Обменная транзакция Джона тратит выход контрактной транзакции Фатимы, предоставляя S и его под-