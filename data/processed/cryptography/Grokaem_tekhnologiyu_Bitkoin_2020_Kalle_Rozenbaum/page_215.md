---
source_image: page_215.png
page_number: 215
model: model-run-olm-ocr
prompt_type: olmocr_technical
processing_time: 41.79
tokens: 7630
characters: 2156
timestamp: 2025-12-24T08:36:35.083705
finish_reason: stop
---

Подробнее о том, как устанавливается соединение и как кошелек и узел пересылают информацию друг другу, мы поговорим в главе 8. Здесь я лишь кратко опишу следующие основные моменты:

1 Кошелек Джона запрашивает у полного узла все заголовки блоков, полученные после последнего заголовка известного кошельку, и все транзакции, имеющие отношение к адресам Джона.

2 Полный узел, действующий в кафе, отправляет все запрошенные заголовки блоков в кошелек и все транзакции, имеющие отношение к адресам Джона.

Выполняя шаг 1, кошелек не посылает точного списка адресов Джона. Это навредило бы конфиденциальности Джона, потому что тогда в кафе узнали бы все адреса, принадлежащие Джону, и могли бы продать эту информацию страховой компании Acme Insurances. Поэтому кошелек Джона отправляет полному узлу фильтр. Этот фильтр называется фильтром Блума (bloom filter). Используя его, полный узел определяет, какие транзакции следует отправить в кошелек. Согласно фильтру, полный узел посылает все транзакции, относящиеся к адресам @a и @b, а также транзакции, не имеющие отношения к кошельку Джона, благодаря чему маскируются адреса, на самом деле принадлежащие кошельку. Фильтры Блума не имеют ничего общего с блокчейном, но я все равно выделил для них отдельный подраздел, потому что они широко используются легкими кошельками.

На шаге 2 в кошелек Джона отправляются транзакции и заголовки блоков, но полные блоки не отправляются (для экономии сетевого трафика). Однако одних только транзакций и заголовков блоков недостаточно, чтобы кошелек Джона мог убедиться, что транзакция действительно присутствует в блоке. Требуется нечто большее: частичное дерево Меркла, которое доказывает, что одна или несколько транзакций действительно включены в блок.

Эти два шага выполняются как этап синхронизации сразу после подключения кошелька к полному узлу в кафе. После этого, по мере создания новых блоков Лизой, полный узел в кафе будет забирать их и отправлять соответствующие заголовки в кошелек вместе со всеми транзакциями, касающимися адресов Джона, как было описано выше.

Далее мы обсудим фильтры Блума. Деревья Меркла будут описаны ниже, в разделе «Деревья Меркла».