"""
Конфигурация AI-репетитора.

Модуль содержит все основные настройки приложения:
- параметры модели
- пути к файлам
- настройки RAG-подхода
"""

import os
from pathlib import Path

# ============================================================================
# ОСНОВНЫЕ ПУТИ
# ============================================================================
PROJECT_ROOT = Path(__file__).parent
DATA_DIR = PROJECT_ROOT / "data"
DOCUMENTS_DIR = DATA_DIR / "documents"
VECTOR_STORE_DIR = DATA_DIR / "vector_store"
MODELS_DIR = DATA_DIR / "models"

# Создание необходимых директорий
DATA_DIR.mkdir(exist_ok=True)
DOCUMENTS_DIR.mkdir(exist_ok=True)
VECTOR_STORE_DIR.mkdir(exist_ok=True)
MODELS_DIR.mkdir(exist_ok=True)

# ============================================================================
# ПАРАМЕТРЫ МОДЕЛИ И API
# ============================================================================

# Используемая LLM модель
LLM_MODEL = "gpt-2"  # Можно заменить на "gpt-3.5-turbo" при наличии API ключа

# API KEY для OpenAI (если используется)
OPENAI_API_KEY = os.getenv("OPENAI_API_KEY", "")

# Модель для создания эмбеддингов
EMBEDDING_MODEL = "sentence-transformers/all-MiniLM-L6-v2"

# Размер эмбедингов
EMBEDDING_DIMENSION = 384

# ============================================================================
# ПАРАМЕТРЫ RAG
# ============================================================================

# Количество релевантных документов для поиска
TOP_K_DOCUMENTS = 5

# Порог сходства для фильтрации документов
SIMILARITY_THRESHOLD = 0.3

# Максимальная длина контекста для модели
MAX_CONTEXT_LENGTH = 2000

# Максимальная длина генерируемого ответа
MAX_RESPONSE_LENGTH = 500

# ============================================================================
# ПАРАМЕТРЫ ВЕКТОРНОГО ХРАНИЛИЩА
# ============================================================================

# Размер батча для обработки документов
BATCH_SIZE = 32

# Расстояние для поиска (cosine, euclidean, ip)
METRIC_TYPE = "cosine"

# ============================================================================
# WEB ИНТЕРФЕЙС
# ============================================================================

# Хост для Flask приложения
HOST = "0.0.0.0"

# Порт приложения
PORT = 5000

# Режим отладки
DEBUG = True

# Максимальная длина вопроса пользователя
MAX_QUESTION_LENGTH = 1000

# ============================================================================
# ПРИМЕРЫ УЧЕБНЫХ МАТЕРИАЛОВ
# ============================================================================

# Примеры учебных материалов для инициализации
SAMPLE_MATERIALS = {
    "mathematics": """
    МАТЕМАТИКА - ОСНОВНЫЕ КОНЦЕПЦИИ
    
    1. АЛГЕБРА
    - Линейные уравнения: ax + b = 0
    - Квадратные уравнения: ax² + bx + c = 0
    - Дискриминант: D = b² - 4ac
    - Корни квадратного уравнения: x = (-b ± √D) / 2a
    
    2. ГЕОМЕТРИЯ
    - Теорема Пифагора: a² + b² = c²
    - Площадь треугольника: S = (a × h) / 2
    - Объем куба: V = a³
    - Площадь круга: S = πr²
    
    3. АНАЛИЗ
    - Производная функции: f'(x) = lim(h→0) (f(x+h) - f(x)) / h
    - Интеграл: ∫ f(x)dx
    - Правило цепи: (f(g(x)))' = f'(g(x)) × g'(x)
    """,
    
    "physics": """
    ФИЗИКА - КЛЮЧЕВЫЕ ФОРМУЛЫ
    
    1. МЕХАНИКА
    - Скорость: v = s / t
    - Ускорение: a = Δv / Δt
    - Сила: F = m × a (закон Ньютона)
    - Работа: W = F × s × cos(α)
    - Кинетическая энергия: E_k = (m × v²) / 2
    
    2. ТЕРМОДИНАМИКА
    - Температура абсолютная: T(K) = T(°C) + 273.15
    - Количество тепла: Q = m × c × ΔT
    - Первый закон термодинамики: ΔU = Q - W
    - Давление газа: P = (n × k × T) / V
    
    3. ЭЛЕКТРОМАГНЕТИЗМ
    - Закон Кулона: F = k × |q1 × q2| / r²
    - Электрическое поле: E = F / q
    - Потенциал: φ = W / q
    - Сила тока: I = Q / t
    """,
    
    "chemistry": """
    ХИМИЯ - ОСНОВНЫЕ ЗАКОНЫ
    
    1. СТЕХИОМЕТРИЯ
    - Молярная масса (M): M = m / n, г/моль
    - Число молекул: N = n × N_A
    - Молярный объем при нормальных условиях: V_m = 22.4 л/моль
    - Относительная молекулярная масса: M_r = Σ A_i
    
    2. ХИМИЧЕСКИЕ РЕАКЦИИ
    - Закон сохранения массы
    - Закон постоянства состава вещества
    - Закон кратных отношений
    - Уравнение реакции: aA + bB = cC + dD
    
    3. ЭЛЕКТРОЛИЗ
    - Законы Фарадея: m = (M × I × t) / (n × F)
    - Где F = 96500 Кл/моль (число Фарадея)
    - Степень окисления элемента
    """,
    
    "programming": """
    ПРОГРАММИРОВАНИЕ - ОСНОВЫ PYTHON
    
    1. БАЗОВЫЕ ТИПЫ ДАННЫХ
    - int: целые числа (1, -5, 0)
    - float: числа с плавающей точкой (3.14, -2.5)
    - str: строки ('hello', "world")
    - bool: логические значения (True, False)
    - list: списки [1, 2, 3]
    - dict: словари {'ключ': 'значение'}
    
    2. УСЛОВНЫЕ ОПЕРАТОРЫ
    - if условие: выполнить код
    - elif другое_условие: альтернатива
    - else: по умолчанию
    - Операторы сравнения: ==, !=, <, >, <=, >=
    
    3. ЦИКЛЫ
    - for переменная in последовательность: итерация
    - while условие: повторение
    - break: выход из цикла
    - continue: переход к следующей итерации
    
    4. ФУНКЦИИ
    - def имя_функции(параметры): определение
    - return значение: возврат результата
    - Аргументы позиционные и именованные
    """
}

# ============================================================================
# ЛОГИРОВАНИЕ
# ============================================================================

LOG_LEVEL = "INFO"
LOG_FILE = DATA_DIR / "app.log"

# ============================================================================
# ПАРАМЕТРЫ ТОКЕНИЗАЦИИ
# ============================================================================

# Минимальная длина документа для обработки
MIN_DOCUMENT_LENGTH = 50

# Максимальная длина документа (если больше, то разбивается на чанки)
MAX_CHUNK_LENGTH = 500

# Размер перекрытия между чанками
CHUNK_OVERLAP = 100
